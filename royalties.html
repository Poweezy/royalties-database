<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mining Royalties Manager</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"
    />
    <link rel="stylesheet" href="royalties.css" />
    <link rel="stylesheet" href="css/user-management-enhanced.css" />
    <link rel="stylesheet" href="css/contract-management-enhanced.css" />
    <link rel="stylesheet" href="css/gis-dashboard-enhanced.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-geometryutil@0.10.1/src/leaflet.geometryutil.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="js/bcrypt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module" src="js/utils/error-handler.js"></script>
    <script type="module" src="js/services/database.service.js"></script>
    <script type="module" src="js/services/auth.service.js"></script>
    <script type="module" src="js/modules/NotificationManager.js"></script>
    <script type="module" src="js/modules/ChartManager.js"></script>
    <script type="module" src="js/modules/FileManager.js"></script>
    <script type="module" src="js/modules/NavigationManager.js"></script>
    <script type="module" src="js/semantic-search.js"></script>
    <script type="module" src="js/user-form-validation.js"></script>
    <script type="module" src="js/modules/UserManager.js"></script>
    <script type="module" src="js/app.js"></script>
    <script>
      // Register Service Worker
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("js/service-worker.js")
            .then((registration) => {
              console.log("ServiceWorker registration successful");

              // Request notification permission
              if ("Notification" in window) {
                Notification.requestPermission();
              }

              // Subscribe to push notifications
              // Push notifications will be configured later
              if (false && "PushManager" in window) {
                // Disabled for now until we have proper VAPID keys
                /*registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: 'YOUR_PUBLIC_VAPID_KEY'
              });*/
              }
            })
            .catch((err) => {
              console.error("ServiceWorker registration failed:", err);
            });
        });
      }
    </script>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: flex;">
        <div class="loading-content">
            <div class="loading-logo">MR</div>
            <h2>Mining Royalties Manager</h2>
            <div class="spinner"></div>
            <p>Initializing Application...</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications-container" class="notifications-container"></div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Login Section -->
    <section class="login-section" id="login-section" style="display: none">
      <div class="login-container">
        <div class="login-header">
          <div class="login-logo" aria-label="Mining Royalties Manager Logo">
            MR
          </div>
          <h2>Mining Royalties Manager</h2>
          <p>Secure access to your royalty management system</p>
        </div>
        <form class="login-form" id="login-form">
          <div class="input-group">
            <i class="fas fa-user" aria-label="Username icon"></i>
            <input
              type="text"
              id="username"
              placeholder="Username"
              aria-describedby="username-error"
              autocomplete="username"
              required
            />
            <div
              class="validation-error"
              id="username-error"
              style="display: none"
            >
              Username is required
            </div>
          </div>
          <div class="input-group">
            <i class="fas fa-lock" aria-label="Password icon"></i>
            <input
              type="password"
              id="password"
              placeholder="Password"
              aria-describedby="password-error"
              autocomplete="current-password"
              required
            />
            <button
              type="button"
              class="password-toggle-btn"
              data-action="toggle-password"
              data-target="#password"
              aria-label="Toggle password visibility"
            >
              <i
                class="fas fa-eye"
                aria-label="Toggle password visibility icon"
              ></i>
            </button>
            <div
              class="validation-error"
              id="password-error"
              style="display: none"
            >
              Password is required
            </div>
          </div>
          <div class="login-options">
            <div class="remember-me-group">
              <label class="checkbox-label">
                <input type="checkbox" id="remember-me" />
                Remember Me
              </label>
            </div>
            <a href="#" id="forgot-password-link" class="forgot-password-link"
              >Forgot Password?</a
            >
          </div>
          <button type="submit" class="btn btn-primary btn-large">
            Sign In
          </button>
        </form>
        <div class="login-footer">
          <p>Please contact your administrator for credentials.</p>
        </div>
      </div>
    </section>


    <!-- Forgot Password Section -->
    <section
      class="forgot-password-section"
      id="forgot-password-section"
      style="display: none"
    >
      <div class="login-container">
        <div class="login-header">
          <div class="login-logo" aria-label="Mining Royalties Manager Logo">
            MR
          </div>
          <h2>Reset Password</h2>
          <p>Enter your email to receive a reset link</p>
        </div>
        <form class="forgot-password-form" id="forgot-password-form">
          <div class="input-group">
            <i class="fas fa-envelope" aria-label="Email icon"></i>
            <input
              type="email"
              id="reset-email"
              placeholder="Enter your email"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary btn-large">
            Send Reset Link
          </button>
        </form>
        <div class="login-footer">
          <p><a href="#" id="back-to-login-link">Back to Sign In</a></p>
        </div>
      </div>
    </section>

    <!-- Main App -->
    <div class="app-container" id="app-container" style="display: none">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo" aria-label="Mining Royalties Manager Logo">
            MR
          </div>
          <h2>Royalties Manager</h2>
        </div>
        <nav id="main-nav">
          <ul>
            <li>
              <a href="#dashboard" class="active"
                ><i class="fas fa-home" aria-label="Dashboard icon"></i>
                Dashboard</a
              >
            </li>
            <li>
              <a href="#gis-dashboard"
                ><i
                  class="fas fa-map-marked-alt"
                  aria-label="GIS Dashboard icon"
                ></i>
                GIS Dashboard</a
              >
            </li>
            <li>
              <a href="#user-management"
                ><i class="fas fa-users" aria-label="User Management icon"></i>
                User Management</a
              >
            </li>
            <li>
              <a href="#royalty-records"
                ><i
                  class="fas fa-file-invoice"
                  aria-label="Royalty Records icon"
                ></i>
                Royalty Records</a
              >
            </li>
            <li>
              <a href="#contract-management"
                ><i
                  class="fas fa-file-contract"
                  aria-label="Contract Management icon"
                ></i>
                Contract Management</a
              >
            </li>
            <li>
              <a href="#lease-management"
                ><i
                  class="fas fa-file-signature"
                  aria-label="Lease Management icon"
                ></i>
                Lease Management</a
              >
            </li>
            <li>
              <a href="#expense-tracking"
                ><i class="fas fa-coins" aria-label="Expense Tracking icon"></i>
                JIB / Expense Tracking</a
              >
            </li>
            <li>
              <a href="#document-management"
                ><i
                  class="fas fa-folder-open"
                  aria-label="Document Management icon"
                ></i>
                Document Management</a
              >
            </li>
            <li>
              <a href="#audit-dashboard"
                ><i
                  class="fas fa-shield-alt"
                  aria-label="Audit Dashboard icon"
                ></i>
                Audit Dashboard</a
              >
            </li>
            <li>
              <a href="#reporting-analytics"
                ><i
                  class="fas fa-chart-bar"
                  aria-label="Reporting & Analytics icon"
                ></i>
                Reporting & Analytics</a
              >
            </li>
            <li>
              <a href="#communication"
                ><i class="fas fa-envelope" aria-label="Communication icon"></i>
                Communication</a
              >
            </li>
            <li>
              <a href="#notifications"
                ><i class="fas fa-bell" aria-label="Notifications icon"></i>
                Notifications <span class="notification-badge">0</span></a
              >
            </li>
            <li>
              <a href="#compliance"
                ><i
                  class="fas fa-check-circle"
                  aria-label="Compliance & Regulatory icon"
                ></i>
                Compliance & Regulatory</a
              >
            </li>
            <li>
              <a href="#regulatory-management"
                ><i
                  class="fas fa-gavel"
                  aria-label="Regulatory Management icon"
                ></i>
                Regulatory Management</a
              >
            </li>
            <li>
              <a href="#semantic-search"
                ><i class="fas fa-search" aria-label="AI Search icon"></i> AI
                Search</a
              >
            </li>
            <li>
              <a href="#profile"
                ><i class="fas fa-user" aria-label="My Profile icon"></i> My
                Profile</a
              >
            </li>
            <li>
              <a href="#logout" class="logout-link"
                ><i class="fas fa-sign-out-alt" aria-label="Logout icon"></i>
                Logout</a
              >
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" style="display: block">
          <div class="page-header">
            <div class="page-title">
              <h1>Dashboard</h1>
              <p>
                Welcome back, <span id="user-name">System Administrator</span> |
                Last login: <span id="last-login-time">Today, 09:15 AM</span>
              </p>
            </div>
            <div class="page-actions">
              <div class="dashboard-controls">
                <label class="auto-refresh-toggle">
                  <input type="checkbox" id="auto-refresh-toggle" />
                  <span>Auto Refresh</span>
                </label>
                <span id="last-refresh-time" class="last-refresh"
                  >Last updated: Never</span
                >
              </div>
              <button
                class="btn btn-info"
                id="refresh-dashboard"
                title="Refresh dashboard data"
              >
                <i class="fas fa-sync-alt" aria-label="Refresh icon"></i>
                Refresh
              </button>
              <div class="dropdown">
                <button
                  class="btn btn-secondary dropdown-toggle"
                  type="button"
                  id="dashboardCustomize"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i class="fas fa-cog"></i> Customize
                </button>
                <div class="dropdown-menu" aria-labelledby="dashboardCustomize">
                  <button
                    class="dropdown-item"
                    data-action="switch-theme"
                    data-theme="light"
                  >
                    Light Theme
                  </button>
                  <button
                    class="dropdown-item"
                    data-action="switch-theme"
                    data-theme="dark"
                  >
                    Dark Theme
                  </button>
                  <div class="dropdown-divider"></div>
                  <button
                    class="dropdown-item"
                    data-action="toggle-widget"
                    data-widget="forecast"
                  >
                    Toggle Forecast
                  </button>
                  <button
                    class="dropdown-item"
                    data-action="toggle-widget"
                    data-widget="comparative"
                  >
                    Toggle Comparison
                  </button>
                </div>
              </div>
              <button
                class="btn btn-primary"
                id="admin-panel-btn"
                title="Access Admin Panel"
              >
                <i class="fas fa-cog" aria-label="Admin Panel icon"></i> Admin
                Panel
              </button>
              <button
                class="btn btn-secondary"
                id="notifications-btn"
                title="View Notifications"
              >
                <i class="fas fa-bell" aria-label="Notifications icon"></i>
                <span id="notifications-count">3</span>
              </button>
            </div>
          </div>

          <!-- Enhanced Key Performance Indicators -->
          <div class="charts-grid">
            <div class="metric-card card enhanced-kpi">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-coins live-indicator"
                    aria-label="Total Royalties icon"
                  ></i>
                  Total Royalties (YTD)
                </h3>
                <select class="metric-period" id="royalties-period">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="all">All Time</option>
                </select>
              </div>
              <div class="card-body">
                <div class="metric-main">
                  <p id="total-royalties">E 992,500.00</p>
                  <div class="trend-sparkline" id="royalties-sparkline"></div>
                </div>
                <div class="metric-details">
                  <small class="trend-indicator" id="royalties-trend">
                    <i
                      class="fas fa-arrow-up trend-positive"
                      aria-label="Upward trend icon"
                    ></i>
                    +15.8% from last year
                  </small>
                  <div class="metric-breakdown">
                    <span
                      >YoY Growth:
                      <strong id="royalties-yoy">+15.8%</strong></span
                    >
                    <span
                      >Forecast:
                      <strong id="royalties-forecast">E 1,200,000</strong></span
                    >
                  </div>
                </div>
                <div class="mini-progress">
                  <div
                    class="progress-bar"
                    id="royalties-progress"
                    style="width: 75%"
                  ></div>
                </div>
              </div>
            </div>

            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-industry"
                    aria-label="Active Entities icon"
                  ></i>
                  Active Entities
                </h3>
                <select class="metric-period" id="entities-period">
                  <option value="current">This Quarter</option>
                  <option value="last">Last Quarter</option>
                  <option value="ytd">YTD</option>
                </select>
              </div>
              <div class="card-body">
                <p id="active-entities">6</p>
                <small class="trend-indicator" id="entities-trend">
                  <i
                    class="fas fa-arrow-up trend-positive"
                    aria-label="Upward trend icon"
                  ></i>
                  +2 new this month
                </small>
                <div class="entities-breakdown">
                  <small>
                    <span class="entity-type"
                      >Mines: <span id="mines-count">2</span></span
                    >
                    |
                    <span class="entity-type"
                      >Quarries: <span id="quarries-count">4</span></span
                    >
                  </small>
                </div>
              </div>
            </div>

            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-check-circle"
                    aria-label="Compliance Rate icon"
                  ></i>
                  Compliance Rate
                </h3>
                <button
                  class="btn btn-sm btn-secondary"
                  id="compliance-details"
                  title="View compliance details"
                >
                  <i class="fas fa-info-circle" aria-label="Details icon"></i>
                </button>
              </div>
              <div class="card-body">
                <p id="compliance-rate">80%</p>
                <div class="collection-progress">
                  <div
                    class="progress-bar"
                    id="compliance-progress"
                    style="width: 80%"
                  ></div>
                </div>
                <small class="compliance-breakdown">
                  <span>Paid: <span id="paid-count">3</span></span> |
                  <span>Pending: <span id="pending-count">1</span></span> |
                  <span>Overdue: <span id="overdue-count">1</span></span>
                </small>
              </div>
            </div>

            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-clock"
                    aria-label="Pending Approvals icon"
                  ></i>
                  Pending Approvals
                </h3>
                <button
                  class="btn btn-sm btn-warning"
                  id="view-pending"
                  title="View pending items"
                >
                  <i class="fas fa-eye" aria-label="View icon"></i>
                </button>
              </div>
              <div class="card-body">
                <p id="pending-approvals">2</p>
                <small id="pending-urgency"
                  >1 urgent item requires attention</small
                >
                <div class="urgency-indicator">
                  <span
                    class="urgent-badge"
                    id="urgent-items"
                    style="display: inline-flex"
                  >
                    <i
                      class="fas fa-exclamation-triangle"
                      aria-label="Urgent items icon"
                    ></i>
                    <span id="urgent-count">1</span> Urgent
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Analytics Charts Section -->
          <div class="charts-grid">
            <div class="analytics-chart card">
              <div class="chart-header">
                <h3>
                  <i
                    class="fas fa-chart-line"
                    aria-label="Revenue Trends icon"
                  ></i>
                  Revenue Trends
                </h3>
                <div class="chart-controls">
                  <button
                    class="chart-btn active"
                    data-chart-type="line"
                    data-chart-id="revenue-trends-chart"
                  >
                    <i
                      class="fas fa-chart-line"
                      aria-label="Line chart icon"
                    ></i>
                    Line
                  </button>
                  <button
                    class="chart-btn"
                    data-chart-type="bar"
                    data-chart-id="revenue-trends-chart"
                  >
                    <i class="fas fa-chart-bar" aria-label="Bar chart icon"></i>
                    Bar
                  </button>
                  <button
                    class="chart-btn"
                    data-chart-type="area"
                    data-chart-id="revenue-trends-chart"
                  >
                    <i
                      class="fas fa-chart-area"
                      aria-label="Area chart icon"
                    ></i>
                    Area
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary export-chart-btn"
                    data-chart-id="revenue-trends-chart"
                  >
                    <i class="fas fa-download"></i> Export
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  id="revenue-trends-chart"
                  aria-label="Revenue trends chart showing monthly royalty collections"
                ></canvas>
              </div>
              <div class="chart-summary">
                <small>
                  <i class="fas fa-info-circle" aria-label="Info icon"></i>
                  Average monthly collection:
                  <strong>E <span id="avg-monthly">82,708</span></strong> | Peak
                  month:
                  <strong><span id="peak-month">January 2024</span></strong>
                </small>
              </div>
            </div>

            <div class="analytics-chart card">
              <div class="chart-header">
                <h3>
                  <i
                    class="fas fa-chart-pie"
                    aria-label="Production by Entity icon"
                  ></i>
                  Production by Entity
                </h3>
                <div class="chart-controls">
                  <button
                    class="chart-btn active"
                    data-chart-type="pie"
                    data-chart-id="production-by-entity-chart"
                  >
                    <i class="fas fa-chart-pie" aria-label="Pie chart icon"></i>
                    Pie
                  </button>
                  <button
                    class="chart-btn"
                    data-chart-type="doughnut"
                    data-chart-id="production-by-entity-chart"
                  >
                    <i
                      class="fas fa-circle-notch"
                      aria-label="Doughnut chart icon"
                    ></i>
                    Doughnut
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary export-chart-btn"
                    data-chart-id="production-by-entity-chart"
                  >
                    <i class="fas fa-download"></i> Export
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  id="production-by-entity-chart"
                  aria-label="Production volume breakdown by mining entity"
                ></canvas>
              </div>
              <div class="chart-summary">
                <small>
                  <i class="fas fa-info-circle" aria-label="Info icon"></i>
                  Total production:
                  <strong><span id="total-production">52,000</span> m³</strong>
                  | Top producer:
                  <strong><span id="top-producer">Kwalini Quarry</span></strong>
                </small>
              </div>
            </div>
          </div>

          <!-- Advanced Analytics Section -->
          <div class="charts-grid">
            <div class="analytics-chart card" id="compliance-widget">
              <div class="chart-header">
                <h3>
                  <i
                    class="fas fa-shield-check"
                    aria-label="Compliance Trends icon"
                  ></i>
                  Compliance Trends
                </h3>
                <div class="chart-controls">
                  <button
                    class="chart-btn active"
                    data-chart-type="bar"
                    data-chart-id="compliance-trends-chart"
                  >
                    <i class="fas fa-chart-bar" aria-label="Bar chart icon"></i>
                    Bar
                  </button>
                  <button
                    class="chart-btn"
                    data-chart-type="line"
                    data-chart-id="compliance-trends-chart"
                  >
                    <i
                      class="fas fa-chart-line"
                      aria-label="Line chart icon"
                    ></i>
                    Line
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary export-chart-btn"
                    data-chart-id="compliance-trends-chart"
                  >
                    <i class="fas fa-download"></i> Export
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  id="compliance-trends-chart"
                  aria-label="Compliance rate trends over time"
                ></canvas>
              </div>
              <div class="chart-summary">
                <small>
                  <i class="fas fa-info-circle" aria-label="Info icon"></i>
                  Average compliance: <strong>88.7%</strong> | Best month:
                  <strong>April (95%)</strong>
                </small>
              </div>
            </div>

            <div class="analytics-chart card" id="forecast-widget">
              <div class="chart-header">
                <h3>
                  <i
                    class="fas fa-crystal-ball"
                    aria-label="Revenue Forecast icon"
                  ></i>
                  Revenue Forecast
                </h3>
                <div class="chart-controls">
                  <button
                    class="chart-btn active"
                    data-chart-type="line"
                    data-chart-id="revenue-forecast-chart"
                  >
                    <i
                      class="fas fa-chart-line"
                      aria-label="Line chart icon"
                    ></i>
                    Line
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary export-chart-btn"
                    data-chart-id="revenue-forecast-chart"
                  >
                    <i class="fas fa-download"></i> Export
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  id="revenue-forecast-chart"
                  aria-label="Revenue forecast for upcoming months"
                ></canvas>
              </div>
              <div class="chart-summary">
                <small>
                  <i class="fas fa-info-circle" aria-label="Info icon"></i>
                  Next month forecast:
                  <strong id="next-month-forecast">E 1,050,000</strong> |
                  Confidence: <strong>85%</strong>
                </small>
              </div>
            </div>
          </div>

          <!-- Comparative Analytics -->
          <div class="charts-grid">
            <div class="analytics-chart card" id="comparative-widget">
              <div class="chart-header">
                <h3>
                  <i
                    class="fas fa-chart-bar"
                    aria-label="Year over Year Comparison icon"
                  ></i>
                  Year-over-Year Comparison
                </h3>
                <div class="chart-controls">
                  <button
                    class="chart-btn active"
                    data-chart-type="bar"
                    data-chart-id="comparative-chart"
                  >
                    <i class="fas fa-chart-bar" aria-label="Bar chart icon"></i>
                    Bar
                  </button>
                  <button
                    class="chart-btn"
                    data-chart-type="line"
                    data-chart-id="comparative-chart"
                  >
                    <i
                      class="fas fa-chart-line"
                      aria-label="Line chart icon"
                    ></i>
                    Line
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary export-chart-btn"
                    data-chart-id="comparative-chart"
                  >
                    <i class="fas fa-download"></i> Export
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  id="comparative-chart"
                  aria-label="Comparative analysis between years"
                ></canvas>
              </div>
              <div class="chart-summary">
                <small>
                  <i class="fas fa-info-circle" aria-label="Info icon"></i>
                  YTD Growth: <strong>+18.2%</strong> | Best performing month:
                  <strong>June (+15.4%)</strong>
                </small>
              </div>
            </div>

            <div class="metric-card card advanced-metrics">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-analytics"
                    aria-label="Advanced Metrics icon"
                  ></i>
                  Advanced Metrics
                </h3>
              </div>
              <div class="card-body">
                <div class="metrics-grid">
                  <div class="metric-item">
                    <h4>Revenue per Entity</h4>
                    <p id="revenue-per-entity">E 165,417</p>
                    <small>+8.5% from last month</small>
                  </div>
                  <div class="metric-item">
                    <h4>Production Efficiency</h4>
                    <p id="avg-production-efficiency">87.5%</p>
                    <small>+3.2% improvement</small>
                  </div>
                  <div class="metric-item">
                    <h4>Compliance Score</h4>
                    <p id="compliance-score">94.2%</p>
                    <small>+1.8% from last quarter</small>
                  </div>
                  <div class="metric-item">
                    <h4>Month-over-Month</h4>
                    <p id="month-over-month">+12.8%</p>
                    <small>Strong growth trend</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity & Quick Actions -->
          <div class="charts-grid">
            <div class="card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-history"
                    aria-label="Recent Activity icon"
                  ></i>
                  Recent Activity
                </h3>
                <button class="btn btn-sm btn-secondary" id="view-all-activity">
                  <i
                    class="fas fa-external-link-alt"
                    aria-label="View All icon"
                  ></i>
                  View All
                </button>
              </div>
              <div class="card-body">
                <div class="activity-list" id="recent-activity">
                  <div class="activity-item">
                    <div class="activity-icon">
                      <i
                        class="fas fa-plus-circle text-success"
                        aria-label="New item icon"
                      ></i>
                    </div>
                    <div class="activity-content">
                      <p>
                        <strong>New royalty record</strong> added for Kwalini
                        Quarry
                      </p>
                      <small>2 hours ago</small>
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-icon">
                      <i
                        class="fas fa-user-plus text-info"
                        aria-label="New user icon"
                      ></i>
                    </div>
                    <div class="activity-content">
                      <p><strong>New user</strong> finance.manager created</p>
                      <small>5 hours ago</small>
                    </div>
                  </div>
                  <div class="activity-item">
                    <div class="activity-icon">
                      <i
                        class="fas fa-file-alt text-warning"
                        aria-label="Report icon"
                      ></i>
                    </div>
                    <div class="activity-content">
                      <p><strong>Compliance report</strong> submitted to ERA</p>
                      <small>1 day ago</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-bolt" aria-label="Quick Actions icon"></i>
                  Quick Actions
                </h3>
              </div>
              <div class="card-body">
                <div class="quick-actions-grid">
                  <button
                    class="btn btn-success quick-action-btn"
                    id="add-royalty-record"
                  >
                    <i class="fas fa-plus" aria-label="Add icon"></i>
                    <span>Add Royalty Record</span>
                  </button>
                  <button
                    class="btn btn-info quick-action-btn"
                    id="generate-report"
                  >
                    <i class="fas fa-file-pdf" aria-label="PDF icon"></i>
                    <span>Generate Report</span>
                  </button>
                  <button
                    class="btn btn-warning quick-action-btn"
                    id="view-overdue"
                  >
                    <i
                      class="fas fa-exclamation-triangle"
                      aria-label="Overdue icon"
                    ></i>
                    <span>View Overdue</span>
                  </button>
                  <button
                    class="btn btn-primary quick-action-btn"
                    id="manage-users"
                  >
                    <i
                      class="fas fa-users-cog"
                      aria-label="Manage Users icon"
                    ></i>
                    <span>Manage Users</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Leaderboards -->
          <div class="charts-grid">
            <div class="card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-trophy" aria-label="Trophy icon"></i> Top 5
                  Performing Entities
                </h3>
              </div>
              <div class="card-body">
                <ol id="top-entities-list" class="leaderboard-list"></ol>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-exclamation-triangle"
                    aria-label="Warning icon"
                  ></i>
                  Entities with Overdue Payments
                </h3>
              </div>
              <div class="card-body">
                <ul id="overdue-entities-list" class="leaderboard-list"></ul>
              </div>
            </div>
          </div>

          <!-- System Status & Alerts -->
          <div class="charts-grid">
            <div class="card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-bell" aria-label="System Alerts icon"></i>
                  System Alerts
                </h3>
                <span class="alert-count" id="alert-count-badge">0</span>
              </div>
              <div class="card-body">
                <div class="alerts-container" id="system-alerts">
                  <div class="alert-item info">
                    <i class="fas fa-info-circle" aria-label="Info icon"></i>
                    <div class="alert-content">
                      <p>System running normally</p>
                      <small>All services operational</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-server" aria-label="System Status icon"></i>
                  System Status
                </h3>
                <span class="status-indicator online" id="system-status">
                  <i class="fas fa-circle" aria-label="Online status icon"></i>
                  Online
                </span>
              </div>
              <div class="card-body">
                <div class="system-metrics">
                  <div class="metric-row">
                    <span class="metric-label">Database:</span>
                    <span class="metric-value status-good" id="db-status">
                      <i
                        class="fas fa-circle"
                        aria-label="Connected status icon"
                      ></i>
                      Connected
                    </span>
                  </div>
                  <div class="metric-row">
                    <span class="metric-label">Last Backup:</span>
                    <span class="metric-value" id="last-backup"
                      >Today, 03:00 AM</span
                    >
                  </div>
                  <div class="metric-row">
                    <span class="metric-label">Active Sessions:</span>
                    <span class="metric-value" id="active-sessions"
                      >3 users</span
                    >
                  </div>
                  <div class="metric-row">
                    <span class="metric-label">Uptime:</span>
                    <span class="metric-value" id="system-uptime"
                      >7 days, 14 hours</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Entity Details Modal -->
        <div id="entity-details-modal" class="modal" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="entity-name">Entity Details</h3>
              <span class="close" data-action="close-modal">&times;</span>
            </div>
            <div class="modal-body" id="entity-details-content">
              <!-- Content will be dynamically populated -->
            </div>
          </div>
        </div>

        <!-- Admin Panel -->
        <section id="admin-panel" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Admin Panel</h1>
              <p>System configuration and administrative tools</p>
            </div>
          </div>

          <!-- Announcement Banner Form -->
          <div class="user-form-container">
            <h4>Announcement Banner</h4>
            <form id="announcement-form">
              <div class="form-group">
                <label for="announcement-message">Message</label>
                <input
                  type="text"
                  id="announcement-message"
                  placeholder="Enter announcement message"
                />
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  Update Banner
                </button>
              </div>
            </form>
          </div>

          <!-- Bulk Royalty Rate Update -->
          <div class="user-form-container">
            <h4>Bulk Royalty Rate Update</h4>
            <form id="bulk-royalty-update-form">
              <div class="grid-4">
                <div class="form-group">
                  <label for="bulk-mineral-select">Mineral</label>
                  <select id="bulk-mineral-select">
                    <option>All Minerals</option>
                    <option>Coal</option>
                    <option>Iron Ore</option>
                    <option>Gravel</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="bulk-new-rate">New Rate (E/m³)</label>
                  <input
                    type="number"
                    id="bulk-new-rate"
                    placeholder="New rate"
                  />
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  Apply Update
                </button>
              </div>
            </form>
          </div>

          <!-- Audit Log Viewer -->
          <div class="user-form-container">
            <h4>Audit Log</h4>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="admin-audit-log-tbody">
                  <!-- Audit log will be populated here -->
                </tbody>
              </table>
            </div>
            <div
              class="table-pagination"
              id="contract-management-pagination"
            ></div>
          </div>
        </section>

        <!-- GIS Dashboard -->
        <section id="gis-dashboard" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>GIS Dashboard</h1>
              <p>Geospatial overview of mining operations in Eswatini</p>
            </div>
          </div>
          <div class="user-form-container">
            <div id="map" style="height: 600px; width: 100%"></div>
          </div>
        </section>

        <!-- User Management -->
        <section id="user-management" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>User Management</h1>
              <p>
                Comprehensive user administration with role-based access
                control, security monitoring, and audit trails
              </p>
            </div>
            <div class="page-actions">
              <button
                class="btn btn-info"
                id="view-audit-btn"
                title="View detailed audit logs"
              >
                <i
                  class="fas fa-shield-alt"
                  aria-label="View Audit Log icon"
                ></i>
                View Audit Log
              </button>
              <button
                class="btn btn-primary"
                id="export-report-btn"
                title="Export user management report"
              >
                <i
                  class="fas fa-file-export"
                  aria-label="Export Report icon"
                ></i>
                Export Report
              </button>
              <button
                class="btn btn-success"
                id="add-user-btn"
                title="Add new user account"
              >
                <i class="fas fa-user-plus" aria-label="Add User icon"></i> Add
                User
              </button>
            </div>
          </div>

          <!-- User Management Metrics Dashboard -->
          <div class="charts-grid">
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-users" aria-label="Active Users icon"></i>
                  Active Users
                </h3>
                <select class="metric-period">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
              </div>
              <div class="card-body">
                <p id="active-users-count">3</p>
                <small
                  ><i
                    class="fas fa-circle text-success"
                    aria-label="Online status icon"
                  ></i>
                  Currently active and logged in</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-exclamation-triangle"
                    aria-label="Failed Logins icon"
                  ></i>
                  Failed Logins
                </h3>
                <select class="metric-period">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
              </div>
              <div class="card-body">
                <p id="failed-logins-count">0</p>
                <small
                  ><i
                    class="fas fa-shield-alt text-success"
                    aria-label="Security status icon"
                  ></i>
                  Security status: Normal</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-bell" aria-label="Security Alerts icon"></i>
                  Security Alerts
                </h3>
              </div>
              <div class="card-body">
                <p id="security-alerts-count">None</p>
                <small
                  ><i
                    class="fas fa-check-circle text-success"
                    aria-label="All systems secure icon"
                  ></i>
                  All systems secure</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-key"
                    aria-label="Password Compliance icon"
                  ></i>
                  Password Compliance
                </h3>
              </div>
              <div class="card-body">
                <p id="password-compliance-rate">100%</p>
                <small
                  ><i
                    class="fas fa-certificate text-success"
                    aria-label="Security standards icon"
                  ></i>
                  Meeting security standards</small
                >
                <div class="mini-progress">
                  <div
                    class="progress-bar"
                    style="width: 100%; background: var(--success-color)"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Add New User Form -->
          <div
            class="user-form-container"
            id="add-user-form-container"
            style="display: none"
          >
            <div class="section-header">
              <h4>
                <i class="fas fa-user-plus" aria-label="Add New User icon"></i>
                Add New User Account
              </h4>
              <div class="table-actions">
                <button
                  class="btn btn-secondary btn-sm"
                  id="close-add-user-form"
                  title="Close form"
                >
                  <i class="fas fa-times" aria-label="Close icon"></i> Close
                </button>
              </div>
            </div>

            <form id="add-user-form" novalidate>
              <div class="grid-4">
                <!-- Username Field -->
                <div class="form-group">
                  <label for="new-username">Username</label>
                  <input
                    type="text"
                    id="new-username"
                    name="new-username"
                    placeholder="Enter username"
                    aria-describedby="new-username-error"
                    autocomplete="username"
                  />
                  <div class="validation-error" id="new-username-error">
                    Username is required
                  </div>
                  <div class="validation-success" id="new-username-success">
                    Username is available
                  </div>
                </div>

                <!-- Email Field -->
                <div class="form-group">
                  <label for="new-email">Email Address</label>
                  <input
                    type="email"
                    id="new-email"
                    name="new-email"
                    placeholder="user@example.com"
                    aria-describedby="new-email-error"
                  />
                  <div class="validation-error" id="new-email-error">
                    Valid email is required
                  </div>
                  <div class="validation-success" id="new-email-success">
                    Email is valid
                  </div>
                </div>

                <!-- Role Field -->
                <div class="form-group">
                  <label for="new-role">Role</label>
                  <select
                    id="new-role"
                    name="new-role"
                    aria-describedby="new-role-error"
                  >
                    <option value="">Select Role</option>
                    <option value="Administrator">Administrator</option>
                    <option value="Editor">Editor</option>
                    <option value="Auditor">Auditor</option>
                    <option value="Finance Officer">Finance Officer</option>
                    <option value="Viewer">Viewer</option>
                  </select>
                  <div class="validation-error" id="new-role-error">
                    Role selection is required
                  </div>
                  <div class="validation-success" id="new-role-success">
                    Role selected
                  </div>
                </div>

                <!-- Department Field -->
                <div class="form-group">
                  <label for="new-department">Department</label>
                  <select
                    id="new-department"
                    name="new-department"
                    aria-describedby="new-department-error"
                  >
                    <option value="">Select Department</option>
                    <option value="Administration">Administration</option>
                    <option value="Finance">Finance</option>
                    <option value="Operations">Operations</option>
                    <option value="Audit & Compliance">
                      Audit & Compliance
                    </option>
                    <option value="Legal Affairs">Legal Affairs</option>
                  </select>
                  <div class="validation-error" id="new-department-error">
                    Department selection is required
                  </div>
                  <div class="validation-success" id="new-department-success">
                    Department selected
                  </div>
                </div>

                <!-- Password Field -->
                <div class="form-group">
                  <label for="new-password">Password</label>
                  <div class="password-input-container">
                    <input
                      type="password"
                      id="new-password"
                      placeholder="Enter secure password"
                      aria-describedby="new-password-error"
                      autocomplete="new-password"
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      data-action="toggle-password"
                      data-target="#new-password"
                      aria-label="Show password"
                    >
                      <i class="fas fa-eye" aria-label="Show password icon"></i>
                    </button>
                  </div>
                  <div class="validation-error" id="new-password-error">
                    Strong password is required
                  </div>
                  <div class="validation-success" id="new-password-success">
                    Password is secure
                  </div>
                  <div class="password-strength-meter">
                    <div class="strength-bar">
                      <div class="strength-bar-fill" style="width: 0%"></div>
                    </div>
                    <div class="strength-text">
                      Password Strength: Enter password
                    </div>
                  </div>
                </div>

                <!-- Confirm Password Field -->
                <div class="form-group">
                  <label for="confirm-password">Confirm Password</label>
                  <div class="password-input-container">
                    <input
                      type="password"
                      id="confirm-password"
                      placeholder="Confirm password"
                      aria-describedby="confirm-password-error"
                      autocomplete="new-password"
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      data-action="toggle-password"
                      data-target="#confirm-password"
                      aria-label="Show password"
                    >
                      <i class="fas fa-eye" aria-label="Show password icon"></i>
                    </button>
                  </div>
                  <div class="validation-error" id="confirm-password-error">
                    Passwords must match
                  </div>
                  <div class="validation-success" id="confirm-password-success">
                    Passwords match
                  </div>
                </div>

                <!-- Account Expiry Field -->
                <div class="form-group">
                  <label for="account-expires"
                    >Account Expires (Optional)</label
                  >
                  <input
                    type="date"
                    id="account-expires"
                    aria-describedby="account-expires-help"
                  />
                  <div class="form-help" id="account-expires-help">
                    <i class="fas fa-info-circle" aria-label="Info icon"></i>
                    Leave blank for no expiration
                  </div>
                </div>

                <!-- Additional Options -->
                <div class="form-group">
                  <label>Account Options</label>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="send-welcome-email" checked />
                      Send welcome email with login instructions
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox" id="force-password-change" />
                      Force password change on first login
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox" id="account-active" checked />
                      Account is active (can login immediately)
                    </label>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="cancel-add-user"
                >
                  <i class="fas fa-times" aria-label="Cancel icon"></i> Cancel
                </button>
                <button type="button" class="btn btn-warning" id="reset-form">
                  <i class="fas fa-undo" aria-label="Reset icon"></i> Reset Form
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  id="create-user-btn"
                  disabled
                >
                  <i class="fas fa-user-plus" aria-label="Create User icon"></i>
                  Create User
                </button>
              </div>
            </form>
          </div>

          <!-- User Accounts Management Table -->
          <div class="user-form-container">
            <div class="section-header">
              <h4>
                <i
                  class="fas fa-users-cog"
                  aria-label="User Accounts Management icon"
                ></i>
                User Accounts Management
              </h4>
              <div class="table-actions">
                <button
                  class="btn btn-secondary btn-sm"
                  id="refresh-users"
                  title="Refresh user list"
                >
                  <i class="fas fa-sync" aria-label="Refresh icon"></i> Refresh
                </button>
                <button
                  class="btn btn-info btn-sm"
                  id="export-users"
                  title="Export user list"
                >
                  <i class="fas fa-download" aria-label="Export icon"></i>
                  Export
                </button>
                <button
                  class="btn btn-primary btn-sm"
                  id="manage-roles-permissions"
                  title="Manage roles and permissions"
                >
                  <i
                    class="fas fa-users-cog"
                    aria-label="Manage roles icon"
                  ></i>
                  Manage Roles
                </button>
                <div
                  id="bulk-actions-container"
                  style="display: none; align-items: center; gap: 0.5rem"
                >
                  <select
                    id="bulk-action-status"
                    class="form-control form-control-sm"
                  >
                    <option value="">-- Change Status --</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Locked">Locked</option>
                  </select>
                  <button
                    class="btn btn-primary btn-sm"
                    id="bulk-apply-status-change"
                    title="Apply status change"
                  >
                    <i class="fas fa-check" aria-label="Apply icon"></i> Apply
                  </button>
                  <button
                    class="btn btn-info btn-sm"
                    id="bulk-assign-roles"
                    title="Assign roles to selected users"
                  >
                    <i
                      class="fas fa-user-tag"
                      aria-label="Assign roles icon"
                    ></i>
                    Assign Roles
                  </button>
                  <button
                    class="btn btn-warning btn-sm"
                    id="bulk-email-users"
                    title="Send email to selected users"
                  >
                    <i class="fas fa-envelope" aria-label="Email icon"></i>
                    Email Selected
                  </button>
                  <button
                    class="btn btn-success btn-sm"
                    id="bulk-export-selected"
                    title="Export selected users"
                  >
                    <i class="fas fa-download" aria-label="Export icon"></i>
                    Export Selected
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    id="bulk-delete-users"
                    title="Delete selected users"
                  >
                    <i class="fas fa-trash" aria-label="Delete icon"></i> Delete
                    Selected
                  </button>
                </div>

                <!-- Enhanced Bulk Operations Panel -->
                <div id="bulk-operations-panel-container">
                  <!-- This will be populated by the BulkOperationsPanel component -->
                </div>
              </div>
            </div>

            <!-- Advanced Filtering -->
            <div class="table-filters">
              <h6>
                <i class="fas fa-filter" aria-label="Filter icon"></i> Filter &
                Search Options
              </h6>
              <div class="grid-4">
                <!-- Search Users Component -->
                <div class="filter-component filter-search">
                  <div class="form-group">
                    <label for="filter-search">Search Users</label>
                    <input
                      type="text"
                      id="filter-search"
                      placeholder="Search by name, email, or username..."
                    />
                  </div>
                </div>

                <!-- Filter by Role Component -->
                <div class="filter-component filter-role">
                  <div class="form-group">
                    <label for="filter-role">Filter by Role</label>
                    <select id="filter-role">
                      <option value="">All Roles</option>
                      <option value="administrator">Administrator</option>
                      <option value="editor">Editor</option>
                      <option value="auditor">Auditor</option>
                      <option value="finance">Finance Officer</option>
                      <option value="viewer">Viewer</option>
                    </select>
                  </div>
                </div>

                <!-- Filter by Status Component -->
                <div class="filter-component filter-status">
                  <div class="form-group">
                    <label for="filter-status">Filter by Status</label>
                    <select id="filter-status">
                      <option value="">All Statuses</option>
                      <option value="active">Active</option>
                      <option value="inactive">Inactive</option>
                      <option value="locked">Locked</option>
                      <option value="expired">Expired</option>
                    </select>
                  </div>
                </div>

                <!-- Filter Actions Component -->
                <div class="filter-component filter-actions">
                  <div class="form-group filter-actions">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" id="apply-filters">
                      <i
                        class="fas fa-search"
                        aria-label="Apply Filters icon"
                      ></i>
                      Apply Filters
                    </button>
                    <button class="btn btn-secondary" id="clear-filters">
                      <i
                        class="fas fa-times"
                        aria-label="Clear Filters icon"
                      ></i>
                      Clear
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Users Data Table -->
            <div class="table-container">
              <table class="data-table" id="users-table">
                <thead>
                  <tr>
                    <th>
                      <input
                        type="checkbox"
                        id="select-all-users"
                        title="Select all users"
                      />
                    </th>
                    <th sortable data-sort="username">
                      Username
                      <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="email">
                      Email <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="role">
                      Role <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="department">
                      Department
                      <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="status">
                      Status <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="lastLogin">
                      Last Login
                      <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th sortable data-sort="created">
                      Created <i class="fas fa-sort" aria-label="Sort icon"></i>
                    </th>
                    <th>2FA</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-tbody">
                  <!-- Users will be populated here by JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="table-pagination" id="users-pagination"></div>
          </div>

          <!-- Security Audit Log -->
          <div class="user-form-container">
            <div class="section-header">
              <h4>
                <i
                  class="fas fa-shield-alt"
                  aria-label="Security Audit Log icon"
                ></i>
                Security Audit Log & Activity Monitoring
              </h4>
              <div class="table-actions">
                <button
                  class="btn btn-secondary btn-sm"
                  id="refresh-audit-log"
                  title="Refresh audit log"
                >
                  <i class="fas fa-sync" aria-label="Refresh icon"></i> Refresh
                </button>
                <button
                  class="btn btn-info btn-sm"
                  id="export-audit-log"
                  title="Export audit log"
                >
                  <i class="fas fa-download" aria-label="Export icon"></i>
                  Export
                </button>
                <button
                  class="btn btn-warning btn-sm"
                  id="clear-audit-log"
                  title="Clear old audit entries"
                >
                  <i class="fas fa-broom" aria-label="Clear icon"></i> Clear Old
                  Entries
                </button>
              </div>
            </div>

            <!-- Audit Log Filters -->
            <div class="table-filters">
              <h6>
                <i class="fas fa-search" aria-label="Search icon"></i> Audit Log
                Search & Filters
              </h6>
              <div class="grid-4">
                <div class="form-group">
                  <label for="audit-filter-user">Filter by User</label>
                  <select id="audit-filter-user">
                    <option value="">All Users</option>
                    <option value="admin">admin</option>
                    <option value="j.doe">j.doe</option>
                    <option value="m.smith">m.smith</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="audit-filter-action">Filter by Action</label>
                  <select id="audit-filter-action">
                    <option value="">All Actions</option>
                    <option value="login">Login</option>
                    <option value="logout">Logout</option>
                    <option value="failed-login">Failed Login</option>
                    <option value="create-user">Create User</option>
                    <option value="modify-user">Modify User</option>
                    <option value="delete-user">Delete User</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="audit-filter-date">Date Range</label>
                  <select id="audit-filter-date">
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="custom">Custom Range</option>
                  </select>
                </div>

                <div class="filter-component filter-actions">
                  <div class="form-group filter-actions">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" id="apply-audit-filters">
                      <i class="fas fa-search" aria-label="Apply icon"></i>
                      Apply
                    </button>
                    <button class="btn btn-secondary" id="clear-audit-filters">
                      <i class="fas fa-times" aria-label="Clear icon"></i> Clear
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Audit Log Table -->
            <div class="table-container">
              <table class="data-table" id="audit-log-table">
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>IP Address</th>
                    <th>User Agent</th>
                    <th>Status</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="audit-log-tbody"></tbody>
              </table>
            </div>
            <div class="table-pagination" id="audit-pagination"></div>
          </div>
        </section>

        <!-- Royalty Records -->
        <section id="royalty-records" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Royalty Records</h1>
              <p>Manage and review all royalty payments</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success">Record Payment</button>
            </div>
          </div>
          <div class="user-form-container">
            <h4>Record Royalty Payment</h4>
            <div class="grid-4">
              <div class="form-group">
                <label for="entity">Entity</label>
                <select id="entity" aria-describedby="entity-validation">
                  <option>Select Entity</option>
                  <option>Kwalini Quarry</option>
                  <option>Mbabane Quarry</option>
                  <option>Sidvokodvo Quarry</option>
                  <option>Maloma Colliery</option>
                  <option>Ngwenya Mine</option>
                  <option>Malolotja Mine</option>
                </select>
                <div class="validation-error" id="entity-validation">
                  Entity is required
                </div>
              </div>
              <div class="form-group">
                <label for="mineral">Mineral</label>
                <select id="mineral" aria-describedby="mineral-validation">
                  <option>Select Mineral</option>
                  <option>Coal</option>
                  <option>Iron Ore</option>
                  <option>Green Chert</option>
                  <option>Gravel</option>
                  <option>River Sand</option>
                  <option>Plaster Sand</option>
                  <option>Quarried Stone</option>
                </select>
                <div class="validation-error" id="mineral-validation">
                  Mineral is required
                </div>
              </div>
              <div class="form-group">
                <label for="volume">Volume (m³)</label>
                <input
                  type="number"
                  id="volume"
                  placeholder="Volume (m³)"
                  aria-describedby="volume-validation"
                />
                <div class="validation-error" id="volume-validation">
                  Volume must be a positive number
                </div>
              </div>
              <div class="form-group">
                <label for="tariff">Royalty Tariff (E/m³)</label>
                <input
                  type="number"
                  id="tariff"
                  placeholder="Tariff (E/m³)"
                  aria-describedby="tariff-validation"
                />
                <div class="validation-error" id="tariff-validation">
                  Tariff must be a positive number
                </div>
              </div>
              <div class="form-group">
                <label for="payment-date">Date</label>
                <input
                  type="date"
                  id="payment-date"
                  aria-describedby="date-validation"
                />
                <div class="validation-error" id="date-validation">
                  Date is required
                </div>
              </div>
            </div>
            <div class="form-actions">
              <button class="btn btn-success" id="save-royalty-btn">
                Save Royalty
              </button>
            </div>
          </div>
          <div class="user-form-container">
            <h4>Royalty Records Table</h4>
            <div class="grid-4">
              <div class="form-group">
                <label for="filter-entity">Entity</label>
                <select id="filter-entity">
                  <option>All Entities</option>
                  <option>Kwalini Quarry</option>
                  <option>Mbabane Quarry</option>
                  <option>Sidvokodvo Quarry</option>
                  <option>Maloma Colliery</option>
                  <option>Ngwenya Mine</option>
                  <option>Malolotja Mine</option>
                </select>
              </div>
              <div class="form-group">
                <button class="btn btn-primary" id="apply-royalty-filters-btn">
                  Apply Filters
                </button>
                <button
                  class="btn btn-secondary"
                  id="export-royalty-report-btn"
                >
                  Export Report
                </button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Entity</th>
                    <th>Mineral</th>
                    <th>Volume (m³)</th>
                    <th>Tariff (E/m³)</th>
                    <th>Royalties (E)</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="royalty-records-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Enhanced Contract Management -->
        <section id="contract-management" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Enhanced Contract Management</h1>
              <p>Advanced contract authoring, workflow, and analytics</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-info" id="contract-analytics-btn">
                <i class="fas fa-chart-pie"></i> View Analytics
              </button>
              <button class="btn btn-primary" id="compare-contracts-btn">
                <i class="fas fa-balance-scale"></i> Compare Contracts
              </button>
              <button class="btn btn-success" id="add-contract-btn">
                <i class="fas fa-plus"></i> Create Contract
              </button>
            </div>
          </div>

          <!-- Contract List -->
          <div class="user-form-container">
             <div class="section-header">
                <h4><i class="fas fa-file-contract"></i> All Contracts</h4>
             </div>
             <div class="table-filters">
                <div class="form-group">
                    <label for="contract-filter-search">Search Contracts</label>
                    <input type="text" id="contract-filter-search" placeholder="Search by entity, mineral, or status...">
                </div>
             </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th sortable data-sort="id">ID</th>
                    <th sortable data-sort="entity">Entity</th>
                    <th sortable data-sort="mineral">Mineral</th>
                    <th sortable data-sort="status">Status</th>
                    <th sortable data-sort="startDate">Start Date</th>
                    <th sortable data-sort="endDate">End Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="contract-management-table-body">
                  <!-- Enhanced contract rows will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
            <div class="table-pagination" id="contract-management-pagination"></div>
          </div>

           <!-- Contract Details View -->
          <div id="contract-details-view" class="user-form-container" style="display: none;">
                <div class="section-header">
                    <h4><i class="fas fa-file-alt"></i> Contract Details</h4>
                    <div class="table-actions">
                         <button class="btn btn-secondary btn-sm" id="close-details-view-btn"><i class="fas fa-times"></i> Close</button>
                    </div>
                </div>
                <div id="contract-details-content"></div>
          </div>
        </section>

        <!-- Modal for Adding/Editing Contracts (Enhanced) -->
        <div id="add-contract-modal" class="modal" style="display: none">
          <div class="modal-content large">
            <div class="modal-header">
              <h4 id="contract-modal-title">Create New Contract</h4>
              <button id="close-add-contract-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
              <form id="add-contract-form" novalidate>
                 <input type="hidden" id="contract-id" />
                 <!-- Step 1: Template Selection -->
                 <div id="contract-step-1">
                    <h5>Step 1: Choose a Contract Template</h5>
                    <div class="form-group">
                        <label for="contract-template">Select Template</label>
                        <select id="contract-template" required>
                            <option value="">Start from scratch</option>
                            <!-- Templates will be populated here -->
                        </select>
                    </div>
                 </div>
                 <hr>
                 <!-- Step 2: Core Details -->
                 <div id="contract-step-2">
                    <h5>Step 2: Core Contract Details</h5>
                    <div class="grid-4">
                        <div class="form-group">
                            <label for="contract-entity">Entity</label>
                            <input type="text" id="contract-entity" placeholder="e.g., Kwalini Quarry" required />
                        </div>
                        <div class="form-group">
                            <label for="contract-mineral">Mineral</label>
                            <input type="text" id="contract-mineral" placeholder="e.g., Coal" required />
                        </div>
                         <div class="form-group">
                            <label for="start-date">Start Date</label>
                            <input type="date" id="start-date" required />
                        </div>
                        <div class="form-group">
                            <label for="end-date">End Date</label>
                            <input type="date" id="end-date" />
                        </div>
                    </div>
                 </div>
                 <hr>
                 <!-- Step 3: Terms and Conditions -->
                 <div id="contract-step-3">
                    <h5>Step 3: Royalty Terms & Conditions</h5>
                     <div class="grid-4">
                        <div class="form-group">
                            <label for="calculation-type">Calculation Type</label>
                            <select id="calculation-type">
                                <option value="fixed">Fixed Rate</option>
                                <option value="sliding_scale">Sliding Scale</option>
                                <option value="ad_valorem">Ad Valorem</option>
                            </select>
                        </div>
                        <div id="calculation-params-container" class="form-group grid-4">
                            <!-- Dynamic fields for calculation params -->
                        </div>
                     </div>
                 </div>
                 <hr>
                 <!-- Step 4: Document Upload -->
                 <div id="contract-step-4">
                    <h5>Step 4: Attach Documents</h5>
                     <div class="form-group">
                        <label for="contract-document-upload">Upload Contract Document</label>
                        <input type="file" id="contract-document-upload" />
                     </div>
                 </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" id="cancel-add-contract-btn" class="btn btn-secondary">Cancel</button>
              <button type="submit" id="save-contract-btn" class="btn btn-success" form="add-contract-form">Save Contract</button>
            </div>
          </div>
        </div>

        <!-- Contract Analytics Modal -->
        <div id="contract-analytics-modal" class="modal" style="display: none;">
            <div class="modal-content large">
                <div class="modal-header">
                    <h4>Contract Analytics</h4>
                    <button id="close-analytics-modal-btn" class="close-btn">&times;</button>
                </div>
                <div class="modal-body" id="contract-analytics-content">
                    <!-- Analytics content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Lease Management -->
        <section id="lease-management" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Enhanced Lease Management</h1>
              <p>Advanced lease tracking, document management, and alerts</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success" id="add-lease-btn">
                <i class="fas fa-plus"></i> Create Lease
              </button>
            </div>
          </div>

          <!-- Lease List -->
          <div class="user-form-container">
             <div class="section-header">
                <h4><i class="fas fa-file-signature"></i> All Leases</h4>
             </div>
             <div class="table-filters">
                <div class="form-group">
                    <label for="lease-filter-search">Search Leases</label>
                    <input type="text" id="lease-filter-search" placeholder="Search by entity, type, or status...">
                </div>
             </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th sortable data-sort="id">ID</th>
                    <th sortable data-sort="entity">Entity</th>
                    <th sortable data-sort="type">Type</th>
                    <th sortable data-sort="status">Status</th>
                    <th sortable data-sort="startDate">Start Date</th>
                    <th sortable data-sort="endDate">End Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="lease-management-table-body">
                </tbody>
              </table>
            </div>
            <div class="table-pagination" id="lease-management-pagination"></div>
          </div>

           <!-- Lease Details View -->
          <div id="lease-details-view" class="user-form-container" style="display: none;">
                <div class="section-header">
                    <h4><i class="fas fa-file-alt"></i> Lease Details</h4>
                    <div class="table-actions">
                         <button class="btn btn-secondary btn-sm" id="close-lease-details-view-btn"><i class="fas fa-times"></i> Close</button>
                    </div>
                </div>
                <div id="lease-details-content"></div>
          </div>
        </section>

        <!-- Modal for Adding/Editing Leases (Enhanced) -->
        <div id="add-lease-modal" class="modal" style="display: none">
          <div class="modal-content large">
            <div class="modal-header">
              <h4 id="lease-modal-title">Create New Lease</h4>
              <button id="close-add-lease-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
              <form id="add-lease-form" novalidate>
                 <input type="hidden" id="lease-id" />
                 <div class="grid-4">
                    <div class="form-group">
                        <label for="lease-entity">Entity</label>
                        <input type="text" id="lease-entity" placeholder="e.g., Maloma Colliery" required />
                    </div>
                    <div class="form-group">
                        <label for="lease-type">Lease Type</label>
                        <select id="lease-type">
                            <option value="Land">Land</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="lease-start-date">Start Date</label>
                        <input type="date" id="lease-start-date" required />
                    </div>
                    <div class="form-group">
                        <label for="lease-end-date">End Date</label>
                        <input type="date" id="lease-end-date" />
                    </div>
                 </div>
                 <hr>
                 <h5>Attach Documents</h5>
                 <div class="form-group">
                    <label for="lease-document-upload">Upload Lease Agreement</label>
                    <input type="file" id="lease-document-upload" />
                 </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" id="cancel-add-lease-btn" class="btn btn-secondary">Cancel</button>
              <button type="submit" id="save-lease-btn" class="btn btn-success" form="add-lease-form">Save Lease</button>
            </div>
          </div>
        </div>

        <!-- JIB / Expense Tracking -->
        <section id="expense-tracking" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>JIB / Expense Tracking</h1>
              <p>
                Manage Joint Interest Billing and other operational expenses.
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success" id="add-expense-btn">
                Add Expense
              </button>
            </div>
          </div>
          <div class="user-form-container">
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Entity</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="expense-tracking-table-body">
                  <!-- Expense rows will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
            <div
              class="table-pagination"
              id="expense-tracking-pagination"
            ></div>
          </div>
        </section>

        <!-- Modal for Adding Expenses -->
        <div id="add-expense-modal" class="modal" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h4>Add New Expense</h4>
              <button id="close-add-expense-modal-btn" class="close-btn">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <form id="add-expense-form" novalidate>
                <div class="form-group">
                  <label for="expense-date">Date</label>
                  <input type="date" id="expense-date" required />
                </div>
                <div class="form-group">
                  <label for="expense-category">Category</label>
                  <select id="expense-category" required>
                    <option value="">Select Category</option>
                    <option value="Operational">Operational</option>
                    <option value="Capital">Capital</option>
                    <option value="Administrative">Administrative</option>
                    <option value="JIB">JIB</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="expense-description">Description</label>
                  <input
                    type="text"
                    id="expense-description"
                    placeholder="e.g., Fuel for machinery"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="expense-amount">Amount (E)</label>
                  <input
                    type="number"
                    id="expense-amount"
                    placeholder="0.00"
                    step="0.01"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="expense-entity">Associated Entity</label>
                  <select id="expense-entity" required>
                    <option value="">Select Entity</option>
                    <option>Kwalini Quarry</option>
                    <option>Mbabane Quarry</option>
                    <option>Sidvokodvo Quarry</option>
                    <option>Maloma Colliery</option>
                    <option>Ngwenya Mine</option>
                    <option>Malolotja Mine</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                id="cancel-add-expense-btn"
                class="btn btn-secondary"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="save-expense-btn"
                class="btn btn-success"
                form="add-expense-form"
              >
                Save Expense
              </button>
            </div>
          </div>
        </div>

        <!-- Document Management -->
        <section id="document-management" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Document Management</h1>
              <p>Upload, store, and manage all relevant documents.</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success" id="upload-document-btn">
                Upload Document
              </button>
            </div>
          </div>
          <div class="user-form-container">
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Filename</th>
                    <th>Category</th>
                    <th>Uploaded By</th>
                    <th>Upload Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="document-management-table-body">
                  <!-- Document rows will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
            <div
              class="table-pagination"
              id="document-management-pagination"
            ></div>
          </div>
        </section>

        <!-- Modal for Uploading Documents -->
        <div id="upload-document-modal" class="modal" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h4>Upload New Document</h4>
              <button id="close-upload-document-modal-btn" class="close-btn">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <form id="upload-document-form" novalidate>
                <div class="form-group">
                  <label for="document-file">Select File</label>
                  <input type="file" id="document-file" required />
                </div>
                <div class="form-group">
                  <label for="document-category">Category</label>
                  <select id="document-category" required>
                    <option value="">Select Category</option>
                    <option value="Contract">Contract</option>
                    <option value="Lease Agreement">Lease Agreement</option>
                    <option value="Compliance Report">Compliance Report</option>
                    <option value="Financial Statement">
                      Financial Statement
                    </option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                id="cancel-upload-document-btn"
                class="btn btn-secondary"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="btn btn-success"
                form="upload-document-form"
              >
                Upload
              </button>
            </div>
          </div>
        </div>

        <!-- Audit Dashboard -->
        <section id="audit-dashboard" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Audit Dashboard</h1>
              <p>Review discrepancies and audit reports</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary">Export Report</button>
            </div>
          </div>
          <div class="user-form-container">
            <div class="grid-4">
              <div class="form-group">
                <label for="audit-filter-entity">Entity</label>
                <select id="audit-filter-entity">
                  <option>All Entities</option>
                  <option>Kwalini Quarry</option>
                  <option>Mbabane Quarry</option>
                  <option>Sidvokodvo Quarry</option>
                  <option>Maloma Colliery</option>
                  <option>Ngwenya Mine</option>
                  <option>Malolotja Mine</option>
                </select>
              </div>
              <div class="form-group">
                <button class="btn btn-primary">Apply Filters</button>
              </div>
            </div>
            <h4>Discrepancies</h4>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Project</th>
                    <th>Mineral</th>
                    <th>Declared (m³)</th>
                    <th>Verified (m³)</th>
                    <th>Outstanding (E)</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Sidvokodvo Quarry</td>
                    <td>Gravel</td>
                    <td>1,250</td>
                    <td>1,320</td>
                    <td>E1,050.00</td>
                    <td>
                      <span class="status-badge warning">Under Review</span>
                    </td>
                  </tr>
                  <tr>
                    <td>Ngwenya Mine</td>
                    <td>Iron Ore</td>
                    <td>2,150</td>
                    <td>2,080</td>
                    <td>E-1,750.00</td>
                    <td><span class="status-badge success">Resolved</span></td>
                  </tr>
                  <tr>
                    <td>Malolotja Mine</td>
                    <td>Coal</td>
                    <td>980</td>
                    <td>1,100</td>
                    <td>E3,000.00</td>
                    <td><span class="status-badge danger">Critical</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Reporting & Analytics -->
        <section id="reporting-analytics" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Reporting & Analytics</h1>
              <p>
                Comprehensive reporting, real-time analytics, and KPI dashboards
                for stakeholder insights
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary">Export Dashboard</button>
              <button class="btn btn-primary">Schedule Report</button>
              <button class="btn btn-success">Generate Report</button>
            </div>
          </div>
          <div class="charts-grid">
            <div class="metric-card card">
              <div class="card-header">
                <h3>Total Revenue (YTD)</h3>
                <select class="metric-period">
                  <option>2024</option>
                  <option>2023</option>
                  <option>All Time</option>
                </select>
              </div>
              <div class="card-body">
                <p>E 2,847,650.00</p>
                <small class="trend-positive">+15.8% from last year</small>
                <div class="mini-chart">Trend</div>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>Production Volume</h3>
                <select class="metric-period">
                  <option>This Quarter</option>
                  <option>Last Quarter</option>
                  <option>YTD</option>
                </select>
              </div>
              <div class="card-body">
                <p>485,250 m³</p>
                <small class="trend-positive">+08.2% from last quarter</small>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>Collection Rate</h3>
              </div>
              <div class="card-body">
                <p>96.5%</p>
                <small>Maintained high collection rate</small>
                <div class="collection-progress">
                  <div class="progress-bar" style="width: 96.5%"></div>
                </div>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>Outstanding Amounts</h3>
              </div>
              <div class="card-body">
                <p>E 125,400.00</p>
                <small>3 entities with overdue payments</small>
                <button class="btn btn-primary btn-sm">View Details</button>
              </div>
            </div>
          </div>
          <div class="user-form-container">
            <div class="report-tabs">
              <button class="tab-btn active" data-tab="#quick-reports">
                Quick Reports
              </button>
              <button class="tab-btn" data-tab="#custom-reports">
                Custom Reports
              </button>
              <button class="tab-btn" data-tab="#scheduled-reports">
                Scheduled Reports
              </button>
              <button class="btn tab-btn" data-tab="#audit-trail-reports">
                Audit Trail Reports
              </button>
            </div>
            <div class="tab-content active" id="quick-reports">
              <div class="quick-reports-grid">
                <div class="report-card">
                  <div class="report-icon">📊</div>
                  <div class="report-info">
                    <h5>Monthly Royalty Summary</h5>
                    <p>
                      Comprehensive overview of all royalty payments for the
                      current month
                    </p>
                    <div class="report-meta">
                      <span
                        ><i class="fas fa-clock" aria-label="Time icon"></i> 2-3
                        minutes</span
                      >
                      <span
                        ><i class="fas fa-file-pdf" aria-label="PDF icon"></i>
                        PDF</span
                      >
                    </div>
                  </div>
                  <button class="btn btn-primary">Generate</button>
                </div>
                <div class="report-card">
                  <div class="report-icon">📈</div>
                  <div class="report-info">
                    <h5>Entity Performance Analysis</h5>
                    <p>Production and payment metrics by mining entity</p>
                    <div class="report-meta">
                      <span
                        ><i class="fas fa-clock" aria-label="Time icon"></i> 3-5
                        minutes</span
                      >
                      <span
                        ><i
                          class="fas fa-file-excel"
                          aria-label="Excel icon"
                        ></i>
                        Excel</span
                      >
                    </div>
                  </div>
                  <button class="btn btn-primary">Generate</button>
                </div>
                <div class="report-card">
                  <div class="report-icon">📋</div>
                  <div class="report-info">
                    <h5>Compliance Status Report</h5>
                    <p>
                      Current compliance standings and upcoming requirements
                    </p>
                    <div class="report-meta">
                      <span
                        ><i class="fas fa-clock" aria-label="Time icon"></i> 1-2
                        minutes</span
                      >
                      <span
                        ><i class="fas fa-file-pdf" aria-label="PDF icon"></i>
                        PDF</span
                      >
                    </div>
                  </div>
                  <button class="btn btn-primary">Generate</button>
                </div>
                <div class="report-card">
                  <div class="report-icon">💰</div>
                  <div class="report-info">
                    <h5>Outstanding Payments</h5>
                    <p>Detailed breakdown of overdue and pending payments</p>
                    <div class="report-meta">
                      <span
                        ><i class="fas fa-clock" aria-label="Time icon"></i> 1
                        minute</span
                      >
                      <span
                        ><i class="fas fa-file-csv" aria-label="CSV icon"></i>
                        CSV</span
                      >
                    </div>
                  </div>
                  <button class="btn btn-primary">Generate</button>
                </div>
              </div>
            </div>
            <div class="tab-content" id="custom-reports">
              <div class="custom-report-builder">
                <div class="builder-section">
                  <h5>
                    <i class="fas fa-filter" aria-label="Filter icon"></i>
                    Report Criteria
                  </h5>
                  <div class="grid-4">
                    <div class="form-group">
                      <label for="report-type">Report Type</label>
                      <select
                        id="report-type"
                        aria-describedby="report-type-validation"
                      >
                        <option>Select Report Type</option>
                        <option>Financial Analysis</option>
                        <option>Production Analysis</option>
                        <option>Compliance Tracking</option>
                        <option>Entity Performance</option>
                        <option>Audit & Verification</option>
                        <option>Comparative Analysis</option>
                      </select>
                      <div class="validation-error" id="report-type-validation">
                        Report type is required
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="report-period">Period</label>
                      <select
                        id="report-period"
                        aria-describedby="period-validation"
                      >
                        <option>Select Period</option>
                        <option>Monthly</option>
                        <option>Quarterly</option>
                        <option>Yearly</option>
                        <option>Custom Range</option>
                      </select>
                      <div class="validation-error" id="period-validation">
                        Period is required
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="report-entity">Entity</label>
                      <select
                        id="report-entity"
                        aria-describedby="entity-report-validation"
                      >
                        <option>All Entities</option>
                        <option>Kwalini Quarry</option>
                        <option>Mbabane Quarry</option>
                        <option>Sidvokodvo Quarry</option>
                        <option>Maloma Colliery</option>
                        <option>Ngwenya Mine</option>
                        <option>Malolotja Mine</option>
                      </select>
                      <div
                        class="validation-error"
                        id="entity-report-validation"
                      >
                        Entity selection required
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="output-format">Output Format</label>
                      <select
                        id="output-format"
                        aria-describedby="format-validation"
                      >
                        <option>PDF</option>
                        <option>Excel</option>
                        <option>CSV</option>
                        <option>HTML</option>
                      </select>
                      <div class="validation-error" id="format-validation">
                        Output format is required
                      </div>
                    </div>
                  </div>
                </div>
                <div class="builder-section">
                  <h5>
                    <i class="fas fa-chart-bar" aria-label="Metrics icon"></i>
                    Metrics Selection
                  </h5>
                  <div class="metrics-selector">
                    <div class="checkbox-group">
                      <label class="checkbox-label">
                        <input type="checkbox" checked /> Total Revenue
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" checked /> Production Volume
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" /> Collection Rate
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" /> Outstanding Amounts
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" /> Compliance Status
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" /> Entity Performance
                      </label>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button class="btn btn-secondary">Reset</button>
                  <button class="btn btn-success">Preview Report</button>
                </div>
              </div>
            </div>
            <div class="tab-content" id="scheduled-reports">
              <div class="scheduled-reports-header">
                <button class="btn btn-success">Add Scheduled Report</button>
              </div>
              <div class="scheduled-reports-list">
                <div class="schedule-item">
                  <div class="schedule-info">
                    <h6>Weekly Revenue Report</h6>
                    <p>Every Monday at 9:00 AM</p>
                    <span class="status-badge active">Active</span>
                  </div>
                  <div class="schedule-actions">
                    <button class="btn btn-sm btn-secondary">Edit</button>
                    <button class="btn btn-sm btn-warning">Pause</button>
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </div>
                </div>
                <div class="schedule-item active">
                  <div class="schedule-info">
                    <h6>Monthly Compliance Report</h6>
                    <p>First day of each month at 8:00 AM</p>
                    <span class="status-badge active">Active</span>
                  </div>
                  <div class="schedule-actions">
                    <button class="btn btn-sm btn-secondary">Edit</button>
                    <button class="btn btn-sm btn-warning">Pause</button>
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-content" id="audit-trail-reports">
              <div class="report-history-controls">
                <div class="grid-4">
                  <div class="form-group">
                    <label for="audit-report-from">From Date</label>
                    <input type="date" id="audit-report-from" />
                  </div>
                  <div class="form-group">
                    <label for="audit-report-to">To Date</label>
                    <input type="date" id="audit-report-to" />
                  </div>
                  <div class="form-group">
                    <label for="audit-report-user">User</label>
                    <select id="audit-report-user">
                      <option>All users</option>
                      <option>admin</option>
                      <option>finance.user</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary">
                      Generate Audit Report
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Report Name</th>
                      <th>Generated By</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>User Activity Report</td>
                      <td>admin</td>
                      <td>2024-02-10</td>
                      <td>
                        <button class="btn btn-sm btn-secondary">
                          Download
                        </button>
                        <button class="btn btn-sm btn-info">View</button>
                      </td>
                    </tr>
                    <tr>
                      <td>System Changes Log</td>
                      <td>system</td>
                      <td>2024-02-09</td>
                      <td>
                        <button class="btn btn-sm btn-secondary">
                          Download
                        </button>
                        <button class="btn btn-sm btn-info">View</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Communication -->
        <section id="communication" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>Communication Hub</h1>
              <p>Centralized communication with stakeholders</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success" id="compose-message-btn">
                <i class="fas fa-plus" aria-label="Compose Message icon"></i>
                Compose Message
              </button>
            </div>
          </div>

          <!-- Communication Dashboard -->
          <div class="charts-grid">
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-envelope"
                    aria-label="Messages Sent icon"
                  ></i>
                  Messages Sent (Month)
                </h3>
              </div>
              <div class="card-body">
                <p id="messages-sent-count">127</p>
                <small class="trend-positive">+15% from last month</small>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-reply" aria-label="Response Rate icon"></i>
                  Response Rate
                </h3>
              </div>
              <div class="card-body">
                <p id="response-rate">89%</p>
                <small>Average response time: 2.3 hours</small>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-users"
                    aria-label="Active Conversations icon"
                  ></i>
                  Active Conversations
                </h3>
              </div>
              <div class="card-body">
                <p id="active-conversations">23</p>
                <small>3 requiring attention</small>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-exclamation-triangle"
                    aria-label="Urgent Messages icon"
                  ></i>
                  Urgent Messages
                </h3>
              </div>
              <div class="card-body">
                <p id="urgent-messages">3</p>
                <small>Requires immediate attention</small>
              </div>
            </div>
          </div>

          <!-- Message Composition -->
          <div
            class="user-form-container"
            id="compose-message-container"
            style="display: none"
          >
            <div class="section-header">
              <h4>
                <i class="fas fa-edit" aria-label="Compose icon"></i> Compose
                New Message
              </h4>
              <div class="table-actions">
                <button
                  class="btn btn-secondary btn-sm"
                  id="close-compose-form"
                >
                  <i class="fas fa-times" aria-label="Close icon"></i> Close
                </button>
              </div>
            </div>

            <form id="compose-message-form" novalidate="">
              <div class="form-group">
                <label for="message-recipients">Recipients</label>
                <select
                  id="message-recipients"
                  aria-describedby="recipients-validation"
                >
                  <option value="all-entities">All Mining Entities</option>
                  <option value="overdue-entities">
                    Entities with Overdue Payments
                  </option>
                  <option value="regulatory-bodies">Regulatory Bodies</option>
                  <option value="internal-staff">Internal Staff</option>
                </select>
              </div>

              <div class="form-group">
                <label for="message-subject">Subject</label>
                <input
                  type="text"
                  id="message-subject"
                  placeholder="Enter message subject"
                  aria-describedby="subject-validation"
                />
              </div>

              <div class="form-group">
                <label for="message-content">Message Content</label>
                <textarea
                  id="message-content"
                  rows="8"
                  placeholder="Enter your message here..."
                  aria-describedby="content-validation"
                ></textarea>
              </div>

              <div class="form-actions">
                <button
                  type="submit"
                  class="btn btn-success"
                  id="send-message-btn"
                >
                  <i class="fas fa-paper-plane" aria-label="Send icon"></i> Send
                  Message
                </button>
              </div>
            </form>
          </div>

          <!-- Message History and Tracking -->
          <div class="user-form-container">
            <div class="section-header">
              <h4>
                <i class="fas fa-history" aria-label="History icon"></i> Message
                History
              </h4>
            </div>

            <div class="table-container">
              <table class="data-table" id="messages-table">
                <thead>
                  <tr>
                    <th>Date/Time</th>
                    <th>Recipients</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="messages-table-tbody">
                  <!-- Messages will be populated here by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Notifications -->
        <section id="notifications" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>
                <i class="fas fa-bell" aria-label="Notifications icon"></i>
                Notifications Center
              </h1>
              <p>
                System alerts, reminders, and important updates for mining
                royalty management
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-info" id="mark-all-read-btn">
                <i
                  class="fas fa-check-double"
                  aria-label="Mark all read icon"
                ></i>
                Mark All Read
              </button>
              <button class="btn btn-secondary" id="notification-settings-btn">
                <i class="fas fa-cog" aria-label="Settings icon"></i> Settings
              </button>
              <button class="btn btn-primary" id="create-notification-btn">
                <i class="fas fa-plus" aria-label="Create Alert icon"></i>
                Create Alert
              </button>
            </div>
          </div>

          <!-- Notification Stats -->
          <div class="charts-grid">
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-bell"
                    aria-label="Active Notifications icon"
                  ></i>
                  Active Notifications
                </h3>
              </div>
              <div class="card-body">
                <p id="active-notifications-count">7</p>
                <small
                  ><i
                    class="fas fa-circle text-info"
                    aria-label="Info icon"
                  ></i>
                  3 unread, 4 read</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-exclamation-triangle"
                    aria-label="Critical Alerts icon"
                  ></i>
                  Critical Alerts
                </h3>
              </div>
              <div class="card-body">
                <p id="critical-alerts-count">2</p>
                <small
                  ><i
                    class="fas fa-clock text-danger"
                    aria-label="Clock icon"
                  ></i>
                  Requires immediate attention</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-calendar-alt"
                    aria-label="Scheduled Reminders icon"
                  ></i>
                  Scheduled Reminders
                </h3>
              </div>
              <div class="card-body">
                <p id="scheduled-reminders-count">12</p>
                <small
                  ><i
                    class="fas fa-calendar-check text-success"
                    aria-label="Calendar icon"
                  ></i>
                  Next: Feb 16, 2024</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-chart-line"
                    aria-label="System Health icon"
                  ></i>
                  System Health
                </h3>
              </div>
              <div class="card-body">
                <p id="system-health-status">Optimal</p>
                <small
                  ><i
                    class="fas fa-check-circle text-success"
                    aria-label="Success icon"
                  ></i>
                  All systems operational</small
                >
              </div>
            </div>
          </div>

          <!-- Notification Categories -->
          <div class="user-form-container">
            <div class="section-header">
              <h4>
                <i class="fas fa-list" aria-label="List icon"></i> Notification
                Categories
              </h4>
              <div class="table-actions">
                <div class="notification-filters">
                  <button class="filter-btn active" data-filter="all">
                    All (7)
                  </button>
                  <button class="filter-btn" data-filter="unread">
                    Unread (3)
                  </button>
                  <button class="filter-btn" data-filter="critical">
                    Critical (2)
                  </button>
                  <button class="filter-btn" data-filter="payments">
                    Payments (4)
                  </button>
                  <button class="filter-btn" data-filter="compliance">
                    Compliance (1)
                  </button>
                </div>
              </div>
            </div>

            <!-- Notifications List -->
            <div class="notifications-list" id="notifications-list">
              <div class="notification-item unread critical">
                <div class="notification-icon critical">
                  <i
                    class="fas fa-exclamation-circle"
                    aria-label="Critical icon"
                  ></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <h5>Critical: Payment Overdue - Maloma Colliery</h5>
                    <span class="notification-time">2 hours ago</span>
                  </div>
                  <p>
                    Maloma Colliery payment is 15 days overdue. Total
                    outstanding: E 145,750.00
                  </p>
                  <div class="notification-actions">
                    <button class="btn btn-sm btn-primary">View Details</button>
                    <button class="btn btn-sm btn-warning">
                      Send Reminder
                    </button>
                    <button class="btn btn-sm btn-secondary">Mark Read</button>
                  </div>
                </div>
              </div>

              <div class="notification-item unread critical">
                <div class="notification-icon critical">
                  <i class="fas fa-shield-alt" aria-label="Security icon"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <h5>Security Alert: Multiple Failed Login Attempts</h5>
                    <span class="notification-time">4 hours ago</span>
                  </div>
                  <p>
                    Detected 5 failed login attempts from IP 203.0.113.45 in the
                    last hour
                  </p>
                  <div class="notification-actions">
                    <button class="btn btn-sm btn-danger">Block IP</button>
                    <button class="btn btn-sm btn-info">View Logs</button>
                    <button class="btn btn-sm btn-secondary">Mark Read</button>
                  </div>
                </div>
              </div>

              <div class="notification-item unread">
                <div class="notification-icon info">
                  <i
                    class="fas fa-calendar-check"
                    aria-label="Reminder icon"
                  ></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <h5>Reminder: Monthly Report Due Tomorrow</h5>
                    <span class="notification-time">6 hours ago</span>
                  </div>
                  <p>
                    February 2024 royalty report submission deadline is tomorrow
                    at 5:00 PM
                  </p>
                  <div class="notification-actions">
                    <button class="btn btn-sm btn-success">
                      Generate Report
                    </button>
                    <button class="btn btn-sm btn-secondary">Mark Read</button>
                  </div>
                </div>
              </div>

              <div class="notification-item read">
                <div class="notification-icon success">
                  <i class="fas fa-check-circle" aria-label="Success icon"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <h5>Payment Received - Kwalini Quarry</h5>
                    <span class="notification-time">1 day ago</span>
                  </div>
                  <p>
                    Received royalty payment of E 45,200.00 from Kwalini Quarry
                    for January 2024
                  </p>
                  <div class="notification-actions">
                    <button class="btn btn-sm btn-info">View Receipt</button>
                  </div>
                </div>
              </div>

              <div class="notification-item read">
                <div class="notification-icon info">
                  <i class="fas fa-user-plus" aria-label="New user icon"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <h5>New User Account Created</h5>
                    <span class="notification-time">2 days ago</span>
                  </div>
                  <p>
                    User account 'm.smith' created successfully with Auditor
                    role
                  </p>
                  <div class="notification-actions">
                    <button class="btn btn-sm btn-info">View User</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Notification Settings -->
          <div
            class="user-form-container"
            id="notification-settings-container"
            style="display: none"
          >
            <div class="section-header">
              <h4>
                <i class="fas fa-cog" aria-label="Settings icon"></i>
                Notification Preferences
              </h4>
              <div class="table-actions">
                <button class="btn btn-secondary btn-sm" id="close-settings">
                  <i class="fas fa-times" aria-label="Close icon"></i> Close
                </button>
              </div>
            </div>

            <div class="settings-grid">
              <div class="settings-category">
                <h6>
                  <i class="fas fa-envelope" aria-label="Email icon"></i> Email
                  Notifications
                </h6>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" checked /> Payment reminders
                  </label>
                </div>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" checked /> Overdue notifications
                  </label>
                </div>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" /> Daily summaries
                  </label>
                </div>
              </div>

              <div class="settings-category">
                <h6>
                  <i class="fas fa-desktop" aria-label="Desktop icon"></i>
                  System Alerts
                </h6>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" checked /> Security alerts
                  </label>
                </div>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" checked /> System maintenance
                  </label>
                </div>
                <div class="setting-item">
                  <label class="setting-label">
                    <input type="checkbox" /> Performance warnings
                  </label>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button class="btn btn-secondary">Reset to Defaults</button>
              <button class="btn btn-success">Save Preferences</button>
            </div>
          </div>
        </section>

        <!-- Compliance & Regulatory -->
        <section id="compliance" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>
                <i
                  class="fas fa-check-double"
                  aria-label="Compliance & Regulatory icon"
                ></i>
                Compliance & Regulatory
              </h1>
              <p>
                Comprehensive compliance monitoring, regulatory adherence, and
                audit trail management
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-success" id="run-compliance-check-btn">
                <i class="fas fa-check-double" aria-label="Run Check icon"></i>
                Run Compliance Check
              </button>
              <button
                class="btn btn-primary"
                id="generate-compliance-report-btn"
              >
                <i
                  class="fas fa-file-alt"
                  aria-label="Generate Report icon"
                ></i>
                Generate Report
              </button>
              <button class="btn btn-info" id="regulatory-calendar-btn">
                <i class="fas fa-calendar" aria-label="Calendar icon"></i>
                Regulatory Calendar
              </button>
            </div>
          </div>

          <!-- Compliance Dashboard -->
          <div class="charts-grid">
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-shield-check"
                    aria-label="Compliance icon"
                  ></i>
                  Overall Compliance
                </h3>
                <select class="metric-period">
                  <option>Current Status</option>
                  <option>Last Month</option>
                  <option>Last Quarter</option>
                </select>
              </div>
              <div class="card-body">
                <p id="overall-compliance-rate">94%</p>
                <small class="trend-positive">+3% improvement this month</small>
                <div class="compliance-progress">
                  <div
                    class="progress-bar"
                    style="width: 94%; background: var(--success-color)"
                  ></div>
                </div>
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-exclamation-triangle"
                    aria-label="Warning icon"
                  ></i>
                  Non-Compliance Issues
                </h3>
              </div>
              <div class="card-body">
                <p id="non-compliance-count">3</p>
                <small
                  ><i
                    class="fas fa-clock text-warning"
                    aria-label="Clock icon"
                  ></i>
                  2 minor, 1 moderate</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-calendar-check"
                    aria-label="Calendar icon"
                  ></i>
                  Upcoming Deadlines
                </h3>
              </div>
              <div class="card-body">
                <p id="upcoming-deadlines-count">5</p>
                <small
                  ><i
                    class="fas fa-clock text-info"
                    aria-label="Clock icon"
                  ></i>
                  Next: Feb 20, 2024</small
                >
              </div>
            </div>
            <div class="metric-card card">
              <div class="card-header">
                <h3>
                  <i
                    class="fas fa-file-contract"
                    aria-label="Contract icon"
                  ></i>
                  Regulatory Updates
                </h3>
              </div>
              <div class="card-body">
                <p id="regulatory-updates-count">2</p>
                <small
                  ><i
                    class="fas fa-info-circle text-info"
                    aria-label="Info icon"
                  ></i>
                  Require review</small
                >
              </div>
            </div>
          </div>

          <!-- Compliance Categories -->
          <div class="user-form-container">
            <div class="regulatory-tabs">
              <button class="tab-btn active" data-tab="#financial-compliance">
                Financial Compliance
              </button>
              <button class="tab-btn" data-tab="#environmental-compliance">
                Environmental
              </button>
              <button class="tab-btn" data-tab="#operational-compliance">
                Operational
              </button>
              <button class="tab-btn" data-tab="#regulatory-updates">
                Regulatory Updates
              </button>
            </div>

            <!-- Financial Compliance -->
            <div class="tab-content active" id="financial-compliance">
              <h5>
                <i class="fas fa-coins" aria-label="Coins icon"></i> Financial
                Compliance Status
              </h5>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Compliance Item</th>
                      <th>Status</th>
                      <th>Last Audit Date</th>
                      <th>Next Deadline</th>
                      <th>Assigned To</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Royalty Payment Compliance</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-07-01</td>
                      <td>2026-07-01</td>
                      <td>Finance Dept.</td>
                      <td><button class="btn btn-sm btn-info">View</button></td>
                    </tr>
                    <tr>
                      <td>Tax Reporting Compliance</td>
                      <td>
                        <span class="status-badge warning"
                          >Needs Attention</span
                        >
                      </td>
                      <td>2025-06-15</td>
                      <td>2025-08-30</td>
                      <td>J. Doe</td>
                      <td><button class="btn btn-sm btn-info">View</button></td>
                    </tr>
                    <tr>
                      <td>Audit Trail Maintenance</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-08-01</td>
                      <td>N/A</td>
                      <td>System</td>
                      <td>
                        <button class="btn btn-sm btn-info">View Logs</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Environmental Compliance -->
            <div class="tab-content" id="environmental-compliance">
              <h5>
                <i class="fas fa-leaf" aria-label="Leaf icon"></i> Environmental
                Compliance Status
              </h5>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Compliance Item</th>
                      <th>Status</th>
                      <th>Last Audit Date</th>
                      <th>Next Deadline</th>
                      <th>Assigned To</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Environmental Impact Assessments (EIA)</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-01-10</td>
                      <td>2030-01-10</td>
                      <td>Environ. Dept.</td>
                      <td>
                        <button class="btn btn-sm btn-info">View Report</button>
                      </td>
                    </tr>
                    <tr>
                      <td>Water Usage Permits</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-07-20</td>
                      <td>2026-07-20</td>
                      <td>Operations</td>
                      <td>
                        <button class="btn btn-sm btn-info">View Permit</button>
                      </td>
                    </tr>
                    <tr>
                      <td>Rehabilitation Bonds</td>
                      <td>
                        <span class="status-badge warning"
                          >Review Required</span
                        >
                      </td>
                      <td>2024-03-15</td>
                      <td>2025-09-15</td>
                      <td>Finance Dept.</td>
                      <td>
                        <button class="btn btn-sm btn-info">
                          View Details
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Operational Compliance -->
            <div class="tab-content" id="operational-compliance">
              <h5>
                <i class="fas fa-cogs" aria-label="Cogs icon"></i> Operational
                Compliance Status
              </h5>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Compliance Item</th>
                      <th>Status</th>
                      <th>Last Audit Date</th>
                      <th>Next Deadline</th>
                      <th>Assigned To</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Mining Licenses</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2024-06-01</td>
                      <td>2029-05-31</td>
                      <td>Legal Dept.</td>
                      <td>
                        <button class="btn btn-sm btn-info">
                          View License
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td>Safety Compliance (OSHA)</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-08-10</td>
                      <td>2026-02-10</td>
                      <td>HSE Dept.</td>
                      <td>
                        <button class="btn btn-sm btn-info">View Report</button>
                      </td>
                    </tr>
                    <tr>
                      <td>Production Reporting</td>
                      <td>
                        <span class="status-badge success">Compliant</span>
                      </td>
                      <td>2025-08-01</td>
                      <td>2025-09-01</td>
                      <td>Operations</td>
                      <td>
                        <button class="btn btn-sm btn-info">
                          View Submissions
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Regulatory Updates -->
            <div class="tab-content" id="regulatory-updates">
              <h5>
                <i class="fas fa-newspaper" aria-label="Newspaper icon"></i>
                Recent Regulatory Updates
              </h5>
              <div class="regulatory-updates-list">
                <div class="update-item">
                  <div class="update-header">
                    <h6>Mining Tax Amendment Act 2024</h6>
                    <span class="update-date">February 12, 2024</span>
                    <span class="update-priority high">High Priority</span>
                  </div>
                  <div class="update-content">
                    <p>
                      New tax rates effective April 1, 2024. Royalty rates
                      increased for iron ore and coal.
                    </p>
                    <div class="update-actions">
                      <button class="btn btn-sm btn-primary">
                        Review Changes
                      </button>
                      <button class="btn btn-sm btn-success">
                        Mark Reviewed
                      </button>
                    </div>
                  </div>
                </div>

                <div class="update-item">
                  <div class="update-header">
                    <h6>Environmental Compliance Guidelines Update</h6>
                    <span class="update-date">February 8, 2024</span>
                    <span class="update-priority medium">Medium Priority</span>
                  </div>
                  <div class="update-content">
                    <p>
                      Updated guidelines for water usage monitoring and
                      reporting requirements.
                    </p>
                    <div class="update-actions">
                      <button class="btn btn-sm btn-primary">
                        Review Changes
                      </button>
                      <button class="btn btn-sm btn-success">
                        Mark Reviewed
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Compliance Actions -->
          <div class="user-form-container">
            <div class="section-header">
              <h4>
                <i class="fas fa-tasks" aria-label="Tasks icon"></i> Required
                Actions & Deadlines
              </h4>
            </div>

            <div class="table-container">
              <table class="data-table" id="compliance-actions-table">
                <thead>
                  <tr>
                    <th>Action Required</th>
                    <th>Entity/Department</th>
                    <th>Priority</th>
                    <th>Deadline</th>
                    <th>Status</th>
                    <th>Assigned To</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Update tax return submission</td>
                    <td>Maloma Colliery</td>
                    <td><span class="priority-badge high">High</span></td>
                    <td>2024-02-28</td>
                    <td><span class="status-badge pending">Pending</span></td>
                    <td>Finance Team</td>
                    <td>
                      <button class="btn btn-sm btn-primary">Assign</button>
                      <button class="btn btn-sm btn-success">Complete</button>
                    </td>
                  </tr>
                  <tr>
                    <td>Renew environmental permit</td>
                    <td>Ngwenya Mine</td>
                    <td><span class="priority-badge medium">Medium</span></td>
                    <td>2024-03-15</td>
                    <td>
                      <span class="status-badge in-progress">In Progress</span>
                    </td>
                    <td>Compliance Officer</td>
                    <td>
                      <button class="btn btn-sm btn-info">View Progress</button>
                      <button class="btn btn-sm btn-warning">Escalate</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- New Regulatory Management Section -->
        <section id="regulatory-management" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>
                <i
                  class="fas fa-gavel"
                  aria-label="Regulatory Management icon"
                ></i>
                Regulatory Management
              </h1>
              <p>
                Comprehensive management of jurisdictional requirements and
                regulatory frameworks
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary">Regulatory Assessment</button>
              <button class="btn btn-success">Update Compliance Matrix</button>
            </div>
          </div>

          <!-- Jurisdictional Requirements Matrix -->
          <div class="user-form-container">
            <h4>
              <i
                class="fas fa-globe-africa"
                aria-label="Jurisdictions icon"
              ></i>
              Multi-Jurisdictional Compliance Matrix
            </h4>
            <div class="jurisdiction-matrix">
              <div class="grid-4">
                <div class="jurisdiction-card">
                  <div class="jurisdiction-header">
                    <h5>
                      <i
                        class="fas fa-flag"
                        aria-label="Eswatini flag icon"
                      ></i>
                      Kingdom of Eswatini
                    </h5>
                    <span class="jurisdiction-status active"
                      >Primary Jurisdiction</span
                    >
                  </div>
                  <div class="jurisdiction-requirements">
                    <ul>
                      <li>
                        <i
                          class="fas fa-check-circle text-success"
                          aria-label="Success icon"
                        ></i>
                        Mining License: Current
                      </li>
                      <li>
                        <i
                          class="fas fa-check-circle text-success"
                          aria-label="Success icon"
                        ></i>
                        Environmental Permit: Valid
                      </li>
                      <li>
                        <i
                          class="fas fa-exclamation-triangle text-warning"
                          aria-label="Warning icon"
                        ></i>
                        Annual Return: Due Soon
                      </li>
                      <li>
                        <i
                          class="fas fa-check-circle text-success"
                          aria-label="Success icon"
                        ></i>
                        Tax Compliance: Up to Date
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="jurisdiction-card">
                  <div class="jurisdiction-header">
                    <h5>
                      <i class="fas fa-landmark" aria-label="SADC icon"></i>
                      SADC Regional
                    </h5>
                    <span class="jurisdiction-status secondary"
                      >Secondary Jurisdiction</span
                    >
                  </div>
                  <div class="jurisdiction-requirements">
                    <ul>
                      <li>
                        <i
                          class="fas fa-check-circle text-success"
                          aria-label="Success icon"
                        ></i>
                        Cross-border Trade: Compliant
                      </li>
                      <li>
                        <i
                          class="fas fa-check-circle text-success"
                          aria-label="Success icon"
                        ></i>
                        Environmental Standards: Met
                      </li>
                      <li>
                        <i
                          class="fas fa-info-circle text-info"
                          aria-label="Info icon"
                        ></i>
                        Regional Reporting: Optional
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tax Structure Management -->
          <div class="user-form-container">
            <h4>
              <i class="fas fa-calculator" aria-label="Calculator icon"></i> Tax
              Structure & Rates Management
            </h4>
            <div class="tax-structure-grid">
              <div class="tax-category">
                <h6>
                  <i class="fas fa-gem" aria-label="Gem icon"></i> Mineral
                  Royalties
                </h6>
                <div class="tax-rates">
                  <div class="rate-item">
                    <span class="mineral-type">Coal</span>
                    <span class="rate-value">E 2.50/m�</span>
                    <span class="rate-status current">Current</span>
                  </div>
                  <div class="rate-item">
                    <span class="mineral-type">Iron Ore</span>
                    <span class="rate-value">E 3.75/m�</span>
                    <span class="rate-status current">Current</span>
                  </div>
                  <div class="rate-item">
                    <span class="mineral-type">Quarried Stone</span>
                    <span class="rate-value">E 1.25/m�</span>
                    <span class="rate-status current">Current</span>
                  </div>
                </div>
              </div>

              <div class="tax-category">
                <h6>
                  <i class="fas fa-building" aria-label="Building icon"></i>
                  Corporate Taxes
                </h6>
                <div class="tax-rates">
                  <div class="rate-item">
                    <span class="mineral-type">Corporate Income Tax</span>
                    <span class="rate-value">27.5%</span>
                    <span class="rate-status current">Current</span>
                  </div>
                  <div class="rate-item">
                    <span class="mineral-type">Withholding Tax</span>
                    <span class="rate-value">15%</span>
                    <span class="rate-status current">Current</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button class="btn btn-primary">Update Tax Rates</button>
              <button class="btn btn-secondary">Export Tax Schedule</button>
            </div>
          </div>

          <!-- Regulatory Calendar -->
          <div class="user-form-container">
            <h4>
              <i class="fas fa-calendar-alt" aria-label="Calendar icon"></i>
              Regulatory Calendar & Deadlines
            </h4>
            <div class="calendar-view">
              <div class="upcoming-deadlines">
                <h6>
                  <i class="fas fa-clock" aria-label="Clock icon"></i> Upcoming
                  Regulatory Deadlines
                </h6>
                <div class="deadline-list">
                  <div class="deadline-item">
                    <div class="deadline-date">
                      <span class="day">15</span>
                      <span class="month">Feb</span>
                    </div>
                    <div class="deadline-info">
                      <h6>Monthly Royalty Return</h6>
                      <p>Ministry of Natural Resources</p>
                      <span class="days-remaining">5 days remaining</span>
                    </div>
                    <div class="deadline-actions">
                      <button class="btn btn-primary btn-sm">Prepare</button>
                      <button class="btn btn-success btn-sm">Submit</button>
                    </div>
                  </div>
                  <div class="deadline-item">
                    <div class="deadline-date">
                      <span class="day">28</span>
                      <span class="month">Feb</span>
                    </div>
                    <div class="deadline-info">
                      <h6>Environmental Report</h6>
                      <p>Environmental Authority</p>
                      <span class="days-remaining">13 days remaining</span>
                    </div>
                    <div class="deadline-actions">
                      <button class="btn btn-primary btn-sm">Prepare</button>
                      <button class="btn btn-success btn-sm">Submit</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- AI Semantic Search -->
        <!-- Semantic Search -->
        <section id="semantic-search" style="display: none">
          <div class="page-header">
            <div class="page-title">
              <h1>
                <i class="fas fa-search" aria-label="Search icon"></i> AI Search
              </h1>
              <p>Search across all royalty data using natural language</p>
            </div>
            <div class="page-actions">
              <button
                class="btn btn-info"
                id="search-history-btn"
                title="View search history"
              >
                <i class="fas fa-history" aria-label="History icon"></i> History
              </button>
              <button
                class="btn btn-primary"
                id="export-results-btn"
                title="Export results"
              >
                <i class="fas fa-download" aria-label="Export icon"></i> Export
              </button>
            </div>
          </div>

          <!-- Search Interface -->
          <div class="search-container">
            <div class="search-input-wrapper">
              <div class="search-input-box">
                <i class="fas fa-search" aria-label="Search icon"></i>
                <input
                  type="text"
                  id="semantic-search-input"
                  placeholder="Search using natural language... e.g., 'Show me overdue payments'"
                  autocomplete="off"
                />
                <button class="btn btn-primary" id="search-btn">
                  <i
                    class="fas fa-arrow-right"
                    aria-label="Search button icon"
                  ></i>
                </button>
              </div>
            </div>

            <!-- Search Filters -->
            <div
              class="search-filters"
              id="search-filters"
              style="display: none"
            >
              <div class="filter-group">
                <label>Data Sources:</label>
                <div class="filter-checkboxes">
                  <label
                    ><input type="checkbox" value="royalty-records" checked />
                    Royalty Records</label
                  >
                  <label
                    ><input type="checkbox" value="entities" checked /> Mining
                    Entities</label
                  >
                  <label
                    ><input type="checkbox" value="compliance" checked />
                    Compliance Data</label
                  >
                </div>
              </div>
              <div class="filter-group">
                <label>Time Period:</label>
                <select id="time-period-filter">
                  <option value="all">All Time</option>
                  <option value="ytd" selected>Year to Date</option>
                  <option value="last-quarter">Last Quarter</option>
                  <option value="last-year">Last Year</option>
                </select>
              </div>
              <div class="filter-group">
                <label>Entity Type:</label>
                <select id="entity-type-filter">
                  <option value="">All Types</option>
                  <option value="mine">Coal Mines</option>
                  <option value="quarry">Stone Quarries</option>
                </select>
              </div>
            </div>

            <div class="search-actions">
              <button class="btn btn-outline" id="toggle-filters-btn">
                <i class="fas fa-filter" aria-label="Filter icon"></i> Filters
              </button>
              <button class="btn btn-outline" id="clear-search-btn">
                <i class="fas fa-times" aria-label="Clear icon"></i> Clear
              </button>
            </div>
          </div>

          <!-- Search Results -->
          <div class="search-results" id="search-results" style="display: none">
            <div class="results-header">
              <h3>Search Results</h3>
              <p id="results-summary">
                Found <span id="results-count">0</span> results
              </p>
            </div>

            <div class="results-list" id="results-list">
              <!-- Results will be populated here -->
            </div>

            <!-- No Results -->
            <div class="no-results" id="no-results" style="display: none">
              <i class="fas fa-search" aria-label="No results icon"></i>
              <h4>No results found</h4>
              <p>Try adjusting your search terms or filters</p>
            </div>
          </div>
        </section>

        <!-- My Profile -->
        <section id="profile">
          <div class="page-header">
            <div class="page-title">
              <h1>My Profile</h1>
              <p>Manage your account details and preferences</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary">Save Changes</button>
            </div>
          </div>
          <div class="user-form-container">
            <h4>Profile Information</h4>
            <div class="grid-4">
              <div class="form-group">
                <label for="profile-username">Username</label>
                <input
                  type="text"
                  id="profile-username"
                  placeholder="Username"
                  aria-describedby="profile-username-validation"
                />
                <div class="validation-error" id="profile-username-validation">
                  Username is required
                </div>
              </div>
              <div class="form-group">
                <label for="profile-email">Email</label>
                <input
                  type="email"
                  id="profile-email"
                  placeholder="Email"
                  aria-describedby="profile-email-validation"
                />
                <div class="validation-error" id="profile-email-validation">
                  Email is required
                </div>
              </div>
              <div class="form-group">
                <label for="profile-department">Department</label>
                <select
                  id="profile-department"
                  aria-describedby="profile-department-validation"
                >
                  <option>Select Department</option>
                  <option>Finance</option>
                  <option>Operations</option>
                  <option>Compliance</option>
                  <option>Audit</option>
                  <option>Management</option>
                </select>
                <div
                  class="validation-error"
                  id="profile-department-validation"
                >
                  Department is required
                </div>
              </div>
            </div>
            <h4>Change Password</h4>
            <form id="change-password-form" novalidate>
              <!-- Hidden username field for accessibility -->
              <input
                type="text"
                id="profile-username-hidden"
                style="display: none"
                autocomplete="username"
              />
              <div class="grid-4">
                <div class="form-group">
                  <label for="current-password">Current Password</label>
                  <input
                    type="password"
                    id="current-password"
                    placeholder="Current Password"
                    aria-describedby="current-password-validation"
                    autocomplete="current-password"
                  />
                  <div
                    class="validation-error"
                    id="current-password-validation"
                  >
                    Current password is required
                  </div>
                </div>
                <div class="form-group">
                  <label for="new-profile-password">New Password</label>
                  <input
                    type="password"
                    id="new-profile-password"
                    placeholder="New Password"
                    aria-describedby="new-profile-password-validation"
                    autocomplete="new-password"
                  />
                  <div
                    class="validation-error"
                    id="new-profile-password-validation"
                  >
                    New password is required
                  </div>
                </div>
                <div class="form-group">
                  <label for="confirm-profile-password"
                    >Confirm New Password</label
                  >
                  <input
                    type="password"
                    id="confirm-profile-password"
                    placeholder="Confirm New Password"
                    aria-describedby="confirm-profile-password-validation"
                    autocomplete="new-password"
                  />
                  <div
                    class="validation-error"
                    id="confirm-profile-password-validation"
                  >
                    Passwords must match
                  </div>
                </div>
              </div>
            </form>
            <div class="form-actions">
              <button class="btn btn-secondary">Cancel</button>
              <button class="btn btn-success">Update Profile</button>
            </div>
          </div>
        </section>

        <!-- Logout -->
        <section id="logout">
          <div class="page-header">
            <div class="page-title">
              <h1>Logout</h1>
              <p>Securely end your session</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-danger" id="confirm-logout-btn">
                Confirm Logout
              </button>
            </div>
          </div>
          <div class="user-form-container">
            <p>
              Click the button above to log out of the Mining Royalties Manager.
              Ensure all changes are saved before logging out.
            </p>
            <div class="logout-warning">
              <h5>⚠️ Before you logout:</h5>
              <ul>
                <li>Save any unsaved changes</li>
                <li>Complete any pending operations</li>
                <li>Close any open reports or forms</li>
              </ul>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Modern Modular JavaScript -->
    <script type="module" src="js/app.js"></script>

    <!-- Active Entities Modal -->
    <div id="active-entities-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Active Mining Entities</h4>
          <button id="close-active-entities-modal-btn" class="close-btn">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <ul id="active-entities-list">
            <!-- Active entities will be populated here by JavaScript -->
          </ul>
        </div>
      </div>
    </div>

    <!-- Enhanced Communication & Notifications Functionality -->
    <script>
      // Note: Login functionality is handled by js/app.js module
      // Valid credentials for demo:
      // - admin / demo123
      // - finance / demo123
      // - auditor / demo123
    </script>

    <script>
      // Enhanced Communication Hub Functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Communication form handling
        const composeBtn = document.getElementById("compose-message-btn");
        const composeContainer = document.getElementById(
          "compose-message-container",
        );
        const composeForm = document.getElementById("compose-message-form");

        if (composeBtn && composeContainer) {
          composeBtn.addEventListener("click", () => {
            composeContainer.style.display =
              composeContainer.style.display === "none" ? "block" : "none";
          });
        }

        if (composeForm) {
          composeForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const recipients =
              document.getElementById("message-recipients")?.value;
            const subject = document.getElementById("message-subject")?.value;
            const content = document.getElementById("message-content")?.value;

            if (recipients && subject && content) {
              showNotification(
                "Message sent successfully to " +
                  recipients.length +
                  " recipients",
                "success",
              );
              composeForm.reset();
              composeContainer.style.display = "none";
            } else {
              showNotification("Please fill in all required fields", "error");
            }
          });
        }

        // Notification management
        const markAllReadBtn = document.getElementById("mark-all-read-btn");
        if (markAllReadBtn) {
          markAllReadBtn.addEventListener("click", function () {
            document
              .querySelectorAll(".notification-item.unread")
              .forEach((item) => {
                item.classList.remove("unread");
                item.classList.add("read");
              });
            showNotification("All notifications marked as read", "success");
            updateNotificationCount();
          });
        }

        // Compliance checking
        const runComplianceBtn = document.getElementById(
          "run-compliance-check-btn",
        );
        if (runComplianceBtn) {
          runComplianceBtn.addEventListener("click", function () {
            this.innerHTML =
              '<i class="fas fa-spinner fa-spin"></i> Running Check...';
            this.disabled = true;

            setTimeout(() => {
              showNotification(
                "Compliance check completed successfully",
                "success",
              );
              this.innerHTML =
                '<i class="fas fa-check-double"></i> Run Compliance Check';
              this.disabled = false;
              updateComplianceMetrics();
            }, 3000);
          });
        }

        // Update notification count
        function updateNotificationCount() {
          const unreadCount = document.querySelectorAll(
            ".notification-item.unread",
          ).length;
          const countBadge = document.querySelector(
            'nav a[href="#notifications"] span',
          );
          if (countBadge) {
            countBadge.textContent = unreadCount;
          }
        }

        // Update compliance metrics
        function updateComplianceMetrics() {
          const overallCompliance = document.getElementById(
            "overall-compliance-rate",
          );
          const upcomingDeadlines = document.getElementById(
            "upcoming-deadlines-count",
          );

          if (overallCompliance) {
            overallCompliance.textContent = "98%";
          }
          if (upcomingDeadlines) {
            upcomingDeadlines.textContent = "3";
          }
        }

        // Enhanced notification actions
        document.addEventListener("click", function (e) {
          if (
            e.target.closest(".btn") &&
            e.target.closest(".notification-actions")
          ) {
            const btn = e.target.closest(".btn");
            const notificationItem = btn.closest(".notification-item");

            if (btn.textContent.includes("Mark Read")) {
              notificationItem.classList.remove("unread");
              notificationItem.classList.add("read");
              showNotification("Notification marked as read", "info");
              updateNotificationCount();
            } else if (btn.textContent.includes("View Details")) {
              showNotification("Opening detailed view...", "info");
            } else if (btn.textContent.includes("Send Reminder")) {
              showNotification("Reminder sent successfully", "success");
            }
          }

          // Filter buttons for notifications
          if (e.target.classList.contains("filter-btn")) {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");

            const filter = e.target.dataset.filter;
            const notifications =
              document.querySelectorAll(".notification-item");

            notifications.forEach((notification) => {
              if (filter === "all") {
                notification.style.display = "flex";
              } else if (
                filter === "unread" &&
                notification.classList.contains("unread")
              ) {
                notification.style.display = "flex";
              } else if (
                filter === "critical" &&
                notification.classList.contains("critical")
              ) {
                notification.style.display = "flex";
              } else if (notification.style.display !== "none") {
                notification.style.display = filter === "all" ? "flex" : "none";
              }
            });
          }
        });

        // Initialize notification count
        updateNotificationCount();

        // Tab functionality for compliance section
        document.addEventListener("click", function (e) {
          if (e.target.matches(".tab-btn[data-tab]")) {
            const targetTab = e.target.dataset.tab;

            // Remove active class from all tabs and content
            document
              .querySelectorAll(".tab-btn")
              .forEach((btn) => btn.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((content) => content.classList.remove("active"));

            // Add active class to clicked tab and corresponding content
            e.target.classList.add("active");
            const targetContent = document.querySelector(targetTab);
            if (targetContent) {
              targetContent.classList.add("active");
            }
          }
        });
      });

      // Global notification function (if not already defined)
      if (typeof showNotification === "undefined") {
        function showNotification(message, type = "info") {
          const notification = document.createElement("div");
          notification.className = `notification notification-${type}`;
          notification.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 10000;
          background: ${type === "success" ? "#dcfce7" : type === "error" ? "#fef2f2" : type === "warning" ? "#fef3c7" : "#dbeafe"};
          color: ${type === "success" ? "#166534" : type === "error" ? "#dc2626" : type === "warning" ? "#92400e" : "#1e40af"};
          padding: 1rem 1.5rem; border-radius: 8px; border: 1px solid #e5e7eb;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px;
          display: flex; align-items: center; gap: 0.75rem; font-weight: 500;
        `;

          notification.innerHTML = `
          <span>${type === "success" ? "?" : type === "error" ? "?" : type === "warning" ? "??" : "??"}</span>
          <span>${message}</span>
          <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer; margin-left: auto;">�</button>
        `;

          document.body.appendChild(notification);
          setTimeout(() => notification.remove(), 5000);
        }
      }
    </script>

    <!-- Legacy support for non-module browsers -->
    <script nomodule>
      console.warn(
        "This browser does not support ES6 modules. Please upgrade to a modern browser.",
      );

      // Simple fallback for basic functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Populate dashboard metrics with sample data
        const updateDashboardMetrics = () => {
          // Update royalty metrics
          const totalRoyalties = document.getElementById("total-royalties");
          const activeEntities = document.getElementById("active-entities");
          const complianceRate = document.getElementById("compliance-rate");
          const pendingApprovals = document.getElementById("pending-approvals");

          if (totalRoyalties) totalRoyalties.textContent = "E 2,847,650.00";
          if (activeEntities) activeEntities.textContent = "15";
          if (complianceRate) complianceRate.textContent = "94%";
          if (pendingApprovals) pendingApprovals.textContent = "5";

          // Update progress bars
          const royaltiesProgress =
            document.getElementById("royalties-progress");
          const complianceProgress = document.getElementById(
            "compliance-progress",
          );

          if (royaltiesProgress) royaltiesProgress.style.width = "75%";
          if (complianceProgress) complianceProgress.style.width = "94%";

          // Update trend indicators
          const royaltiesTrend = document.getElementById("royalties-trend");
          const entitiesTrend = document.getElementById("entities-trend");

          if (royaltiesTrend) {
            royaltiesTrend.innerHTML =
              '<i class="fas fa-arrow-up trend-positive"></i> +15.8% from last year';
          }
          if (entitiesTrend) {
            entitiesTrend.innerHTML =
              '<i class="fas fa-arrow-up trend-positive"></i> +2 new entities';
          }

          // Update compliance metrics
          const overallComplianceRate = document.getElementById(
            "overall-compliance-rate",
          );
          const auditScore = document.getElementById("audit-score");
          const upcomingDeadlinesCount = document.getElementById(
            "upcoming-deadlines-count",
          );
          const regulatoryUpdatesCount = document.getElementById(
            "regulatory-updates-count",
          );

          if (overallComplianceRate) overallComplianceRate.textContent = "94%";
          if (auditScore) auditScore.textContent = "98%";
          if (upcomingDeadlinesCount) upcomingDeadlinesCount.textContent = "5";
          if (regulatoryUpdatesCount) regulatoryUpdatesCount.textContent = "2";

          // Update notification counts
          const activeNotificationsCount = document.getElementById(
            "active-notifications-count",
          );
          const unreadCount = document.getElementById("unread-count");
          const criticalAlertsCount = document.getElementById(
            "critical-alerts-count",
          );
          const systemHealthStatus = document.getElementById(
            "system-health-status",
          );

          if (activeNotificationsCount)
            activeNotificationsCount.textContent = "7";
          if (unreadCount) unreadCount.textContent = "3";
          if (criticalAlertsCount) criticalAlertsCount.textContent = "2";
          if (systemHealthStatus) systemHealthStatus.textContent = "Optimal";

          // Update communication metrics
          const messagesSentCount = document.getElementById(
            "messages-sent-count",
          );
          const responseRate = document.getElementById("response-rate");
          const activeConversations = document.getElementById(
            "active-conversations",
          );
          const urgentMessages = document.getElementById("urgent-messages");

          if (messagesSentCount) messagesSentCount.textContent = "127";
          if (responseRate) responseRate.textContent = "89%";
          if (activeConversations) activeConversations.textContent = "23";
          if (urgentMessages) urgentMessages.textContent = "3";
        };

        // Call the update function
        updateDashboardMetrics();

        // Additional dashboard initialization with sample data
        const initializeDashboardWithData = () => {
          // Populate chart summaries
          const avgMonthly = document.getElementById("avg-monthly");
          const peakMonth = document.getElementById("peak-month");
          const totalProduction = document.getElementById("total-production");
          const topProducer = document.getElementById("top-producer");

          if (avgMonthly) avgMonthly.textContent = "387,500";
          if (peakMonth) peakMonth.textContent = "December";
          if (totalProduction) totalProduction.textContent = "240,000";
          if (topProducer) topProducer.textContent = "Maloma Colliery";

          // Update mines vs quarries breakdown
          const minesCount = document.getElementById("mines-count");
          const quarriesCount = document.getElementById("quarries-count");
          if (minesCount) minesCount.textContent = "3";
          if (quarriesCount) quarriesCount.textContent = "3";

          // Update system status indicators
          const dbStatus = document.getElementById("db-status");
          const lastBackup = document.getElementById("last-backup");
          const activeSessions = document.getElementById("active-sessions");
          const systemUptime = document.getElementById("system-uptime");

          if (dbStatus && !dbStatus.textContent.includes("Connected")) {
            dbStatus.innerHTML = '<i class="fas fa-circle"></i> Connected';
          }
          if (lastBackup && !lastBackup.textContent.includes("AM")) {
            lastBackup.textContent = "Today, 03:00 AM";
          }
          if (activeSessions && !activeSessions.textContent.includes("users")) {
            activeSessions.textContent = "3 users";
          }
          if (systemUptime && !systemUptime.textContent.includes("days")) {
            systemUptime.textContent = "7 days, 14 hours";
          }

          console.log("Dashboard initialized with complete sample data");
        };

        // Initialize dashboard with data
        initializeDashboardWithData();

        // Update metrics every 30 seconds to simulate real-time data
        setInterval(() => {
          updateDashboardMetrics();
          initializeDashboardWithData();
        }, 30000);

        // Add basic form validation for login - handled by main app.js
        // Login functionality is managed by the modular js/app.js

        // Enhanced navigation functionality
        document.addEventListener("click", function (e) {
          const link = e.target.closest('nav a[href^="#"]');
          if (link) {
            e.preventDefault();
            const targetId = link.getAttribute("href").substring(1);

            // Handle logout separately
            if (targetId === "logout") {
              if (confirm("Are you sure you want to logout?")) {
                // Reset to login
                document.getElementById("app-container").style.display = "none";
                document.getElementById("login-section").style.display = "flex";
              }
              return;
            }

            // Hide all sections
            document.querySelectorAll("main section").forEach((section) => {
              section.style.display = "none";
            });

            // Show target section
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
              targetSection.style.display = "block";
              console.log(`Switched to section: ${targetId}`);
            }

            // Update navigation active state
            document
              .querySelectorAll("nav a")
              .forEach((a) => a.classList.remove("active"));
            link.classList.add("active");
          }
        });

        // Initialize dashboard as active on page load
        document.addEventListener("DOMContentLoaded", function () {
          // Set dashboard nav as active
          const dashboardNav = document.querySelector(
            'nav a[href="#dashboard"]',
          );
          if (dashboardNav) {
            dashboardNav.classList.add("active");
          }

          // Ensure dashboard is visible
          const dashboardSection = document.getElementById("dashboard");
          if (dashboardSection) {
            dashboardSection.style.display = "block";
          }

          // Hide all other sections
          document
            .querySelectorAll("main section:not(#dashboard)")
            .forEach((section) => {
              section.style.display = "none";
            });
        });

        // Enhanced chart initialization
        const initializeCharts = () => {
          // Initialize charts if Chart.js is available
          if (typeof Chart !== "undefined") {
            try {
              // Revenue Trends Chart
              const revenueCtx = document.getElementById(
                "revenue-trends-chart",
              );
              if (revenueCtx) {
                new Chart(revenueCtx, {
                  type: "line",
                  data: {
                    labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
                    datasets: [
                      {
                        label: "Revenue (E)",
                        data: [500000, 600000, 750000, 700000, 800000, 900000],
                        borderColor: "#1a365d",
                        backgroundColor: "rgba(26, 54, 93, 0.2)",
                        fill: true,
                        tension: 0.4,
                      },
                    ],
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                      y: {
                        beginAtZero: true,
                        ticks: {
                          callback: (value) => `E ${value.toLocaleString()}`,
                        },
                      },
                    },
                  },
                });
              }

              // Production by Entity Chart
              const productionCtx = document.getElementById(
                "production-by-entity-chart",
              );
              if (productionCtx) {
                new Chart(productionCtx, {
                  type: "pie",
                  data: {
                    labels: [
                      "Maloma Colliery",
                      "Kwalini Quarry",
                      "Mbabane Quarry",
                      "Sidvokodvo Quarry",
                      "Ngwenya Mine",
                      "Malolotja Mine",
                    ],
                    datasets: [
                      {
                        data: [55000, 45000, 38000, 42000, 28000, 32000],
                        backgroundColor: [
                          "#1a365d",
                          "#2563eb",
                          "#059669",
                          "#dc2626",
                          "#d97706",
                          "#7c3aed",
                        ],
                      },
                    ],
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: { position: "bottom", labels: { padding: 20 } },
                    },
                  },
                });
              }

              console.log("Charts initialized successfully");
            } catch (error) {
              console.warn("Chart initialization failed:", error);
              showChartFallbacks();
            }
          } else {
            console.warn("Chart.js not available, showing fallback content");
            showChartFallbacks();
          }
        };

        // Chart fallback function
        const showChartFallbacks = () => {
          const revenueChart = document.getElementById("revenue-trends-chart");
          const productionChart = document.getElementById(
            "production-by-entity-chart",
          );

          if (revenueChart) {
            revenueChart.parentElement.innerHTML = `
            <div style="padding: 2rem; text-align: center; background: #f8fafc; border-radius: 8px;">
              <i class="fas fa-chart-line" style="font-size: 2rem; color: #64748b; margin-bottom: 1rem;"></i>
              <h4 style="color: #334155; margin: 0.5rem 0;">Revenue Trends</h4>
              <p style="color: #64748b; margin: 0.5rem 0;">YTD Revenue: <strong>E 4,250,000</strong></p>
              <p style="color: #64748b; margin: 0;">Growth: <strong>+15.8%</strong></p>
            </div>
          `;
          }

          if (productionChart) {
            productionChart.parentElement.innerHTML = `
            <div style="padding: 2rem; text-align: center; background: #f8fafc; border-radius: 8px;">
              <i class="fas fa-chart-pie" style="font-size: 2rem; color: #64748b; margin-bottom: 1rem;"></i>
              <h4 style="color: #334155; margin: 0.5rem 0;">Production Overview</h4>
              <p style="color: #64748b; margin: 0.5rem 0;">Total Volume: <strong>240,000 m�</strong></p>
              <p style="color: #64748b; margin: 0;">Top Producer: <strong>Maloma Colliery</strong></p>
            </div>
          `;
          }
        };

        // Initialize charts with delay to ensure DOM is ready
        setTimeout(initializeCharts, 1000);

        // Chart control buttons
        document.addEventListener("click", function (e) {
          if (e.target.closest(".chart-btn")) {
            const btn = e.target.closest(".chart-btn");
            const chartType = btn.dataset.chartType;
            const chartId = btn.dataset.chartId;

            // Update active button
            btn.parentElement
              .querySelectorAll(".chart-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");

            console.log(`Chart type changed to ${chartType} for ${chartId}`);
            showNotification(`Chart updated to ${chartType} view`, "info");
          }
        });

        // Show dashboard by default and initialize
        setTimeout(() => {
          const dashboardSection = document.getElementById("dashboard");
          if (dashboardSection) {
            dashboardSection.style.display = "block";
            // Mark dashboard nav as active
            const dashboardNav = document.querySelector(
              'nav a[href="#dashboard"]',
            );
            if (dashboardNav) dashboardNav.classList.add("active");
          }
        }, 500);
      });
    </script>

    <script>
      // Dashboard initialization function
      function initializeDashboardWithData() {
        console.log("Initializing dashboard with sample data...");

        // Update all dashboard metrics
        const metrics = {
          "total-royalties": "E 992,500.00",
          "active-entities": "6",
          "compliance-rate": "80%",
          "pending-approvals": "2",
          "mines-count": "2",
          "quarries-count": "4",
          "paid-count": "3",
          "pending-count": "1",
          "overdue-count": "1",
          "avg-monthly": "82,708",
          "peak-month": "January 2024",
          "total-production": "52,000",
          "top-producer": "Kwalini Quarry",
        };

        // Update all metric elements
        Object.entries(metrics).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
          }
        });

        // Update progress bars
        const progressBars = {
          "compliance-progress": "80%",
          "royalties-progress": "75%",
        };

        Object.entries(progressBars).forEach(([id, width]) => {
          const element = document.getElementById(id);
          if (element) {
            element.style.width = width;
          }
        });

        // Show urgent items
        const urgentItems = document.getElementById("urgent-items");
        if (urgentItems) {
          urgentItems.style.display = "inline-flex";
        }

        // Update trends to show positive indicators
        const trendsElements = document.querySelectorAll(".trend-indicator");
        trendsElements.forEach((trend) => {
          if (trend.id === "royalties-trend") {
            trend.innerHTML =
              '<i class="fas fa-arrow-up trend-positive"></i> +15.8% from last year';
          } else if (trend.id === "entities-trend") {
            trend.innerHTML =
              '<i class="fas fa-arrow-up trend-positive"></i> +2 new this month';
          }
        });

        console.log("Dashboard initialized successfully");
      }
    </script>

    <script>
      // Global error handler for better debugging
      window.addEventListener("error", function (e) {
        // Filter out extension-related errors
        if (
          e.message &&
          (e.message.includes("Extension context invalidated") ||
            e.message.includes("message channel closed") ||
            e.message.includes("chrome-extension"))
        ) {
          e.preventDefault();
          return false;
        }

        console.error("Application error:", {
          message: e.message,
          filename: e.filename,
          lineno: e.lineno,
          colno: e.colno,
          error: e.error,
        });
      });

      // Unhandled promise rejection handler
      window.addEventListener("unhandledrejection", function (e) {
        if (e.reason && typeof e.reason === "object" && e.reason.message) {
          if (
            e.reason.message.includes("Extension context") ||
            e.reason.message.includes("chrome-extension")
          ) {
            e.preventDefault();
            return false;
          }
        }

        console.error("Unhandled promise rejection:", e.reason);
      });
    </script>
  </body>
</html>
