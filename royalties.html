<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mining Royalties Manager</title>
  <link rel="stylesheet" href="royalties.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>Loading your workspace...</p>
    </div>
  </div>

  <!-- Login Section -->
  <section class="login-section" id="login-section">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Mining Royalties Manager</h2>
        <p>Secure access to your royalty management system</p>
      </div>
      <form class="login-form">
        <div class="input-group">
          <i class="fas fa-user"></i>
          <input type="text" id="username" placeholder="Username" aria-describedby="username-error">
          <div class="validation-error" id="username-error">Username is required</div>
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="password" placeholder="Password" aria-describedby="password-error">
          <button type="button" class="password-toggle" aria-label="Toggle password visibility">
            <i class="fas fa-eye"></i>
          </button>
          <div class="validation-error" id="password-error">Password is required</div>
        </div>
        <button type="submit" class="btn btn-primary btn-large">Sign In</button>
      </form>
      <div class="login-footer">
        <p>Please contact your administrator for credentials.</p>
      </div>
    </div>
  </section>

  <!-- Main App -->
  <div class="app-container" id="app-container" style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Royalties Manager</h2>
      </div>
      <nav>
        <ul>
          <li><a href="#dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
          <li><a href="#user-management"><i class="fas fa-users"></i> User Management</a></li>
          <li><a href="#royalty-records"><i class="fas fa-file-invoice"></i> Royalty Records</a></li>
          <li><a href="#contract-management"><i class="fas fa-file-contract"></i> Contract Management</a></li>
          <li><a href="#audit-dashboard"><i class="fas fa-shield-alt"></i> Audit Dashboard</a></li>
          <li><a href="#reporting-analytics"><i class="fas fa-chart-bar"></i> Reporting & Analytics</a></li>
          <li><a href="#communication"><i class="fas fa-envelope"></i> Communication</a></li>
          <li><a href="#notifications"><i class="fas fa-bell"></i> Notifications <span>3</span></a></li>
          <li><a href="#compliance"><i class="fas fa-check-circle"></i> Compliance & Regulatory</a></li>
          <li><a href="#regulatory-management"><i class="fas fa-gavel"></i> Regulatory Management</a></li>
          <li><a href="#profile"><i class="fas fa-user"></i> My Profile</a></li>
          <li><a href="#logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard -->
      <section id="dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1>Dashboard</h1>
            <p>Welcome back, <span id="user-name">User</span></p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary" id="admin-btn" title="Access Admin Panel">Admin</button>
            <button class="btn btn-secondary" id="notifications-count" title="View Notifications">0</button>
          </div>
        </div>
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3>Total Royalties (YTD)</h3>
              <select class="metric-period">
                <option>2024</option>
                <option>2023</option>
                <option>All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="total-royalties">E0.00</p>
              <small class="trend-positive">+0% from last year</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Active Entities</h3>
              <select class="metric-period">
                <option>This Quarter</option>
                <option>Last Quarter</option>
                <option>YTD</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-entities">0</p>
              <small class="trend-stable">No change</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Compliance Rate</h3>
            </div>
            <div class="card-body">
              <p id="compliance-rate">0%</p>
              <div class="collection-progress">
                <div class="progress-bar" style="width: 0%;"></div>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Pending Approvals</h3>
            </div>
            <div class="card-body">
              <p id="pending-approvals">0</p>
            </div>
          </div>
        </div>
        <div class="charts-grid">
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5>Revenue Trends</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="line" data-chart-id="revenue-trends-chart">Line</button>
                <button class="chart-btn" data-chart-type="bar" data-chart-id="revenue-trends-chart">Bar</button>
                <button class="chart-btn" data-chart-type="area" data-chart-id="revenue-trends-chart">Area</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="revenue-trends-chart"></canvas>
            </div>
          </div>
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5>Production by Entity</h5>
            </div>
            <div class="chart-container">
              <canvas id="production-by-entity-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- User Management -->
      <section id="user-management">
        <div class="page-header">
          <div class="page-title">
            <h1>üë• User Management</h1>
            <p>Comprehensive user administration with role-based access control, security monitoring, and audit trails</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="view-audit-btn" title="View detailed audit logs">
              <i class="fas fa-shield-alt"></i> View Audit Log
            </button>
            <button class="btn btn-primary" id="export-report-btn" title="Export user management report">
              <i class="fas fa-file-export"></i> Export Report
            </button>
            <button class="btn btn-success" id="add-user-btn" title="Add new user account">
              <i class="fas fa-user-plus"></i> Add User
            </button>
          </div>
        </div>
        
        <!-- User Management Metrics Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-users"></i> Active Users</h3>
              <select class="metric-period">
                <option>Current</option>
                <option>Last 30 days</option>
                <option>All time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-users-count">3</p>
              <small><i class="fas fa-circle text-success"></i> Currently active and logged in</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Failed Logins</h3>
              <select class="metric-period">
                <option>Last 24 hours</option>
                <option>Last 7 days</option>
                <option>Last 30 days</option>
              </select>
            </div>
            <div class="card-body">
              <p id="failed-logins-count">0</p>
              <small><i class="fas fa-shield-alt text-success"></i> Security status: Normal</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> Security Alerts</h3>
            </div>
            <div class="card-body">
              <p id="security-alerts-count">None</p>
              <small><i class="fas fa-check-circle text-success"></i> All systems secure</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-key"></i> Password Compliance</h3>
            </div>
            <div class="card-body">
              <p id="password-compliance-rate">100%</p>
              <small><i class="fas fa-certificate text-success"></i> Meeting security standards</small>
              <div class="mini-progress">
                <div class="progress-bar" style="width: 100%; background: var(--success-color);"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add New User Form -->
        <div class="user-form-container" id="add-user-form-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-user-plus"></i> Add New User Account</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-add-user-form" title="Close form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
          
          <form id="add-user-form" novalidate>
            <div class="grid-4">
              <!-- Username Field -->
              <div class="form-group">
                <label for="new-username">
                  <i class="fas fa-user"></i> Username *
                </label>
                <input 
                  type="text" 
                  id="new-username" 
                  name="username" 
                  placeholder="Enter unique username" 
                  required 
                  aria-describedby="new-username-error new-username-success"
                  autocomplete="off"
                  minlength="3"
                  maxlength="50"
                  pattern="^[a-zA-Z0-9._-]+$"
                >
                <div class="validation-success" id="new-username-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Username is available
                </div>
                <div class="validation-error" id="new-username-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Username is required and must be unique
                </div>
                <small class="form-help">3-50 characters, letters, numbers, dots, dashes, underscores only</small>
              </div>
              
              <!-- Email Field -->
              <div class="form-group">
                <label for="new-email">
                  <i class="fas fa-envelope"></i> Email Address *
                </label>
                <input 
                  type="email" 
                  id="new-email" 
                  name="email" 
                  placeholder="user@eswacaa.sz" 
                  required 
                  aria-describedby="new-email-error new-email-success"
                  autocomplete="email"
                >
                <div class="validation-success" id="new-email-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Email address is valid
                </div>
                <div class="validation-error" id="new-email-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Valid email address is required
                </div>
                <small class="form-help">Must be a valid email address, preferably @eswacaa.sz domain</small>
              </div>
              
              <!-- Role Field -->
              <div class="form-group">
                <label for="new-role">
                  <i class="fas fa-user-tag"></i> User Role *
                </label>
                <select id="new-role" name="role" required aria-describedby="new-role-error">
                  <option value="">Select User Role</option>
                  <option value="Administrator">üëë Administrator (Full System Access)</option>
                  <option value="Editor">‚úèÔ∏è Editor (Read/Write Access)</option>
                  <option value="Viewer">üëÅÔ∏è Viewer (Read-Only Access)</option>
                  <option value="Auditor">üîç Auditor (Audit & Compliance Access)</option>
                  <option value="Finance">üí∞ Finance (Financial Data Access)</option>
                </select>
                <div class="validation-error" id="new-role-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a user role
                </div>
                <small class="form-help">Role determines system permissions and access levels</small>
              </div>
              
              <!-- Department Field -->
              <div class="form-group">
                <label for="new-department">
                  <i class="fas fa-building"></i> Department *
                </label>
                <select id="new-department" name="department" required aria-describedby="new-department-error">
                  <option value="">Select Department</option>
                  <option value="Finance">üí∞ Finance Department</option>
                  <option value="Operations">‚öôÔ∏è Operations Department</option>
                  <option value="Compliance">üìã Compliance & Legal</option>
                  <option value="Audit">üîç Internal Audit</option>
                  <option value="Management">üëî Executive Management</option>
                  <option value="IT">üíª Information Technology</option>
                </select>
                <div class="validation-error" id="new-department-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a department
                </div>
                <small class="form-help">User's organizational department for reporting purposes</small>
              </div>
              
              <!-- Password Field -->
              <div class="form-group">
                <label for="new-password">
                  <i class="fas fa-lock"></i> Password *
                </label>
                <div class="password-input-container">
                  <input 
                    type="password" 
                    id="new-password" 
                    name="password" 
                    placeholder="Enter secure password" 
                    required 
                    aria-describedby="new-password-error"
                    minlength="8"
                    autocomplete="new-password"
                  >
                  <button type="button" class="password-toggle-btn" onclick="togglePassword('new-password')" aria-label="Show password">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="password-strength-meter">
                  <div class="strength-bar strength-weak">
                    <div class="strength-bar-fill" style="width: 0%;"></div>
                  </div>
                  <p class="strength-text">Password Strength: Enter password</p>
                </div>
                <div class="validation-error" id="new-password-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Password must be at least 8 characters with uppercase, lowercase, and number
                </div>
                <small class="form-help">Minimum 8 characters with uppercase, lowercase, number, and special character</small>
              </div>
              
              <!-- Confirm Password Field -->
              <div class="form-group">
                <label for="confirm-password">
                  <i class="fas fa-lock"></i> Confirm Password *
                </label>
                <div class="password-input-container">
                  <input 
                    type="password" 
                    id="confirm-password" 
                    name="confirmPassword" 
                    placeholder="Confirm password" 
                    required 
                    aria-describedby="confirm-password-error confirm-password-success"
                    autocomplete="new-password"
                  >
                  <button type="button" class="password-toggle-btn" onclick="togglePassword('confirm-password')" aria-label="Show password">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="validation-success" id="confirm-password-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Passwords match perfectly
                </div>
                <div class="validation-error" id="confirm-password-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Passwords must match exactly
                </div>
              </div>
              
              <!-- Account Expiry Field -->
              <div class="form-group">
                <label for="account-expires">
                  <i class="fas fa-calendar-alt"></i> Account Expires (Optional)
                </label>
                <input 
                  type="date" 
                  id="account-expires" 
                  name="expires" 
                  aria-describedby="account-expires-help"
                  min=""
                >
                <small class="form-help" id="account-expires-help">
                  <i class="fas fa-info-circle"></i> Leave blank for permanent account, or set expiration date
                </small>
              </div>
              
              <!-- Additional Options -->
              <div class="form-group">
                <label><i class="fas fa-cog"></i> Account Options</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="force-password-change" name="forcePasswordChange">
                    <span class="checkmark"></span>
                    <span>
                      <strong>Force password change on first login</strong>
                      <small>User must change password when they first log in</small>
                    </span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="send-welcome-email" name="sendWelcomeEmail" checked>
                    <span class="checkmark"></span>
                    <span>
                      <strong>Send welcome email with credentials</strong>
                      <small>Email login details to the user's email address</small>
                    </span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="enable-2fa" name="enable2FA">
                    <span class="checkmark"></span>
                    <span>
                      <strong>Enable two-factor authentication</strong>
                      <small>Enhanced security with 2FA requirement</small>
                    </span>
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-add-user">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="button" class="btn btn-warning" id="reset-form">
                <i class="fas fa-undo"></i> Reset Form
              </button>
              <button type="submit" class="btn btn-success" id="create-user-btn" disabled>
                <i class="fas fa-user-plus"></i> Create User Account
              </button>
            </div>
          </form>
        </div>

        <!-- User Accounts Management Table -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-users-cog"></i> User Accounts Management</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-users" title="Refresh user list">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-users" title="Export user list">
                <i class="fas fa-download"></i> Export
              </button>
              <button class="btn btn-danger btn-sm" id="bulk-delete-users" style="display: none;" disabled title="Delete selected users">
                <i class="fas fa-trash-alt"></i> Delete Selected (<span id="selected-count">0</span>)
              </button>
            </div>
          </div>
          
          <!-- Advanced Filtering -->
          <div class="table-filters">
            <h6><i class="fas fa-filter"></i> Filter & Search Options</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="filter-user-role">
                  <i class="fas fa-user-tag"></i> Filter by Role
                </label>
                <select id="filter-user-role">
                  <option value="">All Roles</option>
                  <option value="Administrator">Administrator</option>
                  <option value="Editor">Editor</option>
                  <option value="Viewer">Viewer</option>
                  <option value="Auditor">Auditor</option>
                  <option value="Finance">Finance</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filter-user-status">
                  <i class="fas fa-toggle-on"></i> Filter by Status
                </label>
                <select id="filter-user-status">
                  <option value="">All Statuses</option>
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                  <option value="Locked">Locked</option>
                  <option value="Expired">Expired</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filter-user-department">
                  <i class="fas fa-building"></i> Filter by Department
                </label>
                <select id="filter-user-department">
                  <option value="">All Departments</option>
                  <option value="Finance">Finance</option>
                  <option value="Operations">Operations</option>
                  <option value="Compliance">Compliance</option>
                  <option value="Audit">Audit</option>
                  <option value="Management">Management</option>
                  <option value="IT">Information Technology</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <button class="btn btn-primary" id="apply-user-filters" title="Apply selected filters">
                  <i class="fas fa-search"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" id="clear-user-filters" title="Clear all filters">
                  <i class="fas fa-times"></i> Clear All
                </button>
              </div>
            </div>
          </div>
          
          <!-- Users Data Table -->
          <div class="table-container">
            <table class="data-table" id="users-table">
              <thead>
                <tr>
                  <th style="width: 40px;">
                    <input type="checkbox" id="select-all-users" title="Select all visible users">
                  </th>
                  <th sortable data-sort="username" style="min-width: 120px;">
                    <i class="fas fa-user"></i> Username <i class="fas fa-sort"></i>
                  </th>
                  <th sortable data-sort="email" style="min-width: 200px;">
                    <i class="fas fa-envelope"></i> Email <i class="fas fa-sort"></i>
                  </th>
                  <th sortable data-sort="role" style="min-width: 100px;">
                    <i class="fas fa-user-tag"></i> Role <i class="fas fa-sort"></i>
                  </th>
                  <th sortable data-sort="department" style="min-width: 120px;">
                    <i class="fas fa-building"></i> Department <i class="fas fa-sort"></i>
                  </th>
                  <th sortable data-sort="status" style="min-width: 100px;">
                    <i class="fas fa-toggle-on"></i> Status <i class="fas fa-sort"></i>
                  </th>
                  <th sortable data-sort="lastLogin" style="min-width: 140px;">
                    <i class="fas fa-clock"></i> Last Login <i class="fas fa-sort"></i>
                  </th>
                  <th style="min-width: 80px;">
                    <i class="fas fa-exclamation-triangle"></i> Failed Attempts
                  </th>
                  <th style="min-width: 100px;">
                    <i class="fas fa-calendar-times"></i> Expires
                  </th>
                  <th style="min-width: 200px;">
                    <i class="fas fa-cogs"></i> Actions
                  </th>
                </tr>
              </thead>
              <tbody id="users-table-tbody">
                <!-- Users will be populated by JavaScript -->
                <tr>
                  <td colspan="10" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-spinner fa-spin"></i> Loading user accounts...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Table Pagination -->
          <div class="table-pagination" id="users-pagination">
            <div class="pagination-info">
              Showing <span id="users-start">0</span> to <span id="users-end">0</span> of <span id="users-total">0</span> users
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="users-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="users-pages"></span>
              <button class="btn btn-sm btn-secondary" id="users-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Security Audit Log -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-shield-alt"></i> Security Audit Log & Activity Monitoring</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-audit-log" title="Refresh audit log">
                <i class="fas fa-sync-alt"></i> Refresh Log
              </button>
              <button class="btn btn-info btn-sm" id="export-audit-log" title="Export audit log">
                <i class="fas fa-file-export"></i> Export Log
              </button>
              <button class="btn btn-warning btn-sm" id="clear-audit-log" title="Clear old audit entries">
                <i class="fas fa-trash"></i> Clear Old Entries
              </button>
            </div>
          </div>
          
          <!-- Audit Log Filters -->
          <div class="table-filters">
            <h6><i class="fas fa-search"></i> Audit Log Search & Filters</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="audit-from-date">
                  <i class="fas fa-calendar"></i> From Date
                </label>
                <input type="date" id="audit-from-date">
              </div>
              
              <div class="form-group">
                <label for="audit-to-date">
                  <i class="fas fa-calendar"></i> To Date
                </label>
                <input type="date" id="audit-to-date">
              </div>
              
              <div class="form-group">
                <label for="audit-action-type">
                  <i class="fas fa-list"></i> Action Type
                </label>
                <select id="audit-action-type">
                  <option value="">All Actions</option>
                  <option value="Login">üîì Login Attempts</option>
                  <option value="Logout">üîí Logout Events</option>
                  <option value="Create User">üë§ User Creation</option>
                  <option value="Modify User">‚úèÔ∏è User Modifications</option>
                  <option value="Delete User">üóëÔ∏è User Deletions</option>
                  <option value="Failed Login">‚ùå Failed Login Attempts</option>
                  <option value="Password Change">üîë Password Changes</option>
                  <option value="Role Change">üëë Role Changes</option>
                  <option value="Account Lock">üîê Account Locks</option>
                  <option value="Account Unlock">üîì Account Unlocks</option>
                  <option value="Data Access">üìä Data Access</option>
                  <option value="Settings Change">‚öôÔ∏è Settings Changes</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <button class="btn btn-primary" id="apply-audit-filters" title="Apply audit filters">
                  <i class="fas fa-search"></i> Search Log
                </button>
                <button class="btn btn-secondary" id="clear-audit-filters" title="Clear audit filters">
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
          </div>
          
          <!-- Audit Log Table -->
          <div class="table-container">
            <table class="data-table" id="audit-log-table">
              <thead>
                <tr>
                  <th style="min-width: 140px;">
                    <i class="fas fa-clock"></i> Timestamp
                  </th>
                  <th style="min-width: 100px;">
                    <i class="fas fa-user"></i> User
                  </th>
                  <th style="min-width: 120px;">
                    <i class="fas fa-list"></i> Action
                  </th>
                  <th style="min-width: 100px;">
                    <i class="fas fa-crosshairs"></i> Target
                  </th>
                  <th style="min-width: 120px;">
                    <i class="fas fa-network-wired"></i> IP Address
                  </th>
                  <th style="min-width: 80px;">
                    <i class="fas fa-check-circle"></i> Status
                  </th>
                  <th style="min-width: 200px;">
                    <i class="fas fa-info-circle"></i> Details
                  </th>
                  <th style="min-width: 80px;">
                    <i class="fas fa-cogs"></i> Actions
                  </th>
                </tr>
              </thead>
              <tbody id="audit-log-tbody">
                <!-- Audit log will be populated by JavaScript -->
                <tr>
                  <td colspan="8" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-spinner fa-spin"></i> Loading audit log entries...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Audit Log Pagination -->
          <div class="table-pagination" id="audit-pagination">
            <div class="pagination-info">
              Showing <span id="audit-start">0</span> to <span id="audit-end">0</span> of <span id="audit-total">0</span> audit entries
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="audit-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="audit-pages"></span>
              <button class="btn btn-sm btn-secondary" id="audit-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Royalty Records -->
      <section id="royalty-records">
        <div class="page-header">
          <div class="page-title">
            <h1>Royalty Records</h1>
            <p>Manage and review all royalty payments</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Record Payment</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Record Royalty Payment</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="entity">Entity</label>
              <select id="entity" aria-describedby="entity-validation">
                <option>Select Entity</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="entity-validation">Entity is required</div>
            </div>
            <div class="form-group">
              <label for="mineral">Mineral</label>
              <select id="mineral" aria-describedby="mineral-validation">
                <option>Select Mineral</option>
                <option>Coal</option>
                <option>Iron Ore</option>
                <option>Green Chert</option>
                <option>Gravel</option>
                <option>River Sand</option>
                <option>Plaster Sand</option>
                <option>Quarried Stone</option>
              </select>
              <div class="validation-error" id="mineral-validation">Mineral is required</div>
            </div>
            <div class="form-group">
              <label for="volume">Volume (m¬≥)</label>
              <input type="number" id="volume" placeholder="Volume (m¬≥)" aria-describedby="volume-validation">
              <div class="validation-error" id="volume-validation">Volume must be a positive number</div>
            </div>
            <div class="form-group">
              <label for="tariff">Royalty Tariff (E/m¬≥)</label>
              <input type="number" id="tariff" placeholder="Tariff (E/m¬≥)" aria-describedby="tariff-validation">
              <div class="validation-error" id="tariff-validation">Tariff must be a positive number</div>
            </div>
            <div class="form-group">
              <label for="payment-date">Date</label>
              <input type="date" id="payment-date" aria-describedby="date-validation">
              <div class="validation-error" id="date-validation">Date is required</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-success" id="save-royalty-btn">Save Royalty</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Royalty Records Table</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="filter-entity">Entity</label>
              <select id="filter-entity">
                <option>All Entities</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
              <button class="btn btn-primary">Export Report</button>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Entity</th>
                  <th>Mineral</th>
                  <th>Volume (m¬≥)</th>
                  <th>Tariff (E/m¬≥)</th>
                  <th>Royalties (E)</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="royalty-records-tbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Contract Management -->
      <section id="contract-management">
        <div class="page-header">
          <div class="page-title">
            <h1>Contract Management</h1>
            <p>Manage royalty agreements for mines and quarries</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Add Contract</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Add Contract</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="contract-entity">Entity</label>
              <select id="contract-entity" aria-describedby="contract-entity-validation">
                <option>Select Entity</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="contract-entity-validation">Entity is required</div>
            </div>
            <div class="form-group">
              <label for="royalty-rate">Royalty Rate (E/m¬≥)</label>
              <input type="number" id="royalty-rate" placeholder="Royalty Rate (E/m¬≥)" aria-describedby="royalty-rate-validation">
              <div class="validation-error" id="royalty-rate-validation">Rate is required</div>
            </div>
            <div class="form-group">
              <label for="start-date">Start Date</label>
              <input type="date" id="start-date" aria-describedby="start-date-validation">
              <div class="validation-error" id="start-date-validation">Start date is required</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-success">Save Contract</button>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Entity</th>
                <th>Royalty Rate (E/m¬≥)</th>
                <th>Start Date</th>
                <th>Document</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Audit Dashboard -->
      <section id="audit-dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1>Audit Dashboard</h1>
            <p>Review discrepancies and audit reports</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Export Report</button>
          </div>
        </div>
        <div class="user-form-container">
          <div class="grid-4">
            <div class="form-group">
              <label for="audit-filter-entity">Entity</label>
              <select id="audit-filter-entity">
                <option>All Entities</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
            </div>
          </div>
          <h4>Discrepancies</h4>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Project</th>
                  <th>Mineral</th>
                  <th>Declared (m¬≥)</th>
                  <th>Verified (m¬≥)</th>
                  <th>Outstanding (E)</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Reporting & Analytics -->
      <section id="reporting-analytics">
        <div class="page-header">
          <div class="page-title">
            <h1>Reporting & Analytics</h1>
            <p>Comprehensive reporting, real-time analytics, and KPI dashboards for stakeholder insights</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Export Dashboard</button>
            <button class="btn btn-primary">Schedule Report</button>
            <button class="btn btn-success">Generate Report</button>
          </div>
        </div>
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3>Total Revenue (YTD)</h3>
              <select class="metric-period">
                <option>2024</option>
                <option>2023</option>
                <option>All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p>E 2,847,650.00</p>
              <small class="trend-positive">+15.8% from last year</small>
              <div class="mini-chart">Trend</div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Production Volume</h3>
              <select class="metric-period">
                <option>This Quarter</option>
                <option>Last Quarter</option>
                <option>YTD</option>
              </select>
            </div>
            <div class="card-body">
              <p>485,250 m¬≥</p>
              <small class="trend-positive">+08.2% from last quarter</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Collection Rate</h3>
            </div>
            <div class="card-body">
              <p>96.5%</p>
              <small>Maintained high collection rate</small>
              <div class="collection-progress">
                <div class="progress-bar" style="width: 96.5%;"></div>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Outstanding Amounts</h3>
            </div>
            <div class="card-body">
              <p>E 125,400.00</p>
              <small>3 entities with overdue payments</small>
              <button class="btn btn-primary btn-sm">View Details</button>
            </div>
          </div>
        </div>
        <div class="user-form-container">
          <div class="report-tabs">
            <button class="tab-btn active" data-tab="#quick-reports">Quick Reports</button>
            <button class="tab-btn" data-tab="#custom-reports">Custom Reports</button>
            <button class="tab-btn" data-tab="#scheduled-reports">Scheduled Reports</button>
            <button class="btn tab-btn" data-tab="#audit-trail-reports">Audit Trail Reports</button>
          </div>
          <div class="tab-content active" id="quick-reports">
            <div class="quick-reports-grid">
              <div class="report-card">
                <div class="report-icon">üìä</div>
                <div class="report-info">
                  <h5>Monthly Royalty Summary</h5>
                  <p>Comprehensive overview of all royalty payments for the current month</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 2-3 minutes</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">üìà</div>
                <div class="report-info">
                  <h5>Entity Performance Analysis</h5>
                  <p>Production and payment metrics by mining entity</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 3-5 minutes</span>
                    <span><i class="fas fa-file-excel"></i> Excel</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">üìã</div>
                <div class="report-info">
                  <h5>Compliance Status Report</h5>
                  <p>Current compliance standings and upcoming requirements</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 1-2 minutes</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">üí∞</div>
                <div class="report-info">
                  <h5>Outstanding Payments</h5>
                  <p>Detailed breakdown of overdue and pending payments</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 1 minute</span>
                    <span><i class="fas fa-file-csv"></i> CSV</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
            </div>
          </div>
          <div class="tab-content" id="custom-reports">
            <div class="custom-report-builder">
              <div class="builder-section">
                <h5><i class="fas fa-filter"></i> Report Criteria</h5>
                <div class="grid-4">
                  <div class="form-group">
                    <label for="report-type">Report Type</label>
                    <select id="report-type" aria-describedby="report-type-validation">
                      <option>Select Report Type</option>
                      <option>Financial Analysis</option>
                      <option>Production Analysis</option>
                      <option>Compliance Tracking</option>
                      <option>Entity Performance</option>
                      <option>Audit & Verification</option>
                      <option>Comparative Analysis</option>
                    </select>
                    <div class="validation-error" id="report-type-validation">Report type is required</div>
                  </div>
                  <div class="form-group">
                    <label for="report-period">Period</label>
                    <select id="report-period" aria-describedby="period-validation">
                      <option>Select Period</option>
                      <option>Monthly</option>
                      <option>Quarterly</option>
                      <option>Yearly</option>
                      <option>Custom Range</option>
                    </select>
                    <div class="validation-error" id="period-validation">Period is required</div>
                  </div>
                  <div class="form-group">
                    <label for="report-entity">Entity</label>
                    <select id="report-entity" aria-describedby="entity-report-validation">
                      <option>All Entities</option>
                      <option>Kwalini Quarry</option>
                      <option>Mbabane Quarry</option>
                      <option>Sidvokodvo Quarry</option>
                      <option>Maloma Colliery</option>
                      <option>Ngwenya Mine</option>
                      <option>Malolotja Mine</option>
                    </select>
                    <div class="validation-error" id="entity-report-validation">Entity selection required</div>
                  </div>
                  <div class="form-group">
                    <label for="output-format">Output Format</label>
                    <select id="output-format" aria-describedby="format-validation">
                      <option>PDF</option>
                      <option>Excel</option>
                      <option>CSV</option>
                      <option>HTML</option>
                    </select>
                    <div class="validation-error" id="format-validation">Output format is required</div>
                  </div>
                </div>
              </div>
              <div class="builder-section">
                <h5><i class="fas fa-chart-bar"></i> Metrics Selection</h5>
                <div class="metrics-selector">
                  <div class="metric-category">
                    <h6>Financial Metrics</h6>
                    <div class="metric-options">
                      <label class="checkbox-label"><input type="checkbox">Total Royalties</label>
                      <label class="checkbox-label"><input type="checkbox">Outstanding Payments</label>
                      <label class="checkbox-label"><input type="checkbox">Revenue Trends</label>
                    </div>
                  </div>
                  <div class="metric-category">
                    <h6>Production Metrics</h6>
                    <div class="metric-options">
                      <label class="checkbox-label"><input type="checkbox">Volume Extracted</label>
                      <label class="checkbox-label"><input type="checkbox">Production Rate</label>
                    </div>
                  </div>
                  <div class="metric-category">
                    <h6>Compliance Metrics</h6>
                    <div class="metric-options">
                      <label class="checkbox-label"><input type="checkbox">Compliance Rate</label>
                      <label class="checkbox-label"><input type="checkbox">Audit Findings</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <button class="btn btn-secondary">Reset</button>
                <button class="btn btn-success">Preview Report</button>
              </div>
            </div>
          </div>
          <div class="tab-content" id="scheduled-reports">
            <div class="scheduled-reports-header">
              <button class="btn btn-success">Add Scheduled Report</button>
            </div>
            <div class="scheduled-reports-list">
              <div class="schedule-item">
                <div class="schedule-info">
                  <h5>Weekly Royalty Summary</h5>
                  <p>Summary of royalty payments sent every Monday</p>
                  <div class="schedule-details">
                    <span><i class="fas fa-clock"></i> Weekly on Monday at 9 AM</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                    <span><i class="fas fa-envelope"></i> finance@example.com</span>
                  </div>
                </div>
                <div class="schedule-actions">
                  <button class="btn btn-primary btn-sm">Edit</button>
                  <button class="btn btn-danger btn-sm">Delete</button>
                </div>
              </div>
              <div class="schedule-item active">
                <div class="schedule-info">
                  <h5>Monthly Compliance Report</h5>
                  <p>Compliance status sent to all entities monthly</p>
                  <div class="schedule-details">
                    <span><i class="fas fa-clock"></i> Monthly on 1st at 8 AM</span>
                    <span><i class="fas fa-file-excel"></i> Excel</span>
                    <span><i class="fas fa-envelope"></i> Active</span>
                  </div>
                </div>
                <div class="schedule-actions">
                  <button class="btn btn-primary btn-sm">Edit</button>
                  <button class="btn btn-danger btn-sm">Delete</button>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="audit-trail-reports">
            <div class="report-history-controls">
              <div class="grid-4">
                <div class="form-group">
                  <label for="audit-report-from-date">From Date</label>
                  <input type="date" id="audit-report-from-date">
                </div>
                <div class="form-group">
                  <label for="audit-report-to-date">To Date</label>
                  <input type="date" id="audit-report-to-date">
                </div>
                <div class="form-group">
                  <label for="audit-report-type">Report Type</label>
                  <select id="audit-report-type">
                    <option>All Types</option>
                    <option>Financial</option>
                    <option>Production</option>
                    <option>Compliance</option>
                    <option>Audit</option>
                  </select>
                </div>
                <div class="form-group">
                  <button class="btn btn-primary">Generate Audit Report</button>
                </div>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Report Name</th>
                    <th>Type</th>
                    <th>Generated</th>
                    <th>By</th>
                    <th>Format</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Financial Audit Q2</td>
                    <td class="report-type financial">Financial</td>
                    <td>2024-07-01</td>
                    <td>Admin</td>
                    <td>PDF</td>
                    <td>
                      <button class="btn btn-primary btn-sm">View</button>
                      <button class="btn btn-secondary btn-sm">Download</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Communication -->
      <section id="communication">
        <div class="page-header">
          <div class="page-title">
            <h1>Communication</h1>
            <p>Manage notifications and messages to stakeholders</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Send Message</button>
            <button class="btn btn-primary">View Message History</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Send New Message</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="recipient">Recipient</label>
              <select id="recipient" aria-describedby="recipient-validation">
                <option>Select Recipient</option>
                <option>All Entities</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="recipient-validation">Recipient is required</div>
            </div>
            <div class="form-group">
              <label for="message-type">Message Type</label>
              <select id="message-type" aria-describedby="message-type-validation">
                <option>Select Type</option>
                <option>Payment Reminder</option>
                <option>Compliance Notice</option>
                <option>General Announcement</option>
              </select>
              <div class="validation-error" id="message-type-validation">Message type is required</div>
            </div>
            <div class="form-group">
              <label for="subject">Subject</label>
              <input type="text" id="subject" placeholder="Subject" aria-describedby="subject-validation">
              <div class="validation-error" id="subject-validation">Subject is required</div>
            </div>
          </div>
          <div class="form-group">
            <label for="message-content">Message Content</label>
            <textarea id="message-content" rows="5" placeholder="Enter your message here" aria-describedby="content-validation"></textarea>
            <div class="validation-error" id="content-validation">Message content is required</div>
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary">Cancel</button>
            <button class="btn btn-success">Send Message</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Message History</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="filter-recipient">Recipient</label>
              <select id="filter-recipient">
                <option>All Recipients</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-message-type">Message Type</label>
              <select id="filter-message-type">
                <option>All Types</option>
                <option>Payment Reminder</option>
                <option>Compliance Notice</option>
                <option>General Announcement</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Recipient</th>
                  <th>Type</th>
                  <th>Subject</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Notifications -->
      <section id="notifications">
        <div class="page-header">
          <div class="page-title">
            <h1>Notifications</h1>
            <p>View and manage system alerts and notifications</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Mark All as read</button>
            <button class="btn btn-primary">Clear Notifications</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Recent Notifications</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="filter-notification-type">Type</label>
              <select id="filter-notification-type">
                <option>All Types</option>
                <option>Payment Due</option>
                <option>Compliance Alert</option>
                <option>System Update</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-notification-status">Status</label>
              <select id="filter-notification-status">
                <option>All Statuses</option>
                <option>Unread</option>
                <option>Read</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Message</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>2024-05-10</td>
                  <td class="report-type warning">Payment Due</td>
                  <td>Payment overdue for Kwalini Quarry</td>
                  <td>Unread</td>
                </tr>
                <tr>
                  <td>2024-05-09</td>
                  <td class="report-type compliance">Compliance</td>
                  <td>Compliance report submitted</td>
                  <td>Read</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Compliance -->
      <section id="compliance">
        <div class="page-header">
          <div class="page-title">
            <h1>Compliance & Regulatory Management</h1>
            <p>Ensure compliance with Eswatini mining laws, regional SADC regulations, and national fiscal requirements</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Generate Compliance Report</button>
            <button class="btn btn-success">Submit to Eswatini Revenue Authority</button>
            <button class="btn btn-secondary">View Regulatory Calendar</button>
          </div>
        </div>
        
        <!-- Compliance Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3>Eswatini Compliance Rate</h3>
              <select class="metric-period">
                <option>Current Quarter</option>
                <option>Previous Quarter</option>
                <option>YTD 2024</option>
              </select>
            </div>
            <div class="card-body">
              <p>98.5%</p>
              <small class="trend-positive">+1.5% from last quarter</small>
              <div class="compliance-breakdown">
                <small>Mining Licenses: 100% | Tax Filings: 97% | Environmental: 99%</small>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Pending Submissions</h3>
            </div>
            <div class="card-body">
              <p>2</p>
              <small>Due within 7 days</small>
              <div class="urgent-items">
                <small>üü° Monthly Royalty Return | üî¥ Environmental Impact Report</small>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Regulatory Alerts</h3>
            </div>
            <div class="card-body">
              <p>1</p>
              <small>New regulation updates</small>
              <div class="alert-summary">
                <small>Mining Act Amendment 2024</small>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Next Audit</h3>
            </div>
            <div class="card-body">
              <p>45 days</p>
              <small>Eswatini Revenue Authority</small>
            </div>
          </div>
        </div>

        <!-- Regulatory Framework Management -->
        <div class="user-form-container">
          <h4>üá∏üáø Eswatini Regulatory Framework</h4>
          <div class="regulatory-tabs">
            <button class="tab-btn active" data-tab="#eswatini-local">Local Laws</button>
            <button class="tab-btn" data-tab="#sadc-regional">SADC Regional</button>
            <button class="tab-btn" data-tab="#fiscal-tax">Fiscal & Tax</button>
            <button class="tab-btn" data-tab="#environmental">Environmental</button>
          </div>
          
          <div class="tab-content active" id="eswatini-local">
            <div class="regulatory-section">
              <h5>Eswatini Mining Laws & Regulations</h5>
              <div class="grid-4">
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Mining Act 2007</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Primary mining legislation governing mineral rights and royalties</p>
                    <div class="regulation-meta">
                      <span>Last Updated: Jan 2024</span>
                      <span>Next Review: Jun 2024</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Mines & Minerals Regulations 2011</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Detailed operational requirements and royalty calculation methods</p>
                    <div class="regulation-meta">
                      <span>Last Updated: Dec 2023</span>
                      <span>Next Review: Mar 2024</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Mineral Royalty Regulations</h6>
                    <span class="status-badge warning">Review Required</span>
                  </div>
                  <div class="regulation-details">
                    <p>Specific royalty rates and payment procedures</p>
                    <div class="regulation-meta">
                      <span>Amendment Due: Feb 2024</span>
                      <span>Action Required: Rate Review</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Mining License Conditions</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>License-specific terms and compliance requirements</p>
                    <div class="regulation-meta">
                      <span>All Licenses Current</span>
                      <span>Renewals: Q3 2024</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="sadc-regional">
            <div class="regulatory-section">
              <h5>SADC Regional Compliance</h5>
              <div class="grid-4">
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>SADC Mining Protocol</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Regional harmonization of mining policies and standards</p>
                    <div class="regulation-meta">
                      <span>Cross-border compliance maintained</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Regional Tax Treaties</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Double taxation agreements with neighboring countries</p>
                    <div class="regulation-meta">
                      <span>SA, Mozambique, Botswana treaties active</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="fiscal-tax">
            <div class="regulatory-section">
              <h5>Fiscal & Tax Structure Compliance</h5>
              <div class="grid-4">
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Eswatini Revenue Authority</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Monthly royalty returns and tax submissions</p>
                    <div class="regulation-meta">
                      <span>Next Filing: 15th Feb 2024</span>
                      <span>Rate: 3-10% depending on mineral</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Corporate Income Tax</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>27.5% corporate tax rate for mining companies</p>
                    <div class="regulation-meta">
                      <span>Annual Return: 30th Jun 2024</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Withholding Tax</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>15% on dividends, 10% on interest and royalties</p>
                    <div class="regulation-meta">
                      <span>Monthly submissions current</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>VAT Registration</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>15% VAT on applicable transactions</p>
                    <div class="regulation-meta">
                      <span>Monthly returns up to date</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="environmental">
            <div class="regulatory-section">
              <h5>Environmental Compliance</h5>
              <div class="grid-4">
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Environmental Impact Assessment</h6>
                    <span class="status-badge warning">Update Due</span>
                  </div>
                  <div class="regulation-details">
                    <p>Annual environmental compliance reporting</p>
                    <div class="regulation-meta">
                      <span>Due: 28th Feb 2024</span>
                      <span>Status: In Progress</span>
                    </div>
                  </div>
                </div>
                <div class="regulation-card">
                  <div class="regulation-header">
                    <h6>Water Use License</h6>
                    <span class="status-badge compliant">Compliant</span>
                  </div>
                  <div class="regulation-details">
                    <p>Water usage reporting and permit compliance</p>
                    <div class="regulation-meta">
                      <span>Permit valid until Dec 2025</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Regulatory Reporting & Submissions -->
        <div class="user-form-container">
          <h4>üìã Regulatory Reporting & Submissions</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="reporting-jurisdiction">Jurisdiction</label>
              <select id="reporting-jurisdiction">
                <option>Eswatini Revenue Authority</option>
                <option>Ministry of Natural Resources</option>
                <option>Environmental Authority</option>
                <option>SADC Secretariat</option>
              </select>
            </div>
            <div class="form-group">
              <label for="report-type">Report Type</label>
              <select id="report-type">
                <option>Monthly Royalty Return</option>
                <option>Quarterly Production Report</option>
                <option>Annual Compliance Certificate</option>
                <option>Environmental Impact Assessment</option>
                <option>Tax Return</option>
                <option>SADC Regional Report</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reporting-period">Reporting Period</label>
              <select id="reporting-period">
                <option>January 2024</option>
                <option>Q4 2023</option>
                <option>Annual 2023</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Generate Report</button>
              <button class="btn btn-success">Submit to Authority</button>
            </div>
          </div>
          
          <!-- Submission Tracking -->
          <h5>Recent Submissions & Deadlines</h5>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Report Type</th>
                  <th>Jurisdiction</th>
                  <th>Due Date</th>
                  <th>Status</th>
                  <th>Submission Date</th>
                  <th>Reference Number</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Monthly Royalty Return</td>
                  <td>Eswatini Revenue Authority</td>
                  <td>15 Feb 2024</td>
                  <td><span class="status-badge pending">Pending</span></td>
                  <td>-</td>
                  <td>-</td>
                  <td>
                    <button class="btn btn-primary btn-sm">Prepare</button>
                    <button class="btn btn-success btn-sm">Submit</button>
                  </td>
                </tr>
                <tr>
                  <td>Environmental Report</td>
                  <td>Environmental Authority</td>
                  <td>28 Feb 2024</td>
                  <td><span class="status-badge warning">In Progress</span></td>
                  <td>-</td>
                  <td>-</td>
                  <td>
                    <button class="btn btn-secondary btn-sm">Continue</button>
                  </td>
                </tr>
                <tr>
                  <td>Quarterly Production</td>
                  <td>Ministry of Natural Resources</td>
                  <td>31 Jan 2024</td>
                  <td><span class="status-badge compliant">Submitted</span></td>
                  <td>29 Jan 2024</td>
                  <td>MNR-Q4-2023-001</td>
                  <td>
                    <button class="btn btn-secondary btn-sm">View</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Compliance Alerts & Notifications -->
        <div class="user-form-container">
          <h4>üö® Compliance Alerts & Deadlines</h4>
          <div class="alert-dashboard">
            <div class="alert-item urgent">
              <div class="alert-icon">üî¥</div>
              <div class="alert-content">
                <h6>Environmental Impact Report Overdue</h6>
                <p>Due: 28 Feb 2024 | Days Overdue: 2</p>
                <div class="alert-actions">
                  <button class="btn btn-danger btn-sm">Submit Now</button>
                  <button class="btn btn-secondary btn-sm">Request Extension</button>
                </div>
              </div>
            </div>
            <div class="alert-item warning">
              <div class="alert-icon">üü°</div>
              <div class="alert-content">
                <h6>Monthly Royalty Return Due Soon</h6>
                <p>Due: 15 Feb 2024 | Days Remaining: 5</p>
                <div class="alert-actions">
                  <button class="btn btn-primary btn-sm">Prepare Report</button>
                </div>
              </div>
            </div>
            <div class="alert-item info">
              <div class="alert-icon">üîµ</div>
              <div class="alert-content">
                <h6>New Mining Act Amendment</h6>
                <p>Effective: 1 Apr 2024 | Review required for compliance impact</p>
                <div class="alert-actions">
                  <button class="btn btn-secondary btn-sm">Review Changes</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Regulatory Calendar -->
        <div class="user-form-container">
          <h4>üìÖ Regulatory Calendar</h4>
          <div class="calendar-view">
            <div class="calendar-header">
              <button class="btn btn-secondary">&lt; Previous</button>
              <h5>February 2024</h5>
              <button class="btn btn-secondary">Next &gt;</button>
            </div>
            <div class="calendar-grid">
              <!-- Simplified calendar representation -->
              <div class="calendar-week">
                <div class="calendar-day">
                  <span class="day-number">15</span>
                  <div class="day-events">
                    <div class="event royalty">Royalty Return Due</div>
                  </div>
                </div>
                <div class="calendar-day">
                  <span class="day-number">28</span>
                  <div class="day-events">
                    <div class="event environmental">Environmental Report</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- New Regulatory Management Section -->
      <section id="regulatory-management">
        <div class="page-header">
          <div class="page-title">
            <h1>Regulatory Management</h1>
            <p>Comprehensive management of jurisdictional requirements and regulatory frameworks</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Regulatory Assessment</button>
            <button class="btn btn-success">Update Compliance Matrix</button>
          </div>
        </div>

        <!-- Jurisdictional Requirements Matrix -->
        <div class="user-form-container">
          <h4>üèõÔ∏è Multi-Jurisdictional Compliance Matrix</h4>
          <div class="jurisdiction-matrix">
            <div class="grid-4">
              <div class="jurisdiction-card">
                <div class="jurisdiction-header">
                  <h6>üá∏üáø Eswatini (Local)</h6>
                  <span class="compliance-score">94%</span>
                </div>
                <div class="jurisdiction-requirements">
                  <div class="requirement-item">
                    <span class="requirement-name">Mining Licenses</span>
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                  <div class="requirement-item">
                    <span class="requirement-name">Royalty Payments</span>
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                  <div class="requirement-item">
                    <span class="requirement-name">Environmental Permits</span>
                    <span class="requirement-status warning">‚ö†Ô∏è</span>
                  </div>
                  <div class="requirement-item">
                    <span class="requirement-name">Tax Filings</span>
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                </div>
              </div>
              
              <div class="jurisdiction-card">
                <div class="jurisdiction-header">
                  <h6>üèõÔ∏è SADC Regional</h6>
                  <span class="compliance-score">100%</span>
                </div>
                <div class="jurisdiction-requirements">
                  <div class="requirement-item">
                    <span class="requirement-name">Regional Protocols</span>
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                  <div class="requirement-item">
                    <span class="requirement-name">Cross-border Trade</span>
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                  <div class="requirement-item">
                    <span class="requirement-name">Environmental
                    <span class="requirement-status compliant">‚úÖ</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tax Structure Management -->
        <div class="user-form-container">
          <h4>üí∞ Tax Structure & Rates Management</h4>
          <div class="tax-structure-grid">
            <div class="tax-category">
              <h6>Mineral Royalties</h6>
              <div class="tax-rates">
                <div class="rate-item">
                  <span>Coal</span>
                  <span class="rate">3%</span>
                  <span class="basis">of gross value</span>
                </div>
                <div class="rate-item">
                  <span>Iron Ore</span>
                  <span class="rate">5%</span>
                  <span class="basis">of gross value</span>
                </div>
                <div class="rate-item">
                  <span>Quarry Products</span>
                  <span class="rate">E15/m¬≥</span>
                  <span class="basis">flat rate</span>
                </div>
                <div class="rate-item">
                  <span>Precious Minerals</span>
                  <span class="rate">10%</span>
                  <span class="basis">of gross value</span>
                </div>
              </div>
            </div>
            
            <div class="tax-category">
              <h6>Corporate Taxes</h6>
              <div class="tax-rates">
                <div class="rate-item">
                  <span>Corporate Income Tax</span>
                  <span class="rate">27.5%</span>
                  <span class="basis">on net profit</span>
                </div>
                <div class="rate-item">
                  <span>Withholding Tax (Dividends)</span>
                  <span class="rate">15%</span>
                  <span class="basis">on distributions</span>
                </div>
                <div class="rate-item">
                  <span>VAT</span>
                  <span class="rate">15%</span>
                  <span class="basis">on applicable sales</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="btn btn-primary">Update Tax Rates</button>
            <button class="btn btn-secondary">Export Tax Schedule</button>
          </div>
        </div>
      </section>

      <!-- My Profile -->
      <section id="profile">
        <div class="page-header">
          <div class="page-title">
            <h1>My Profile</h1>
            <p>Manage your account details and preferences</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Save Changes</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Profile Information</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="profile-username">Username</label>
              <input type="text" id="profile-username" placeholder="Username" aria-describedby="profile-username-validation">
              <div class="validation-error" id="profile-username-validation">Username is required</div>
            </div>
            <div class="form-group">
              <label for="profile-email">Email</label>
              <input type="email" id="profile-email" placeholder="Email" aria-describedby="profile-email-validation">
              <div class="validation-error" id="profile-email-validation">Email is required</div>
            </div>
            <div class="form-group">
              <label for="profile-department">Department</label>
              <select id="profile-department" aria-describedby="profile-department-validation">
                <option>Select Department</option>
                <option>Finance</option>
                <option>Operations</option>
                <option>Compliance</option>
                <option>Audit</option>
                <option>Management</option>
              </select>
              <div class="validation-error" id="profile-department-validation">Department is required</div>
            </div>
          </div>
          <h4>Change Password</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="current-password">Current Password</label>
              <input type="password" id="current-password" placeholder="Current Password" aria-describedby="current-password-validation">
              <div class="validation-error" id="current-password-validation">Current password is required</div>
            </div>
            <div class="form-group">
              <label for="new-profile-password">New Password</label>
              <input type="password" id="new-profile-password" placeholder="New Password" aria-describedby="new-profile-password-validation">
              <div class="validation-error" id="new-profile-password-validation">New password is required</div>
            </div>
            <div class="form-group">
              <label for="confirm-profile-password">Confirm New Password</label>
              <input type="password" id="confirm-profile-password" placeholder="Confirm New Password" aria-describedby="confirm-profile-password-validation">
              <div class="validation-error" id="confirm-profile-password-validation">Passwords must match</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary">Cancel</button>
            <button class="btn btn-success">Update Profile</button>
          </div>
        </div>
      </section>

      <!-- Logout -->
      <section id="logout">
        <div class="page-header">
          <div class="page-title">
            <h1>Logout</h1>
            <p>Securely end your session</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-danger" id="confirm-logout-btn">Confirm Logout</button>
          </div>
        </div>
        <div class="user-form-container">
          <p>Click the button above to log out of the Mining Royalties Manager. Ensure all changes are saved before logging out.</p>
          <div class="logout-warning">
            <h5>‚ö†Ô∏è Before you logout:</h5>
            <ul>
              <li>Save any unsaved changes</li>
              <li>Complete any pending operations</li>
              <li>Close any open reports or forms</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modern Modular JavaScript -->
  <script type="module" src="js/app.js"></script>
  
  <!-- Legacy support for non-module browsers -->
  <script nomodule>
    console.warn('This browser does not support ES6 modules. Please upgrade to a modern browser.');
    
    // Simple fallback for basic functionality
    document.addEventListener('DOMContentLoaded', function() {
      const loadingScreen = document.getElementById('loading-screen');
      const loginSection = document.getElementById('login-section');
      
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        loginSection.style.display = 'flex';
      }, 2000);
      
      // Basic login functionality
      const loginForm = document.querySelector('.login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const appContainer = document.getElementById('app-container');
          loginSection.style.display = 'none';
          appContainer.style.display = 'flex';
        });
      }
    });
  </script>

  <script>
// Enhanced password toggle functionality
function togglePassword(inputId) {
  const input = document.getElementById(inputId);
  if (!input) return;
  
  const container = input.parentElement;
  const button = container.querySelector('.password-toggle-btn');
  const icon = button.querySelector('i');
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.className = 'fas fa-eye-slash';
    button.setAttribute('aria-label', 'Hide password');
  } else {
    input.type = 'password';
    icon.className = 'fas fa-eye';
    button.setAttribute('aria-label', 'Show password');
  }
}

// Enhanced form validation helpers
function validateUsername(username) {
  if (!username || username.trim().length === 0) {
    return { valid: false, message: 'Username is required' };
  }
  if (username.length < 3) {
    return { valid: false, message: 'Username must be at least 3 characters long' };
  }
  if (username.length > 50) {
    return { valid: false, message: 'Username must be less than 50 characters' };
  }
  if (!/^[a-zA-Z0-9._-]+$/.test(username)) {
    return { valid: false, message: 'Username can only contain letters, numbers, dots, dashes, and underscores' };
  }
  // Check for reserved usernames
  const reserved = ['admin', 'root', 'system', 'test', 'demo'];
  if (reserved.includes(username.toLowerCase())) {
    return { valid: false, message: 'This username is reserved' };
  }
  return { valid: true, message: 'Username is available' };
}

function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || email.trim().length === 0) {
    return { valid: false, message: 'Email address is required' };
  }
  if (!emailRegex.test(email)) {
    return { valid: false, message: 'Please enter a valid email address' };
  }
  // Check for valid domain
  const domain = email.split('@')[1];
  if (domain && domain.indexOf('.') === -1) {
    return { valid: false, message: 'Please enter a valid email domain' };
  }
  return { valid: true, message: 'Email address is valid' };
}

function validatePassword(password) {
  if (!password) {
    return { valid: false, message: 'Password is required', strength: 'none', score: 0 };
  }
  
  let score = 0;
  let feedback = [];
  
  // Length check
  if (password.length >= 8) {
    score += 1;
  } else {
    feedback.push('at least 8 characters');
  }
  
  // Lowercase check
  if (/[a-z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('lowercase letters');
  }
  
  // Uppercase check
  if (/[A-Z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('uppercase letters');
  }
  
  // Number check
  if (/[0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('numbers');
  }
  
  // Special character check
  if (/[^a-zA-Z0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('special characters');
  }
  
  let strength = 'weak';
  if (score >= 4) strength = 'strong';
  else if (score >= 3) strength = 'medium';
  
  const isValid = score >= 3;
  const message = isValid 
    ? 'Password strength is good' 
    : `Password needs: ${feedback.join(', ')}`;
  
  return { 
    valid: isValid, 
    message: message,
    strength: strength,
    score: score
  };
}

function validateRequired(value, fieldName) {
  if (!value || value.trim().length === 0) {
    return { valid: false, message: `${fieldName} is required` };
  }
  return { valid: true, message: `${fieldName} is valid` };
}

function showFieldValidation(fieldId, validation) {
  const field = document.getElementById(fieldId);
  const errorElement = document.getElementById(fieldId + '-error');
  const successElement = document.getElementById(fieldId + '-success');
  
  if (!field) return;
  
  // Clear previous states
  field.classList.remove('field-valid', 'field-invalid');
  
  if (validation.valid) {
    field.classList.add('field-valid');
    if (errorElement) errorElement.style.display = 'none';
    if (successElement) {
      successElement.textContent = `‚úì ${validation.message}`;
      successElement.style.display = 'block';
    }
  } else {
    field.classList.add('field-invalid');
    if (successElement) successElement.style.display = 'none';
    if (errorElement) {
      errorElement.textContent = validation.message;
      errorElement.style.display = 'block';
    }
  }
  
  // Update form submit button state
  updateSubmitButtonState();
}

function updatePasswordStrength(password) {
  const validation = validatePassword(password);
  const strengthBar = document.querySelector('.strength-bar-fill');
  const strengthText = document.querySelector('.strength-text');
  const strengthContainer = document.querySelector('.strength-bar');
  
  if (strengthBar && strengthText && strengthContainer) {
    const widthPercent = Math.max((validation.score / 5) * 100, 10);
    strengthBar.style.width = `${widthPercent}%`;
    
    // Remove existing strength classes
    strengthContainer.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
    
    // Add appropriate strength class
    strengthContainer.classList.add(`strength-${validation.strength}`);
    
    if (validation.strength === 'strong') {
      strengthText.textContent = 'Password Strength: Strong';
    } else if (validation.strength === 'medium') {
      strengthText.textContent = 'Password Strength: Medium';
    } else if (validation.strength === 'weak') {
      strengthText.textContent = 'Password Strength: Weak';
    } else {
      strengthText.textContent = 'Password Strength: Enter password';
    }
  }
}

function validatePasswordMatch() {
  const password = document.getElementById('new-password')?.value || '';
  const confirmPassword = document.getElementById('confirm-password')?.value || '';
  
  if (!confirmPassword) {
    return { valid: false, message: 'Please confirm your password' };
  }
  
  const validation = {
    valid: password === confirmPassword && password.length > 0,
    message: password === confirmPassword ? 'Passwords match' : 'Passwords do not match'
  };
  
  showFieldValidation('confirm-password', validation);
  return validation;
}

function updateSubmitButtonState() {
  const submitBtn = document.getElementById('create-user-btn');
  if (!submitBtn) return;
  
  const requiredFields = [
    { id: 'new-username', validator: validateUsername },
    { id: 'new-email', validator: validateEmail },
    { id: 'new-role', validator: (v) => validateRequired(v, 'Role') },
    { id: 'new-department', validator: (v) => validateRequired(v, 'Department') },
    { id: 'new-password', validator: validatePassword }
  ];
  
  let allValid = true;
  
  for (const field of requiredFields) {
    const element = document.getElementById(field.id);
    if (element) {
      const validation = field.validator(element.value);
      if (!validation.valid) {
        allValid = false;
        break;
      }
    }
  }
  
  // Check password match
  const passwordMatch = validatePasswordMatch();
  if (!passwordMatch.valid) {
    allValid = false;
  }
  
  submitBtn.disabled = !allValid;
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
  // Show/hide add user form
  const addUserBtn = document.getElementById('add-user-btn');
  const addUserContainer = document.getElementById('add-user-form-container');
  const closeFormBtn = document.getElementById('close-add-user-form');
  const cancelBtn = document.getElementById('cancel-add-user');
  
  if (addUserBtn && addUserContainer) {
    addUserBtn.addEventListener('click', function() {
      addUserContainer.style.display = 'block';
      addUserContainer.scrollIntoView({ behavior: 'smooth' });
    });
  }
  
  function hideAddUserForm() {
    if (addUserContainer) {
      addUserContainer.style.display = 'none';
      // Reset form
      const form = document.getElementById('add-user-form');
      if (form) form.reset();
      // Clear validations
      document.querySelectorAll('.validation-error, .validation-success').forEach(el => {
        el.style.display = 'none';
      });
      // Reset password strength
      const strengthBar = document.querySelector('.strength-bar-fill');
      const strengthText = document.querySelector('.strength-text');
      if (strengthBar) strengthBar.style.width = '0%';
      if (strengthText) strengthText.textContent = 'Password Strength: Enter password';
    }
  }
  
  if (closeFormBtn) closeFormBtn.addEventListener('click', hideAddUserForm);
  if (cancelBtn) cancelBtn.addEventListener('click', hideAddUserForm);
  
  // Username validation
  const usernameField = document.getElementById('new-username');
  if (usernameField) {
    usernameField.addEventListener('input', function() {
      const validation = validateUsername(this.value);
      showFieldValidation('new-username', validation);
    });
  }
  
  // Email validation
  const emailField = document.getElementById('new-email');
  if (emailField) {
    emailField.addEventListener('input', function() {
      const validation = validateEmail(this.value);
      showFieldValidation('new-email', validation);
    });
  }
  
  // Role validation
  const roleField = document.getElementById('new-role');
  if (roleField) {
    roleField.addEventListener('change', function() {
      const validation = validateRequired(this.value, 'Role');
      showFieldValidation('new-role', validation);
    });
  }
  
  // Department validation
  const departmentField = document.getElementById('new-department');
  if (departmentField) {
    departmentField.addEventListener('change', function() {
      const validation = validateRequired(this.value, 'Department');
      showFieldValidation('new-department', validation);
    });
  }
  
  // Password validation
  const passwordField = document.getElementById('new-password');
  if (passwordField) {
    passwordField.addEventListener('input', function() {
      const validation = validatePassword(this.value);
      showFieldValidation('new-password', validation);
      updatePasswordStrength(this.value);
      
      // Check confirm password if it has a value
      const confirmField = document.getElementById('confirm-password');
      if (confirmField && confirmField.value) {
        validatePasswordMatch();
      }
    });
  }
  
  // Confirm password validation
  const confirmPasswordField = document.getElementById('confirm-password');
  if (confirmPasswordField) {
    confirmPasswordField.addEventListener('input', validatePasswordMatch);
  }
  
  // Bulk selection functionality
  const selectAllCheckbox = document.getElementById('select-all-users');
  const bulkDeleteBtn = document.getElementById('bulk-delete-users');
  
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
      const userCheckboxes = document.querySelectorAll('#users-table-tbody input[type="checkbox"]');
      userCheckboxes.forEach(cb => cb.checked = this.checked);
      updateBulkActions();
    });
  }
  
  function updateBulkActions() {
    const checkedBoxes = document.querySelectorAll('#users-table-tbody input[type="checkbox"]:checked');
    if (bulkDeleteBtn) {
      if (checkedBoxes.length > 0) {
        bulkDeleteBtn.style.display = 'inline-block';
        bulkDeleteBtn.disabled = false;
      } else {
        bulkDeleteBtn.style.display = 'none';
        bulkDeleteBtn.disabled = true;
      }
    }
  }
  
  // Form submission
  const addUserForm = document.getElementById('add-user-form');
  if (addUserForm) {
    addUserForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Final validation
      const isValid = !document.getElementById('create-user-btn').disabled;
      
      if (isValid) {
        // Here you would normally send the data to the server
        console.log('Creating new user...');
        
        // Show success message
        alert('User created successfully!');
        
        // Hide form and reset
        hideAddUserForm();
        
        // Refresh user table (this would be handled by your app.js)
        if (window.populateUserAccounts) {
          window.populateUserAccounts();
        }
      } else {
        alert('Please fix all validation errors before submitting.');
      }
    });
  }
});
</script>
</body>
</html>