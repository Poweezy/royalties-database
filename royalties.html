<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mining Royalties Manager</title>
  <link rel="stylesheet" href="royalties.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>Loading your workspace...</p>
    </div>
  </div>

  <!-- Login Section -->
  <section class="login-section" id="login-section" style="display: none;">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Mining Royalties Manager</h2>
        <p>Secure access to your royalty management system</p>
      </div>
      <form class="login-form">
        <div class="input-group">
          <i class="fas fa-user"></i>
          <input type="text" id="username" placeholder="Username" aria-describedby="username-error" autocomplete="username">
          <div class="validation-error" id="username-error">Username is required</div>
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="password" placeholder="Password" aria-describedby="password-error" autocomplete="current-password">
          <button type="button" class="password-toggle" aria-label="Toggle password visibility">
            <i class="fas fa-eye"></i>
          </button>
          <div class="validation-error" id="password-error">Password is required</div>
        </div>
        <button type="submit" class="btn btn-primary btn-large">Sign In</button>
      </form>
      <div class="login-footer">
        <p>Please contact your administrator for credentials.</p>
      </div>
    </div>
  </section>

  <!-- Main App -->
  <div class="app-container" id="app-container" style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Royalties Manager</h2>
      </div>
      <nav>
        <ul>
          <li><a href="#dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
          <li><a href="#user-management"><i class="fas fa-users"></i> User Management</a></li>
          <li><a href="#royalty-records"><i class="fas fa-file-invoice"></i> Royalty Records</a></li>
          <li><a href="#contract-management"><i class="fas fa-file-contract"></i> Contract Management</a></li>
          <li><a href="#audit-dashboard"><i class="fas fa-shield-alt"></i> Audit Dashboard</a></li>
          <li><a href="#reporting-analytics"><i class="fas fa-chart-bar"></i> Reporting & Analytics</a></li>
          <li><a href="#communication"><i class="fas fa-envelope"></i> Communication</a></li>
          <li><a href="#notifications"><i class="fas fa-bell"></i> Notifications <span>3</span></a></li>
          <li><a href="#compliance"><i class="fas fa-check-circle"></i> Compliance & Regulatory</a></li>
          <li><a href="#regulatory-management"><i class="fas fa-gavel"></i> Regulatory Management</a></li>
          <li><a href="#profile"><i class="fas fa-user"></i> My Profile</a></li>
          <li><a href="#logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard -->
      <section id="dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1>Dashboard</h1>
            <p>Welcome back, <span id="user-name">System Administrator</span> | Last login: <span id="last-login-time">Today, 09:15 AM</span></p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="refresh-dashboard" title="Refresh dashboard data">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <button class="btn btn-primary" id="admin-panel-btn" title="Access Admin Panel">
              <i class="fas fa-cog"></i> Admin Panel
            </button>
            <button class="btn btn-secondary" id="notifications-btn" title="View Notifications">
              <i class="fas fa-bell"></i> <span id="notifications-count">3</span>
            </button>
          </div>
        </div>

        <!-- Key Performance Indicators -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-coins"></i> Total Royalties (YTD)</h3>
              <select class="metric-period" id="royalties-period">
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="all">All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="total-royalties">E 0.00</p>
              <small class="trend-indicator" id="royalties-trend">
                <i class="fas fa-arrow-up trend-positive"></i> +0% from last year
              </small>
              <div class="mini-progress">
                <div class="progress-bar" id="royalties-progress" style="width: 0%;"></div>
              </div>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-industry"></i> Active Entities</h3>
              <select class="metric-period" id="entities-period">
                <option value="current">This Quarter</option>
                <option value="last">Last Quarter</option>
                <option value="ytd">YTD</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-entities">0</p>
              <small class="trend-indicator" id="entities-trend">
                <i class="fas fa-minus trend-stable"></i> No change
              </small>
              <div class="entities-breakdown">
                <small>
                  <span class="entity-type">Mines: <span id="mines-count">0</span></span> | 
                  <span class="entity-type">Quarries: <span id="quarries-count">0</span></span>
                </small>
              </div>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-check-circle"></i> Compliance Rate</h3>
              <button class="btn btn-sm btn-secondary" id="compliance-details" title="View compliance details">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="compliance-rate">0%</p>
              <div class="collection-progress">
                <div class="progress-bar" id="compliance-progress" style="width: 0%;"></div>
              </div>
              <small class="compliance-breakdown">
                <span>Paid: <span id="paid-count">0</span></span> | 
                <span>Pending: <span id="pending-count">0</span></span> | 
                <span>Overdue: <span id="overdue-count">0</span></span>
              </small>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-clock"></i> Pending Approvals</h3>
              <button class="btn btn-sm btn-warning" id="view-pending" title="View pending items">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="pending-approvals">0</p>
              <small id="pending-urgency">No urgent items</small>
              <div class="urgency-indicator">
                <span class="urgent-badge" id="urgent-items" style="display: none;">
                  <i class="fas fa-exclamation-triangle"></i> <span id="urgent-count">0</span> Urgent
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Charts Section -->
        <div class="charts-grid">
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-line"></i> Revenue Trends</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="line" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-line"></i> Line
                </button>
                <button class="chart-btn" data-chart-type="bar" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-bar"></i> Bar
                </button>
                <button class="chart-btn" data-chart-type="area" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-area"></i> Area
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="revenue-trends-chart" aria-label="Revenue trends chart showing monthly royalty collections"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i> 
                Average monthly collection: <strong>E <span id="avg-monthly">0</span></strong> | 
                Peak month: <strong><span id="peak-month">-</span></strong>
              </small>
            </div>
          </div>

          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-pie"></i> Production by Entity</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="pie" data-chart-id="production-by-entity-chart">
                  <i class="fas fa-chart-pie"></i> Pie
                </button>
                <button class="chart-btn" data-chart-type="doughnut" data-chart-id="production-by-entity-chart">
                  <i class="fas fa-circle-notch"></i> Doughnut
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="production-by-entity-chart" aria-label="Production volume breakdown by mining entity"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i> 
                Total production: <strong><span id="total-production">0</span> mÂ³</strong> | 
                Top producer: <strong><span id="top-producer">-</span></strong>
              </small>
            </div>
          </div>
        </div>

        <!-- Recent Activity & Quick Actions -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-history"></i> Recent Activity</h3>
              <button class="btn btn-sm btn-secondary" id="view-all-activity">
                <i class="fas fa-external-link-alt"></i> View All
              </button>
            </div>
            <div class="card-body">
              <div class="activity-list" id="recent-activity">
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-plus-circle text-success"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>New royalty record</strong> added for Kwalini Quarry</p>
                    <small>2 hours ago</small>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-user-plus text-info"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>New user</strong> finance.manager created</p>
                    <small>5 hours ago</small>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-file-alt text-warning"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>Compliance report</strong> submitted to ERA</p>
                    <small>1 day ago</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-body">
              <div class="quick-actions-grid">
                <button class="btn btn-success quick-action-btn" id="add-royalty-record">
                  <i class="fas fa-plus"></i>
                  <span>Add Royalty Record</span>
                </button>
                <button class="btn btn-info quick-action-btn" id="generate-report">
                  <i class="fas fa-file-pdf"></i>
                  <span>Generate Report</span>
                </button>
                <button class="btn btn-warning quick-action-btn" id="view-overdue">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>View Overdue</span>
                </button>
                <button class="btn btn-primary quick-action-btn" id="manage-users">
                  <i class="fas fa-users-cog"></i>
                  <span>Manage Users</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- System Status & Alerts -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> System Alerts</h3>
              <span class="alert-count" id="alert-count-badge">0</span>
            </div>
            <div class="card-body">
              <div class="alerts-container" id="system-alerts">
                <div class="alert-item info">
                  <i class="fas fa-info-circle"></i>
                  <div class="alert-content">
                    <p>System running normally</p>
                    <small>All services operational</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-server"></i> System Status</h3>
              <span class="status-indicator online" id="system-status">
                <i class="fas fa-circle"></i> Online
              </span>
            </div>
            <div class="card-body">
              <div class="system-metrics">
                <div class="metric-row">
                  <span class="metric-label">Database:</span>
                  <span class="metric-value status-good" id="db-status">
                    <i class="fas fa-circle"></i> Connected
                  </span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Last Backup:</span>
                  <span class="metric-value" id="last-backup">Today, 03:00 AM</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Active Sessions:</span>
                  <span class="metric-value" id="active-sessions">3 users</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Uptime:</span>
                  <span class="metric-value" id="system-uptime">7 days, 14 hours</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- User Management -->
      <section id="user-management">
        <div class="page-header">
          <div class="page-title">
            <h1>User Management</h1>
            <p>Comprehensive user administration with role-based access control, security monitoring, and audit trails</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="view-audit-btn" title="View detailed audit logs">
              <i class="fas fa-shield-alt"></i> View Audit Log
            </button>
            <button class="btn btn-primary" id="export-report-btn" title="Export user management report">
              <i class="fas fa-file-export"></i> Export Report
            </button>
            <button class="btn btn-success" id="add-user-btn" title="Add new user account">
              <i class="fas fa-user-plus"></i> Add User
            </button>
          </div>
        </div>
        
        <!-- User Management Metrics Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-users"></i> Active Users</h3>
              <select class="metric-period">
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-users-count">3</p>
              <small><i class="fas fa-circle text-success"></i> Currently active and logged in</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Failed Logins</h3>
              <select class="metric-period">
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
              </select>
            </div>
            <div class="card-body">
              <p id="failed-logins-count">0</p>
              <small><i class="fas fa-shield-alt text-success"></i> Security status: Normal</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> Security Alerts</h3>
            </div>
            <div class="card-body">
              <p id="security-alerts-count">None</p>
              <small><i class="fas fa-check-circle text-success"></i> All systems secure</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-key"></i> Password Compliance</h3>
            </div>
            <div class="card-body">
              <p id="password-compliance-rate">100%</p>
              <small><i class="fas fa-certificate text-success"></i> Meeting security standards</small>
              <div class="mini-progress">
                <div class="progress-bar" style="width: 100%; background: var(--success-color);"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add New User Form -->
        <div class="user-form-container" id="add-user-form-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-user-plus"></i> Add New User Account</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-add-user-form" title="Close form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
          
          <form id="add-user-form" novalidate>
            <div class="grid-4">
              <!-- Username Field -->
              <div class="form-group">
                <label for="new-username">Username</label>
                <input type="text" id="new-username" placeholder="Enter username" aria-describedby="new-username-error" autocomplete="username">
                <div class="validation-error" id="new-username-error">Username is required</div>
                <div class="validation-success" id="new-username-success">Username is available</div>
              </div>
              
              <!-- Email Field -->
              <div class="form-group">
                <label for="new-email">Email Address</label>
                <input type="email" id="new-email" placeholder="user@example.com" aria-describedby="new-email-error">
                <div class="validation-error" id="new-email-error">Valid email is required</div>
                <div class="validation-success" id="new-email-success">Email is valid</div>
              </div>
              
              <!-- Role Field -->
              <div class="form-group">
                <label for="new-role">Role</label>
                <select id="new-role" aria-describedby="new-role-error">
                  <option value="">Select Role</option>
                  <option value="administrator">Administrator</option>
                  <option value="editor">Editor</option>
                  <option value="auditor">Auditor</option>
                  <option value="finance">Finance Officer</option>
                  <option value="viewer">Viewer</option>
                </select>
                <div class="validation-error" id="new-role-error">Role selection is required</div>
                <div class="validation-success" id="new-role-success">Role selected</div>
              </div>
              
              <!-- Department Field -->
              <div class="form-group">
                <label for="new-department">Department</label>
                <select id="new-department" aria-describedby="new-department-error">
                  <option value="">Select Department</option>
                  <option value="administration">Administration</option>
                  <option value="finance">Finance</option>
                  <option value="operations">Operations</option>
                  <option value="audit">Audit & Compliance</option>
                  <option value="legal">Legal Affairs</option>
                </select>
                <div class="validation-error" id="new-department-error">Department selection is required</div>
                <div class="validation-success" id="new-department-success">Department selected</div>
              </div>
              
              <!-- Password Field -->
              <div class="form-group">
                <label for="new-password">Password</label>
                <div class="password-input-container">
                  <input type="password" id="new-password" placeholder="Enter secure password" aria-describedby="new-password-error" autocomplete="new-password">
                  <button type="button" class="password-toggle-btn" onclick="togglePassword('new-password')" aria-label="Show password">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="validation-error" id="new-password-error">Strong password is required</div>
                <div class="validation-success" id="new-password-success">Password is secure</div>
                <div class="password-strength-meter">
                  <div class="strength-bar">
                    <div class="strength-bar-fill" style="width: 0%;"></div>
                  </div>
                  <div class="strength-text">Password Strength: Enter password</div>
                </div>
              </div>
              
              <!-- Confirm Password Field -->
              <div class="form-group">
                <label for="confirm-password">Confirm Password</label>
                <div class="password-input-container">
                  <input type="password" id="confirm-password" placeholder="Confirm password" aria-describedby="confirm-password-error" autocomplete="new-password">
                  <button type="button" class="password-toggle-btn" onclick="togglePassword('confirm-password')" aria-label="Show password">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="validation-error" id="confirm-password-error">Passwords must match</div>
                <div class="validation-success" id="confirm-password-success">Passwords match</div>
              </div>
              
              <!-- Account Expiry Field -->
              <div class="form-group">
                <label for="account-expires">Account Expires (Optional)</label>
                <input type="date" id="account-expires" aria-describedby="account-expires-help">
                <div class="form-help" id="account-expires-help">
                  <i class="fas fa-info-circle"></i> Leave blank for no expiration
                </div>
              </div>
              
              <!-- Additional Options -->
              <div class="form-group">
                <label>Account Options</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="send-welcome-email" checked>
                    Send welcome email with login instructions
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="force-password-change">
                    Force password change on first login
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="account-active" checked>
                    Account is active (can login immediately)
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-add-user">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="button" class="btn btn-warning" id="reset-form">
                <i class="fas fa-undo"></i> Reset Form
              </button>
              <button type="submit" class="btn btn-success" id="create-user-btn" disabled>
                <i class="fas fa-user-plus"></i> Create User
              </button>
            </div>
          </form>
        </div>

        <!-- User Accounts Management Table -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-users-cog"></i> User Accounts Management</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-users" title="Refresh user list">
                <i class="fas fa-sync"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-users" title="Export user list">
                <i class="fas fa-download"></i> Export
              </button>
              <button class="btn btn-danger btn-sm" id="bulk-delete-users" style="display: none;" disabled title="Delete selected users">
                <i class="fas fa-trash"></i> Delete Selected
              </button>
            </div>
          </div>
          
          <!-- Advanced Filtering -->
          <div class="table-filters">
            <h6><i class="fas fa-filter"></i> Filter & Search Options</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="filter-search">Search Users</label>
                <input type="text" id="filter-search" placeholder="Search by name, email, or username...">
              </div>
              
              <div class="form-group">
                <label for="filter-role">Filter by Role</label>
                <select id="filter-role">
                  <option value="">All Roles</option>
                  <option value="administrator">Administrator</option>
                  <option value="editor">Editor</option>
                  <option value="auditor">Auditor</option>
                  <option value="finance">Finance Officer</option>
                  <option value="viewer">Viewer</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filter-status">Filter by Status</label>
                <select id="filter-status">
                  <option value="">All Statuses</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="locked">Locked</option>
                  <option value="expired">Expired</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <label>&nbsp;</label>
                <button class="btn btn-primary" id="apply-filters">
                  <i class="fas fa-search"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" id="clear-filters">
                  <i class="fas fa-times"></i> Clear
                </button>
              </div>
            </div>
          </div>
          
          <!-- Users Data Table -->
          <div class="table-container">
            <table class="data-table" id="users-table">
              <thead>
                <tr>
                  <th>
                    <input type="checkbox" id="select-all-users" title="Select all users">
                  </th>
                  <th sortable data-sort="username">Username <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="email">Email <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="role">Role <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="department">Department <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="status">Status <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="lastLogin">Last Login <i class="fas fa-sort"></i></th>
                  <th sortable data-sort="created">Created <i class="fas fa-sort"></i></th>
                  <th>2FA</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="users-table-tbody">
                <!-- Users will be populated here by JavaScript -->
                <tr>
                  <td><input type="checkbox" name="user-select" value="1"></td>
                  <td>admin</td>
                  <td>admin@government.sz</td>
                  <td><span class="role-badge administrator">Administrator</span></td>
                  <td>Administration</td>
                  <td><span class="status-badge active">Active</span></td>
                  <td>2024-02-15 09:15</td>
                  <td>2024-01-01</td>
                  <td><i class="fas fa-check-circle text-success" title="2FA Enabled"></i></td>
                  <td>
                    <div class="btn-group">
                      <button class="btn btn-info btn-sm" title="Edit user">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-warning btn-sm" title="Reset password">
                        <i class="fas fa-key"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" title="Delete user">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" name="user-select" value="2"></td>
                  <td>j.doe</td>
                  <td>john.doe@government.sz</td>
                  <td><span class="role-badge editor">Editor</span></td>
                  <td>Operations</td>
                  <td><span class="status-badge active">Active</span></td>
                  <td>2024-02-14 16:30</td>
                  <td>2024-01-15</td>
                  <td><i class="fas fa-times-circle text-danger" title="2FA Disabled"></i></td>
                  <td>
                    <div class="btn-group">
                      <button class="btn btn-info btn-sm" title="Edit user">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-warning btn-sm" title="Reset password">
                        <i class="fas fa-key"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" title="Delete user">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" name="user-select" value="3"></td>
                  <td>m.smith</td>
                  <td>mary.smith@government.sz</td>
                  <td><span class="role-badge auditor">Auditor</span></td>
                  <td>Audit & Compliance</td>
                  <td><span class="status-badge inactive">Inactive</span></td>
                  <td>2024-02-10 14:22</td>
                  <td>2024-02-01</td>
                  <td><i class="fas fa-check-circle text-success" title="2FA Enabled"></i></td>
                  <td>
                    <div class="btn-group">
                      <button class="btn btn-info btn-sm" title="Edit user">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-warning btn-sm" title="Reset password">
                        <i class="fas fa-key"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" title="Delete user">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Table Pagination -->
          <div class="table-pagination" id="users-pagination">
            <div class="pagination-info">
              Showing <span id="users-start">1</span> to <span id="users-end">3</span> of <span id="users-total">3</span> users
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="users-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="users-pages">
                <button class="page-btn active">1</button>
              </span>
              <button class="btn btn-sm btn-secondary" id="users-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Security Audit Log -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-shield-alt"></i> Security Audit Log & Activity Monitoring</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-audit-log" title="Refresh audit log">
                <i class="fas fa-sync"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-audit-log" title="Export audit log">
                <i class="fas fa-download"></i> Export
              </button>
              <button class="btn btn-warning btn-sm" id="clear-audit-log" title="Clear old audit entries">
                <i class="fas fa-broom"></i> Clear Old Entries
              </button>
            </div>
          </div>
          
          <!-- Audit Log Filters -->
          <div class="table-filters">
            <h6><i class="fas fa-search"></i> Audit Log Search & Filters</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="audit-filter-user">Filter by User</label>
                <select id="audit-filter-user">
                  <option value="">All Users</option>
                  <option value="admin">admin</option>
                  <option value="j.doe">j.doe</option>
                  <option value="m.smith">m.smith</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="audit-filter-action">Filter by Action</label>
                <select id="audit-filter-action">
                  <option value="">All Actions</option>
                  <option value="login">Login</option>
                  <option value="logout">Logout</option>
                  <option value="failed-login">Failed Login</option>
                  <option value="create-user">Create User</option>
                  <option value="modify-user">Modify User</option>
                  <option value="delete-user">Delete User</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="audit-filter-date">Date Range</label>
                <select id="audit-filter-date">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                  <option value="custom">Custom Range</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <label>&nbsp;</label>
                <button class="btn btn-primary" id="apply-audit-filters">
                  <i class="fas fa-search"></i> Apply
                </button>
                <button class="btn btn-secondary" id="clear-audit-filters">
                  <i class="fas fa-times"></i> Clear
                </button>
              </div>
            </div>
          </div>
          
          <!-- Audit Log Table -->
          <div class="table-container">
            <table class="data-table" id="audit-log-table">
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>IP Address</th>
                  <th>User Agent</th>
                  <th>Status</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="audit-log-tbody">
                <tr>
                  <td>2024-02-15 09:15:23</td>
                  <td>admin</td>
                  <td><span class="action-badge login">Login</span></td>
                  <td>192.168.1.100</td>
                  <td>Chrome 121.0.0.0</td>
                  <td><span class="status-badge active">Success</span></td>
                  <td>Standard login</td>
                </tr>
                <tr>
                  <td>2024-02-15 08:45:12</td>
                  <td>j.doe</td>
                  <td><span class="action-badge data-access">Data Access</span></td>
                  <td>192.168.1.105</td>
                  <td>Firefox 123.0</td>
                  <td><span class="status-badge active">Success</span></td>
                  <td>Accessed royalty records</td>
                </tr>
                <tr>
                  <td>2024-02-14 23:30:45</td>
                  <td>unknown</td>
                  <td><span class="action-badge failed-login">Failed Login</span></td>
                  <td>203.0.113.15</td>
                  <td>Unknown</td>
                  <td><span class="status-badge warning">Failed</span></td>
                  <td>Invalid credentials - blocked</td>
                </tr>
                <tr>
                  <td>2024-02-14 16:30:22</td>
                  <td>admin</td>
                  <td><span class="action-badge create-user">Create User</span></td>
                  <td>192.168.1.100</td>
                  <td>Chrome 121.0.0.0</td>
                  <td><span class="status-badge active">Success</span></td>
                  <td>Created user: m.smith</td>
                </tr>
                <tr>
                  <td>2024-02-14 15:20:18</td>
                  <td>m.smith</td>
                  <td><span class="action-badge logout">Logout</span></td>
                  <td>192.168.1.110</td>
                  <td>Safari 17.2</td>
                  <td><span class="status-badge active">Success</span></td>
                  <td>Manual logout</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Audit Log Pagination -->
          <div class="table-pagination" id="audit-pagination">
            <div class="pagination-info">
              Showing <span id="audit-start">1</span> to <span id="audit-end">5</span> of <span id="audit-total">127</span> audit entries
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="audit-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="audit-pages">
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">...</button>
                <button class="page-btn">26</button>
              </span>
              <button class="btn btn-sm btn-secondary" id="audit-next">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Royalty Records -->
      <section id="royalty-records">
        <div class="page-header">
          <div class="page-title">
            <h1>Royalty Records</h1>
            <p>Manage and review all royalty payments</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Record Payment</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Record Royalty Payment</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="entity">Entity</label>
              <select id="entity" aria-describedby="entity-validation">
                <option>Select Entity</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="entity-validation">Entity is required</div>
            </div>
            <div class="form-group">
              <label for="mineral">Mineral</label>
              <select id="mineral" aria-describedby="mineral-validation">
                <option>Select Mineral</option>
                <option>Coal</option>
                <option>Iron Ore</option>
                <option>Green Chert</option>
                <option>Gravel</option>
                <option>River Sand</option>
                <option>Plaster Sand</option>
                <option>Quarried Stone</option>
              </select>
              <div class="validation-error" id="mineral-validation">Mineral is required</div>
            </div>
            <div class="form-group">
              <label for="volume">Volume (mÂ³)</label>
              <input type="number" id="volume" placeholder="Volume (mÂ³)" aria-describedby="volume-validation">
              <div class="validation-error" id="volume-validation">Volume must be a positive number</div>
            </div>
            <div class="form-group">
              <label for="tariff">Royalty Tariff (E/mÂ³)</label>
              <input type="number" id="tariff" placeholder="Tariff (E/mÂ³)" aria-describedby="tariff-validation">
              <div class="validation-error" id="tariff-validation">Tariff must be a positive number</div>
            </div>
            <div class="form-group">
              <label for="payment-date">Date</label>
              <input type="date" id="payment-date" aria-describedby="date-validation">
              <div class="validation-error" id="date-validation">Date is required</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-success" id="save-royalty-btn">Save Royalty</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Royalty Records Table</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="filter-entity">Entity</label>
              <select id="filter-entity">
                <option>All Entities</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
              <button class="btn btn-primary">Export Report</button>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Entity</th>
                  <th>Mineral</th>
                  <th>Volume (mÂ³)</th>
                  <th>Tariff (E/mÂ³)</th>
                  <th>Royalties (E)</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="royalty-records-tbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Contract Management -->
      <section id="contract-management">
        <div class="page-header">
          <div class="page-title">
            <h1>Contract Management</h1>
            <p>Manage royalty agreements for mines and quarries</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Add Contract</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Add Contract</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="contract-entity">Entity</label>
              <select id="contract-entity" aria-describedby="contract-entity-validation">
                <option>Select Entity</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="contract-entity-validation">Entity is required</div>
            </div>
            <div class="form-group">
              <label for="royalty-rate">Royalty Rate (E/mÂ³)</label>
              <input type="number" id="royalty-rate" placeholder="Royalty Rate (E/mÂ³)" aria-describedby="royalty-rate-validation">
              <div class="validation-error" id="royalty-rate-validation">Rate is required</div>
            </div>
            <div class="form-group">
              <label for="start-date">Start Date</label>
              <input type="date" id="start-date" aria-describedby="start-date-validation">
              <div class="validation-error" id="start-date-validation">Start date is required</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-success">Save Contract</button>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Entity</th>
                <th>Royalty Rate (E/mÂ³)</th>
                <th>Start Date</th>
                <th>Document</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Audit Dashboard -->
      <section id="audit-dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1>Audit Dashboard</h1>
            <p>Review discrepancies and audit reports</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Export Report</button>
          </div>
        </div>
        <div class="user-form-container">
          <div class="grid-4">
            <div class="form-group">
              <label for="audit-filter-entity">Entity</label>
              <select id="audit-filter-entity">
                <option>All Entities</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">Apply Filters</button>
            </div>
          </div>
          <h4>Discrepancies</h4>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Project</th>
                  <th>Mineral</th>
                  <th>Declared (mÂ³)</th>
                  <th>Verified (mÂ³)</th>
                  <th>Outstanding (E)</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Reporting & Analytics -->
      <section id="reporting-analytics">
        <div class="page-header">
          <div class="page-title">
            <h1>Reporting & Analytics</h1>
            <p>Comprehensive reporting, real-time analytics, and KPI dashboards for stakeholder insights</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Export Dashboard</button>
            <button class="btn btn-primary">Schedule Report</button>
            <button class="btn btn-success">Generate Report</button>
          </div>
        </div>
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3>Total Revenue (YTD)</h3>
              <select class="metric-period">
                <option>2024</option>
                <option>2023</option>
                <option>All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p>E 2,847,650.00</p>
              <small class="trend-positive">+15.8% from last year</small>
              <div class="mini-chart">Trend</div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Production Volume</h3>
              <select class="metric-period">
                <option>This Quarter</option>
                <option>Last Quarter</option>
                <option>YTD</option>
              </select>
            </div>
            <div class="card-body">
              <p>485,250 mÂ³</p>
              <small class="trend-positive">+08.2% from last quarter</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Collection Rate</h3>
            </div>
            <div class="card-body">
              <p>96.5%</p>
              <small>Maintained high collection rate</small>
              <div class="collection-progress">
                <div class="progress-bar" style="width: 96.5%;"></div>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3>Outstanding Amounts</h3>
            </div>
            <div class="card-body">
              <p>E 125,400.00</p>
              <small>3 entities with overdue payments</small>
              <button class="btn btn-primary btn-sm">View Details</button>
            </div>
          </div>
        </div>
        <div class="user-form-container">
          <div class="report-tabs">
            <button class="tab-btn active" data-tab="#quick-reports">Quick Reports</button>
            <button class="tab-btn" data-tab="#custom-reports">Custom Reports</button>
            <button class="tab-btn" data-tab="#scheduled-reports">Scheduled Reports</button>
            <button class="btn tab-btn" data-tab="#audit-trail-reports">Audit Trail Reports</button>
          </div>
          <div class="tab-content active" id="quick-reports">
            <div class="quick-reports-grid">
              <div class="report-card">
                <div class="report-icon">ðŸ“Š</div>
                <div class="report-info">
                  <h5>Monthly Royalty Summary</h5>
                  <p>Comprehensive overview of all royalty payments for the current month</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 2-3 minutes</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">ðŸ“ˆ</div>
                <div class="report-info">
                  <h5>Entity Performance Analysis</h5>
                  <p>Production and payment metrics by mining entity</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 3-5 minutes</span>
                    <span><i class="fas fa-file-excel"></i> Excel</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">ðŸ“‹</div>
                <div class="report-info">
                  <h5>Compliance Status Report</h5>
                  <p>Current compliance standings and upcoming requirements</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 1-2 minutes</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
              <div class="report-card">
                <div class="report-icon">ðŸ’°</div>
                <div class="report-info">
                  <h5>Outstanding Payments</h5>
                  <p>Detailed breakdown of overdue and pending payments</p>
                  <div class="report-meta">
                    <span><i class="fas fa-clock"></i> 1 minute</span>
                    <span><i class="fas fa-file-csv"></i> CSV</span>
                  </div>
                </div>
                <button class="btn btn-primary">Generate</button>
              </div>
            </div>
          </div>
          <div class="tab-content" id="custom-reports">
            <div class="custom-report-builder">
              <div class="builder-section">
                <h5><i class="fas fa-filter"></i> Report Criteria</h5>
                <div class="grid-4">
                  <div class="form-group">
                    <label for="report-type">Report Type</label>
                    <select id="report-type" aria-describedby="report-type-validation">
                      <option>Select Report Type</option>
                      <option>Financial Analysis</option>
                      <option>Production Analysis</option>
                      <option>Compliance Tracking</option>
                      <option>Entity Performance</option>
                      <option>Audit & Verification</option>
                      <option>Comparative Analysis</option>
                    </select>
                    <div class="validation-error" id="report-type-validation">Report type is required</div>
                  </div>
                  <div class="form-group">
                    <label for="report-period">Period</label>
                    <select id="report-period" aria-describedby="period-validation">
                      <option>Select Period</option>
                      <option>Monthly</option>
                      <option>Quarterly</option>
                      <option>Yearly</option>
                      <option>Custom Range</option>
                    </select>
                    <div class="validation-error" id="period-validation">Period is required</div>
                  </div>
                  <div class="form-group">
                    <label for="report-entity">Entity</label>
                    <select id="report-entity" aria-describedby="entity-report-validation">
                      <option>All Entities</option>
                      <option>Kwalini Quarry</option>
                      <option>Mbabane Quarry</option>
                      <option>Sidvokodvo Quarry</option>
                      <option>Maloma Colliery</option>
                      <option>Ngwenya Mine</option>
                      <option>Malolotja Mine</option>
                    </select>
                    <div class="validation-error" id="entity-report-validation">Entity selection required</div>
                  </div>
                  <div class="form-group">
                    <label for="output-format">Output Format</label>
                    <select id="output-format" aria-describedby="format-validation">
                      <option>PDF</option>
                      <option>Excel</option>
                      <option>CSV</option>
                      <option>HTML</option>
                    </select>
                    <div class="validation-error" id="format-validation">Output format is required</div>
                  </div>
                </div>
              </div>
              <div class="builder-section">
                <h5><i class="fas fa-chart-bar"></i> Metrics Selection</h5>
                <div class="metrics-selector">
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input type="checkbox" checked> Total Revenue
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox" checked> Production Volume
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox"> Collection Rate
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox"> Outstanding Amounts
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox"> Compliance Status
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox"> Entity Performance
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <button class="btn btn-secondary">Reset</button>
                <button class="btn btn-success">Preview Report</button>
              </div>
            </div>
          </div>
          <div class="tab-content" id="scheduled-reports">
            <div class="scheduled-reports-header">
              <button class="btn btn-success">Add Scheduled Report</button>
            </div>
            <div class="scheduled-reports-list">
              <div class="schedule-item">
                <div class="schedule-info">
                  <h6>Weekly Revenue Report</h6>
                  <p>Every Monday at 9:00 AM</p>
                  <span class="status-badge active">Active</span>
                </div>
                <div class="schedule-actions">
                  <button class="btn btn-sm btn-secondary">Edit</button>
                  <button class="btn btn-sm btn-warning">Pause</button>
                  <button class="btn btn-sm btn-danger">Delete</button>
                </div>
              </div>
              <div class="schedule-item active">
                <div class="schedule-info">
                  <h6>Monthly Compliance Report</h6>
                  <p>First day of each month at 8:00 AM</p>
                  <span class="status-badge active">Active</span>
                </div>
                <div class="schedule-actions">
                  <button class="btn btn-sm btn-secondary">Edit</button>
                  <button class="btn btn-sm btn-warning">Pause</button>
                  <button class="btn btn-sm btn-danger">Delete</button>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="audit-trail-reports">
            <div class="report-history-controls">
              <div class="grid-4">
                <div class="form-group">
                  <label for="audit-report-from">From Date</label>
                  <input type="date" id="audit-report-from">
                </div>
                <div class="form-group">
                  <label for="audit-report-to">To Date</label>
                  <input type="date" id="audit-report-to">
                </div>
                <div class="form-group">
                  <label for="audit-report-user">User</label>
                  <select id="audit-report-user">
                    <option>All users</option>
                    <option>admin</option>
                    <option>finance.user</option>
                  </select>
                </div>
                <div class="form-group">
                  <button class="btn btn-primary">Generate Audit Report</button>
                </div>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Report Name</th>
                    <th>Generated By</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>User Activity Report</td>
                    <td>admin</td>
                    <td>2024-02-10</td>
                    <td>
                      <button class="btn btn-sm btn-secondary">Download</button>
                      <button class="btn btn-sm btn-info">View</button>
                    </td>
                  </tr>
                  <tr>
                    <td>System Changes Log</td>
                    <td>system</td>
                    <td>2024-02-09</td>
                    <td>
                      <button class="btn btn-sm btn-secondary">Download</button>
                      <button class="btn btn-sm btn-info">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Communication -->
      <section id="communication">
        <div class="page-header">
          <div class="page-title">
            <h1>📧 Communication Hub</h1>
            <p>Centralized communication management for stakeholders, entities, and regulatory bodies</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="compose-message-btn">
              <i class="fas fa-plus"></i> Compose Message
            </button>
            <button class="btn btn-primary" id="message-templates-btn">
              <i class="fas fa-file-alt"></i> Templates
            </button>
            <button class="btn btn-info" id="communication-settings-btn">
              <i class="fas fa-cog"></i> Settings
            </button>
          </div>
        </div>

        <!-- Communication Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-envelope"></i> Messages Sent</h3>
              <select class="metric-period">
                <option>This Month</option>
                <option>Last Month</option>
                <option>This Year</option>
              </select>
            </div>
            <div class="card-body">
              <p id="messages-sent-count">127</p>
              <small class="trend-positive">+15% from last month</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-reply"></i> Response Rate</h3>
            </div>
            <div class="card-body">
              <p id="response-rate">89%</p>
              <small>Average response time: 2.3 hours</small>
              <div class="mini-progress">
                <div class="progress-bar" style="width: 89%;"></div>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-users"></i> Active Conversations</h3>
            </div>
            <div class="card-body">
              <p id="active-conversations">23</p>
              <small><i class="fas fa-circle text-success"></i> All conversations monitored</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Urgent Messages</h3>
            </div>
            <div class="card-body">
              <p id="urgent-messages">3</p>
              <small><i class="fas fa-clock text-warning"></i> Requires immediate attention</small>
            </div>
          </div>
        </div>

        <!-- Message Composition -->
        <div class="user-form-container" id="compose-message-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-edit"></i> Compose New Message</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-compose-form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
          
          <form id="compose-message-form" novalidate>
            <div class="grid-4">
              <div class="form-group">
                <label for="message-recipients">Recipients</label>
                <select id="message-recipients" multiple aria-describedby="recipients-validation">
                  <option value="all-entities">All Mining Entities</option>
                  <option value="overdue-entities">Entities with Overdue Payments</option>
                  <option value="regulatory-bodies">Regulatory Bodies</option>
                  <option value="internal-staff">Internal Staff</option>
                  <option value="custom">Custom Recipients...</option>
                </select>
                <div class="validation-error" id="recipients-validation">Recipients are required</div>
              </div>
              
              <div class="form-group">
                <label for="message-priority">Priority Level</label>
                <select id="message-priority" aria-describedby="priority-validation">
                  <option value="low">Low</option>
                  <option value="normal" selected>Normal</option>
                  <option value="high">High</option>
                  <option value="urgent">Urgent</option>
                </select>
                <div class="validation-error" id="priority-validation">Priority is required</div>
              </div>
              
              <div class="form-group">
                <label for="message-template">Use Template</label>
                <select id="message-template">
                  <option value="">Start from scratch</option>
                  <option value="payment-reminder">Payment Reminder</option>
                  <option value="compliance-notice">Compliance Notice</option>
                  <option value="regulatory-update">Regulatory Update</option>
                  <option value="audit-notification">Audit Notification</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="message-schedule">Schedule Delivery</label>
                <input type="datetime-local" id="message-schedule">
                <small class="form-help">Leave empty to send immediately</small>
              </div>
            </div>
            
            <div class="form-group">
              <label for="message-subject">Subject</label>
              <input type="text" id="message-subject" placeholder="Enter message subject" aria-describedby="subject-validation">
              <div class="validation-error" id="subject-validation">Subject is required</div>
            </div>
            
            <div class="form-group">
              <label for="message-content">Message Content</label>
              <textarea id="message-content" rows="8" placeholder="Enter your message here..." aria-describedby="content-validation"></textarea>
              <div class="validation-error" id="content-validation">Message content is required</div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="save-draft-btn">
                <i class="fas fa-save"></i> Save Draft
              </button>
              <button type="button" class="btn btn-info" id="preview-message-btn">
                <i class="fas fa-eye"></i> Preview
              </button>
              <button type="submit" class="btn btn-success" id="send-message-btn">
                <i class="fas fa-paper-plane"></i> Send Message
              </button>
            </div>
          </form>
        </div>

        <!-- Message History and Tracking -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-history"></i> Message History & Tracking</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-messages">
                <i class="fas fa-sync"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-messages">
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table class="data-table" id="messages-table">
              <thead>
                <tr>
                  <th>Date/Time</th>
                  <th>Recipients</th>
                  <th>Subject</th>
                  <th>Priority</th>
                  <th>Status</th>
                  <th>Response Rate</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="messages-table-tbody">
                <tr>
                  <td>2024-02-15 10:30</td>
                  <td>All Mining Entities (12)</td>
                  <td>Monthly Royalty Payment Reminder</td>
                  <td><span class="priority-badge normal">Normal</span></td>
                  <td><span class="status-badge sent">Sent</span></td>
                  <td>75% (9/12)</td>
                  <td>
                    <button class="btn btn-sm btn-info" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary" title="Resend">
                      <i class="fas fa-redo"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td>2024-02-14 15:45</td>
                  <td>Overdue Entities (3)</td>
                  <td>Urgent: Payment Overdue Notice</td>
                  <td><span class="priority-badge urgent">Urgent</span></td>
                  <td><span class="status-badge delivered">Delivered</span></td>
                  <td>100% (3/3)</td>
                  <td>
                    <button class="btn btn-sm btn-info" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-success" title="Follow Up">
                      <i class="fas fa-reply"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Notifications -->
      <section id="notifications">
        <div class="page-header">
          <div class="page-title">
            <h1>🔔 Notifications Center</h1>
            <p>System alerts, reminders, and important updates for mining royalty management</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="mark-all-read-btn">
              <i class="fas fa-check-double"></i> Mark All Read
            </button>
            <button class="btn btn-secondary" id="notification-settings-btn">
              <i class="fas fa-cog"></i> Settings
            </button>
            <button class="btn btn-primary" id="create-notification-btn">
              <i class="fas fa-plus"></i> Create Alert
            </button>
          </div>
        </div>

        <!-- Notification Stats -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> Active Notifications</h3>
            </div>
            <div class="card-body">
              <p id="active-notifications-count">7</p>
              <small><i class="fas fa-circle text-info"></i> 3 unread, 4 read</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Critical Alerts</h3>
            </div>
            <div class="card-body">
              <p id="critical-alerts-count">2</p>
              <small><i class="fas fa-clock text-danger"></i> Requires immediate attention</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-calendar-alt"></i> Scheduled Reminders</h3>
            </div>
            <div class="card-body">
              <p id="scheduled-reminders-count">12</p>
              <small><i class="fas fa-calendar-check text-success"></i> Next: Feb 16, 2024</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-chart-line"></i> System Health</h3>
            </div>
            <div class="card-body">
              <p id="system-health-status">Optimal</p>
              <small><i class="fas fa-check-circle text-success"></i> All systems operational</small>
            </div>
          </div>
        </div>

        <!-- Notification Categories -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-list"></i> Notification Categories</h4>
            <div class="table-actions">
              <div class="notification-filters">
                <button class="filter-btn active" data-filter="all">All (7)</button>
                <button class="filter-btn" data-filter="unread">Unread (3)</button>
                <button class="filter-btn" data-filter="critical">Critical (2)</button>
                <button class="filter-btn" data-filter="payments">Payments (4)</button>
                <button class="filter-btn" data-filter="compliance">Compliance (1)</button>
              </div>
            </div>
          </div>

          <!-- Notifications List -->
          <div class="notifications-list" id="notifications-list">
            <div class="notification-item unread critical">
              <div class="notification-icon critical">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="notification-content">
                <div class="notification-header">
                  <h5>Critical: Payment Overdue - Maloma Colliery</h5>
                  <span class="notification-time">2 hours ago</span>
                </div>
                <p>Maloma Colliery payment is 15 days overdue. Total outstanding: E 145,750.00</p>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-primary">View Details</button>
                  <button class="btn btn-sm btn-warning">Send Reminder</button>
                  <button class="btn btn-sm btn-secondary">Mark Read</button>
                </div>
              </div>
            </div>

            <div class="notification-item unread critical">
              <div class="notification-icon critical">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div class="notification-content">
                <div class="notification-header">
                  <h5>Security Alert: Multiple Failed Login Attempts</h5>
                  <span class="notification-time">4 hours ago</span>
                </div>
                <p>Detected 5 failed login attempts from IP 203.0.113.45 in the last hour</p>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-danger">Block IP</button>
                  <button class="btn btn-sm btn-info">View Logs</button>
                  <button class="btn btn-sm btn-secondary">Mark Read</button>
                </div>
              </div>
            </div>

            <div class="notification-item unread">
              <div class="notification-icon info">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="notification-content">
                <div class="notification-header">
                  <h5>Reminder: Monthly Report Due Tomorrow</h5>
                  <span class="notification-time">6 hours ago</span>
                </div>
                <p>February 2024 royalty report submission deadline is tomorrow at 5:00 PM</p>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-success">Generate Report</button>
                  <button class="btn btn-sm btn-secondary">Mark Read</button>
                </div>
              </div>
            </div>

            <div class="notification-item read">
              <div class="notification-icon success">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="notification-content">
                <div class="notification-header">
                  <h5>Payment Received - Kwalini Quarry</h5>
                  <span class="notification-time">1 day ago</span>
                </div>
                <p>Received royalty payment of E 45,200.00 from Kwalini Quarry for January 2024</p>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-info">View Receipt</button>
                </div>
              </div>
            </div>

            <div class="notification-item read">
              <div class="notification-icon info">
                <i class="fas fa-user-plus"></i>
              </div>
              <div class="notification-content">
                <div class="notification-header">
                  <h5>New User Account Created</h5>
                  <span class="notification-time">2 days ago</span>
                </div>
                <p>User account 'm.smith' created successfully with Auditor role</p>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-info">View User</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notification Settings -->
        <div class="user-form-container" id="notification-settings-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-cog"></i> Notification Preferences</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-settings">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>

          <div class="settings-grid">
            <div class="settings-category">
              <h6>📧 Email Notifications</h6>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox" checked> Payment reminders
                </label>
              </div>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox" checked> Overdue notifications
                </label>
              </div>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox"> Daily summaries
                </label>
              </div>
            </div>

            <div class="settings-category">
              <h6>🔔 System Alerts</h6>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox" checked> Security alerts
                </label>
              </div>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox" checked> System maintenance
                </label>
              </div>
              <div class="setting-item">
                <label class="setting-label">
                  <input type="checkbox"> Performance warnings
                </label>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-secondary">Reset to Defaults</button>
            <button class="btn btn-success">Save Preferences</button>
          </div>
        </div>
      </section>

      <!-- Compliance & Regulatory -->
      <section id="compliance">
        <div class="page-header">
          <div class="page-title">
            <h1>⚖️ Compliance & Regulatory</h1>
            <p>Comprehensive compliance monitoring, regulatory adherence, and audit trail management</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="run-compliance-check-btn">
              <i class="fas fa-check-double"></i> Run Compliance Check
            </button>
            <button class="btn btn-primary" id="generate-compliance-report-btn">
              <i class="fas fa-file-alt"></i> Generate Report
            </button>
            <button class="btn btn-info" id="regulatory-calendar-btn">
              <i class="fas fa-calendar"></i> Regulatory Calendar
            </button>
          </div>
        </div>

        <!-- Compliance Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-shield-check"></i> Overall Compliance</h3>
              <select class="metric-period">
                <option>Current Status</option>
                <option>Last Month</option>
                <option>Last Quarter</option>
              </select>
            </div>
            <div class="card-body">
              <p id="overall-compliance-rate">94%</p>
              <small class="trend-positive">+3% improvement this month</small>
              <div class="compliance-progress">
                <div class="progress-bar" style="width: 94%; background: var(--success-color);"></div>
              </div>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Non-Compliance Issues</h3>
            </div>
            <div class="card-body">
              <p id="non-compliance-count">3</p>
              <small><i class="fas fa-clock text-warning"></i> 2 minor, 1 moderate</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-calendar-check"></i> Upcoming Deadlines</h3>
            </div>
            <div class="card-body">
              <p id="upcoming-deadlines-count">5</p>
              <small><i class="fas fa-clock text-info"></i> Next: Feb 20, 2024</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-file-contract"></i> Regulatory Updates</h3>
            </div>
            <div class="card-body">
              <p id="regulatory-updates-count">2</p>
              <small><i class="fas fa-info-circle text-info"></i> Require review</small>
            </div>
          </div>
        </div>

        <!-- Compliance Categories -->
        <div class="user-form-container">
          <div class="regulatory-tabs">
            <button class="tab-btn active" data-tab="#financial-compliance">Financial Compliance</button>
            <button class="tab-btn" data-tab="#environmental-compliance">Environmental</button>
            <button class="tab-btn" data-tab="#operational-compliance">Operational</button>
            <button class="tab-btn" data-tab="#regulatory-updates">Regulatory Updates</button>
          </div>

          <!-- Financial Compliance -->
          <div class="tab-content active" id="financial-compliance">
            <h5><i class="fas fa-coins"></i> Financial Compliance Status</h5>
            <div class="compliance-grid">
              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Royalty Payment Compliance</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>96% of entities up-to-date with payments</p>
                  <div class="progress-mini">
                    <div class="progress-bar" style="width: 96%;"></div>
                  </div>
                  <small>47/49 entities compliant</small>
                </div>
              </div>

              <div class="compliance-item warning">
                <div class="compliance-header">
                  <h6>Tax Reporting Compliance</h6>
                  <span class="compliance-badge warning">Needs Attention</span>
                </div>
                <div class="compliance-details">
                  <p>3 entities have pending tax returns</p>
                  <small>Deadline: February 28, 2024</small>
                </div>
              </div>

              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Audit Trail Maintenance</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>All transactions properly documented</p>
                  <small>100% audit trail coverage</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Environmental Compliance -->
          <div class="tab-content" id="environmental-compliance">
            <h5><i class="fas fa-leaf"></i> Environmental Compliance Status</h5>
            <div class="compliance-grid">
              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Environmental Impact Assessments</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>All active sites have valid EIAs</p>
                  <small>12/12 sites compliant</small>
                </div>
              </div>

              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Water Usage Permits</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>All water usage within permitted limits</p>
                  <small>Monitoring: Real-time</small>
                </div>
              </div>

              <div class="compliance-item warning">
                <div class="compliance-header">
                  <h6>Rehabilitation Bonds</h6>
                  <span class="compliance-badge warning">Review Required</span>
                </div>
                <div class="compliance-details">
                  <p>2 bonds require renewal this quarter</p>
                  <small>Next review: March 15, 2024</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Operational Compliance -->
          <div class="tab-content" id="operational-compliance">
            <h5><i class="fas fa-cogs"></i> Operational Compliance Status</h5>
            <div class="compliance-grid">
              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Mining Licenses</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>All licenses valid and up-to-date</p>
                  <small>Next renewal: June 2024</small>
                </div>
              </div>

              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Safety Compliance</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>All sites meet safety standards</p>
                  <small>Last inspection: February 10, 2024</small>
                </div>
              </div>

              <div class="compliance-item compliant">
                <div class="compliance-header">
                  <h6>Production Reporting</h6>
                  <span class="compliance-badge success">Compliant</span>
                </div>
                <div class="compliance-details">
                  <p>Monthly reports submitted on time</p>
                  <small>100% reporting compliance</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Regulatory Updates -->
          <div class="tab-content" id="regulatory-updates">
            <h5><i class="fas fa-newspaper"></i> Recent Regulatory Updates</h5>
            <div class="regulatory-updates-list">
              <div class="update-item">
                <div class="update-header">
                  <h6>Mining Tax Amendment Act 2024</h6>
                  <span class="update-date">February 12, 2024</span>
                  <span class="update-priority high">High Priority</span>
                </div>
                <div class="update-content">
                  <p>New tax rates effective April 1, 2024. Royalty rates increased for iron ore and coal.</p>
                  <div class="update-actions">
                    <button class="btn btn-sm btn-primary">Review Changes</button>
                    <button class="btn btn-sm btn-success">Mark Reviewed</button>
                  </div>
                </div>
              </div>

              <div class="update-item">
                <div class="update-header">
                  <h6>Environmental Compliance Guidelines Update</h6>
                  <span class="update-date">February 8, 2024</span>
                  <span class="update-priority medium">Medium Priority</span>
                </div>
                <div class="update-content">
                  <p>Updated guidelines for water usage monitoring and reporting requirements.</p>
                  <div class="update-actions">
                    <button class="btn btn-sm btn-primary">Review Changes</button>
                    <button class="btn btn-sm btn-success">Mark Reviewed</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Compliance Actions -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-tasks"></i> Required Actions & Deadlines</h4>
          </div>
          
          <div class="table-container">
            <table class="data-table" id="compliance-actions-table">
              <thead>
                <tr>
                  <th>Action Required</th>
                  <th>Entity/Department</th>
                  <th>Priority</th>
                  <th>Deadline</th>
                  <th>Status</th>
                  <th>Assigned To</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Update tax return submission</td>
                  <td>Maloma Colliery</td>
                  <td><span class="priority-badge high">High</span></td>
                  <td>2024-02-28</td>
                  <td><span class="status-badge pending">Pending</span></td>
                  <td>Finance Team</td>
                  <td>
                    <button class="btn btn-sm btn-primary">Assign</button>
                    <button class="btn btn-sm btn-success">Complete</button>
                  </td>
                </tr>
                <tr>
                  <td>Renew environmental permit</td>
                  <td>Ngwenya Mine</td>
                  <td><span class="priority-badge medium">Medium</span></td>
                  <td>2024-03-15</td>
                  <td><span class="status-badge in-progress">In Progress</span></td>
                  <td>Compliance Officer</td>
                  <td>
                    <button class="btn btn-sm btn-info">View Progress</button>
                    <button class="btn btn-sm btn-warning">Escalate</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- New Regulatory Management Section -->
      <section id="regulatory-management">
        <div class="page-header">
          <div class="page-title">
            <h1>Regulatory Management</h1>
            <p>Comprehensive management of jurisdictional requirements and regulatory frameworks</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Regulatory Assessment</button>
            <button class="btn btn-success">Update Compliance Matrix</button>
          </div>
        </div>

        <!-- Jurisdictional Requirements Matrix -->
        <div class="user-form-container">
          <h4>🏛️ Multi-Jurisdictional Compliance Matrix</h4>
          <div class="jurisdiction-matrix">
            <div class="grid-4">
              <div class="jurisdiction-card">
                <div class="jurisdiction-header">
                  <h5>🇸🇿 Kingdom of Eswatini</h5>
                  <span class="jurisdiction-status active">Primary Jurisdiction</span>
                </div>
                <div class="jurisdiction-requirements">
                  <ul>
                    <li><i class="fas fa-check-circle text-success"></i> Mining License: Current</li>
                    <li><i class="fas fa-check-circle text-success"></i> Environmental Permit: Valid</li>
                    <li><i class="fas fa-exclamation-triangle text-warning"></i> Annual Return: Due Soon</li>
                    <li><i class="fas fa-check-circle text-success"></i> Tax Compliance: Up to Date</li>
                  </ul>
                </div>
              </div>
              
              <div class="jurisdiction-card">
                <div class="jurisdiction-header">
                  <h5>🌍 SADC Regional</h5>
                  <span class="jurisdiction-status secondary">Secondary Jurisdiction</span>
                </div>
                <div class="jurisdiction-requirements">
                  <ul>
                    <li><i class="fas fa-check-circle text-success"></i> Cross-border Trade: Compliant</li>
                    <li><i class="fas fa-check-circle text-success"></i> Environmental Standards: Met</li>
                    <li><i class="fas fa-info-circle text-info"></i> Regional Reporting: Optional</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tax Structure Management -->
        <div class="user-form-container">
          <h4>💰 Tax Structure & Rates Management</h4>
          <div class="tax-structure-grid">
            <div class="tax-category">
              <h6>Mineral Royalties</h6>
              <div class="tax-rates">
                <div class="rate-item">
                  <span class="mineral-type">Coal</span>
                  <span class="rate-value">E 2.50/m³</span>
                  <span class="rate-status current">Current</span>
                </div>
                <div class="rate-item">
                  <span class="mineral-type">Iron Ore</span>
                  <span class="rate-value">E 3.75/m³</span>
                  <span class="rate-status current">Current</span>
                </div>
                <div class="rate-item">
                  <span class="mineral-type">Quarried Stone</span>
                  <span class="rate-value">E 1.25/m³</span>
                  <span class="rate-status current">Current</span>
                </div>
              </div>
            </div>
            
            <div class="tax-category">
              <h6>Corporate Taxes</h6>
              <div class="tax-rates">
                <div class="rate-item">
                  <span class="mineral-type">Corporate Income Tax</span>
                  <span class="rate-value">27.5%</span>
                  <span class="rate-status current">Current</span>
                </div>
                <div class="rate-item">
                  <span class="mineral-type">Withholding Tax</span>
                  <span class="rate-value">15%</span>
                  <span class="rate-status current">Current</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="btn btn-primary">Update Tax Rates</button>
            <button class="btn btn-secondary">Export Tax Schedule</button>
          </div>
        </div>

        <!-- Regulatory Calendar -->
        <div class="user-form-container">
          <h4>📅 Regulatory Calendar & Deadlines</h4>
          <div class="calendar-view">
            <div class="upcoming-deadlines">
              <h6>📅 Upcoming Regulatory Deadlines</h6>
              <div class="deadline-list">
                <div class="deadline-item">
                  <div class="deadline-date">
                    <span class="day">15</span>
                    <span class="month">Feb</span>
                  </div>
                  <div class="deadline-info">
                    <h6>Monthly Royalty Return</h6>
                    <p>Ministry of Natural Resources</p>
                    <span class="days-remaining">5 days remaining</span>
                  </div>
                  <div class="deadline-actions">
                    <button class="btn btn-primary btn-sm">Prepare</button>
                    <button class="btn btn-success btn-sm">Submit</button>
                  </div>
                </div>
                <div class="deadline-item">
                  <div class="deadline-date">
                    <span class="day">28</span>
                    <span class="month">Feb</span>
                  </div>
                  <div class="deadline-info">
                    <h6>Environmental Report</h6>
                    <p>Environmental Authority</p>
                    <span class="days-remaining">13 days remaining</span>
                  </div>
                  <div class="deadline-actions">
                    <button class="btn btn-primary btn-sm">Prepare</button>
                    <button class="btn btn-success btn-sm">Submit</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- My Profile -->
      <section id="profile">
        <div class="page-header">
          <div class="page-title">
            <h1>My Profile</h1>
            <p>Manage your account details and preferences</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Save Changes</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Profile Information</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="profile-username">Username</label>
              <input type="text" id="profile-username" placeholder="Username" aria-describedby="profile-username-validation">
              <div class="validation-error" id="profile-username-validation">Username is required</div>
            </div>
            <div class="form-group">
              <label for="profile-email">Email</label>
              <input type="email" id="profile-email" placeholder="Email" aria-describedby="profile-email-validation">
              <div class="validation-error" id="profile-email-validation">Email is required</div>
            </div>
            <div class="form-group">
              <label for="profile-department">Department</label>
              <select id="profile-department" aria-describedby="profile-department-validation">
                <option>Select Department</option>
                <option>Finance</option>
                <option>Operations</option>
                <option>Compliance</option>
                <option>Audit</option>
                <option>Management</option>
              </select>
              <div class="validation-error" id="profile-department-validation">Department is required</div>
            </div>
          </div>
          <h4>Change Password</h4>
          <form id="change-password-form" novalidate>
            <!-- Hidden username field for accessibility -->
            <input type="text" id="profile-username-hidden" style="display: none;" autocomplete="username">
            <div class="grid-4">
              <div class="form-group">
                <label for="current-password">Current Password</label>
                <input type="password" id="current-password" placeholder="Current Password" aria-describedby="current-password-validation" autocomplete="current-password">
                <div class="validation-error" id="current-password-validation">Current password is required</div>
              </div>
              <div class="form-group">
                <label for="new-profile-password">New Password</label>
                <input type="password" id="new-profile-password" placeholder="New Password" aria-describedby="new-profile-password-validation" autocomplete="new-password">
                <div class="validation-error" id="new-profile-password-validation">New password is required</div>
              </div>
              <div class="form-group">
                <label for="confirm-profile-password">Confirm New Password</label>
                <input type="password" id="confirm-profile-password" placeholder="Confirm New Password" aria-describedby="confirm-profile-password-validation" autocomplete="new-password">
                <div class="validation-error" id="confirm-profile-password-validation">Passwords must match</div>
              </div>
            </div>
          </form>
          <div class="form-actions">
            <button class="btn btn-secondary">Cancel</button>
            <button class="btn btn-success">Update Profile</button>
          </div>
        </div>
      </section>

      <!-- Logout -->
      <section id="logout">
        <div class="page-header">
          <div class="page-title">
            <h1>Logout</h1>
            <p>Securely end your session</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-danger" id="confirm-logout-btn">Confirm Logout</button>
          </div>
        </div>
        <div class="user-form-container">
          <p>Click the button above to log out of the Mining Royalties Manager. Ensure all changes are saved before logging out.</p>
          <div class="logout-warning">
            <h5>âš ï¸ Before you logout:</h5>
            <ul>
              <li>Save any unsaved changes</li>
              <li>Complete any pending operations</li>
              <li>Close any open reports or forms</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modern Modular JavaScript -->
  <script type="module" src="js/app.js"></script>
  
  <!-- Legacy support for non-module browsers -->
  <script nomodule>
    console.warn('This browser does not support ES6 modules. Please upgrade to a modern browser.');
    
    // Simple fallback for basic functionality
    document.addEventListener('DOMContentLoaded', function() {
      const loadingScreen = document.getElementById('loading-screen');
      const loginSection = document.getElementById('login-section');
      
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        loginSection.style.display = 'flex';
      }, 2000);
      
      // Basic login functionality
      const loginForm = document.querySelector('.login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const appContainer = document.getElementById('app-container');
          loginSection.style.display = 'none';
          appContainer.style.display = 'flex';
        });
      }
    });
  </script>

  <script>
// Enhanced password toggle functionality
function togglePassword(inputId) {
  const input = document.getElementById(inputId);
  if (!input) return;
  
  const container = input.parentElement;
  const button = container.querySelector('.password-toggle-btn');
  const icon = button.querySelector('i');
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.className = 'fas fa-eye-slash';
    button.setAttribute('aria-label', 'Hide password');
  } else {
    input.type = 'password';
    icon.className = 'fas fa-eye';
    button.setAttribute('aria-label', 'Show password');
  }
}

// Enhanced form validation helpers
function validateUsername(username) {
  if (!username || username.trim().length === 0) {
    return { valid: false, message: 'Username is required' };
  }
  if (username.length < 3) {
    return { valid: false, message: 'Username must be at least 3 characters long' };
  }
  if (username.length > 50) {
    return { valid: false, message: 'Username must be less than 50 characters' };
  }
  if (!/^[a-zA-Z0-9._-]+$/.test(username)) {
    return { valid: false, message: 'Username can only contain letters, numbers, dots, dashes, and underscores' };
  }
  // Check for reserved usernames
  const reserved = ['admin', 'root', 'system', 'test', 'demo'];
  if (reserved.includes(username.toLowerCase())) {
    return { valid: false, message: 'This username is reserved' };
  }
  return { valid: true, message: 'Username is available' };
}

function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || email.trim().length === 0) {
    return { valid: false, message: 'Email address is required' };
  }
  if (!emailRegex.test(email)) {
    return { valid: false, message: 'Please enter a valid email address' };
  }
  // Check for valid domain
  const domain = email.split('@')[1];
  if (domain && domain.indexOf('.') === -1) {
    return { valid: false, message: 'Please enter a valid email domain' };
  }
  return { valid: true, message: 'Email address is valid' };
}

function validatePassword(password) {
  if (!password) {
    return { valid: false, message: 'Password is required', strength: 'none', score: 0 };
  }
  
  let score = 0;
  let feedback = [];
  
  // Length check
  if (password.length >= 8) {
    score += 1;
  } else {
    feedback.push('at least 8 characters');
  }
  
  // Lowercase check
  if (/[a-z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('lowercase letters');
  }
  
  // Uppercase check
  if (/[A-Z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('uppercase letters');
  }
  
  // Number check
  if (/[0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('numbers');
  }
  
  // Special character check
  if (/[^a-zA-Z0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('special characters');
  }
  
  let strength = 'weak';
  if (score >= 4) strength = 'strong';
  else if (score >= 3) strength = 'medium';
  
  const isValid = score >= 3;
  const message = isValid 
    ? 'Password strength is good' 
    : `Password needs: ${feedback.join(', ')}`;
  
  return { 
    valid: isValid, 
    message: message,
    strength: strength,
    score: score
  };
}

function validateRequired(value, fieldName) {
  if (!value || value.trim().length === 0) {
    return { valid: false, message: `${fieldName} is required` };
  }
  return { valid: true, message: `${fieldName} is valid` };
}

function showFieldValidation(fieldId, validation) {
  const field = document.getElementById(fieldId);
  const errorElement = document.getElementById(fieldId + '-error');
  const successElement = document.getElementById(fieldId + '-success');
  
  if (!field) return;
  
  // Clear previous states
  field.classList.remove('field-valid', 'field-invalid');
  
  if (validation.valid) {
    field.classList.add('field-valid');
    if (errorElement) errorElement.style.display = 'none';
    if (successElement) {
      successElement.textContent = `âœ“ ${validation.message}`;
      successElement.style.display = 'block';
    }
  } else {
    field.classList.add('field-invalid');
    if (successElement) successElement.style.display = 'none';
    if (errorElement) {
      errorElement.textContent = validation.message;
      errorElement.style.display = 'block';
    }
  }
  
  // Update form submit button state
  updateSubmitButtonState();
}

function updatePasswordStrength(password) {
  const validation = validatePassword(password);
  const strengthBar = document.querySelector('.strength-bar-fill');
  const strengthText = document.querySelector('.strength-text');
  const strengthContainer = document.querySelector('.strength-bar');
  
  if (strengthBar && strengthText && strengthContainer) {
    const widthPercent = Math.max((validation.score / 5) * 100, 10);
    strengthBar.style.width = `${widthPercent}%`;
    
    // Remove existing strength classes
    strengthContainer.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
    
    // Add appropriate strength class
    strengthContainer.classList.add(`strength-${validation.strength}`);
    
    if (validation.strength === 'strong') {
      strengthText.textContent = 'Password Strength: Strong';
    } else if (validation.strength === 'medium') {
      strengthText.textContent = 'Password Strength: Medium';
    } else if (validation.strength === 'weak') {
      strengthText.textContent = 'Password Strength: Weak';
    } else {
      strengthText.textContent = 'Password Strength: Enter password';
    }
  }
}

function validatePasswordMatch() {
  const password = document.getElementById('new-password')?.value || '';
  const confirmPassword = document.getElementById('confirm-password')?.value || '';
  
  if (!confirmPassword) {
    return { valid: false, message: 'Please confirm your password' };
  }
  
  const validation = {
    valid: password === confirmPassword && password.length > 0,
    message: password === confirmPassword ? 'Passwords match' : 'Passwords do not match'
  };
  
  showFieldValidation('confirm-password', validation);
  return validation;
}

function updateSubmitButtonState() {
  const submitBtn = document.getElementById('create-user-btn');
  if (!submitBtn) return;
  
  const requiredFields = [
    { id: 'new-username', validator: validateUsername },
    { id: 'new-email', validator: validateEmail },
    { id: 'new-role', validator: (v) => validateRequired(v, 'Role') },
    { id: 'new-department', validator: (v) => validateRequired(v, 'Department') },
    { id: 'new-password', validator: validatePassword }
  ];
  
  let allValid = true;
  
  for (const field of requiredFields) {
    const element = document.getElementById(field.id);
    if (element) {
      const validation = field.validator(element.value);
      if (!validation.valid) {
        allValid = false;
        break;
      }
    }
  }
  
  // Check password match
  const passwordMatch = validatePasswordMatch();
  if (!passwordMatch.valid) {
    allValid = false;
  }
  
  submitBtn.disabled = !allValid;
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
  // Show/hide add user form
  const addUserBtn = document.getElementById('add-user-btn');
  const addUserContainer = document.getElementById('add-user-form-container');
  const closeFormBtn = document.getElementById('close-add-user-form');
  const cancelBtn = document.getElementById('cancel-add-user');
  
  if (addUserBtn && addUserContainer) {
    addUserBtn.addEventListener('click', function() {
      addUserContainer.style.display = 'block';
      addUserContainer.scrollIntoView({ behavior: 'smooth' });
    });
  }
  
  function hideAddUserForm() {
    if (addUserContainer) {
      addUserContainer.style.display = 'none';
      // Reset form
      const form = document.getElementById('add-user-form');
      if (form) form.reset();
      // Clear validations
      document.querySelectorAll('.validation-error, .validation-success').forEach(el => {
        el.style.display = 'none';
      });
      // Reset password strength
      const strengthBar = document.querySelector('.strength-bar-fill');
      const strengthText = document.querySelector('.strength-text');
      if (strengthBar) strengthBar.style.width = '0%';
      if (strengthText) strengthText.textContent = 'Password Strength: Enter password';
    }
  }
  
  if (closeFormBtn) closeFormBtn.addEventListener('click', hideAddUserForm);
  if (cancelBtn) cancelBtn.addEventListener('click', hideAddUserForm);
  
  // Username validation
  const usernameField = document.getElementById('new-username');
  if (usernameField) {
    usernameField.addEventListener('input', function() {
      const validation = validateUsername(this.value);
      showFieldValidation('new-username', validation);
    });
  }
  
  // Email validation
  const emailField = document.getElementById('new-email');
  if (emailField) {
    emailField.addEventListener('input', function() {
      const validation = validateEmail(this.value);
      showFieldValidation('new-email', validation);
    });
  }
  
  // Role validation
  const roleField = document.getElementById('new-role');
  if (roleField) {
    roleField.addEventListener('change', function() {
      const validation = validateRequired(this.value, 'Role');
      showFieldValidation('new-role', validation);
    });
  }
  
  // Department validation
  const departmentField = document.getElementById('new-department');
  if (departmentField) {
    departmentField.addEventListener('change', function() {
      const validation = validateRequired(this.value, 'Department');
      showFieldValidation('new-department', validation);
    });
  }
  
  // Password validation
  const passwordField = document.getElementById('new-password');
  if (passwordField) {
    passwordField.addEventListener('input', function() {
      const validation = validatePassword(this.value);
      showFieldValidation('new-password', validation);
      updatePasswordStrength(this.value);
      
      // Check confirm password if it has a value
      const confirmField = document.getElementById('confirm-password');
      if (confirmField && confirmField.value) {
        validatePasswordMatch();
      }
    });
  }
  
  // Confirm password validation
  const confirmPasswordField = document.getElementById('confirm-password');
  if (confirmPasswordField) {
    confirmPasswordField.addEventListener('input', validatePasswordMatch);
  }
  
  // Bulk selection functionality
  const selectAllCheckbox = document.getElementById('select-all-users');
  const bulkDeleteBtn = document.getElementById('bulk-delete-users');
  
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
      const userCheckboxes = document.querySelectorAll('#users-table-tbody input[type="checkbox"]');
      userCheckboxes.forEach(cb => cb.checked = this.checked);
      updateBulkActions();
    });
  }
  
  function updateBulkActions() {
    const checkedBoxes = document.querySelectorAll('#users-table-tbody input[type="checkbox"]:checked');
    if (bulkDeleteBtn) {
      if (checkedBoxes.length > 0) {
        bulkDeleteBtn.style.display = 'inline-block';
        bulkDeleteBtn.disabled = false;
      } else {
        bulkDeleteBtn.style.display = 'none';
        bulkDeleteBtn.disabled = true;
      }
    }
  }
  
  // Form submission
  const addUserForm = document.getElementById('add-user-form');
  if (addUserForm) {
    addUserForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Final validation
      const isValid = !document.getElementById('create-user-btn').disabled;
      
      if (isValid) {
        // Here you would normally send the data to the server
        console.log('Creating new user...');
        
        // Show success message
        alert('User created successfully!');
        
        // Hide form and reset
        hideAddUserForm();
        
        // Refresh user table (this would be handled by your app.js)
        if (window.populateUserAccounts) {
          window.populateUserAccounts();
        }
      } else {
        alert('Please fix all validation errors before submitting.');
      }
    });
  }
});
</script>
</body>
</html>


