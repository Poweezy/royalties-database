<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mining Royalties Manager</title>
  <link rel="stylesheet" href="royalties.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script type="module" src="js/app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>Loading your workspace...</p>
    </div>
  </div>

  <!-- Login Section -->
  <section class="login-section" id="login-section">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Mining Royalties Manager</h2>
        <p>Secure access to your royalty management system</p>
      </div>
      <form class="login-form">
        <div class="input-group">
          <i class="fas fa-user"></i>
          <input type="text" id="username" placeholder="Username" aria-describedby="username-error">
          <div class="validation-error" id="username-error">Username is required</div>
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="password" placeholder="Password" aria-describedby="password-error">
          <button type="button" class="password-toggle" aria-label="Toggle password visibility">
            <i class="fas fa-eye"></i>
          </button>
          <div class="validation-error" id="password-error">Password is required</div>
        </div>
        <button type="submit" class="btn btn-primary btn-large">Sign In</button>
      </form>
      <div class="login-footer">
        <p>Please contact your administrator for credentials.</p>
      </div>
    </div>
  </section>

  <!-- Main App -->
  <div class="app-container" id="app-container" style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo" aria-label="Mining Royalties Manager Logo">MR</div>
        <h2>Royalties Manager</h2>
      </div>
      <nav>
        <ul>
          <li><a href="#dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
          <li><a href="#user-management"><i class="fas fa-users"></i> User Management</a></li>
          <li><a href="#royalty-records"><i class="fas fa-file-invoice"></i> Royalty Records</a></li>
          <li><a href="#contract-management"><i class="fas fa-file-contract"></i> Contract Management</a></li>
          <li><a href="#audit-dashboard"><i class="fas fa-shield-alt"></i> Audit Dashboard</a></li>
          <li><a href="#reporting-analytics"><i class="fas fa-chart-bar"></i> Reporting & Analytics</a></li>
          <li><a href="#communication"><i class="fas fa-envelope"></i> Communication</a></li>
          <li><a href="#notifications"><i class="fas fa-bell"></i> Notifications <span>3</span></a></li>
          <li><a href="#compliance"><i class="fas fa-check-circle"></i> Compliance & Regulatory</a></li>
          <li><a href="#regulatory-management"><i class="fas fa-gavel"></i> Regulatory Management</a></li>
          <li><a href="#profile"><i class="fas fa-user"></i> My Profile</a></li>
          <li><a href="#logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard -->
      <section id="dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1>Dashboard</h1>
            <p>Welcome back, <span id="user-name">System Administrator</span> | Last login: <span id="last-login-time">Today, 09:15 AM</span></p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="refresh-dashboard" title="Refresh dashboard data">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <button class="btn btn-primary" id="admin-panel-btn" title="Access Admin Panel">
              <i class="fas fa-cog"></i> Admin Panel
            </button>
            <button class="btn btn-secondary" id="notifications-btn" title="View Notifications">
              <i class="fas fa-bell"></i> <span id="notifications-count">3</span>
            </button>
          </div>
        </div>

        <!-- Key Performance Indicators -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-coins"></i> Total Royalties (YTD)</h3>
              <select class="metric-period" id="royalties-period">
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="all">All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="total-royalties">E 0.00</p>
              <small class="trend-indicator" id="royalties-trend">
                <i class="fas fa-arrow-up trend-positive"></i> +0% from last year
              </small>
              <div class="mini-progress">
                <div class="progress-bar" id="royalties-progress" style="width: 0%;"></div>
              </div>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-industry"></i> Active Entities</h3>
              <select class="metric-period" id="entities-period">
                <option value="current">This Quarter</option>
                <option value="last">Last Quarter</option>
                <option value="ytd">YTD</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-entities">6</p>
              <small class="trend-indicator" id="entities-trend">
                <i class="fas fa-arrow-up trend-positive"></i> +2 new entities
              </small>
              <div class="entities-breakdown">
                <small>
                  <span class="entity-type">Mines: <span id="mines-count">4</span></span> | 
                  <span class="entity-type">Quarries: <span id="quarries-count">2</span></span>
                </small>
              </div>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-check-circle"></i> Compliance Rate</h3>
              <button class="btn btn-sm btn-secondary" id="compliance-details" title="View compliance details">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="compliance-rate">0%</p>
              <div class="collection-progress">
                <div class="progress-bar" id="compliance-progress" style="width: 0%;"></div>
              </div>
              <small class="compliance-breakdown">
                <span>Paid: <span id="paid-count">0</span></span> | 
                <span>Pending: <span id="pending-count">0</span></span> | 
                <span>Overdue: <span id="overdue-count">0</span></span>
              </small>
            </div>
          </div>

          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-clock"></i> Pending Approvals</h3>
              <button class="btn btn-sm btn-warning" id="view-pending" title="View pending items">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="pending-approvals">3</p>
              <small id="pending-urgency">2 urgent items requiring attention</small>
              <div class="urgency-indicator">
                <span class="urgent-badge" id="urgent-items" style="display: inline-flex;">
                  <i class="fas fa-exclamation-triangle"></i> <span id="urgent-count">2</span> Urgent
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Charts Section -->
        <div class="charts-grid">
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-line"></i> Revenue Trends</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="line" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-line"></i> Line
                </button>
                <button class="chart-btn" data-chart-type="bar" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-bar"></i> Bar
                </button>
                <button class="chart-btn" data-chart-type="area" data-chart-id="revenue-trends-chart">
                  <i class="fas fa-chart-area"></i> Area
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="revenue-trends-chart" aria-label="Revenue trends chart showing monthly royalty collections"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i> 
                Average monthly collection: <strong>E <span id="avg-monthly">0</span></strong> | 
                Peak month: <strong><span id="peak-month">-</span></strong>
              </small>
            </div>
          </div>

          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-pie"></i> Production by Entity</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="pie" data-chart-id="production-by-entity-chart">
                  <i class="fas fa-chart-pie"></i> Pie
                </button>
                <button class="chart-btn" data-chart-type="doughnut" data-chart-id="production-by-entity-chart">
                  <i class="fas fa-circle-notch"></i> Doughnut
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="production-by-entity-chart" aria-label="Production volume breakdown by mining entity"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i> 
                Total production: <strong><span id="total-production">0</span> m¬≥</strong> | 
                Top producer: <strong><span id="top-producer">-</span></strong>
              </small>
            </div>
          </div>
        </div>

        <!-- Recent Activity & Quick Actions -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-history"></i> Recent Activity</h3>
              <button class="btn btn-sm btn-secondary" id="view-all-activity">
                <i class="fas fa-external-link-alt"></i> View All
              </button>
            </div>
            <div class="card-body">
              <div class="activity-list" id="recent-activity">
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-plus-circle text-success"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>New royalty record</strong> added for Kwalini Quarry</p>
                    <small>2 hours ago</small>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-user-plus text-info"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>New user</strong> finance.manager created</p>
                    <small>5 hours ago</small>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-file-alt text-warning"></i>
                  </div>
                  <div class="activity-content">
                    <p><strong>Compliance report</strong> submitted to ERA</p>
                    <small>1 day ago</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-body">
              <div class="quick-actions-grid">
                <button class="btn btn-success quick-action-btn" id="add-royalty-record">
                  <i class="fas fa-plus"></i>
                  <span>Add Royalty Record</span>
                </button>
                <button class="btn btn-info quick-action-btn" id="generate-report">
                  <i class="fas fa-file-pdf"></i>
                  <span>Generate Report</span>
                </button>
                <button class="btn btn-warning quick-action-btn" id="view-overdue">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>View Overdue</span>
                </button>
                <button class="btn btn-primary quick-action-btn" id="manage-users">
                  <i class="fas fa-users-cog"></i>
                  <span>Manage Users</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- System Status & Alerts -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> System Alerts</h3>
              <span class="alert-count" id="alert-count-badge">1</span>
            </div>
            <div class="card-body">
              <div class="alerts-container" id="system-alerts">
                <div class="alert-item info">
                  <i class="fas fa-info-circle"></i>
                  <div class="alert-content">
                    <p>System running normally</p>
                    <small>All services operational</small>
                  </div>
                </div>
                 <div class="alert-item warning">
                  <i class="fas fa-exclamation-triangle"></i>
                  <div class="alert-content">
                    <p>Database backup pending</p>
                    <small>Last backup 2 days ago</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-server"></i> System Status</h3>
              <span class="status-indicator online" id="system-status">
                <i class="fas fa-circle"></i> Online
              </span>
            </div>
            <div class="card-body">
              <div class="system-metrics">
                <div class="metric-row">
                  <span class="metric-label">Database:</span>
                  <span class="metric-value status-good" id="db-status">
                    <i class="fas fa-circle"></i> Connected
                  </span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Last Backup:</span>
                  <span class="metric-value" id="last-backup">Today, 03:00 AM</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Active Sessions:</span>
                  <span class="metric-value" id="active-sessions">3 users</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Uptime:</span>
                  <span class="metric-value" id="system-uptime">7 days, 14 hours</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- User Management -->
      <section id="user-management">
        <div class="page-header">
          <div class="page-title">
            <h1>üë• User Management</h1>
            <p>Comprehensive user administration with role-based access control, security monitoring, and audit trails</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="view-audit-btn" title="View detailed audit logs">
              <i class="fas fa-shield-alt"></i> View Audit Log
            </button>
            <button class="btn btn-primary" id="export-report-btn" title="Export user management report">
              <i class="fas fa-file-export"></i> Export Report
            </button>
            <button class="btn btn-success" id="add-user-btn" title="Add new user account">
              <i class="fas fa-user-plus"></i> Add User
            </button>
          </div>
        </div>
        
        <!-- User Management Metrics Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-users"></i> Active Users</h3>
              <select class="metric-period">
                <option>Current</option>
                <option>Last 30 days</option>
                <option>All time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="active-users-count">3</p>
              <small><i class="fas fa-circle text-success"></i> Currently active and logged in</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Failed Logins</h3>
              <select class="metric-period">
                <option>Last 24 hours</option>
                <option>Last 7 days</option>
                <option>Last 30 days</option>
              </select>
            </div>
            <div class="card-body">
              <p id="failed-logins-count">0</p>
              <small><i class="fas fa-shield-alt text-success"></i> Security status: Normal</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-bell"></i> Security Alerts</h3>
            </div>
            <div class="card-body">
              <p id="security-alerts-count">None</p>
              <small><i class="fas fa-check-circle text-success"></i> All systems secure</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-key"></i> Password Compliance</h3>
            </div>
            <div class="card-body">
              <p id="password-compliance-rate">100%</p>
              <small><i class="fas fa-certificate text-success"></i> Meeting security standards</small>
              <div class="mini-progress">
                <div class="progress-bar" style="width: 100%; background: var(--success-color);"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add New User Form -->
        <div class="user-form-container" id="add-user-form-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-user-plus"></i> Add New User Account</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-add-user-form" title="Close form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
          
          <form id="add-user-form" novalidate>
            <div class="grid-4">
              <!-- Username Field -->
              <div class="form-group">
                <label for="new-username">
                  <i class="fas fa-user"></i> Username *
                </label>
                <input 
                  type="text" 
                  id="new-username" 
                  name="username" 
                  placeholder="Enter unique username" 
                  required 
                  aria-describedby="new-username-error new-username-success"
                  autocomplete="off"
                  minlength="3"
                  maxlength="50"
                  pattern="^[a-zA-Z0-9._-]+$"
                >
                <div class="validation-success" id="new-username-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Username is available
                </div>
                <div class="validation-error" id="new-username-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Username is required and must be unique
                </div>
                <small class="form-help">3-50 characters, letters, numbers, dots, dashes, underscores only</small>
              </div>
              
              <!-- Email Field -->
              <div class="form-group">
                <label for="new-email">
                  <i class="fas fa-envelope"></i> Email Address *
                </label>
                <input 
                  type="email" 
                  id="new-email" 
                  name="email" 
                  placeholder="user@eswacaa.sz" 
                  required 
                  aria-describedby="new-email-error new-email-success"
                  autocomplete="email"
                >
                <div class="validation-success" id="new-email-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Email address is valid
                </div>
                <div class="validation-error" id="new-email-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Valid email address is required
                </div>
                <small class="form-help">Must be a valid email address, preferably @eswacaa.sz domain</small>
              </div>
              
              <!-- Role Field -->
              <div class="form-group">
                <label for="new-role">
                  <i class="fas fa-user-tag"></i> User Role *
                </label>
                <select id="new-role" name="role" required aria-describedby="new-role-error">
                  <option value="">Select User Role</option>
                  <option value="ADMIN">üëë ADMIN (Full System Access)</option>
                  <option value="Editor">‚úèÔ∏è Editor (Read/Write Access)</option>
                  <option value="Viewer">üëÅÔ∏è Viewer (Read-Only Access)</option>
                  <option value="Auditor">üîç Auditor (Audit & Compliance Access)</option>
                  <option value="Finance">üí∞ Finance (Financial Data Access)</option>
                </select>
                <div class="validation-error" id="new-role-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a user role
                </div>
                <small class="form-help">Role determines system permissions and access levels</small>
              </div>
              
              <!-- Department Field -->
              <div class="form-group">
                <label for="new-department">
                  <i class="fas fa-building"></i> Department *
                </label>
                <select id="new-department" name="department" required aria-describedby="new-department-error">
                  <option value="">Select Department</option>
                  <option value="Management">üè¢ Management</option>
                  <option value="Finance">üí∞ Finance & Accounting</option>
                  <option value="Operations">‚öôÔ∏è Operations</option>
                  <option value="Compliance">üìã Compliance & Legal</option>
                  <option value="Audit">üîç Audit & Risk</option>
                  <option value="IT">üíª Information Technology</option>
                  <option value="Human Resources">üë• Human Resources</option>
                </select>
                <div class="validation-error" id="new-department-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a department
                </div>
                <small class="form-help">User's organizational department for reporting purposes</small>
              </div>
              
              <!-- Password Field -->
              <div class="form-group">
                <label for="new-password">
                  <i class="fas fa-lock"></i> Password *
                </label>
                <div class="password-input-container">
                  <input 
                    type="password" 
                    id="new-password" 
                    name="password" 
                    placeholder="Enter secure password" 
                    required 
                    aria-describedby="new-password-error"
                    autocomplete="new-password"
                    minlength="8"
                  >
                  <button 
                    type="button" 
                    class="password-toggle-btn" 
                    onclick="togglePassword('new-password')"
                    aria-label="Show password"
                    tabindex="-1"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="password-strength-meter">
                  <div class="strength-bar">
                    <div class="strength-bar-fill" style="width: 0%;"></div>
                  </div>
                  <p class="strength-text">Password Strength: Enter password</p>
                </div>
                <div class="validation-error" id="new-password-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Password must meet security requirements
                </div>
                <small class="form-help">Minimum 8 characters with uppercase, lowercase, number, and special character</small>
              </div>
              
              <!-- Confirm Password Field -->
              <div class="form-group">
                <label for="confirm-password">
                  <i class="fas fa-lock"></i> Confirm Password *
                </label>
                <div class="password-input-container">
                  <input 
                    type="password" 
                    id="confirm-password" 
                    name="confirm-password" 
                    placeholder="Confirm your password" 
                    required 
                    aria-describedby="confirm-password-error confirm-password-success"
                    autocomplete="new-password"
                  >
                  <button 
                    type="button" 
                    class="password-toggle-btn" 
                    onclick="togglePassword('confirm-password')"
                    aria-label="Show password"
                    tabindex="-1"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="validation-success" id="confirm-password-success" style="display: none;">
                  <i class="fas fa-check-circle"></i> Passwords match
                </div>
                <div class="validation-error" id="confirm-password-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Passwords do not match
                </div>
              </div>
              
              <!-- Account Expiry Field -->
              <div class="form-group">
                <label for="account-expires">
                  <i class="fas fa-calendar-alt"></i> Account Expires (Optional)
                </label>
                <input 
                  type="date" 
                  id="account-expires" 
                  name="expires"
                  min="2024-02-01" 
                  aria-describedby="account-expires-help"
                >
                <small class="form-help" id="account-expires-help">
                  <i class="fas fa-info-circle"></i> Leave empty for permanent account. Set expiry for temporary access.
                </small>
              </div>
              
              <!-- Additional Options -->
              <div class="form-group">
                <label><i class="fas fa-cog"></i> Account Options</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" name="force-password-change" value="1">
                    <span>Force password change on first login</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="email-notifications" value="1" checked>
                    <span>Send email notifications to user</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="account-active" value="1" checked>
                    <span>Activate account immediately</span>
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-add-user">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="button" class="btn btn-warning" id="reset-form">
                <i class="fas fa-undo"></i> Reset Form
              </button>
              <button type="submit" class="btn btn-success" id="create-user-btn" disabled>
                <i class="fas fa-user-plus"></i> Create User Account
              </button>
            </div>
          </form>
        </div>

        <!-- User Accounts Management Table -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-users-cog"></i> User Accounts Management</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-users" title="Refresh user list">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-users" title="Export user list">
                <i class="fas fa-download"></i> Export
              </button>
              <button class="btn btn-danger btn-sm" id="bulk-delete-users" style="display: none;" disabled title="Delete selected users">
                <i class="fas fa-trash-alt"></i> Delete Selected (<span id="selected-count">0</span>)
              </button>
            </div>
          </div>
          
          <!-- Advanced Filtering -->
          <div class="table-filters">
            <h6><i class="fas fa-filter"></i> Filter & Search Options</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="filter-user-role">
                  <i class="fas fa-user-tag"></i> Filter by Role
                </label>
                <select id="filter-user-role">
                  <option value="">All Roles</option>
                  <option value="ADMIN">ADMIN</option>
                  <option value="Editor">Editor</option>
                  <option value="Viewer">Viewer</option>
                  <option value="Auditor">Auditor</option>
                  <option value="Finance">Finance</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filter-user-status">
                  <i class="fas fa-toggle-on"></i> Filter by Status
                </label>
                <select id="filter-user-status">
                  <option value="">All Statuses</option>
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                  <option value="Locked">Locked</option>
                  <option value="Expired">Expired</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filter-user-department">
                  <i class="fas fa-building"></i> Filter by Department
                </label>
                <select id="filter-user-department">
                  <option value="">All Departments</option>
                  <option value="Management">Management</option>
                  <option value="Finance">Finance</option>
                  <option value="Operations">Operations</option>
                  <option value="Compliance">Compliance</option>
                  <option value="Audit">Audit</option>
                  <option value="IT">Information Technology</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <button class="btn btn-primary" id="apply-user-filters" title="Apply selected filters">
                  <i class="fas fa-filter"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" id="clear-user-filters" title="Clear all filters">
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
          </div>
          
          <!-- Users Data Table -->
          <div class="table-container">
            <table class="data-table" id="users-table">
              <thead>
                <tr>
                  <th><input type="checkbox" id="select-all-users" title="Select all users"></th>
                  <th sortable>Username</th>
                  <th sortable>Email</th>
                  <th>Role</th>
                  <th>Department</th>
                  <th>Status</th>
                  <th sortable>Last Login</th>
                  <th>Failed Attempts</th>
                  <th>Expires</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="users-table-tbody">
                <!-- Users will be populated by JavaScript -->
                <tr>
                  <td colspan="10" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-user-plus" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                    Loading user accounts...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Table Pagination -->
          <div class="table-pagination" id="users-pagination">
            <div class="pagination-info">
              Showing <span id="users-start">0</span> to <span id="users-end">0</span> of <span id="users-total">0</span> users
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="users-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="users-pages"></span>
              <button class="btn btn-sm btn-secondary" id="users-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Security Audit Log -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-shield-alt"></i> Security Audit Log & Activity Monitoring</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-audit-log" title="Refresh audit log">
                <i class="fas fa-sync-alt"></i> Refresh Log
              </button>
              <button class="btn btn-info btn-sm" id="export-audit-log" title="Export audit log">
                <i class="fas fa-file-export"></i> Export Log
              </button>
              <button class="btn btn-warning btn-sm" id="clear-audit-log" title="Clear old audit entries">
                <i class="fas fa-trash"></i> Clear Old Entries
              </button>
            </div>
          </div>
          
          <!-- Audit Log Filters -->
          <div class="table-filters">
            <h6><i class="fas fa-search"></i> Audit Log Search & Filters</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="audit-from-date">
                  <i class="fas fa-calendar-alt"></i> From Date
                </label>
                <input type="date" id="audit-from-date">
              </div>
              
              <div class="form-group">
                <label for="audit-to-date">
                  <i class="fas fa-calendar-alt"></i> To Date
                </label>
                <input type="date" id="audit-to-date">
              </div>
              
              <div class="form-group">
                <label for="audit-action-type">
                  <i class="fas fa-list"></i> Action Type
                </label>
                <select id="audit-action-type">
                  <option value="">All Actions</option>
                  <option value="Login">Login</option>
                  <option value="Logout">Logout</option>
                  <option value="Create User">Create User</option>
                  <option value="Delete User">Delete User</option>
                  <option value="Password Reset">Password Reset</option>
                  <option value="Data Access">Data Access</option>
                  <option value="Failed Login">Failed Login</option>
                </select>
              </div>
              
              <div class="form-group filter-actions">
                <button class="btn btn-primary" id="apply-audit-filters" title="Apply audit filters">
                  <i class="fas fa-search"></i> Search
                </button>
                <button class="btn btn-secondary" id="clear-audit-filters" title="Clear audit filters">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
          </div>
          
          <!-- Audit Log Table -->
          <div class="table-container">
            <table class="data-table" id="audit-log-table">
              <thead>
                <tr>
                  <th sortable>Timestamp</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Target</th>
                  <th>IP Address</th>
                  <th>Status</th>
                  <th>Details</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="audit-log-tbody">
                <!-- Audit log will be populated by JavaScript -->
                <tr>
                  <td colspan="8" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-shield-alt" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                    Loading audit log entries...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Audit Log Pagination -->
          <div class="table-pagination" id="audit-pagination">
            <div class="pagination-info">
              Showing <span id="audit-start">0</span> to <span id="audit-end">0</span> of <span id="audit-total">0</span> audit entries
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="audit-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="audit-pages"></span>
              <button class="btn btn-sm btn-secondary" id="audit-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </section>
           
      <!-- Royalty Records -->
      <section id="royalty-records">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-file-invoice-dollar"></i> Royalty Records Management</h1>
            <p>Comprehensive tracking, recording, and analysis of all royalty payments and production data</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="record-payment-btn">
              <i class="fas fa-plus"></i> Record New Payment
            </button>
            <button class="btn btn-info" id="bulk-import-btn">
              <i class="fas fa-upload"></i> Bulk Import
            </button>
            <button class="btn btn-primary" id="export-records-btn">
              <i class="fas fa-download"></i> Export Records
            </button>
            <button class="btn btn-warning" id="validate-records-btn">
              <i class="fas fa-check-circle"></i> Validate Records
            </button>
          </div>
        </div>
      
        <!-- Royalty Overview Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-coins"></i> Total Collections (YTD)</h3>
              <select class="metric-period" id="collections-period">
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="all">All Time</option>
              </select>
            </div>
            <div class="card-body">
              <p id="total-collections-ytd">E 1,245,890.50</p>
              <small class="trend-indicator">
                <i class="fas fa-arrow-up trend-positive"></i> +18.5% from last year
              </small>
              <div class="mini-progress">
                <div class="progress-bar" id="collections-progress" style="width: 78%;"></div>
              </div>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-cube"></i> Volume Extracted (m¬≥)</h3>
              <select class="metric-period" id="volume-period">
                <option value="current_month">This Month</option>
                <option value="ytd">YTD</option>
                <option value="last_year">Last Year</option>
              </select>
            </div>
            <div class="card-body">
              <p id="total-volume-extracted">285,750</p>
              <small class="trend-indicator">
                <i class="fas fa-arrow-up trend-positive"></i> +12.3% from last month
              </small>
              <div class="volume-breakdown">
                <small>
                  <span class="volume-type">Coal: <span id="coal-volume">145,200</span></span> |
                  <span class="volume-type">Stone: <span id="stone-volume">140,550</span></span>
                </small>
              </div>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-clock"></i> Pending Records</h3>
              <button class="btn btn-sm btn-warning" id="view-pending-records" title="View pending records">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="pending-records-count">7</p>
              <small id="pending-urgency">3 records require validation</small>
              <div class="urgency-indicator">
                <span class="urgent-badge" id="urgent-records" style="display: inline-flex;">
                  <i class="fas fa-exclamation-triangle"></i> <span id="urgent-pending-count">3</span> Urgent
                </span>
              </div>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-percentage"></i> Collection Rate</h3>
              <button class="btn btn-sm btn-info" id="collection-details" title="View collection details">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <div class="card-body">
              <p id="collection-rate">94.8%</p>
              <div class="collection-progress">
                <div class="progress-bar" id="collection-rate-progress" style="width: 94.8%;"></div>
              </div>
              <small class="collection-breakdown">
                <span>Collected: <span id="collected-count">187</span></span> |
                <span>Outstanding: <span id="outstanding-count">10</span></span>
              </small>
            </div>
          </div>
        </div>
      
        <!-- Record Royalty Payment Form -->
        <div class="user-form-container" id="royalty-form-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-file-plus"></i> Record New Royalty Payment</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-royalty-form" title="Close form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
      
          <form id="royalty-form" novalidate>
            <div class="grid-4">
              <!-- Basic Information -->
              <div class="form-group">
                <label for="entity">
                  <i class="fas fa-industry"></i> Mining Entity *
                </label>
                <select id="entity" name="entity" required aria-describedby="entity-error">
                  <option value="">Select Entity</option>
                  <option value="kwalini">Kwalini Quarry</option>
                  <option value="mbabane">Mbabane Quarry</option>
                  <option value="sidvokodvo">Sidvokodvo Quarry</option>
                  <option value="maloma">Maloma Colliery</option>
                  <option value="ngwenya">Ngwenya Mine</option>
                  <option value="malolotja">Malolotja Mine</option>
                </select>
                <div class="validation-error" id="entity-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a mining entity
                </div>
              </div>
      
              <div class="form-group">
                <label for="mineral">
                  <i class="fas fa-gem"></i> Mineral Type *
                </label>
                <select id="mineral" name="mineral" required aria-describedby="mineral-error">
                  <option value="">Select Mineral</option>
                  <option value="coal">üî• Coal</option>
                  <option value="iron_ore">‚ö´ Iron Ore</option>
                  <option value="green_chert">üü¢ Green Chert</option>
                  <option value="gravel">ü™® Gravel</option>
                  <option value="river_sand">üèñÔ∏è River Sand</option>
                  <option value="plaster_sand">üèóÔ∏è Plaster Sand</option>
                  <option value="quarried_stone">üóø Quarried Stone</option>
                  <option value="limestone">‚ö™ Limestone</option>
                  <option value="granite">‚ö´ Granite</option>
                </select>
                <div class="validation-error" id="mineral-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select a mineral type
                </div>
              </div>
      
              <div class="form-group">
                <label for="payment-period">
                  <i class="fas fa-calendar-alt"></i> Payment Period *
                </label>
                <select id="payment-period" name="paymentPeriod" required aria-describedby="payment-period-error">
                  <option value="">Select Period</option>
                  <option value="2024-01">January 2024</option>
                  <option value="2024-02">February 2024</option>
                  <option value="2024-03">March 2024</option>
                  <option value="2024-04">April 2024</option>
                  <option value="2024-05">May 2024</option>
                  <option value="2024-06">June 2024</option>
                  <option value="custom">Custom Period</option>
                </select>
                <div class="validation-error" id="payment-period-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select payment period
                </div>
              </div>
      
              <div class="form-group">
                <label for="payment-date">
                  <i class="fas fa-calendar-check"></i> Payment Date *
                </label>
                <input type="date" id="payment-date" name="paymentDate" required aria-describedby="payment-date-error"
                  max="2024-06-03">
                <div class="validation-error" id="payment-date-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Payment date is required
                </div>
                <small class="form-help">Date when payment was received</small>
              </div>
      
              <!-- Production Data -->
              <div class="form-group">
                <label for="volume">
                  <i class="fas fa-cube"></i> Volume Extracted (m¬≥) *
                </label>
                <input type="number" id="volume" name="volume" placeholder="e.g., 1500.50" required
                  aria-describedby="volume-error" min="0" step="0.01">
                <div class="validation-error" id="volume-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Volume must be a positive number
                </div>
                <small class="form-help">Total volume extracted during the period</small>
              </div>
      
              <div class="form-group">
                <label for="tariff">
                  <i class="fas fa-tags"></i> Royalty Tariff (E/m¬≥) *
                </label>
                <input type="number" id="tariff" name="tariff" placeholder="e.g., 4.50" required
                  aria-describedby="tariff-error" min="0" step="0.01">
                <div class="validation-error" id="tariff-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Tariff must be a positive number
                </div>
                <small class="form-help">Current royalty rate per cubic meter</small>
              </div>
      
              <div class="form-group">
                <label for="calculated-royalty">
                  <i class="fas fa-calculator"></i> Calculated Royalty (E)
                </label>
                <input type="number" id="calculated-royalty" name="calculatedRoyalty" readonly placeholder="0.00"
                  aria-describedby="calculated-royalty-help">
                <small class="form-help" id="calculated-royalty-help">Automatically calculated: Volume √ó Tariff</small>
              </div>
      
              <div class="form-group">
                <label for="actual-payment">
                  <i class="fas fa-money-bill-wave"></i> Actual Payment (E) *
                </label>
                <input type="number" id="actual-payment" name="actualPayment" placeholder="e.g., 6757.50" required
                  aria-describedby="actual-payment-error" min="0" step="0.01">
                <div class="validation-error" id="actual-payment-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Actual payment amount is required
                </div>
                <small class="form-help">Amount actually paid by the entity</small>
              </div>
      
              <!-- Payment Details -->
              <div class="form-group">
                <label for="payment-method">
                  <i class="fas fa-credit-card"></i> Payment Method *
                </label>
                <select id="payment-method" name="paymentMethod" required aria-describedby="payment-method-error">
                  <option value="">Select Method</option>
                  <option value="bank_transfer">üè¶ Bank Transfer</option>
                  <option value="eft">üí≥ Electronic Funds Transfer</option>
                  <option value="cheque">üìÑ Cheque</option>
                  <option value="cash">üíµ Cash</option>
                  <option value="rtgs">‚ö° RTGS</option>
                </select>
                <div class="validation-error" id="payment-method-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select payment method
                </div>
              </div>
      
              <div class="form-group">
                <label for="reference-number">
                  <i class="fas fa-hashtag"></i> Reference Number
                </label>
                <input type="text" id="reference-number" name="referenceNumber" placeholder="e.g., TXN-2024-001234"
                  aria-describedby="reference-number-help">
                <small class="form-help" id="reference-number-help">Transaction or receipt reference number</small>
              </div>
      
              <div class="form-group">
                <label for="bank-account">
                  <i class="fas fa-university"></i> Deposited to Account
                </label>
                <select id="bank-account" name="bankAccount" aria-describedby="bank-account-help">
                  <option value="">Select Account</option>
                  <option value="govt_revenue">Government Revenue Account</option>
                  <option value="era_main">ERA Main Account</option>
                  <option value="ministry_account">Ministry Account</option>
                </select>
                <small class="form-help" id="bank-account-help">Government account where payment was deposited</small>
              </div>
      
              <div class="form-group">
                <label for="exchange-rate">
                  <i class="fas fa-exchange-alt"></i> Exchange Rate (if applicable)
                </label>
                <input type="number" id="exchange-rate" name="exchangeRate" placeholder="e.g., 18.50"
                  aria-describedby="exchange-rate-help" min="0" step="0.01">
                <small class="form-help" id="exchange-rate-help">E/USD rate if payment was in foreign currency</small>
              </div>
      
              <!-- Additional Information -->
              <div class="form-group full-width">
                <label for="payment-notes">
                  <i class="fas fa-sticky-note"></i> Payment Notes
                </label>
                <textarea id="payment-notes" name="notes" rows="3"
                  placeholder="Additional notes, discrepancies, or special circumstances..."
                  aria-describedby="payment-notes-help"></textarea>
                <small class="form-help" id="payment-notes-help">Optional notes about this payment</small>
              </div>
      
              <!-- Supporting Documents -->
              <div class="form-group">
                <label for="supporting-documents">
                  <i class="fas fa-paperclip"></i> Supporting Documents
                </label>
                <input type="file" id="supporting-documents" name="documents" multiple
                  accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" aria-describedby="documents-help">
                <small class="form-help" id="documents-help">Upload receipts, production reports, or other supporting
                  documents</small>
              </div>
      
              <!-- Verification -->
              <div class="form-group">
                <label for="verified-by">
                  <i class="fas fa-user-check"></i> Verified By
                </label>
                <input type="text" id="verified-by" name="verifiedBy" placeholder="Name of verifying officer"
                  aria-describedby="verified-by-help">
                <small class="form-help" id="verified-by-help">Name of the officer who verified this payment</small>
              </div>
      
              <!-- Status -->
              <div class="form-group">
                <label for="payment-status">
                  <i class="fas fa-flag"></i> Payment Status *
                </label>
                <select id="payment-status" name="status" required aria-describedby="payment-status-error">
                  <option value="">Select Status</option>
                  <option value="pending">‚è≥ Pending Verification</option>
                  <option value="verified">‚úÖ Verified</option>
                  <option value="partial">‚ö†Ô∏è Partial Payment</option>
                  <option value="overpaid">üìà Overpaid</option>
                  <option value="disputed">‚ùì Disputed</option>
                </select>
                <div class="validation-error" id="payment-status-error" style="display: none;">
                  <i class="fas fa-exclamation-circle"></i> Please select payment status
                </div>
              </div>
            </div>
      
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-royalty">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="button" class="btn btn-warning" id="save-draft-royalty">
                <i class="fas fa-save"></i> Save as Draft
              </button>
              <button type="submit" class="btn btn-success" id="save-royalty-btn">
                <i class="fas fa-check"></i> Record Payment
              </button>
            </div>
          </form>
        </div>
      
        <!-- Royalty Records Management Table -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-table"></i> Royalty Payment Records</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-royalty-records" title="Refresh records">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-info btn-sm" id="export-royalty-records" title="Export records">
                <i class="fas fa-download"></i> Export
              </button>
              <button class="btn btn-warning btn-sm" id="bulk-verify-records" style="display: none;" disabled
                title="Bulk verify selected records">
                <i class="fas fa-check-double"></i> Verify Selected (<span id="selected-records-count">0</span>)
              </button>
            </div>
          </div>
      
          <!-- Advanced Filtering -->
          <div class="table-filters">
            <h6><i class="fas fa-filter"></i> Filter & Search Records</h6>
            <div class="grid-4">
              <div class="form-group">
                <label for="filter-entity">
                  <i class="fas fa-industry"></i> Filter by Entity
                </label>
                <select id="filter-entity">
                  <option value="">All Entities</option>
                  <option value="kwalini">Kwalini Quarry</option>
                  <option value="mbabane">Mbabane Quarry</option>
                  <option value="sidvokodvo">Sidvokodvo Quarry</option>
                  <option value="maloma">Maloma Colliery</option>
                  <option value="ngwenya">Ngwenya Mine</option>
                  <option value="malolotja">Malolotja Mine</option>
                </select>
              </div>
      
              <div class="form-group">
                <label for="filter-mineral">
                  <i class="fas fa-gem"></i> Filter by Mineral
                </label>
                <select id="filter-mineral">
                  <option value="">All Minerals</option>
                  <option value="coal">Coal</option>
                  <option value="iron_ore">Iron Ore</option>
                  <option value="green_chert">Green Chert</option>
                  <option value="gravel">Gravel</option>
                  <option value="river_sand">River Sand</option>
                  <option value="plaster_sand">Plaster Sand</option>
                  <option value="quarried_stone">Quarried Stone</option>
                </select>
              </div>
      
              <div class="form-group">
                <label for="filter-status">
                  <i class="fas fa-flag"></i> Filter by Status
                </label>
                <select id="filter-status">
                  <option value="">All Statuses</option>
                  <option value="pending">Pending</option>
                  <option value="verified">Verified</option>
                  <option value="partial">Partial Payment</option>
                  <option value="overpaid">Overpaid</option>
                  <option value="disputed">Disputed</option>
                </select>
              </div>
      
              <div class="form-group">
                <label for="filter-date-range">
                  <i class="fas fa-calendar-alt"></i> Date Range
                </label>
                <div class="date-range-inputs">
                  <input type="date" id="filter-start-date" aria-label="Start Date">
                  <span>to</span>
                  <input type="date" id="filter-end-date" aria-label="End Date">
                </div>
              </div>
      
              <div class="form-group filter-actions">
                <button class="btn btn-primary" id="apply-royalty-filters" title="Apply selected filters">
                  <i class="fas fa-filter"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" id="clear-royalty-filters" title="Clear all filters">
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
          </div>
      
          <!-- Royalty Records Data Table -->
          <div class="table-container">
            <table class="data-table" id="royalty-records-table">
              <thead>
                <tr>
                  <th><input type="checkbox" id="select-all-records" title="Select all records"></th>
                  <th sortable>Entity</th>
                  <th sortable>Mineral</th>
                  <th sortable>Volume (m¬≥)</th>
                  <th sortable>Tariff (E/m¬≥)</th>
                  <th sortable>Calculated (E)</th>
                  <th sortable>Paid (E)</th>
                  <th>Variance</th>
                  <th sortable>Date</th>
                  <th>Status</th>
                  <th>Payment Method</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="royalty-records-tbody">
                <!-- Example records will be populated by JavaScript -->
                <tr>
                  <td><input type="checkbox" value="1"></td>
                  <td><strong>Kwalini Quarry</strong></td>
                  <td>Quarried Stone</td>
                  <td>1,250.00</td>
                  <td>4.50</td>
                  <td>5,625.00</td>
                  <td>5,625.00</td>
                  <td><span class="variance-badge exact">Exact</span></td>
                  <td>2024-05-15</td>
                  <td><span class="status-badge success">Verified</span></td>
                  <td>Bank Transfer</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn btn-sm btn-primary" title="View details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-warning" title="Edit record">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-info" title="View documents">
                        <i class="fas fa-paperclip"></i>
                      </button>
                      <button class="btn btn-sm btn-secondary dropdown-toggle" title="More actions">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" value="2"></td>
                  <td><strong>Maloma Colliery</strong></td>
                  <td>Coal</td>
                  <td>2,100.50</td>
                  <td>5.00</td>
                  <td>10,502.50</td>
                  <td>10,000.00</td>
                  <td><span class="variance-badge under">-502.50</span></td>
                  <td>2024-05-20</td>
                  <td><span class="status-badge warning">Partial Payment</span></td>
                  <td>EFT</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn btn-sm btn-primary" title="View details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" title="Follow up payment">
                        <i class="fas fa-exclamation-triangle"></i>
                      </button>
                      <button class="btn btn-sm btn-info" title="Send notice">
                        <i class="fas fa-bell"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" value="3"></td>
                  <td><strong>Mbabane Quarry</strong></td>
                  <td>Gravel</td>
                  <td>890.25</td>
                  <td>3.75</td>
                  <td>3,338.44</td>
                  <td>3,500.00</td>
                  <td><span class="variance-badge over">+161.56</span></td>
                  <td>2024-05-25</td>
                  <td><span class="status-badge info">Overpaid</span></td>
                  <td>Cheque</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn btn-sm btn-primary" title="View details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success" title="Process refund">
                        <i class="fas fa-undo"></i>
                      </button>
                      <button class="btn btn-sm btn-info" title="Apply to next period">
                        <i class="fas fa-forward"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <!-- More records will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
      
          <!-- Table Pagination -->
          <div class="table-pagination" id="royalty-pagination">
            <div class="pagination-info">
              Showing <span id="royalty-start">1</span> to <span id="royalty-end">10</span> of <span
                id="royalty-total">156</span> records
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="royalty-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="royalty-pages"></span>
              <button class="btn btn-sm btn-secondary" id="royalty-next">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      
        <!-- Royalty Analytics -->
        <div class="charts-grid">
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-line"></i> Royalty Collection Trends</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="line" data-chart-id="royalty-trends-chart">
                  <i class="fas fa-chart-line"></i> Line
                </button>
                <button class="chart-btn" data-chart-type="bar" data-chart-id="royalty-trends-chart">
                  <i class="fas fa-chart-bar"></i> Bar
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="royalty-trends-chart" aria-label="Royalty collection trends over time"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i>
                Average monthly: <strong>E <span id="avg-monthly-royalty">103,824</span></strong> |
                Peak month: <strong><span id="peak-royalty-month">March 2024</span></strong>
              </small>
            </div>
          </div>
      
          <div class="analytics-chart card">
            <div class="chart-header">
              <h5><i class="fas fa-chart-pie"></i> Collections by Entity</h5>
              <div class="chart-controls">
                <button class="chart-btn active" data-chart-type="pie" data-chart-id="entity-collections-chart">
                  <i class="fas fa-chart-pie"></i> Pie
                </button>
                <button class="chart-btn" data-chart-type="doughnut" data-chart-id="entity-collections-chart">
                  <i class="fas fa-circle-notch"></i> Doughnut
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="entity-collections-chart" aria-label="Royalty collections breakdown by mining entity"></canvas>
            </div>
            <div class="chart-summary">
              <small>
                <i class="fas fa-info-circle"></i>
                Top contributor: <strong><span id="top-contributor">Maloma Colliery</span></strong> |
                Total entities: <strong><span id="active-entities-chart">6</span></strong>
              </small>
            </div>
          </div>
        </div>
      </section>
      
      
      <!-- Contract Management -->
      <section id="contract-management">
        <div class="page-header">
          <div class="page-title">
            <h1>Contract Management</h1>
            <p>Manage royalty agreements for mines and quarries</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success">Add Contract</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Add Contract</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="contract-entity">Entity</label>
              <select id="contract-entity" aria-describedby="contract-entity-validation">
                <option>Select Entity</option>
                <option>Kwalini Quarry</option>
                <option>Mbabane Quarry</option>
                <option>Sidvokodvo Quarry</option>
                <option>Maloma Colliery</option>
                <option>Ngwenya Mine</option>
                <option>Malolotja Mine</option>
              </select>
              <div class="validation-error" id="contract-entity-validation">Entity is required</div>
            </div>
            <div class="form-group">
              <label for="royalty-rate">Royalty Rate (E/m¬≥)</label>
              <input type="number" id="royalty-rate" placeholder="Royalty Rate (E/m¬≥)" aria-describedby="royalty-rate-validation">
              <div class="validation-error" id="royalty-rate-validation">Rate is required</div>
            </div>
            <div class="form-group">
              <label for="start-date">Start Date</label>
              <input type="date" id="start-date" aria-describedby="start-date-validation">
              <div class="validation-error" id="start-date-validation">Start date is required</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-success">Save Contract</button>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Entity</th>
                <th>Royalty Rate (E/m¬≥)</th>
                <th>Start Date</th>
                <th>Document</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    
      <!-- Audit Dashboard -->
      <section id="audit-dashboard">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-shield-alt"></i> Audit Dashboard</h1>
            <p>Comprehensive audit overview, discrepancy analysis, and compliance monitoring</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-info" id="view-full-audit-log">
              <i class="fas fa-list"></i> Full Audit Log
            </button>
            <button class="btn btn-primary" id="export-audit-report">
              <i class="fas fa-file-export"></i> Export Report
            </button>
          </div>
        </div>
      
        <!-- Audit Metrics Overview -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Active Discrepancies</h3>
            </div>
            <div class="card-body">
              <p id="active-discrepancies-count">0</p>
              <small class="trend-indicator">
                <i class="fas fa-arrow-down trend-positive"></i> -2 from last week
              </small>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-money-bill-wave"></i> Outstanding Amount</h3>
            </div>
            <div class="card-body">
              <p id="outstanding-amount">E 0.00</p>
              <small>Requiring resolution</small>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-clock"></i> Audit Activities (24h)</h3>
            </div>
            <div class="card-body">
              <p id="recent-audit-activities">0</p>
              <small>System activities logged</small>
            </div>
          </div>
      
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-check-circle"></i> Compliance Rate</h3>
            </div>
            <div class="card-body">
              <p id="audit-compliance-rate">0%</p>
              <div class="mini-progress">
                <div class="progress-bar" id="audit-compliance-progress" style="width: 0%;"></div>
              </div>
            </div>
          </div>
        </div>
      
        <!-- Filters and Controls -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-filter"></i> Audit Filters & Analysis</h4>
          </div>
          <div class="grid-4">
            <div class="form-group">
              <label for="audit-filter-entity">
                <i class="fas fa-industry"></i> Entity
              </label>
              <select id="audit-filter-entity">
                <option value="">All Entities</option>
                <option value="kwalini">Kwalini Quarry</option>
                <option value="mbabane">Mbabane Quarry</option>
                <option value="sidvokodvo">Sidvokodvo Quarry</option>
                <option value="maloma">Maloma Colliery</option>
                <option value="ngwenya">Ngwenya Mine</option>
                <option value="malolotja">Malolotja Mine</option>
              </select>
            </div>
      
            <div class="form-group">
              <label for="audit-filter-period">
                <i class="fas fa-calendar-alt"></i> Period
              </label>
              <select id="audit-filter-period">
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="quarter">This Quarter</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
      
            <div class="form-group">
              <label for="audit-filter-severity">
                <i class="fas fa-exclamation-circle"></i> Severity
              </label>
              <select id="audit-filter-severity">
                <option value="">All Severities</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
      
            <div class="form-group">
              <button class="btn btn-primary" id="apply-audit-filters">
                <i class="fas fa-search"></i> Apply Filters
              </button>
              <button class="btn btn-secondary" id="clear-audit-filters">
                <i class="fas fa-times"></i> Clear
              </button>
            </div>
          </div>
        </div>
      
        <!-- Discrepancies Table -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-exclamation-triangle"></i> Discrepancies & Issues</h4>
            <div class="table-actions">
              <button class="btn btn-success btn-sm" id="resolve-selected-discrepancies" disabled>
                <i class="fas fa-check"></i> Resolve Selected
              </button>
            </div>
          </div>
      
          <div class="table-container">
            <table class="data-table" id="discrepancies-table">
              <thead>
                <tr>
                  <th><input type="checkbox" id="select-all-discrepancies"></th>
                  <th sortable>Entity</th>
                  <th sortable>Mineral</th>
                  <th sortable>Declared (m¬≥)</th>
                  <th sortable>Verified (m¬≥)</th>
                  <th sortable>Variance</th>
                  <th sortable>Outstanding (E)</th>
                  <th>Severity</th>
                  <th sortable>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="discrepancies-tbody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>
          </div>
      
          <div class="table-pagination" id="discrepancies-pagination">
            <div class="pagination-info">
              Showing <span id="discrepancies-start">0</span> to <span id="discrepancies-end">0</span> of <span
                id="discrepancies-total">0</span> discrepancies
            </div>
            <div class="pagination-controls">
              <button class="btn btn-sm btn-secondary" id="discrepancies-prev" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span class="pagination-pages" id="discrepancies-pages"></span>
              <button class="btn btn-sm btn-secondary" id="discrepancies-next" disabled>
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      
        <!-- Recent Audit Activities -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-history"></i> Recent Audit Activities</h4>
            <div class="table-actions">
              <button class="btn btn-info btn-sm" id="view-all-audit-activities">
                <i class="fas fa-external-link-alt"></i> View All Activities
              </button>
            </div>
          </div>
      
          <div class="activity-list" id="recent-audit-activities-list">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </section>
      
      <!-- Reporting & Analytics Placeholder -->
      <section id="reporting-analytics">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-chart-bar"></i> Reporting & Analytics</h1>
            <p>Generate comprehensive reports, analyze data, and visualize key performance indicators.</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary" id="export-all-data-btn"><i class="fas fa-file-excel"></i> Export All Data</button>
            <button class="btn btn-info" id="customize-dashboard-btn"><i class="fas fa-tachometer-alt"></i> Customize Dashboard</button>
          </div>
        </div>

        <!-- Report Generation -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-file-alt"></i> Generate Reports</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="view-scheduled-reports-btn"><i class="fas fa-clock"></i> Scheduled Reports</button>
            </div>
          </div>
          <form id="report-generation-form">
            <div class="grid-4">
              <div class="form-group">
                <label for="report-type"><i class="fas fa-list-alt"></i> Report Type</label>
                <select id="report-type" name="reportType">
                  <option value="">Select Report Type</option>
                  <option value="royalty_summary">Royalty Summary</option>
                  <option value="production_volume">Production Volume</option>
                  <option value="sales_analysis">Sales Analysis</option>
                  <option value="contract_performance">Contract Performance</option>
                  <option value="payment_history">Payment History</option>
                  <option value="compliance_status">Compliance Status</option>
                  <option value="audit_trail_summary">Audit Trail Summary</option>
                </select>
              </div>
              <div class="form-group">
                <label for="report-entity-filter"><i class="fas fa-industry"></i> Filter by Entity</label>
                <select id="report-entity-filter" name="entityFilter">
                  <option value="all">All Entities</option>
                  <option value="kwalini">Kwalini Quarry</option>
                  <option value="mbabane">Mbabane Quarry</option>
                  <option value="maloma">Maloma Colliery</option>
                  <!-- Add more entities as needed -->
                </select>
              </div>
              <div class="form-group">
                <label for="report-date-range"><i class="fas fa-calendar-alt"></i> Date Range</label>
                <div class="date-range-inputs">
                  <input type="date" id="report-start-date" name="startDate" aria-label="Start Date">
                  <span>to</span>
                  <input type="date" id="report-end-date" name="endDate" aria-label="End Date">
                </div>
              </div>
              <div class="form-group">
                <label for="report-format"><i class="fas fa-file-export"></i> Export Format</label>
                <select id="report-format" name="reportFormat">
                  <option value="pdf">PDF</option>
                  <option value="xlsx">Excel (XLSX)</option>
                  <option value="csv">CSV</option>
                </select>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-success"><i class="fas fa-cogs"></i> Generate Report</button>
              <button type="button" class="btn btn-secondary" id="preview-report-btn"><i class="fas fa-eye"></i> Preview Report</button>
              <button type="button" class="btn btn-info" id="schedule-report-btn"><i class="fas fa-calendar-plus"></i> Schedule Report</button>
            </div>
          </form>
        </div>

        <!-- Data Analysis & KPI Dashboards -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-chart-line"></i> Data Analysis & KPI Dashboards</h4>
          </div>
          <div class="charts-grid">
            <div class="analytics-chart card">
              <div class="chart-header">
                <h5><i class="fas fa-coins"></i> Royalty Payments Over Time</h5>
                <div class="chart-controls">
                  <select class="metric-period" id="royalty-analysis-period">
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="royalty-payments-chart" aria-label="Royalty payments analysis chart"></canvas>
              </div>
              <div class="chart-summary">
                <small><i class="fas fa-info-circle"></i> Total collected: E <span id="total-collected-analysis">0.00</span></small>
              </div>
            </div>
            <div class="analytics-chart card">
              <div class="chart-header">
                <h5><i class="fas fa-cube"></i> Production vs. Sales Volume</h5>
                <div class="chart-controls">
                  <select class="metric-period" id="production-sales-period">
                    <option value="last_3_months">Last 3 Months</option>
                    <option value="last_6_months">Last 6 Months</option>
                    <option value="ytd">Year to Date</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="production-sales-chart" aria-label="Production vs. Sales volume chart"></canvas>
              </div>
              <div class="chart-summary">
                <small><i class="fas fa-info-circle"></i> Variance: <span id="production-sales-variance">0</span>%</small>
              </div>
            </div>
          </div>
          <div class="charts-grid">
            <div class="metric-card card">
                <div class="card-header"><h3><i class="fas fa-file-contract"></i> Contract Performance KPI</h3></div>
                <div class="card-body">
                    <p id="avg-contract-value">E 0.00</p>
                    <small>Average Contract Value</small>
                </div>
            </div>
            <div class="metric-card card">
                <div class="card-header"><h3><i class="fas fa-check-double"></i> Compliance Adherence KPI</h3></div>
                <div class="card-body">
                    <p id="compliance-adherence-rate">0%</p>
                    <small>Overall Compliance Rate</small>
                </div>
            </div>
             <div class="metric-card card">
                <div class="card-header"><h3><i class="fas fa-users"></i> Active Contracts</h3></div>
                <div class="card-body">
                    <p id="active-contracts-count">0</p>
                    <small>Total Active Agreements</small>
                </div>
            </div>
             <div class="metric-card card">
                <div class="card-header"><h3><i class="fas fa-exclamation-circle"></i> Expiring Soon</h3></div>
                <div class="card-body">
                    <p id="expiring-contracts-count">0</p>
                    <small>Contracts Expiring in 90 Days</small>
                </div>
            </div>
          </div>
        </div>
        
        <!-- Audit Trail Reporting -->
        <div class="user-form-container">
            <div class="section-header">
                <h4><i class="fas fa-history"></i> Audit Trail Reporting</h4>
                <div class="table-actions">
                     <button class="btn btn-primary btn-sm" id="full-audit-log-link-btn"><i class="fas fa-external-link-alt"></i> View Full Audit Log</button>
                </div>
            </div>
            <p>Generate specific reports from the audit trail to track system activities, data changes, and calculations for transparency and compliance.</p>
            <!-- Simplified form for audit trail reports, more detailed filtering can be on the main audit log page -->
            <form id="audit-report-form">
                <div class="grid-3">
                    <div class="form-group">
                        <label for="audit-report-type"><i class="fas fa-tags"></i> Focus Area</label>
                        <select id="audit-report-type" name="auditReportType">
                            <option value="all">All Activities</option>
                            <option value="data_changes">Data Changes</option>
                            <option value="user_activity">User Activity</option>
                            <option value="calculation_history">Calculation History</option>
                            <option value="security_events">Security Events</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="audit-report-user"><i class="fas fa-user-secret"></i> Specific User (Optional)</label>
                        <input type="text" id="audit-report-user" name="auditUser" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="audit-report-date-range"><i class="fas fa-calendar-alt"></i> Date Range</label>
                         <div class="date-range-inputs">
                            <input type="date" id="audit-report-start-date" name="auditStartDate" aria-label="Start Date">
                            <span>to</span>
                            <input type="date" id="audit-report-end-date" name="auditEndDate" aria-label="End Date">
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success"><i class="fas fa-search"></i> Generate Audit Report</button>
                </div>
            </form>
            <div class="table-container" id="audit-report-results" style="margin-top: 1.5rem; display: none;">
                <h5>Audit Report Results</h5>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>User</th>
                            <th>Action</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="audit-report-tbody">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
      </section>

      <!-- Communication -->
      <section id="communication">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-envelope"></i> Communication Hub</h1>
            <p>Manage internal and external communications, announcements, and alerts.</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="new-message-btn"><i class="fas fa-paper-plane"></i> New Message</button>
            <button class="btn btn-info" id="view-templates-btn"><i class="fas fa-file-alt"></i> Message Templates</button>
          </div>
        </div>
      
        <!-- Communication Dashboard/Metrics (Optional) -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-inbox"></i> Unread Messages</h3>
            </div>
            <div class="card-body">
              <p id="unread-messages-count">5</p>
              <small><i class="fas fa-envelope-open-text"></i> Requiring attention</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-bullhorn"></i> Active Announcements</h3>
            </div>
            <div class="card-body">
              <p id="active-announcements-count">2</p>
              <small><i class="fas fa-info-circle"></i> System-wide alerts</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-users"></i> Contact Groups</h3>
            </div>
            <div class="card-body">
              <p id="contact-groups-count">8</p>
              <small><i class="fas fa-list-alt"></i> For targeted messaging</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-paper-plane"></i> Sent Today</h3>
            </div>
            <div class="card-body">
              <p id="sent-today-count">12</p>
              <small><i class="fas fa-check-circle"></i> Messages successfully sent</small>
            </div>
          </div>
        </div>
      
        <!-- New Message/Announcement Form (Initially Hidden or in a Modal) -->
        <div class="user-form-container" id="new-message-form-container" style="display: none;">
          <div class="section-header">
            <h4><i class="fas fa-edit"></i> Compose New Message/Announcement</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="close-message-form-btn" title="Close form">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
          <form id="new-message-form">
            <div class="grid-2">
              <div class="form-group">
                <label for="message-recipient"><i class="fas fa-users"></i> Recipients/Group</label>
                <select id="message-recipient" name="recipient">
                  <option value="all_users">All Users</option>
                  <option value="all_entities">All Mining Entities</option>
                  <option value="finance_dept">Finance Department</option>
                  <option value="compliance_team">Compliance Team</option>
                  <!-- Add more groups or allow custom input -->
                </select>
              </div>
              <div class="form-group">
                <label for="message-type"><i class="fas fa-tag"></i> Message Type</label>
                <select id="message-type" name="messageType">
                  <option value="announcement">üì¢ Announcement</option>
                  <option value="alert">‚ö†Ô∏è Alert</option>
                  <option value="notification">üîî Notification</option>
                  <option value="direct_message">‚úâÔ∏è Direct Message</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="message-subject"><i class="fas fa-heading"></i> Subject</label>
              <input type="text" id="message-subject" name="subject" placeholder="Enter message subject" required>
            </div>
            <div class="form-group">
              <label for="message-body"><i class="fas fa-paragraph"></i> Message Body</label>
              <textarea id="message-body" name="body" rows="6" placeholder="Compose your message here..." required></textarea>
            </div>
            <div class="form-group">
              <label for="message-attachments"><i class="fas fa-paperclip"></i> Attachments (Optional)</label>
              <input type="file" id="message-attachments" name="attachments" multiple>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-message-btn">Cancel</button>
              <button type="submit" class="btn btn-success"><i class="fas fa-paper-plane"></i> Send Message</button>
            </div>
          </form>
        </div>
      
        <!-- Message History / Inbox -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-history"></i> Message History & Inbox</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-messages-btn"><i class="fas fa-sync-alt"></i>
                Refresh</button>
              <button class="btn btn-info btn-sm" id="filter-messages-btn"><i class="fas fa-filter"></i> Filter</button>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table" id="communication-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>From</th>
                  <th>To/Group</th>
                  <th>Subject</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="communication-table-tbody">
                <!-- Example Row -->
                <tr>
                  <td>2025-06-03 10:00 AM</td>
                  <td>System Admin</td>
                  <td>All Users</td>
                  <td>Scheduled System Maintenance</td>
                  <td><span class="status-badge info">Announcement</span></td>
                  <td><span class="status-badge success">Sent</span></td>
                  <td>
                    <button class="btn btn-sm btn-primary"><i class="fas fa-eye"></i> View</button>
                    <button class="btn btn-sm btn-secondary"><i class="fas fa-archive"></i> Archive</button>
                  </td>
                </tr>
                <tr>
                  <td>2025-06-02 02:30 PM</td>
                  <td>Compliance Officer</td>
                  <td>Maloma Colliery</td>
                  <td>Urgent: Overdue Safety Report</td>
                  <td><span class="status-badge danger">Alert</span></td>
                  <td><span class="status-badge success">Delivered</span></td>
                  <td>
                    <button class="btn btn-sm btn-primary"><i class="fas fa-eye"></i> View</button>
                    <button class="btn btn-sm btn-warning"><i class="fas fa-reply"></i> Reply</button>
                  </td>
                </tr>
                <!-- More messages will be populated here -->
                <tr>
                  <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-envelope-open" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                    No messages to display or loading messages...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pagination for messages (similar to other tables) -->
          <div class="table-pagination" id="communication-pagination">
            <!-- Pagination controls here -->
          </div>
        </div>
      </section>
      <!-- End of Communication -->

        <!-- Notifications -->
        <section id="notifications">
          <div class="page-header">
            <div class="page-title">
              <h1><i class="fas fa-bell"></i> Notifications</h1>
              <p>View important updates, alerts, and system messages.</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary" id="mark-all-read-btn"><i class="fas fa-check-double"></i> Mark All as
                Read</button>
              <button class="btn btn-danger" id="clear-all-notifications-btn"><i class="fas fa-trash-alt"></i> Clear
                All</button>
            </div>
          </div>
        
          <div class="user-form-container">
            <div class="section-header">
              <h4><i class="fas fa-list-ul"></i> Recent Notifications</h4>
              <div class="table-actions">
                <select id="filter-notifications-type" class="form-control-sm" style="margin-right: 10px;">
                  <option value="all">All Types</option>
                  <option value="alert">Alerts</option>
                  <option value="system">System Updates</option>
                  <option value="approval">Approvals</option>
                </select>
                <button class="btn btn-secondary btn-sm" id="refresh-notifications-btn"><i class="fas fa-sync-alt"></i>
                  Refresh</button>
              </div>
            </div>
        
            <div class="notifications-list" id="notifications-list-container">
              <!-- Example Notification Item (Unread) -->
              <div class="notification-item unread">
                <div class="notification-icon alert">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <span class="notification-title">Urgent: Royalty Payment Overdue</span>
                    <span class="notification-time">2 hours ago</span>
                  </div>
                  <p class="notification-message">Royalty payment for Maloma Colliery (Q1 2025) is overdue by 3 days. Please
                    take action.</p>
                </div>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-primary" title="View Details"><i class="fas fa-eye"></i></button>
                  <button class="btn btn-sm btn-success" title="Mark as Read"><i class="fas fa-check"></i></button>
                </div>
              </div>
        
              <!-- Example Notification Item (Read) -->
              <div class="notification-item">
                <div class="notification-icon system">
                  <i class="fas fa-info-circle"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <span class="notification-title">System Maintenance Scheduled</span>
                    <span class="notification-time">1 day ago</span>
                  </div>
                  <p class="notification-message">Scheduled system maintenance will occur on June 5, 2025, from 02:00 AM to
                    04:00 AM.</p>
                </div>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-secondary" title="Archive"><i class="fas fa-archive"></i></button>
                </div>
              </div>
        
              <!-- Example Notification Item (Approval) -->
              <div class="notification-item unread">
                <div class="notification-icon approval">
                  <i class="fas fa-thumbs-up"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-header">
                    <span class="notification-title">New User Registration Pending Approval</span>
                    <span class="notification-time">3 days ago</span>
                  </div>
                  <p class="notification-message">User 'john.doe' has registered and requires your approval to access the
                    system.</p>
                </div>
                <div class="notification-actions">
                  <button class="btn btn-sm btn-primary" title="Review Request"><i class="fas fa-user-check"></i></button>
                  <button class="btn btn-sm btn-success" title="Mark as Read"><i class="fas fa-check"></i></button>
                </div>
              </div>
              <!-- Placeholder for no notifications -->
              <div class="notification-item no-notifications"
                style="display: none; text-align: center; padding: 2rem; color: var(--text-muted);">
                <i class="fas fa-bell-slash" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                No new notifications.
              </div>
            </div>
          </div>
        </section>
        <!-- End of Notifications -->

      <!-- Compliance & Regulatory (Dedicated Section) -->
      <section id="compliance">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-check-circle"></i> Compliance & Regulatory</h1>
            <p>Monitor compliance status, track regulatory requirements, and ensure adherence to mining laws and regulations.</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success"><i class="fas fa-plus"></i> New Compliance Check</button>
            <button class="btn btn-info"><i class="fas fa-file-export"></i> Export Compliance Report</button>
            <button class="btn btn-primary"><i class="fas fa-gavel"></i> View Regulations</button>
          </div>
        </div>

        <!-- Compliance Overview Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-shield-check"></i> Overall Compliance</h3>
            </div>
            <div class="card-body">
              <p id="overall-compliance-rate">94.2%</p>
              <small><i class="fas fa-arrow-up trend-positive"></i> +2.3% from last month</small>
              <div class="mini-progress">
                <div class="progress-bar" style="width: 94.2%; background: var(--success-color);"></div>
              </div>
            </div>
          </div>
          
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Non-Compliant Items</h3>
            </div>
            <div class="card-body">
              <p id="non-compliant-count">3</p>
              <small><i class="fas fa-clock text-warning"></i> Require immediate attention</small>
            </div>
          </div>
          
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-calendar-check"></i> Due This Month</h3>
            </div>
            <div class="card-body">
              <p id="due-this-month">8</p>
              <small><i class="fas fa-tasks text-info"></i> Compliance tasks pending</small>
            </div>
          </div>
          
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-certificate"></i> Certifications</h3>
            </div>
            <div class="card-body">
              <p id="valid-certifications">12/15</p>
              <small><i class="fas fa-check text-success"></i> Valid certifications</small>
            </div>
          </div>
        </div>

        <!-- Compliance Status by Entity -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-industry"></i> Compliance Status by Mining Entity</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm"><i class="fas fa-sync-alt"></i> Refresh Status</button>
              <button class="btn btn-info btn-sm"><i class="fas fa-download"></i> Export Report</button>
            </div>
          </div>
          
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Entity</th>
                  <th>License Status</th>
                  <th>Environmental Compliance</th>
                  <th>Safety Compliance</th>
                  <th>Tax Status</th>
                  <th>Overall Score</th>
                  <th>Last Audit</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Kwalini Quarry</strong></td>
                  <td><span class="status-badge success">‚úì Valid</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge success">‚úì Current</span></td>
                  <td><span class="compliance-score excellent">98%</span></td>
                  <td>Jan 15, 2024</td>
                  <td>
                    <button class="btn btn-sm btn-info">View Details</button>
                    <button class="btn btn-sm btn-primary">Schedule Audit</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Mbabane Quarry</strong></td>
                  <td><span class="status-badge success">‚úì Valid</span></td>
                  <td><span class="status-badge warning">‚ö† Review Required</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge success">‚úì Current</span></td>
                  <td><span class="compliance-score good">87%</span></td>
                  <td>Feb 02, 2024</td>
                  <td>
                    <button class="btn btn-sm btn-warning">Review Environmental</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Maloma Colliery</strong></td>
                  <td><span class="status-badge warning">‚ö† Expires Soon</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge danger">‚úó Non-Compliant</span></td>
                  <td><span class="status-badge warning">‚ö† Overdue</span></td>
                  <td><span class="compliance-score critical">62%</span></td>
                  <td>Jan 28, 2024</td>
                  <td>
                    <button class="btn btn-sm btn-danger">Urgent Action Required</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Ngwenya Mine</strong></td>
                  <td><span class="status-badge success">‚úì Valid</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge success">‚úì Compliant</span></td>
                  <td><span class="status-badge success">‚úì Current</span></td>
                  <td><span class="compliance-score excellent">96%</span></td>
                  <td>Feb 10, 2024</td>
                  <td>
                    <button class="btn btn-sm btn-info">View Details</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Regulatory Requirements Tracker -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-list-check"></i> Regulatory Requirements Tracker</h4>
            <div class="table-actions">
              <button class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Add Requirement</button>
              <button class="btn btn-secondary btn-sm"><i class="fas fa-filter"></i> Filter Requirements</button>
            </div>
          </div>
          
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Requirement</th>
                  <th>Regulation Reference</th>
                  <th>Applicable Entities</th>
                  <th>Due Date</th>
                  <th>Status</th>
                  <th>Priority</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Annual Environmental Impact Report</td>
                  <td>Environmental Management Act, 2002</td>
                  <td>All Mining Entities</td>
                  <td>March 31, 2024</td>
                  <td><span class="status-badge warning">In Progress</span></td>
                  <td><span class="priority-badge high">High</span></td>
                  <td>
                    <button class="btn btn-sm btn-primary">Track Progress</button>
                    <button class="btn btn-sm btn-info">View Details</button>
                  </td>
                </tr>
                <tr>
                  <td>Safety Certificate Renewal</td>
                  <td>Occupational Health and Safety Act, 2001</td>
                  <td>Maloma Colliery</td>
                  <td>February 28, 2024</td>
                  <td><span class="status-badge danger">Overdue</span></td>
                  <td><span class="priority-badge critical">Critical</span></td>
                  <td>
                    <button class="btn btn-sm btn-danger">Escalate</button>
                    <button class="btn btn-sm btn-warning">Notify Entity</button>
                  </td>
                </tr>
                <tr>
                  <td>Quarterly Royalty Declaration</td>
                  <td>Mines and Minerals Act, 2011</td>
                  <td>All Active Entities</td>
                  <td>April 15, 2024</td>
                  <td><span class="status-badge info">Upcoming</span></td>
                  <td><span class="priority-badge medium">Medium</span></td>
                  <td>
                    <button class="btn btn-sm btn-info">Send Reminder</button>
                    <button class="btn btn-sm btn-secondary">Schedule</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Compliance Alerts & Actions -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-exclamation-circle"></i> Compliance Alerts</h5>
              <span class="alert-count">4</span>
            </div>
            <div class="card-body">
              <div class="activity-list">
                <div class="activity-item urgent">
                  <div class="activity-icon"><i class="fas fa-exclamation-triangle text-danger"></i></div>
                  <div class="activity-content">
                    <p><strong>Critical:</strong> Maloma Colliery safety certificate expired</p>
                    <small>Operations must cease until renewal</small>
                  </div>
                </div>
                <div class="activity-item warning">
                  <div class="activity-icon"><i class="fas fa-clock text-warning"></i></div>
                  <div class="activity-content">
                    <p><strong>Warning:</strong> Environmental permit expires in 15 days</p>
                    <small>Mbabane Quarry renewal required</small>
                  </div>
                </div>
                <div class="activity-item info">
                  <div class="activity-icon"><i class="fas fa-info-circle text-info"></i></div>
                  <div class="activity-content">
                    <p><strong>Reminder:</strong> Annual reports due next month</p>
                    <small>All entities must submit by March 31</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-tasks"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="quick-actions-grid">
                <button class="btn btn-danger quick-action-btn">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>Review Critical Issues</span>
                </button>
                <button class="btn btn-warning quick-action-btn">
                  <i class="fas fa-bell"></i>
                  <span>Send Reminders</span>
                </button>
                <button class="btn btn-info quick-action-btn">
                  <i class="fas fa-file-alt"></i>
                  <span>Generate Report</span>
                </button>
                <button class="btn btn-primary quick-action-btn">
                  <i class="fas fa-calendar-check"></i>
                  <span>Schedule Audits</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Regulatory Management -->
      <section id="regulatory-management">
        <div class="page-header">
          <div class="page-title">
            <h1><i class="fas fa-gavel"></i> Regulatory Management</h1>
            <p>Manage regulatory frameworks, tax structures, and jurisdictional compliance for Eswatini mining sector.</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="add-regulation-btn"><i class="fas fa-plus"></i> Add New Regulation</button>
            <button class="btn btn-info" id="sync-regulations-btn"><i class="fas fa-sync-alt"></i> Sync with Government Portal</button>
            <button class="btn btn-primary" id="export-regulations-btn"><i class="fas fa-download"></i> Export Regulations</button>
          </div>
        </div>

        <!-- Regulatory Overview Dashboard -->
        <div class="charts-grid">
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-balance-scale"></i> Active Regulations</h3>
            </div>
            <div class="card-body">
              <p id="active-regulations-count">23</p>
              <small><i class="fas fa-check-circle text-success"></i> All regulations current</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-exclamation-triangle"></i> Pending Updates</h3>
            </div>
            <div class="card-body">
              <p id="pending-updates-count">2</p>
              <small><i class="fas fa-clock text-warning"></i> Awaiting implementation</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-calendar-alt"></i> Recent Changes</h3>
            </div>
            <div class="card-body">
              <p id="recent-changes-count">1</p>
              <small><i class="fas fa-bell text-info"></i> Last 30 days</small>
            </div>
          </div>
          <div class="metric-card card">
            <div class="card-header">
              <h3><i class="fas fa-percentage"></i> Compliance Rate</h3>
            </div>
            <div class="card-body">
              <p id="regulatory-compliance-rate">98.5%</p>
              <small><i class="fas fa-shield-check text-success"></i> Excellent compliance</small>
            </div>
          </div>
        </div>

        <!-- Primary Mining Laws & Acts -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-book"></i> Primary Mining Laws & Acts of Eswatini</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="filter-primary-laws">
                <i class="fas fa-filter"></i> Filter Laws
              </button>
              <button class="btn btn-info btn-sm" id="download-act-summaries">
                <i class="fas fa-file-pdf"></i> Download Summaries
              </button>
            </div>
          </div>

          <div class="regulations-grid">
            <div class="regulation-card primary-law">
              <div class="regulation-header">
                <h6><i class="fas fa-scroll"></i> Mines and Minerals Act, 2011</h6>
                <span class="regulation-status active">Active</span>
              </div>
              <div class="regulation-content">
                <p><strong>Act No. 4 of 2011</strong> - The principal legislation governing mining operations in Eswatini.</p>
                <div class="regulation-details">
                  <ul>
                    <li>Establishes the legal framework for mineral rights</li>
                    <li>Defines procedures for mining licenses and permits</li>
                    <li>Sets out environmental and safety requirements</li>
                    <li>Prescribes royalty rates and taxation</li>
                    <li>Establishes the Mining Commissioner's office</li>
                  </ul>
                </div>
                <div class="regulation-meta">
                  <small><strong>Last Updated:</strong> 15 March 2023</small>
                  <small><strong>Effective Date:</strong> 1 January 2012</small>
                </div>
              </div>
              <div class="regulation-actions">
                <button class="btn btn-sm btn-primary">View Full Text</button>
                <button class="btn btn-sm btn-info">Download PDF</button>
                <button class="btn btn-sm btn-secondary">View Amendments</button>
              </div>
            </div>

            <div class="regulation-card primary-law">
              <div class="regulation-header">
                <h6><i class="fas fa-leaf"></i> Environmental Management Act, 2002</h6>
                <span class="regulation-status active">Active</span>
              </div>
              <div class="regulation-content">
                <p><strong>Act No. 5 of 2002</strong> - Environmental protection and impact assessment requirements for mining.</p>
                <div class="regulation-details">
                  <ul>
                    <li>Environmental Impact Assessment (EIA) requirements</li>
                    <li>Environmental Management Plans (EMP)</li>
                    <li>Waste management and pollution control</li>
                    <li>Restoration and rehabilitation obligations</li>
                    <li>Environmental monitoring and compliance</li>
                  </ul>
                </div>
                <div class="regulation-meta">
                  <small><strong>Last Updated:</strong> 8 September 2022</small>
                  <small><strong>Effective Date:</strong> 1 July 2003</small>
                </div>
              </div>
              <div class="regulation-actions">
                <button class="btn btn-sm btn-primary">View Full Text</button>
                <button class="btn btn-sm btn-info">Download PDF</button>
                <button class="btn btn-sm btn-warning">EIA Guidelines</button>
              </div>
            </div>

            <div class="regulation-card primary-law">
              <div class="regulation-header">
                <h6><i class="fas fa-hard-hat"></i> Occupational Health and Safety Act, 2001</h6>
                <span class="regulation-status active">Active</span>
              </div>
              <div class="regulation-content">
                <p><strong>Act No. 9 of 2001</strong> - Workplace safety standards and requirements for mining operations.</p>
                <div class="regulation-details">
                  <ul>
                    <li>Mining safety standards and protocols</li>
                    <li>Worker protection and safety equipment</li>
                    <li>Accident reporting and investigation</li>
                    <li>Safety training and certification</li>
                    <li>Inspection and enforcement procedures</li>
                  </ul>
                </div>
                <div class="regulation-meta">
                  <small><strong>Last Updated:</strong> 22 November 2023</small>
                  <small><strong>Effective Date:</strong> 1 April 2002</small>
                </div>
              </div>
              <div class="regulation-actions">
                <button class="btn btn-sm btn-primary">View Full Text</button>
                <button class="btn btn-sm btn-info">Download PDF</button>
                <button class="btn btn-sm btn-success">Safety Guidelines</button>
              </div>
            </div>

            <div class="regulation-card primary-law">
              <div class="regulation-header">
                <h6><i class="fas fa-coins"></i> Income Tax Act, 1975 (Mining Provisions)</h6>
                <span class="regulation-status active">Active</span>
              </div>
              <div class="regulation-content">
                <p><strong>Act No. 21 of 1975</strong> - Tax obligations and incentives for mining companies.</p>
                <div class="regulation-details">
                  <ul>
                    <li>Corporate income tax rates for mining companies</li>
                    <li>Depreciation allowances for mining equipment</li>
                    <li>Capital gains tax on mineral rights</li>
                    <li>Withholding tax on dividends and royalties</li>
                    <li>Investment incentives and tax holidays</li>
                  </ul>
                </div>
                <div class="regulation-meta">
                  <small><strong>Last Updated:</strong> 30 June 2023</small>
                  <small><strong>Effective Date:</strong> Ongoing amendments</small>
                </div>
              </div>
              <div class="regulation-actions">
                <button class="btn btn-sm btn-primary">View Mining Sections</button>
                <button class="btn btn-sm btn-info">Tax Calculator</button>
                <button class="btn btn-sm btn-warning">Recent Changes</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Mining Regulations & Statutory Instruments -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-cogs"></i> Mining Regulations & Statutory Instruments</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="filter-regulations">
                <i class="fas fa-search"></i> Search Regulations
              </button>
              <button class="btn btn-info btn-sm" id="regulation-updates">
                <i class="fas fa-bell"></i> Get Updates
              </button>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="regulations-table">
              <thead>
                <tr>
                  <th>Regulation Title</th>
                  <th>Type</th>
                  <th>Reference No.</th>
                  <th>Effective Date</th>
                  <th>Status</th>
                  <th>Last Review</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Mining Licence Application Regulations</td>
                  <td>Statutory Instrument</td>
                  <td>S.I. No. 45 of 2012</td>
                  <td>1 April 2012</td>
                  <td><span class="status-badge success">Active</span></td>
                  <td>15 Jan 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                    <button class="btn btn-sm btn-info">Download</button>
                  </td>
                </tr>
                <tr>
                  <td>Royalty Payment Procedures</td>
                  <td>Regulation</td>
                  <td>Reg. No. 12 of 2013</td>
                  <td>1 July 2013</td>
                  <td><span class="status-badge success">Active</span></td>
                  <td>8 Feb 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                    <button class="btn btn-sm btn-info">Download</button>
                  </td>
                </tr>
                <tr>
                  <td>Environmental Impact Assessment Guidelines</td>
                  <td>Guideline</td>
                  <td>EIA-MIN-001</td>
                  <td>15 March 2020</td>
                  <td><span class="status-badge warning">Under Review</span></td>
                  <td>22 Feb 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                    <button class="btn btn-sm btn-warning">Review Status</button>
                  </td>
                </tr>
                <tr>
                  <td>Small Scale Mining Regulations</td>
                  <td>Statutory Instrument</td>
                  <td>S.I. No. 78 of 2015</td>
                  <td>1 October 2015</td>
                  <td><span class="status-badge success">Active</span></td>
                  <td>5 March 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                    <button class="btn btn-sm btn-info">Download</button>
                  </td>
                </tr>
                <tr>
                  <td>Mining Safety Standards</td>
                  <td>Standard</td>
                  <td>ESS-MIN-002</td>
                  <td>1 June 2019</td>
                  <td><span class="status-badge success">Active</span></td>
                  <td>12 March 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                    <button class="btn btn-sm btn-success">Safety Checklist</button>
                  </td>
                </tr>
                <tr>
                  <td>Quarrying Operations Guidelines</td>
                  <td>Guideline</td>
                  <td>QOG-2021-01</td>
                  <td>1 January 2021</td>
                  <td><span class="status-badge info">Updated</span></td>
                  <td>18 March 2024</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View Latest</button>
                    <button class="btn btn-sm btn-info">Download</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Regulatory Authorities & Contact Information -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-building"></i> Regulatory Authorities & Contact Information</h4>
          </div>

          <div class="authorities-grid">
            <div class="authority-card">
              <div class="authority-header">
                <h6><i class="fas fa-university"></i> Ministry of Natural Resources and Energy</h6>
                <span class="authority-role">Primary Mining Authority</span>
              </div>
              <div class="authority-content">
                <p><strong>Mining Commissioner's Office</strong></p>
                <div class="contact-info">
                  <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> Lobamba, Eswatini</p>
                  <p><i class="fas fa-phone"></i> <strong>Phone:</strong> +268 2416 1171</p>
                  <p><i class="fas fa-fax"></i> <strong>Fax:</strong> +268 2416 1506</p>
                  <p><i class="fas fa-envelope"></i> <strong>Email:</strong> mining@gov.sz</p>
                </div>
                <div class="authority-services">
                  <h7>Services:</h7>
                  <ul>
                    <li>Mining licence applications and renewals</li>
                    <li>Royalty collection and administration</li>
                    <li>Mining policy development</li>
                    <li>Compliance monitoring and enforcement</li>
                  </ul>
                </div>
              </div>
              <div class="authority-actions">
                <button class="btn btn-sm btn-primary">Visit Website</button>
                <button class="btn btn-sm btn-info">Contact Directory</button>
              </div>
            </div>

            <div class="authority-card">
              <div class="authority-header">
                <h6><i class="fas fa-leaf"></i> Eswatini Environment Authority (EEA)</h6>
                <span class="authority-role">Environmental Regulation</span>
              </div>
              <div class="authority-content">
                <p><strong>Environmental Protection & Assessment</strong></p>
                <div class="contact-info">
                  <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> Mbabane, Eswatini</p>
                  <p><i class="fas fa-phone"></i> <strong>Phone:</strong> +268 2404 6931</p>
                  <p><i class="fas fa-fax"></i> <strong>Fax:</strong> +268 2404 7219</p>
                  <p><i class="fas fa-envelope"></i> <strong>Email:</strong> info@eea.org.sz</p>
                </div>
                <div class="authority-services">
                  <h7>Services:</h7>
                  <ul>
                    <li>Environmental Impact Assessments</li>
                    <li>Environmental permits and licences</li>
                    <li>Environmental monitoring</li>
                    <li>Pollution control and enforcement</li>
                  </ul>
                </div>
              </div>
              <div class="authority-actions">
                <button class="btn btn-sm btn-primary">Visit Website</button>
                <button class="btn btn-sm btn-success">EIA Application</button>
              </div>
            </div>

            <div class="authority-card">
              <div class="authority-header">
                <h6><i class="fas fa-shield-alt"></i> Department of Labour & Social Security</h6>
                <span class="authority-role">Occupational Safety</span>
              </div>
              <div class="authority-content">
                <p><strong>Occupational Health & Safety Division</strong></p>
                <div class="contact-info">
                  <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> Mbabane, Eswatini</p>
                  <p><i class="fas fa-phone"></i> <strong>Phone:</strong> +268 2404 2771</p>
                  <p><i class="fas fa-fax"></i> <strong>Fax:</strong> +268 2404 3041</p>
                  <p><i class="fas fa-envelope"></i> <strong>Email:</strong> labour@gov.sz</p>
                </div>
                <div class="authority-services">
                  <h7>Services:</h7>
                  <ul>
                    <li>Workplace safety inspections</li>
                    <li>Safety permits and certifications</li>
                    <li>Accident investigation</li>
                    <li>Safety training and compliance</li>
                  </ul>
                </div>
              </div>
              <div class="authority-actions">
                <button class="btn btn-sm btn-primary">Visit Website</button>
                <button class="btn btn-sm btn-warning">Safety Report</button>
              </div>
            </div>

            <div class="authority-card">
              <div class="authority-header">
                <h6><i class="fas fa-calculator"></i> Eswatini Revenue Authority (ERA)</h6>
                <span class="authority-role">Tax Administration</span>
              </div>
              <div class="authority-content">
                <p><strong>Corporate Tax & Mining Revenue</strong></p>
                <div class="contact-info">
                  <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> Mbabane, Eswatini</p>
                  <p><i class="fas fa-phone"></i> <strong>Phone:</strong> +268 2404 8100</p>
                  <p><i class="fas fa-fax"></i> <strong>Fax:</strong> +268 2404 8122</p>
                  <p><i class="fas fa-envelope"></i> <strong>Email:</strong> info@era.org.sz</p>
                </div>
                <div class="authority-services">
                  <h7>Services:</h7>
                  <ul>
                    <li>Corporate income tax collection</li>
                    <li>Royalty tax administration</li>
                    <li>Tax compliance and audits</li>
                    <li>Tax incentive administration</li>
                  </ul>
                </div>
              </div>
              <div class="authority-actions">
                <button class="btn btn-sm btn-primary">Visit Website</button>
                <button class="btn btn-sm btn-info">Tax Portal</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Regulatory Updates & Amendments -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-newspaper"></i> Recent Regulatory Updates & Amendments</h4>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" id="subscribe-updates">
                <i class="fas fa-bell"></i> Subscribe to Updates
              </button>
              <button class="btn btn-info btn-sm" id="view-all-updates">
                <i class="fas fa-list"></i> View All Updates
              </button>
            </div>
          </div>

          <div class="updates-timeline">
            <div class="update-item recent">
              <div class="update-date">
                <span class="date">15 MAR</span>
                <span class="year">2024</span>
              </div>
              <div class="update-content">
                <h6><i class="fas fa-gavel"></i> Amendment to Mines and Minerals Act</h6>
                <p><strong>Notice No. 25 of 2024</strong> - Updated royalty calculation methods for coal mining operations.</p>
                <div class="update-details">
                  <p>Key changes include:</p>
                  <ul>
                    <li>Revised royalty rate structure for coal from 4% to 5%</li>
                    <li>New quarterly payment schedule requirements</li>
                    <li>Enhanced environmental bond requirements</li>
                  </ul>
                </div>
                <div class="update-actions">
                  <button class="btn btn-sm btn-primary">Read Full Amendment</button>
                  <button class="btn btn-sm btn-warning">Impact Assessment</button>
                </div>
              </div>
            </div>

            <div class="update-item">
              <div class="update-date">
                <span class="date">08 FEB</span>
                <span class="year">2024</span>
              </div>
              <div class="update-content">
                <h6><i class="fas fa-leaf"></i> New Environmental Guidelines</h6>
                <p><strong>EIA Circular 2024-01</strong> - Updated environmental impact assessment procedures for quarrying operations.</p>
                <div class="update-details">
                  <p>New requirements include:</p>
                  <ul>
                    <li>Mandatory biodiversity assessments</li>
                    <li>Community consultation requirements</li>
                    <li>Water resource impact studies</li>
                  </ul>
                </div>
                <div class="update-actions">
                  <button class="btn btn-sm btn-primary">Download Guidelines</button>
                  <button class="btn btn-sm btn-info">Compliance Checklist</button>
                </div>
              </div>
            </div>

            <div class="update-item">
              <div class="update-date">
                <span class="date">22 JAN</span>
                <span class="year">2024</span>
              </div>
              <div class="update-content">
                <h6><i class="fas fa-hard-hat"></i> Safety Regulation Updates</h6>
                <p><strong>Safety Notice 2024-03</strong> - Enhanced safety protocols for underground mining operations.</p>
                <div class="update-details">
                  <p>Updated requirements:</p>
                  <ul>
                    <li>Mandatory gas detection systems</li>
                    <li>Enhanced emergency response procedures</li>
                    <li>Additional safety training requirements</li>
                  </ul>
                </div>
                <div class="update-actions">
                  <button class="btn btn-sm btn-primary">View Safety Notice</button>
                  <button class="btn btn-sm btn-success">Training Schedule</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Regulatory Compliance Matrix -->
        <div class="user-form-container">
          <div class="section-header">
            <h4><i class="fas fa-table"></i> Regulatory Compliance Matrix</h4>
            <div class="table-actions">
              <button class="btn btn-primary btn-sm" id="update-compliance-status">
                <i class="fas fa-sync-alt"></i> Update Status
              </button>
              <button class="btn btn-info btn-sm" id="export-compliance-matrix">
                <i class="fas fa-download"></i> Export Matrix
              </button>
            </div>
          </div>

          <div class="compliance-matrix">
            <div class="matrix-header">
              <h6>Mining Entity Regulatory Compliance Status</h6>
              <p>Current compliance status across all active mining operations</p>
            </div>
            
            <div class="table-container">
              <table class="data-table compliance-table">
                <thead>
                  <tr>
                    <th>Mining Entity</th>
                    <th>Mining Licence</th>
                    <th>Environmental Permit</th>
                    <th>Safety Certificate</th>
                    <th>Tax Compliance</th>
                    <th>Royalty Status</th>
                    <th>Overall Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Kwalini Quarry</strong></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Current</span></td>
                    <td><span class="compliance-status compliant">‚úì Up to Date</span></td>
                    <td><span class="overall-status excellent">Excellent</span></td>
                    <td>
                      <button class="btn btn-sm btn-info">View Details</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Mbabane Quarry</strong></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status warning">‚ö† Expires Soon</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Current</span></td>
                    <td><span class="compliance-status compliant">‚úì Up to Date</span></td>
                    <td><span class="overall-status good">Good</span></td>
                    <td>
                      <button class="btn btn-sm btn-warning">Renew Permit</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Maloma Colliery</strong></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status non-compliant">‚úó Expired</span></td>
                    <td><span class="compliance-status compliant">‚úì Current</span></td>
                    <td><span class="compliance-status warning">‚ö† Overdue</span></td>
                    <td><span class="overall-status critical">Critical</span></td>
                    <td>
                      <button class="btn btn-sm btn-danger">Take Action</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Ngwenya Mine</strong></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Valid</span></td>
                    <td><span class="compliance-status compliant">‚úì Current</span></td>
                    <td><span class="compliance-status compliant">‚úì Up to Date</span></td>
                    <td><span class="overall-status excellent">Excellent</span></td>
                    <td>
                      <button class="btn btn-sm btn-info">View Details</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- My Profile -->
      <section id="profile">
        <div class="page-header">
          <div class="page-title">
            <h1>My Profile</h1>
            <p>Manage your account details and preferences</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary">Save Changes</button>
          </div>
        </div>
        <div class="user-form-container">
          <h4>Profile Information</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="profile-username">Username</label>
              <input type="text" id="profile-username" placeholder="Username" aria-describedby="profile-username-validation">
              <div class="validation-error" id="profile-username-validation">Username is required</div>
            </div>
            <div class="form-group">
              <label for="profile-email">Email</label>
              <input type="email" id="profile-email" placeholder="Email" aria-describedby="profile-email-validation">
              <div class="validation-error" id="profile-email-validation">Email is required</div>
            </div>
            <div class="form-group">
              <label for="profile-department">Department</label>
              <select id="profile-department" aria-describedby="profile-department-validation">
                <option>Select Department</option>
                <option>Finance</option>
                <option>Operations</option>
                <option>Compliance</option>
                <option>Audit</option>
                <option>Management</option>
              </select>
              <div class="validation-error" id="profile-department-validation">Department is required</div>
            </div>
          </div>
          <h4>Change Password</h4>
          <div class="grid-4">
            <div class="form-group">
              <label for="current-password">Current Password</label>
              <input type="password" id="current-password" placeholder="Current Password" aria-describedby="current-password-validation">
              <div class="validation-error" id="current-password-validation">Current password is required</div>
            </div>
            <div class="form-group">
              <label for="new-profile-password">New Password</label>
              <input type="password" id="new-profile-password" placeholder="New Password" aria-describedby="new-profile-password-validation">
              <div class="validation-error" id="new-profile-password-validation">New password is required</div>
            </div>
            <div class="form-group">
              <label for="confirm-profile-password">Confirm New Password</label>
              <input type="password" id="confirm-profile-password" placeholder="Confirm New Password" aria-describedby="confirm-profile-password-validation">
              <div class="validation-error" id="confirm-profile-password-validation">Passwords must match</div>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary">Cancel</button>
            <button class="btn btn-success">Update Profile</button>
          </div>
        </div>
      </section>

      <!-- Logout -->
      <section id="logout">
        <div class="page-header">
          <div class="page-title">
            <h1>Logout</h1>
            <p>Securely end your session</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-danger" id="confirm-logout-btn">Confirm Logout</button>
          </div>
        </div>
        <div class="user-form-container">
          <p>Click the button above to log out of the Mining Royalties Manager. Ensure all changes are saved before logging out.</p>
          <div class="logout-warning">
            <h5>‚ö†Ô∏è Before you logout:</h5>
            <ul>
              <li>Save any unsaved changes</li>
              <li>Complete any pending operations</li>
              <li>Close any open reports or forms</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modern Modular JavaScript -->
  <!-- Note: The file js/app.js needs to be created and populated with the application's main JavaScript logic. -->
  <script type="module" src="js/app.js"></script>
  
  <!-- Legacy support for non-module browsers -->
  <script nomodule>
    console.warn('This browser does not support ES6 modules. Please upgrade to a modern browser.');
    
    // Simple fallback for basic functionality
    document.addEventListener('DOMContentLoaded', function() {
      const loadingScreen = document.getElementById('loading-screen');
      const loginSection = document.getElementById('login-section');
      
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        loginSection.style.display = 'flex';
      }, 2000);
      
      // Basic login functionality
      const loginForm = document.querySelector('.login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const appContainer = document.getElementById('app-container');
          loginSection.style.display = 'none';
          appContainer.style.display = 'flex';
        });
      }
    });
  </script>

  <script>
// Enhanced password toggle functionality
function togglePassword(inputId) {
  const input = document.getElementById(inputId);
  if (!input) return;
  
  const container = input.parentElement;
  const button = container.querySelector('.password-toggle-btn');
  const icon = button.querySelector('i');
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.className = 'fas fa-eye-slash';
    button.setAttribute('aria-label', 'Hide password');
  } else {
    input.type = 'password';
    icon.className = 'fas fa-eye';
    button.setAttribute('aria-label', 'Show password');
  }
}

// Enhanced form validation helpers
function validateUsername(username) {
  if (!username || username.trim().length === 0) {
    return { valid: false, message: 'Username is required' };
  }
  if (username.length < 3) {
    return { valid: false, message: 'Username must be at least 3 characters long' };
  }
  if (username.length > 50) {
    return { valid: false, message: 'Username must be less than 50 characters' };
  }
  if (!/^[a-zA-Z0-9._-]+$/.test(username)) {
    return { valid: false, message: 'Username can only contain letters, numbers, dots, dashes, and underscores' };
  }
  // Check for reserved usernames
  const reserved = ['admin', 'root', 'system', 'test', 'demo'];
  if (reserved.includes(username.toLowerCase())) {
    return { valid: false, message: 'This username is reserved' };
  }
  return { valid: true, message: 'Username is available' };
}

function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || email.trim().length === 0) {
    return { valid: false, message: 'Email address is required' };
  }
  if (!emailRegex.test(email)) {
    return { valid: false, message: 'Please enter a valid email address' };
  }
  // Check for valid domain
  const domain = email.split('@')[1];
  if (domain && domain.indexOf('.') === -1) {
    return { valid: false, message: 'Please enter a valid email domain' };
  }
  return { valid: true, message: 'Email address is valid' };
}

function validatePassword(password) {
  if (!password) {
    return { valid: false, message: 'Password is required', strength: 'none', score: 0 };
  }
  
  let score = 0;
  let feedback = [];
  
  // Length check
  if (password.length >= 8) {
    score += 1;
  } else {
    feedback.push('at least 8 characters');
  }
  
  // Lowercase check
  if (/[a-z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('lowercase letters');
  }
  
  // Uppercase check
  if (/[A-Z]/.test(password)) {
    score += 1;
  } else {
    feedback.push('uppercase letters');
  }
  
  // Number check
  if (/[0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('numbers');
  }
  
  // Special character check
  if (/[^a-zA-Z0-9]/.test(password)) {
    score += 1;
  } else {
    feedback.push('special characters');
  }
  
  let strength = 'weak';
  if (score >= 4) strength = 'strong';
  else if (score >= 3) strength = 'medium';
  
  const isValid = score >= 3;
  const message = isValid 
    ? 'Password strength is good' 
    : `Password needs: ${feedback.join(', ')}`;
  
  return { 
    valid: isValid, 
    message: message,
    strength: strength,
    score: score
  };
}

function validateRequired(value, fieldName) {
  if (!value || value.trim().length === 0) {
    return { valid: false, message: `${fieldName} is required` };
  }
  return { valid: true, message: `${fieldName} is valid` };
}

function showFieldValidation(fieldId, validation) {
  const field = document.getElementById(fieldId);
  const errorElement = document.getElementById(fieldId + '-error');
  const successElement = document.getElementById(fieldId + '-success');
  
  if (!field) return;
  
  // Clear previous states
  field.classList.remove('field-valid', 'field-invalid');
  
  if (validation.valid) {
    field.classList.add('field-valid');
    if (errorElement) errorElement.style.display = 'none';
    if (successElement) {
      successElement.textContent = `‚úì ${validation.message}`;
      successElement.style.display = 'block';
    }
  } else {
    field.classList.add('field-invalid');
    if (successElement) successElement.style.display = 'none';
    if (errorElement) {
      errorElement.textContent = validation.message;
      errorElement.style.display = 'block';
    }
  }
  
  // Update form submit button state
  updateSubmitButtonState();
}

function updatePasswordStrength(password) {
  const validation = validatePassword(password);
  const strengthBar = document.querySelector('.strength-bar-fill');
  const strengthText = document.querySelector('.strength-text');
  const strengthContainer = document.querySelector('.strength-bar');
  
  if (strengthBar && strengthText && strengthContainer) {
    const widthPercent = Math.max((validation.score / 5) * 100, 10);
    strengthBar.style.width = `${widthPercent}%`;
    
    // Remove existing strength classes
    strengthContainer.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
    
    // Add appropriate strength class
    strengthContainer.classList.add(`strength-${validation.strength}`);
    
    if (validation.strength === 'strong') {
      strengthText.textContent = 'Password Strength: Strong';
    } else if (validation.strength === 'medium') {
      strengthText.textContent = 'Password Strength: Medium';
    } else if (validation.strength === 'weak') {
      strengthText.textContent = 'Password Strength: Weak';
    } else {
      strengthText.textContent = 'Password Strength: Enter password';
    }
  }
}

function validatePasswordMatch() {
  const password = document.getElementById('new-password')?.value || '';
  const confirmPassword = document.getElementById('confirm-password')?.value || '';
  
  if (!confirmPassword) {
    return { valid: false, message: 'Please confirm your password' };
  }
  
  const validation = {
    valid: password === confirmPassword && password.length > 0,
    message: password === confirmPassword ? 'Passwords match' : 'Passwords do not match'
  };
  
  showFieldValidation('confirm-password', validation);
  return validation;
}

function updateSubmitButtonState() {
  const submitBtn = document.getElementById('create-user-btn');
  if (!submitBtn) return;
  
  const requiredFields = [
    { id: 'new-username', validator: validateUsername },
    { id: 'new-email', validator: validateEmail },
    { id: 'new-role', validator: (v) => validateRequired(v, 'Role') },
    { id: 'new-department', validator: (v) => validateRequired(v, 'Department') },
    { id: 'new-password', validator: validatePassword }
  ];
  
  let allValid = true;
  
  for (const field of requiredFields) {
    const element = document.getElementById(field.id);
    if (element) {
      const validation = field.validator(element.value);
      if (!validation.valid) {
        allValid = false;
        break;
      }
    }
  }
  
  // Check password match
  const passwordMatch = validatePasswordMatch();
  if (!passwordMatch.valid) {
    allValid = false;
  }
  
  submitBtn.disabled = !allValid;
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
  // Show/hide add user form
  const addUserBtn = document.getElementById('add-user-btn');
  const addUserContainer = document.getElementById('add-user-form-container');
  const closeFormBtn = document.getElementById('close-add-user-form');
  const cancelBtn = document.getElementById('cancel-add-user');
  
  if (addUserBtn && addUserContainer) {
    addUserBtn.addEventListener('click', function() {
      addUserContainer.style.display = 'block';
      addUserContainer.scrollIntoView({ behavior: 'smooth' });
    });
  }
  
  function hideAddUserForm() {
    if (addUserContainer) {
      addUserContainer.style.display = 'none';
      // Reset form
      const form = document.getElementById('add-user-form');
      if (form) form.reset();
      // Clear validations
      document.querySelectorAll('.validation-error, .validation-success').forEach(el => {
        el.style.display = 'none';
      });
      // Reset password strength
      const strengthBar = document.querySelector('.strength-bar-fill');
      const strengthText = document.querySelector('.strength-text');
      if (strengthBar) strengthBar.style.width = '0%';
      if (strengthText) strengthText.textContent = 'Password Strength: Enter password';
    }
  }
  
  if (closeFormBtn) closeFormBtn.addEventListener('click', hideAddUserForm);
  if (cancelBtn) cancelBtn.addEventListener('click', hideAddUserForm);
  
  // Username validation
  const usernameField = document.getElementById('new-username');
  if (usernameField) {
    usernameField.addEventListener('input', function() {
      const validation = validateUsername(this.value);
      showFieldValidation('new-username', validation);
    });
  }
  
  // Email validation
  const emailField = document.getElementById('new-email');
  if (emailField) {
    emailField.addEventListener('input', function() {
      const validation = validateEmail(this.value);
      showFieldValidation('new-email', validation);
    });
  }
  
  // Password validation
  const passwordField = document.getElementById('new-password');
  if (passwordField) {
    passwordField.addEventListener('input', function() {
      const validation = validatePassword(this.value);
      showFieldValidation('new-password', validation);
      updatePasswordStrength(this.value);
    });
  }
  
  // Confirm password validation
  const confirmPasswordField = document.getElementById('confirm-password');
  if (confirmPasswordField) {
    confirmPasswordField.addEventListener('input', function() {
      validatePasswordMatch();
    });
  }
  
  // Role and department change actions
  const roleField = document.getElementById('new-role');
  const departmentField = document.getElementById('new-department');
  if (roleField && departmentField) {
    roleField.addEventListener('change', function() {
      // Auto-select department based on role (example logic)
      if (this.value === 'ADMIN') {
        departmentField.value = 'Management';
      } else {
        departmentField.value = '';
      }
      updateSubmitButtonState();
    });
    
    departmentField.addEventListener('change', function() {
      // Auto-select role based on department (example logic)
      if (this.value === 'Management') {
        roleField.value = 'ADMIN';
      } else {
        roleField.value = '';
      }
      updateSubmitButtonState();
    });
  }
});

  </script>
</body>
</html>