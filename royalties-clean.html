<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Mining Royalties Manager - Clean Version">
  <title>Mining Royalties Manager - Clean</title>
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.svg" type="image/svg+xml">
  
  <!-- Essential Dependencies Only -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js for dashboard charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Core Styles -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/enhanced-styles.css">
  
  <style>
    /* Essential inline styles for immediate functionality */
    .notification {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .loading-screen {
      background: linear-gradient(135deg, #1a365d 0%, #2563eb 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
    }
    
    .login-section {
      background: linear-gradient(135deg, #1a365d 0%, #2563eb 100%);
      display: none;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: white;
    }
    
    .main-app {
      display: none;
      min-height: 100vh;
    }
    
    .spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="spinner"></div>
    <h2>Mining Royalties Manager</h2>
    <p>Loading application...</p>
  </div>

  <!-- Login Section -->
  <div id="login-section" class="login-section">
    <div class="login-container">
      <div class="login-header">
        <h1>Mining Royalties Manager</h1>
        <p>Government of Eswatini - Mining Authority</p>
      </div>
      
      <form id="login-form" class="login-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="username" required value="admin">
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required value="admin123">
        </div>
        
        <button type="submit" class="btn btn-primary btn-login">Login</button>
        
        <div id="error-message" class="error-message" style="display: none;"></div>
      </form>
    </div>
  </div>

  <!-- Main Application -->
  <div id="main-app" class="main-app">
    
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h3>Mining Royalties</h3>
      </div>
      
      <nav class="sidebar-nav">
        <ul>
          <li><a href="#dashboard" class="nav-link active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
          <li><a href="#user-management" class="nav-link" data-section="user-management"><i class="fas fa-users"></i> User Management</a></li>
          <li><a href="#royalty-records" class="nav-link" data-section="royalty-records"><i class="fas fa-file-invoice-dollar"></i> Royalty Records</a></li>
          <li><a href="#contract-management" class="nav-link" data-section="contract-management"><i class="fas fa-file-contract"></i> Contract Management</a></li>
          <li><a href="#reporting-analytics" class="nav-link" data-section="reporting-analytics"><i class="fas fa-chart-bar"></i> Reports & Analytics</a></li>
          <li><a href="#communication" class="nav-link" data-section="communication"><i class="fas fa-comments"></i> Communication</a></li>
          <li><a href="#notifications" class="nav-link" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
          <li><a href="#compliance" class="nav-link" data-section="compliance"><i class="fas fa-shield-alt"></i> Compliance</a></li>
          <li><a href="#regulatory-management" class="nav-link" data-section="regulatory-management"><i class="fas fa-gavel"></i> Regulatory</a></li>
          <li><a href="#profile" class="nav-link" data-section="profile"><i class="fas fa-user"></i> Profile</a></li>
        </ul>
      </nav>
      
      <div class="sidebar-footer">
        <button class="btn btn-secondary" data-section="logout">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- Dashboard Section -->
      <section id="dashboard" class="content-section">
        <div class="page-header">
          <h1>Dashboard</h1>
          <div class="page-actions">
            <button class="btn btn-primary" onclick="refreshDashboard()">
              <i class="fas fa-sync"></i> Refresh
            </button>
            <button class="btn btn-secondary" onclick="addNewRecord()">
              <i class="fas fa-plus"></i> Add Record
            </button>
            <button class="btn btn-info" onclick="runComplianceCheck()">
              <i class="fas fa-check"></i> Compliance Check
            </button>
          </div>
        </div>
        
        <div class="dashboard-metrics">
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-money-bill-wave"></i></div>
            <div class="metric-content">
              <h3 id="total-royalties">E 0.00</h3>
              <p>Total Royalties</p>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-industry"></i></div>
            <div class="metric-content">
              <h3 id="active-entities">0</h3>
              <p>Active Entities</p>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-chart-pie"></i></div>
            <div class="metric-content">
              <h3 id="compliance-rate">0%</h3>
              <p>Compliance Rate</p>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-check-circle"></i></div>
            <div class="metric-content">
              <h3 id="paid-count">0</h3>
              <p>Paid Records</p>
            </div>
          </div>
        </div>
        
        <div class="dashboard-charts">
          <div class="chart-container">
            <h4>Revenue Trends</h4>
            <canvas id="revenue-trends-chart"></canvas>
          </div>
          
          <div class="chart-container">
            <h4>Production by Entity</h4>
            <canvas id="production-by-entity-chart"></canvas>
          </div>
        </div>
      </section>

      <!-- User Management Section -->
      <section id="user-management" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>User Management</h1>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3>User Accounts</h3>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="select-all-users"></th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Last Login</th>
                    <th>Failed Attempts</th>
                    <th>Expires</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-tbody">
                  <!-- Content will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3>Audit Log</h3>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Target</th>
                    <th>IP Address</th>
                    <th>Status</th>
                    <th>Details</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="audit-log-tbody">
                  <!-- Content will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Royalty Records Section -->
      <section id="royalty-records" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Royalty Records</h1>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3>All Records</h3>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Entity</th>
                    <th>Mineral</th>
                    <th>Volume</th>
                    <th>Tariff</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="royalty-records-tbody">
                  <!-- Content will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Other Sections (Placeholder) -->
      <section id="contract-management" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Contract Management</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Contract management functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="reporting-analytics" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Reports & Analytics</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Reporting and analytics functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="communication" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Communication</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Communication functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="notifications" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Notifications</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Notification management functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="compliance" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Compliance</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Compliance management functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="regulatory-management" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Regulatory Management</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>Regulatory management functionality will be available soon.</p>
          </div>
        </div>
      </section>

      <section id="profile" class="content-section" style="display: none;">
        <div class="page-header">
          <h1>Profile</h1>
          <p>This section is under development</p>
        </div>
        <div class="card">
          <div class="card-body">
            <p>User profile functionality will be available soon.</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Logout Confirmation Modal -->
  <div id="logout-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Confirm Logout</h3>
      <p>Are you sure you want to logout?</p>
      <div class="modal-actions">
        <button id="confirm-logout-btn" class="btn btn-danger">Yes, Logout</button>
        <button class="btn btn-secondary" onclick="document.getElementById('logout-modal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Essential Scripts -->
  
  <!-- Use the clean application core -->
  <script src="app-clean.js"></script>
  
  <!-- Simple chart initialization for dashboard -->
  <script>
    // Basic chart setup for dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for the app to initialize, then create basic charts
      setTimeout(() => {
        if (typeof Chart !== 'undefined') {
          createBasicCharts();
        }
      }, 3000);
    });
    
    function createBasicCharts() {
      // Revenue Trends Chart
      const revenueCanvas = document.getElementById('revenue-trends-chart');
      if (revenueCanvas) {
        new Chart(revenueCanvas, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
              label: 'Revenue (E)',
              data: [45000, 52000, 48000, 61000, 55000, 67000],
              borderColor: '#1a365d',
              backgroundColor: 'rgba(26, 54, 93, 0.1)',
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return 'E' + value.toLocaleString();
                  }
                }
              }
            }
          }
        });
      }
      
      // Production Chart
      const productionCanvas = document.getElementById('production-by-entity-chart');
      if (productionCanvas) {
        new Chart(productionCanvas, {
          type: 'doughnut',
          data: {
            labels: ['Ngwenya Mine', 'Maloma Colliery', 'Kwalini Quarry'],
            datasets: [{
              data: [2100, 850, 1250],
              backgroundColor: ['#1a365d', '#2563eb', '#059669']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      }
    }
  </script>

</body>
</html>
