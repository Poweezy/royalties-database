<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Icon Fix Script</title>
</head>
<body>
    <script>
        // Enhanced FontAwesome replacement and error handling
        (function() {
            'use strict';
            
            // Extended icon mapping with more icons
            const iconMap = {
                'fa-home': 'ðŸ ',
                'fa-user': 'ðŸ‘¤',
                'fa-users': 'ðŸ‘¥',
                'fa-chart-bar': 'ðŸ“Š',
                'fa-chart-line': 'ðŸ“ˆ',
                'fa-chart-pie': 'ðŸ¥§',
                'fa-file-alt': 'ðŸ“„',
                'fa-file': 'ðŸ“„',
                'fa-folder': 'ðŸ“',
                'fa-cog': 'âš™ï¸',
                'fa-settings': 'âš™ï¸',
                'fa-database': 'ðŸ—„ï¸',
                'fa-money-bill': 'ðŸ’°',
                'fa-dollar-sign': 'ðŸ’²',
                'fa-search': 'ðŸ”',
                'fa-plus': 'âž•',
                'fa-edit': 'âœï¸',
                'fa-pencil': 'âœï¸',
                'fa-trash': 'ðŸ—‘ï¸',
                'fa-delete': 'ðŸ—‘ï¸',
                'fa-download': 'â¬‡ï¸',
                'fa-upload': 'â¬†ï¸',
                'fa-print': 'ðŸ–¨ï¸',
                'fa-eye': 'ðŸ‘ï¸',
                'fa-eye-slash': 'ðŸ™ˆ',
                'fa-lock': 'ðŸ”’',
                'fa-unlock': 'ðŸ”“',
                'fa-calendar': 'ðŸ“…',
                'fa-clock': 'ðŸ•',
                'fa-time': 'ðŸ•',
                'fa-check': 'âœ…',
                'fa-times': 'âŒ',
                'fa-close': 'âŒ',
                'fa-warning': 'âš ï¸',
                'fa-exclamation-triangle': 'âš ï¸',
                'fa-info': 'â„¹ï¸',
                'fa-info-circle': 'â„¹ï¸',
                'fa-arrow-up': 'â¬†ï¸',
                'fa-arrow-down': 'â¬‡ï¸',
                'fa-arrow-left': 'â¬…ï¸',
                'fa-arrow-right': 'âž¡ï¸',
                'fa-bars': 'â˜°',
                'fa-menu': 'â˜°',
                'fa-bell': 'ðŸ””',
                'fa-envelope': 'âœ‰ï¸',
                'fa-phone': 'ðŸ“ž',
                'fa-star': 'â­',
                'fa-heart': 'â¤ï¸',
                'fa-bookmark': 'ðŸ”–',
                'fa-share': 'ðŸ“¤',
                'fa-save': 'ðŸ’¾',
                'fa-filter': 'ðŸ”½',
                'fa-sort': 'â†•ï¸',
                'fa-refresh': 'ðŸ”„',
                'fa-sync': 'ðŸ”„',
                'fa-power-off': 'â»',
                'fa-sign-out': 'ðŸšª',
                'fa-sign-in': 'ðŸšª',
                'fa-question': 'â“',
                'fa-help': 'â“',
                // Additional common icons
                'fa-chart': 'ðŸ“Š',
                'fa-report': 'ðŸ“Š',
                'fa-dashboard': 'ðŸ“‹',
                'fa-analytics': 'ðŸ“ˆ',
                'fa-notification': 'ðŸ””',
                'fa-notifications': 'ðŸ””'
            };

            // Enhanced error suppression for all console methods
            function suppressErrors() {
                const errorPatterns = [
                    'fontawesome',
                    'favicon',
                    'CORS',
                    '404',
                    'kit.fontawesome.com',
                    'a076d05399.js',
                    'favicon-192.png',
                    'Manifest',
                    'Access to fetch',
                    'SyntaxError: Unexpected identifier',
                    'Download error or resource'
                ];

                ['error', 'warn', 'log'].forEach(method => {
                    const original = console[method];
                    console[method] = function(...args) {
                        const message = args.join(' ');
                        if (typeof message === 'string' && 
                            errorPatterns.some(pattern => message.toLowerCase().includes(pattern.toLowerCase()))) {
                            return; // Silently ignore these errors
                        }
                        original.apply(console, args);
                    };
                });

                // Suppress window errors
                window.addEventListener('error', function(e) {
                    if (e.filename && (
                        e.filename.includes('fontawesome') ||
                        e.filename.includes('a076d05399.js')
                    )) {
                        e.preventDefault();
                        return false;
                    }
                });

                // Suppress unhandled promise rejections
                window.addEventListener('unhandledrejection', function(e) {
                    if (e.reason && typeof e.reason === 'string' && (
                        e.reason.includes('fontawesome') ||
                        e.reason.includes('CORS') ||
                        e.reason.includes('favicon')
                    )) {
                        e.preventDefault();
                        return false;
                    }
                });
            }

            // Block problematic network requests
            function blockProblematicRequests() {
                // Override fetch to block problematic requests
                const originalFetch = window.fetch;
                window.fetch = function(url, options) {
                    if (typeof url === 'string' && (
                        url.includes('kit.fontawesome.com') ||
                        url.includes('a076d05399.js') ||
                        url.includes('favicon-192.png')
                    )) {
                        return Promise.reject(new Error('Blocked problematic request'));
                    }
                    return originalFetch.apply(this, arguments);
                };

                // Override XMLHttpRequest
                const originalXHR = window.XMLHttpRequest;
                window.XMLHttpRequest = function() {
                    const xhr = new originalXHR();
                    const originalOpen = xhr.open;
                    xhr.open = function(method, url) {
                        if (typeof url === 'string' && (
                            url.includes('kit.fontawesome.com') ||
                            url.includes('a076d05399.js') ||
                            url.includes('favicon-192.png')
                        )) {
                            throw new Error('Blocked problematic request');
                        }
                        return originalOpen.apply(this, arguments);
                    };
                    return xhr;
                };
            }

            function replaceIcons() {
                // Find all elements with FontAwesome classes
                const allElements = document.querySelectorAll('[class*="fa-"]');
                
                allElements.forEach(element => {
                    const classList = Array.from(element.classList);
                    let iconReplaced = false;
                    
                    classList.forEach(className => {
                        if (iconMap[className]) {
                            // Remove FontAwesome classes
                            element.classList.remove(className, 'fas', 'far', 'fab', 'fa');
                            
                            // Add emoji icon
                            if (!element.textContent.trim() || element.textContent.trim().length === 1) {
                                element.textContent = iconMap[className];
                                element.classList.add('emoji-icon');
                                iconReplaced = true;
                            }
                        }
                    });
                    
                    // If no icon was replaced but element has fa- classes, add a default icon
                    if (!iconReplaced && classList.some(c => c.startsWith('fa-'))) {
                        element.textContent = 'ðŸ“‹';
                        element.classList.add('emoji-icon');
                        // Remove all FontAwesome classes
                        classList.forEach(c => {
                            if (c.startsWith('fa')) {
                                element.classList.remove(c);
                            }
                        });
                    }
                });
            }

            function removeFailedFontAwesome() {
                // Remove failed FontAwesome script tags more aggressively
                const fontAwesomeScripts = document.querySelectorAll('script');
                fontAwesomeScripts.forEach(script => {
                    if (script.src && (
                        script.src.includes('kit.fontawesome.com') ||
                        script.src.includes('a076d05399.js') ||
                        script.src.includes('fontawesome')
                    )) {
                        script.remove();
                    }
                });

                // Remove failed stylesheet links
                const fontAwesomeLinks = document.querySelectorAll('link');
                fontAwesomeLinks.forEach(link => {
                    if (link.href && (
                        link.href.includes('fontawesome') ||
                        link.href.includes('favicon-192.png')
                    )) {
                        link.remove();
                    }
                });

                // Remove any manifest references to problematic icons
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (manifestLink) {
                    manifestLink.remove();
                }
            }

            function addMobileMenuToggle() {
                if (!document.querySelector('.mobile-menu-toggle')) {
                    const toggle = document.createElement('button');
                    toggle.className = 'mobile-menu-toggle';
                    toggle.innerHTML = 'â˜°';
                    toggle.setAttribute('aria-label', 'Toggle Menu');
                    
                    toggle.onclick = function() {
                        const sidebar = document.querySelector('.sidebar');
                        if (sidebar) {
                            sidebar.classList.toggle('active');
                        }
                    };
                    
                    document.body.appendChild(toggle);
                }
            }

            function handleFontAwesomeError() {
                // Immediately replace icons without waiting
                replaceIcons();
                
                // Check if FontAwesome loaded properly after a delay
                setTimeout(() => {
                    const testElement = document.createElement('i');
                    testElement.className = 'fas fa-home';
                    testElement.style.position = 'absolute';
                    testElement.style.left = '-9999px';
                    document.body.appendChild(testElement);
                    
                    setTimeout(() => {
                        const computedStyle = window.getComputedStyle(testElement, ':before');
                        const content = computedStyle.getPropertyValue('content');
                        
                        // If FontAwesome didn't load properly, ensure all icons are replaced
                        if (!content || content === 'none' || content === '""') {
                            console.log('FontAwesome not available, using emoji fallbacks');
                            removeFailedFontAwesome();
                            replaceIcons(); // Run again to catch any new elements
                        }
                        
                        document.body.removeChild(testElement);
                    }, 100);
                }, 200);
            }

            function createFallbackFavicon() {
                // Remove ALL existing favicon and icon links
                const allIconLinks = document.querySelectorAll('link[rel*="icon"], link[rel*="shortcut"], link[rel*="apple-touch-icon"]');
                allIconLinks.forEach(link => link.remove());

                // Create comprehensive favicon coverage
                const faviconSVG = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23e6c659"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%231a365d">ðŸ’°</text></svg>';
                
                // Standard favicon
                const favicon = document.createElement('link');
                favicon.rel = 'icon';
                favicon.type = 'image/svg+xml';
                favicon.href = faviconSVG;
                document.head.appendChild(favicon);

                // Apple touch icon
                const appleFavicon = document.createElement('link');
                appleFavicon.rel = 'apple-touch-icon';
                appleFavicon.href = faviconSVG;
                document.head.appendChild(appleFavicon);

                // Add theme color
                let themeColor = document.querySelector('meta[name="theme-color"]');
                if (!themeColor) {
                    themeColor = document.createElement('meta');
                    themeColor.name = 'theme-color';
                    themeColor.content = '#1a365d';
                    document.head.appendChild(themeColor);
                }
            }

            function cleanupDOM() {
                // Remove any broken image elements
                const brokenImages = document.querySelectorAll('img[src*="favicon"]');
                brokenImages.forEach(img => {
                    if (!img.src.startsWith('data:')) {
                        img.remove();
                    }
                });

                // Remove any error-causing elements
                const errorElements = document.querySelectorAll('[src*="a076d05399.js"], [href*="favicon-192.png"]');
                errorElements.forEach(el => el.remove());
            }

            // Initialize when DOM is ready
            function init() {
                suppressErrors();
                blockProblematicRequests();
                createFallbackFavicon();
                removeFailedFontAwesome();
                cleanupDOM();
                replaceIcons();
                addMobileMenuToggle();
                handleFontAwesomeError();
                
                // Add enhanced CSS
                const style = document.createElement('style');
                style.textContent = `
                    /* Hide any broken images or failed resources */
                    img[src*="favicon"]:not([src^="data:"]) {
                        display: none !important;
                    }
                    
                    /* Hide any script tags that might show as broken */
                    script[src*="fontawesome"],
                    script[src*="a076d05399"] {
                        display: none !important;
                    }
                    
                    /* Ensure emoji icons display properly */
                    .emoji-icon {
                        font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif !important;
                        font-style: normal !important;
                        font-weight: normal !important;
                        font-variant: normal !important;
                        text-transform: none !important;
                        line-height: 1 !important;
                        -webkit-font-feature-settings: "liga" !important;
                        font-feature-settings: "liga" !important;
                    }
                `;
                document.head.appendChild(style);
            }

            // Run immediately and aggressively
            suppressErrors();
            blockProblematicRequests();

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

            // Run multiple times to ensure all errors are caught
            setTimeout(init, 50);
            setTimeout(init, 100);
            setTimeout(removeFailedFontAwesome, 200);
            setTimeout(cleanupDOM, 300);
            setTimeout(replaceIcons, 400);
            setTimeout(replaceIcons, 1000);

            // Continuous cleanup
            setInterval(() => {
                removeFailedFontAwesome();
                cleanupDOM();
                replaceIcons();
            }, 2000);

            // Listen for new elements being added
            if (window.MutationObserver) {
                const observer = new MutationObserver(function(mutations) {
                    let shouldCleanup = false;
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === 1) {
                                    // Check for problematic elements
                                    if ((node.src && (node.src.includes('fontawesome') || node.src.includes('favicon-192'))) ||
                                        (node.href && (node.href.includes('fontawesome') || node.href.includes('favicon-192'))) ||
                                        (node.classList && Array.from(node.classList).some(c => c.startsWith('fa-')))) {
                                        shouldCleanup = true;
                                    }
                                }
                            });
                        }
                    });
                    if (shouldCleanup) {
                        setTimeout(() => {
                            removeFailedFontAwesome();
                            cleanupDOM();
                            replaceIcons();
                        }, 10);
                    }
                });

                observer.observe(document.head, { childList: true, subtree: true });
                observer.observe(document.body, { childList: true, subtree: true });
            }

        })();
    </script>
    
    <!-- Fallback message for users -->
    <div style="display: none;">
        <p>This script provides comprehensive error handling, icon fallbacks, and mobile menu functionality for the Royalties Database application.</p>
    </div>
</body>
</html>
