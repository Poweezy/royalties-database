<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Method Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .method-test {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .available { background: #d4edda; color: #155724; }
        .missing { background: #f8d7da; color: #721c24; }
        .status { font-weight: bold; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Notification System Method Verification</h1>
        
        <button onclick="runVerification()">Run Method Verification</button>
        <button onclick="debugSystem()">Debug System Object</button>
        
        <div id="method-results">
            <p>Click "Run Method Verification" to check all methods...</p>
        </div>
        
        <div id="debug-info">
            <!-- Debug information will appear here -->
        </div>
        
        <!-- Mock notification count element -->
        <div id="notification-count" style="display: none;">0</div>
    </div>

    <script src="js/enhanced-notification-system.js"></script>
    
    <script>
        function runVerification() {
            const resultsDiv = document.getElementById('method-results');
            resultsDiv.innerHTML = '<h3>Method Verification Results:</h3>';
            
            const requiredMethods = [
                'init',
                'show',
                'addPersistentNotification',
                'getPersistentNotifications',
                'markAsRead',
                'removePersistentNotification',
                'deleteNotification',
                'updateNotificationCount',
                'loadPersistentNotifications',
                'savePersistentNotifications',
                'calculateUnreadCount',
                'bulkMarkAsRead',
                'bulkDelete'
            ];
            
            console.log('=== VERIFICATION START ===');
            console.log('NotificationSystem:', window.NotificationSystem);
            console.log('notificationManager:', window.notificationManager);
            
            // Check NotificationSystem
            if (window.NotificationSystem) {
                resultsDiv.innerHTML += '<h4>window.NotificationSystem:</h4>';
                
                requiredMethods.forEach(method => {
                    const available = typeof window.NotificationSystem[method] === 'function';
                    const div = document.createElement('div');
                    div.className = `method-test ${available ? 'available' : 'missing'}`;
                    div.innerHTML = `
                        <span>NotificationSystem.${method}()</span>
                        <span class="status">${available ? '‚úÖ Available' : '‚ùå Missing'}</span>
                    `;
                    resultsDiv.appendChild(div);
                    
                    console.log(`NotificationSystem.${method}:`, available ? 'AVAILABLE' : 'MISSING');
                });
            } else {
                resultsDiv.innerHTML += '<div class="method-test missing">‚ùå NotificationSystem not found</div>';
            }
            
            // Check notificationManager
            if (window.notificationManager) {
                resultsDiv.innerHTML += '<h4>window.notificationManager:</h4>';
                
                requiredMethods.forEach(method => {
                    const available = typeof window.notificationManager[method] === 'function';
                    const div = document.createElement('div');
                    div.className = `method-test ${available ? 'available' : 'missing'}`;
                    div.innerHTML = `
                        <span>notificationManager.${method}()</span>
                        <span class="status">${available ? '‚úÖ Available' : '‚ùå Missing'}</span>
                    `;
                    resultsDiv.appendChild(div);
                    
                    console.log(`notificationManager.${method}:`, available ? 'AVAILABLE' : 'MISSING');
                });
                
                // Test if they're the same object
                const sameObject = window.notificationManager === window.NotificationSystem;
                const div = document.createElement('div');
                div.className = `method-test ${sameObject ? 'available' : 'missing'}`;
                div.innerHTML = `
                    <span>notificationManager === NotificationSystem</span>
                    <span class="status">${sameObject ? '‚úÖ Same Object' : '‚ùå Different Objects'}</span>
                `;
                resultsDiv.appendChild(div);
                
            } else {
                resultsDiv.innerHTML += '<div class="method-test missing">‚ùå notificationManager not found</div>';
            }
            
            console.log('=== VERIFICATION END ===');
        }
        
        function debugSystem() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = '<h3>Debug Information:</h3>';
            
            // Show NotificationSystem object structure
            if (window.NotificationSystem) {
                const methods = Object.getOwnPropertyNames(window.NotificationSystem)
                    .filter(prop => typeof window.NotificationSystem[prop] === 'function');
                    
                debugDiv.innerHTML += `
                    <h4>NotificationSystem Methods (${methods.length}):</h4>
                    <pre>${methods.join('\n')}</pre>
                `;
                
                // Show properties
                const properties = Object.getOwnPropertyNames(window.NotificationSystem)
                    .filter(prop => typeof window.NotificationSystem[prop] !== 'function');
                    
                debugDiv.innerHTML += `
                    <h4>NotificationSystem Properties (${properties.length}):</h4>
                    <pre>${properties.join('\n')}</pre>
                `;
            }
            
            // Show initialization status
            debugDiv.innerHTML += `
                <h4>Initialization Status:</h4>
                <pre>
Container exists: ${window.NotificationSystem?.container ? 'YES' : 'NO'}
Persistent notifications: ${window.NotificationSystem?.persistentNotifications?.length || 0}
Unread count: ${window.NotificationSystem?.unreadCount || 0}
Sound enabled: ${window.NotificationSystem?.soundEnabled || false}
                </pre>
            `;
        }
        
        // Auto-run when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                runVerification();
                debugSystem();
            }, 1000);
        });
        
        // Listen for system ready event
        window.addEventListener('notificationSystemReady', () => {
            console.log('üéâ Notification system ready event received!');
            setTimeout(() => {
                runVerification();
                debugSystem();
            }, 100);
        });
    </script>
</body>
</html>
