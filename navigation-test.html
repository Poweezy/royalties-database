<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Test - Mining Royalties Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #005a87;
        }
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Navigation Test & Debug Tool</h1>
        <p>This page will test the navigation functionality and help debug any issues.</p>
        
        <div class="test-section">
            <h2>üìä Test Status</h2>
            <div id="test-status" class="status">Initializing tests...</div>
        </div>
        
        <div class="test-section">
            <h2>üéÆ Manual Tests</h2>
            <button class="test-button" onclick="testNavigationSetup()">Test Navigation Setup</button>
            <button class="test-button" onclick="testDebugNavigation()">Run Navigation Debug</button>
            <button class="test-button" onclick="testSidebarLoad()">Test Sidebar Load</button>
            <button class="test-button" onclick="testNavigationClick()">Test Navigation Click</button>
            <button class="test-button" onclick="runFullDiagnostic()">Full Diagnostic</button>
            <button class="test-button" onclick="clearDebugOutput()">Clear Output</button>
        </div>
        
        <div class="test-section">
            <h2>üìã Debug Output</h2>
            <div id="debug-output" class="debug-output">
                <div>Debug output will appear here...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üèóÔ∏è Application Container</h2>
            <p>The main application will be embedded below:</p>
            <iframe src="royalties.html" width="100%" height="600" style="border: 1px solid #ddd; border-radius: 4px;"></iframe>
        </div>
    </div>

    <script>
        // Test functions
        let debugOutput = document.getElementById('debug-output');
        let testStatus = document.getElementById('test-status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '5px';
            logEntry.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#6c757d';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            debugOutput.appendChild(logEntry);
            debugOutput.scrollTop = debugOutput.scrollHeight;
            
            console.log(`[Navigation Test] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            testStatus.textContent = message;
            testStatus.className = `status ${type}`;
        }
        
        function clearDebugOutput() {
            debugOutput.innerHTML = '<div>Debug output cleared...</div>';
        }
        
        function testNavigationSetup() {
            log('üîß Testing navigation setup...', 'info');
            
            // Check if the iframe window has the app
            const iframe = document.querySelector('iframe');
            if (iframe && iframe.contentWindow) {
                try {
                    const app = iframe.contentWindow.royaltiesApp || iframe.contentWindow.app;
                    if (app) {
                        log('‚úÖ App instance found in iframe', 'success');
                        
                        if (app.setupNavigation) {
                            log('üîÑ Running setupNavigation()...', 'info');
                            app.setupNavigation();
                            log('‚úÖ setupNavigation() completed', 'success');
                        } else {
                            log('‚ùå setupNavigation method not found', 'error');
                        }
                        
                        // Check navigation links
                        const navLinks = iframe.contentDocument.querySelectorAll('.nav-link[data-section]');
                        log(`üîç Found ${navLinks.length} navigation links`, navLinks.length > 0 ? 'success' : 'error');
                        
                        if (navLinks.length > 0) {
                            navLinks.forEach((link, i) => {
                                log(`  ${i + 1}. ${link.dataset.section}`, 'info');
                            });
                            updateStatus(`Navigation setup successful - ${navLinks.length} links found`, 'success');
                        } else {
                            updateStatus('Navigation setup failed - no links found', 'error');
                        }
                    } else {
                        log('‚ùå App instance not found in iframe', 'error');
                        updateStatus('App not loaded yet', 'warning');
                    }
                } catch (error) {
                    log(`‚ùå Error accessing iframe: ${error.message}`, 'error');
                    updateStatus('Cannot access iframe content', 'error');
                }
            } else {
                log('‚ùå Iframe not found or not loaded', 'error');
                updateStatus('Iframe not available', 'error');
            }
        }
        
        function testDebugNavigation() {
            log('üîç Running navigation debug...', 'info');
            
            const iframe = document.querySelector('iframe');
            if (iframe && iframe.contentWindow) {
                try {
                    const app = iframe.contentWindow.royaltiesApp || iframe.contentWindow.app;
                    if (app && app.debugNavigation) {
                        log('üîÑ Running debugNavigation()...', 'info');
                        app.debugNavigation();
                        log('‚úÖ Debug navigation completed (check iframe console)', 'success');
                        updateStatus('Debug navigation completed', 'success');
                    } else {
                        log('‚ùå debugNavigation method not found', 'error');
                        updateStatus('Debug method not available', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error: ${error.message}`, 'error');
                    updateStatus('Debug failed', 'error');
                }
            }
        }
        
        function testSidebarLoad() {
            log('üìÇ Testing sidebar load...', 'info');
            
            const iframe = document.querySelector('iframe');
            if (iframe && iframe.contentWindow) {
                try {
                    const app = iframe.contentWindow.royaltiesApp || iframe.contentWindow.app;
                    if (app && app.loadSidebar) {
                        log('üîÑ Running loadSidebar()...', 'info');
                        app.loadSidebar().then(() => {
                            log('‚úÖ Sidebar load completed', 'success');
                            
                            // Check if sidebar has content
                            const sidebar = iframe.contentDocument.getElementById('sidebar');
                            if (sidebar) {
                                log(`üìä Sidebar innerHTML length: ${sidebar.innerHTML.length}`, 'info');
                                log(`üîç Contains navigation: ${sidebar.innerHTML.includes('nav-link')}`, 'info');
                                updateStatus('Sidebar load successful', 'success');
                            } else {
                                log('‚ùå Sidebar element not found', 'error');
                                updateStatus('Sidebar element missing', 'error');
                            }
                        }).catch(error => {
                            log(`‚ùå Sidebar load error: ${error.message}`, 'error');
                            updateStatus('Sidebar load failed', 'error');
                        });
                    } else {
                        log('‚ùå loadSidebar method not found', 'error');
                        updateStatus('Sidebar load method not available', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error: ${error.message}`, 'error');
                    updateStatus('Sidebar test failed', 'error');
                }
            }
        }
        
        function testNavigationClick() {
            log('üëÜ Testing navigation click...', 'info');
            
            const iframe = document.querySelector('iframe');
            if (iframe && iframe.contentWindow) {
                try {
                    const navLinks = iframe.contentDocument.querySelectorAll('.nav-link[data-section]');
                    if (navLinks.length > 0) {
                        const testLink = navLinks[1]; // Try second link (usually user-management)
                        const section = testLink.dataset.section;
                        
                        log(`üéØ Clicking on '${section}' navigation link...`, 'info');
                        testLink.click();
                        
                        setTimeout(() => {
                            const targetSection = iframe.contentDocument.getElementById(section);
                            if (targetSection && targetSection.style.display !== 'none') {
                                log(`‚úÖ Navigation to '${section}' successful`, 'success');
                                updateStatus(`Navigation test passed - '${section}' section active`, 'success');
                            } else {
                                log(`‚ùå Navigation to '${section}' failed`, 'error');
                                updateStatus(`Navigation test failed - '${section}' section not active`, 'error');
                            }
                        }, 1000);
                    } else {
                        log('‚ùå No navigation links found for testing', 'error');
                        updateStatus('No navigation links available for testing', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error: ${error.message}`, 'error');
                    updateStatus('Navigation click test failed', 'error');
                }
            }
        }
        
        function runFullDiagnostic() {
            log('üî¨ Running full navigation diagnostic...', 'info');
            updateStatus('Running full diagnostic...', 'warning');
            
            setTimeout(() => testSidebarLoad(), 500);
            setTimeout(() => testNavigationSetup(), 1500);
            setTimeout(() => testDebugNavigation(), 2500);
            setTimeout(() => testNavigationClick(), 3500);
            
            setTimeout(() => {
                log('üèÅ Full diagnostic completed', 'success');
                updateStatus('Full diagnostic completed', 'success');
            }, 4500);
        }
        
        // Auto-run basic diagnostic after iframe loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üöÄ Page loaded, starting auto-diagnostic...', 'info');
                runFullDiagnostic();
            }, 3000);
        });
    </script>
</body>
</html>
