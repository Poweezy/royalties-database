<div class="page-header">
  <div class="page-title">
    <h1>ðŸ‘¥ User Management</h1>
    <p>Comprehensive user administration with role-based access control, security monitoring, and audit trails</p>
  </div>
  <div class="page-actions">
    <button class="btn btn-info" id="view-audit-btn" title="View detailed audit logs">
      <i class="fas fa-shield-alt"></i> View Audit Log
    </button>
    <button class="btn btn-primary" id="export-report-btn" title="Export user management report">
      <i class="fas fa-file-export"></i> Export Report
    </button>
    <button class="btn btn-success" id="add-user-btn" title="Add new user account">
      <i class="fas fa-user-plus"></i> Add User
    </button>
  </div>
</div>

<!-- User Management Metrics Dashboard -->
<div class="charts-grid" id="user-metrics">
  <div class="metric-card card">
    <div class="card-header">
      <h5><i class="fas fa-users"></i> Active Users</h5>
      <select class="metric-period">
        <option>Current</option>
        <option>Last 30 days</option>
        <option>All time</option>
      </select>
    </div>
    <div class="card-body">
      <p id="active-users-count">3</p>
      <small><i class="fas fa-circle text-success"></i> Currently active and logged in</small>
    </div>
  </div>
  
  <div class="metric-card card">
    <div class="card-header">
      <h5><i class="fas fa-user-shield"></i> Administrators</h5>
    </div>
    <div class="card-body">
      <p id="admin-count">1</p>
      <small><i class="fas fa-shield-alt"></i> System administrators</small>
    </div>
  </div>
  
  <div class="metric-card card">
    <div class="card-header">
      <h5><i class="fas fa-exclamation-triangle"></i> Failed Logins</h5>
    </div>
    <div class="card-body">
      <p id="failed-logins-count">1</p>
      <small><i class="fas fa-clock"></i> Last 24 hours</small>
    </div>
  </div>
  
  <div class="metric-card card">
    <div class="card-header">
      <h5><i class="fas fa-calendar-times"></i> Account Expiry</h5>
    </div>
    <div class="card-body">
      <p id="expiring-accounts">2</p>
      <small><i class="fas fa-warning"></i> Expiring within 90 days</small>
    </div>
  </div>
</div>

<!-- Quick User Actions -->
<div class="card">
  <div class="card-header">
    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
  </div>
  <div class="card-body">
    <div class="quick-actions-grid">
      <button class="quick-action-btn" onclick="showBulkUserUpload()">
        <i class="fas fa-upload"></i>
        <span>Bulk Import Users</span>
      </button>
      <button class="quick-action-btn" onclick="resetAllPasswords()">
        <i class="fas fa-key"></i>
        <span>Reset Passwords</span>
      </button>
      <button class="quick-action-btn" onclick="auditUserActivity()">
        <i class="fas fa-search"></i>
        <span>Audit Activity</span>
      </button>
      <button class="quick-action-btn" onclick="generateUserReport()">
        <i class="fas fa-chart-bar"></i>
        <span>Generate Report</span>
      </button>
    </div>
  </div>
</div>

<!-- User Management Table Container -->
<div id="user-table-container">
  <div class="table-container">
    <div class="section-header">
      <h4><i class="fas fa-users"></i> User Accounts Registry</h4>
      <div class="table-actions">
        <button class="btn btn-info btn-sm" id="filter-users-btn">
          <i class="fas fa-filter"></i> Filter
        </button>
        <button class="btn btn-secondary btn-sm" id="sort-users-btn">
          <i class="fas fa-sort"></i> Sort
        </button>
        <button class="btn btn-warning btn-sm" id="bulk-actions-btn">
          <i class="fas fa-tasks"></i> Bulk Actions
        </button>
      </div>
    </div>

    <table class="data-table" id="users-table">
      <thead>
        <tr>
          <th><input type="checkbox" id="select-all-users" title="Select all users"></th>
          <th sortable data-sort="username">Username</th>
          <th sortable data-sort="email">Email</th>
          <th sortable data-sort="role">Role</th>
          <th sortable data-sort="department">Department</th>
          <th sortable data-sort="status">Status</th>
          <th sortable data-sort="lastLogin">Last Login</th>
          <th sortable data-sort="created">Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="users-table-tbody">
        <!-- Will be populated dynamically -->
      </tbody>
    </table>

    <div class="table-pagination">
      <div class="pagination-info">
        Showing <span id="showing-start">1</span> to <span id="showing-end">3</span> of <span id="total-users">3</span> users
      </div>
      <div class="pagination-controls">
        <button class="btn btn-sm btn-secondary" id="prev-page" disabled>
          <i class="fas fa-chevron-left"></i> Previous
        </button>
        <div class="pagination-pages">
          <a href="#" class="page-btn active">1</a>
        </div>
        <button class="btn btn-sm btn-secondary" id="next-page" disabled>
          Next <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add New User Modal (Hidden by default) -->
<div id="add-user-modal" class="modal-overlay" style="display: none;">
  <div class="modal-container">
    <div class="modal-header">
      <h3><i class="fas fa-user-plus"></i> Add New User Account</h3>
      <button class="modal-close" type="button">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="add-user-form">
        <div class="grid-4">
          <div class="form-group">
            <label for="new-username">
              <i class="fas fa-user"></i> Username *
            </label>
            <input type="text" id="new-username" name="username" placeholder="Enter unique username" required>
            <small class="form-help">3-50 characters, letters, numbers, dots, dashes, underscores only</small>
          </div>
          
          <div class="form-group">
            <label for="new-fullname">
              <i class="fas fa-id-card"></i> Full Name *
            </label>
            <input type="text" id="new-fullname" name="fullname" placeholder="Enter full name" required>
            <small class="form-help">Employee's full legal name</small>
          </div>
          
          <div class="form-group">
            <label for="new-email">
              <i class="fas fa-envelope"></i> Email Address *
            </label>
            <input type="email" id="new-email" name="email" placeholder="user@eswacaa.sz" required>
            <small class="form-help">Official organization email address</small>
          </div>
          
          <div class="form-group">
            <label for="new-role">
              <i class="fas fa-user-tag"></i> Role *
            </label>
            <select id="new-role" name="role" required>
              <option value="">Select user role</option>
              <option value="Administrator">Administrator</option>
              <option value="Editor">Editor</option>
              <option value="Viewer">Viewer</option>
              <option value="Auditor">Auditor</option>
              <option value="Finance">Finance Manager</option>
            </select>
            <small class="form-help">Determines system access permissions</small>
          </div>
          
          <div class="form-group">
            <label for="new-department">
              <i class="fas fa-building"></i> Department *
            </label>
            <select id="new-department" name="department" required>
              <option value="">Select department</option>
              <option value="Management">Management</option>
              <option value="Finance">Finance</option>
              <option value="Audit">Audit</option>
              <option value="Legal">Legal</option>
              <option value="Operations">Operations</option>
              <option value="IT">Information Technology</option>
            </select>
            <small class="form-help">User's organizational department</small>
          </div>
          
          <div class="form-group">
            <label for="new-password">
              <i class="fas fa-lock"></i> Initial Password *
            </label>
            <div class="password-input-container">
              <input type="password" id="new-password" name="password" placeholder="Enter secure password" required minlength="8">
              <button type="button" class="password-toggle-btn" id="toggle-new-password">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <small class="form-help">Minimum 8 characters with letters, numbers, and symbols</small>
          </div>
          
          <div class="form-group">
            <label for="new-password-confirm">
              <i class="fas fa-lock"></i> Confirm Password *
            </label>
            <input type="password" id="new-password-confirm" name="password_confirm" placeholder="Confirm password" required>
            <small class="form-help">Re-enter the password for confirmation</small>
          </div>
          
          <div class="form-group">
            <label for="new-expires" class="optional">
              <i class="fas fa-calendar-alt"></i> Account Expires (Optional)
            </label>
            <input type="date" id="new-expires" name="expires">
            <small class="form-help">Leave blank for no expiration date</small>
          </div>
        </div>
        
        <div class="form-section">
          <h5><i class="fas fa-shield-alt"></i> User Permissions</h5>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="read" checked disabled>
              <span>Read Access (Required)</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="write" id="perm-write">
              <span>Write Access</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="delete" id="perm-delete">
              <span>Delete Access</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="admin" id="perm-admin">
              <span>Administrative Access</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="audit" id="perm-audit">
              <span>Audit Access</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions[]" value="finance" id="perm-finance">
              <span>Financial Access</span>
            </label>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
      <button type="button" class="btn btn-warning" id="reset-form">
        <i class="fas fa-undo"></i> Reset Form
      </button>
      <button type="submit" class="btn btn-success" id="create-user-btn">
        <i class="fas fa-user-plus"></i> Create User Account
      </button>
    </div>
  </div>
</div>

<!-- Security Audit Log Container -->
<div id="security-audit-container" style="display: none;">
  <div class="card audit-log-section">
    <div class="card-header">
      <h5><i class="fas fa-shield-alt"></i> Security Audit Log</h5>
      <div class="table-actions">
        <button class="btn btn-info btn-sm" id="export-audit-btn">
          <i class="fas fa-download"></i> Export Log
        </button>
        <button class="btn btn-secondary btn-sm" id="filter-audit-btn">
          <i class="fas fa-filter"></i> Filter
        </button>
        <button class="btn btn-primary btn-sm" id="refresh-audit-btn">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
    </div>
    <div class="table-container">
      <table class="data-table" id="audit-log-table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>User</th>
            <th>Action</th>
            <th>Target</th>
            <th>IP Address</th>
            <th>Status</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody id="audit-log-tbody">
          <!-- Will be populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</div>
