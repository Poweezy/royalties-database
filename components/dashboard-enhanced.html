<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="page-header">
    <div class="page-title">
      <h1><i class="fas fa-chart-line"></i> Mining Royalties Dashboard</h1>
      <p>Comprehensive overview of production, payments, compliance, and financial performance</p>
    </div>
    <div class="page-actions">
      <button class="btn btn-info" id="refresh-dashboard-btn" title="Refresh all data">
        <i class="fas fa-sync-alt"></i> Refresh Data
      </button>
      <button class="btn btn-success" id="export-dashboard-btn" title="Export dashboard as PDF/Excel">
        <i class="fas fa-download"></i> Export Report
      </button>
      <button class="btn btn-secondary" id="customize-dashboard-btn" title="Customize dashboard layout">
        <i class="fas fa-cog"></i> Customize View
      </button>
      <button class="btn btn-warning" id="forecast-btn" title="Generate forecasts">
        <i class="fas fa-chart-line"></i> Forecast
      </button>
    </div>
  </div>

  <!-- Quick Filters & Time Period Selector -->
  <div class="card dashboard-filters mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-3">
          <label for="time-period" class="form-label">Time Period:</label>
          <select id="time-period" class="form-select">
            <option value="current-month">Current Month</option>
            <option value="last-month">Last Month</option>
            <option value="quarter">Current Quarter</option>
            <option value="year" selected>Current Year</option>
            <option value="custom">Custom Range</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="entity-filter" class="form-label">Entity Filter:</label>
          <select id="entity-filter" class="form-select">
            <option value="all">All Entities</option>
            <option value="mines">Mines Only</option>
            <option value="quarries">Quarries Only</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="mineral-filter" class="form-label">Mineral Type:</label>
          <select id="mineral-filter" class="form-select">
            <option value="all">All Minerals</option>
            <option value="coal">Coal</option>
            <option value="iron-ore">Iron Ore</option>
            <option value="stone">Quarried Stone</option>
            <option value="sand">Sand & Gravel</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="status-filter" class="form-label">Status:</label>
          <select id="status-filter" class="form-select">
            <option value="all">All Status</option>
            <option value="active">Active Only</option>
            <option value="pending">Pending Review</option>
            <option value="overdue">Overdue</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Key Performance Indicators -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card metric-card border-primary">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle text-muted mb-1">Total Revenue</h6>
              <h3 class="card-title text-primary mb-0" id="total-revenue">E 2,847,650</h3>
              <small class="text-success">
                <i class="fas fa-arrow-up"></i> +12.5% from last month
              </small>
            </div>
            <div class="metric-icon bg-primary">
              <i class="fas fa-dollar-sign"></i>
            </div>
          </div>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-primary" style="width: 78%"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card metric-card border-success">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle text-muted mb-1">Production Volume</h6>
              <h3 class="card-title text-success mb-0" id="production-volume">1,245,780 tons</h3>
              <small class="text-success">
                <i class="fas fa-arrow-up"></i> +8.3% from last month
              </small>
            </div>
            <div class="metric-icon bg-success">
              <i class="fas fa-industry"></i>
            </div>
          </div>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-success" style="width: 85%"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card metric-card border-warning">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle text-muted mb-1">Compliance Rate</h6>
              <h3 class="card-title text-warning mb-0" id="compliance-rate">94.2%</h3>
              <small class="text-warning">
                <i class="fas fa-arrow-down"></i> -2.1% from last month
              </small>
            </div>
            <div class="metric-icon bg-warning">
              <i class="fas fa-shield-alt"></i>
            </div>
          </div>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-warning" style="width: 94%"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card metric-card border-info">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle text-muted mb-1">Active Contracts</h6>
              <h3 class="card-title text-info mb-0" id="active-contracts">127</h3>
              <small class="text-success">
                <i class="fas fa-arrow-up"></i> +5 new this month
              </small>
            </div>
            <div class="metric-icon bg-info">
              <i class="fas fa-file-contract"></i>
            </div>
          </div>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-info" style="width: 72%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row mb-4">
    <!-- Revenue Trend Chart -->
    <div class="col-lg-8 mb-4">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="fas fa-chart-line text-primary"></i> Revenue Trend Analysis
          </h5>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary btn-sm active" data-period="monthly">Monthly</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-period="quarterly">Quarterly</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-period="yearly">Yearly</button>
          </div>
        </div>
        <div class="card-body">
          <canvas id="revenue-trend-chart" height="300"></canvas>
        </div>
      </div>
    </div>

    <!-- Production Distribution -->
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-chart-pie text-success"></i> Production by Mineral Type
          </h5>
        </div>
        <div class="card-body">
          <canvas id="production-distribution-chart" height="300"></canvas>
          <div class="mt-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span><i class="fas fa-circle text-primary"></i> Coal</span>
              <span class="fw-bold">45.2%</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span><i class="fas fa-circle text-success"></i> Iron Ore</span>
              <span class="fw-bold">32.8%</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span><i class="fas fa-circle text-warning"></i> Stone</span>
              <span class="fw-bold">15.5%</span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span><i class="fas fa-circle text-info"></i> Sand & Gravel</span>
              <span class="fw-bold">6.5%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Tables Row -->
  <div class="row mb-4">
    <!-- Recent Transactions -->
    <div class="col-lg-6 mb-4">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="fas fa-receipt text-primary"></i> Recent Transactions
          </h5>
          <a href="#royalty-records" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Date</th>
                  <th>Entity</th>
                  <th>Amount</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="recent-transactions">
                <tr>
                  <td>2025-06-25</td>
                  <td>Northfield Mining Co.</td>
                  <td class="text-success fw-bold">E 145,230</td>
                  <td><span class="badge bg-success">Paid</span></td>
                </tr>
                <tr>
                  <td>2025-06-24</td>
                  <td>Iron Ridge Quarry</td>
                  <td class="text-success fw-bold">E 89,450</td>
                  <td><span class="badge bg-success">Paid</span></td>
                </tr>
                <tr>
                  <td>2025-06-23</td>
                  <td>Sunset Stone Works</td>
                  <td class="text-warning fw-bold">E 67,890</td>
                  <td><span class="badge bg-warning">Pending</span></td>
                </tr>
                <tr>
                  <td>2025-06-22</td>
                  <td>Valley Coal Mining</td>
                  <td class="text-success fw-bold">E 234,560</td>
                  <td><span class="badge bg-success">Paid</span></td>
                </tr>
                <tr>
                  <td>2025-06-21</td>
                  <td>Riverside Aggregates</td>
                  <td class="text-danger fw-bold">E 56,780</td>
                  <td><span class="badge bg-danger">Overdue</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Compliance Alerts -->
    <div class="col-lg-6 mb-4">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="fas fa-exclamation-triangle text-warning"></i> Compliance Alerts
          </h5>
          <a href="#compliance" class="btn btn-sm btn-outline-warning">View All</a>
        </div>
        <div class="card-body">
          <div class="alert alert-warning d-flex align-items-center mb-3">
            <i class="fas fa-clock me-2"></i>
            <div>
              <strong>Environmental Report Due</strong><br>
              <small>Northfield Mining Co. - Due in 3 days</small>
            </div>
          </div>
          
          <div class="alert alert-danger d-flex align-items-center mb-3">
            <i class="fas fa-exclamation-circle me-2"></i>
            <div>
              <strong>License Renewal Overdue</strong><br>
              <small>Sunset Stone Works - 5 days overdue</small>
            </div>
          </div>
          
          <div class="alert alert-info d-flex align-items-center mb-3">
            <i class="fas fa-info-circle me-2"></i>
            <div>
              <strong>Safety Inspection Scheduled</strong><br>
              <small>Valley Coal Mining - Tomorrow at 10:00 AM</small>
            </div>
          </div>
          
          <div class="alert alert-warning d-flex align-items-center mb-0">
            <i class="fas fa-file-alt me-2"></i>
            <div>
              <strong>Production Report Review</strong><br>
              <small>Iron Ridge Quarry - Pending approval</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-bolt text-primary"></i> Quick Actions
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <a href="#royalty-records" class="btn btn-outline-primary w-100 h-100 d-flex flex-column justify-content-center">
                <i class="fas fa-plus fa-2x mb-2"></i>
                <span>Add Payment</span>
              </a>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <a href="#contract-management" class="btn btn-outline-success w-100 h-100 d-flex flex-column justify-content-center">
                <i class="fas fa-file-contract fa-2x mb-2"></i>
                <span>New Contract</span>
              </a>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <a href="#reporting-analytics" class="btn btn-outline-info w-100 h-100 d-flex flex-column justify-content-center">
                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                <span>Generate Report</span>
              </a>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <a href="#user-management" class="btn btn-outline-warning w-100 h-100 d-flex flex-column justify-content-center">
                <i class="fas fa-user-plus fa-2x mb-2"></i>
                <span>Add User</span>
              </a>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <a href="#compliance" class="btn btn-outline-danger w-100 h-100 d-flex flex-column justify-content-center">
                <i class="fas fa-clipboard-check fa-2x mb-2"></i>
                <span>Submit Report</span>
              </a>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
              <button class="btn btn-outline-secondary w-100 h-100 d-flex flex-column justify-content-center" onclick="window.print()">
                <i class="fas fa-print fa-2x mb-2"></i>
                <span>Print Dashboard</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize dashboard functionality
    initializeDashboard();
});

function initializeDashboard() {
    console.log('Initializing enhanced dashboard...');
    
    // Initialize charts
    initializeCharts();
    
    // Set up event listeners
    setupEventListeners();
    
    // Auto-refresh data every 5 minutes
    setInterval(refreshDashboardData, 300000);
    
    console.log('Dashboard initialization complete');
}

function initializeCharts() {
    // Revenue trend chart
    const revenueCtx = document.getElementById('revenue-trend-chart');
    if (revenueCtx && typeof Chart !== 'undefined') {
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Revenue (E)',
                    data: [2100000, 2250000, 2180000, 2450000, 2380000, 2650000],
                    borderColor: '#1a365d',
                    backgroundColor: 'rgba(26, 54, 93, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'E' + (value / 1000000).toFixed(1) + 'M';
                            }
                        }
                    }
                }
            }
        });
    }

    // Production distribution chart
    const productionCtx = document.getElementById('production-distribution-chart');
    if (productionCtx && typeof Chart !== 'undefined') {
        new Chart(productionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Coal', 'Iron Ore', 'Stone', 'Sand & Gravel'],
                datasets: [{
                    data: [45.2, 32.8, 15.5, 6.5],
                    backgroundColor: ['#1a365d', '#38a169', '#d69e2e', '#3182ce'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
}

function setupEventListeners() {
    // Time period filter
    const timePeriodSelect = document.getElementById('time-period');
    if (timePeriodSelect) {
        timePeriodSelect.addEventListener('change', handleTimePeriodChange);
    }

    // Entity filter
    const entityFilter = document.getElementById('entity-filter');
    if (entityFilter) {
        entityFilter.addEventListener('change', handleEntityFilterChange);
    }

    // Refresh button
    const refreshBtn = document.getElementById('refresh-dashboard-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', refreshDashboardData);
    }

    // Export button
    const exportBtn = document.getElementById('export-dashboard-btn');
    if (exportBtn) {
        exportBtn.addEventListener('click', exportDashboard);
    }

    // Customize button
    const customizeBtn = document.getElementById('customize-dashboard-btn');
    if (customizeBtn) {
        customizeBtn.addEventListener('click', showCustomizeModal);
    }

    // Chart period buttons
    const periodButtons = document.querySelectorAll('[data-period]');
    periodButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            periodButtons.forEach(btn => btn.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            // Update chart data
            updateChartPeriod(this.dataset.period);
        });
    });
}

function handleTimePeriodChange(event) {
    const period = event.target.value;
    console.log('Time period changed to:', period);
    // Update dashboard data based on selected period
    refreshDashboardData();
}

function handleEntityFilterChange(event) {
    const filter = event.target.value;
    console.log('Entity filter changed to:', filter);
    // Filter dashboard data
    refreshDashboardData();
}

function refreshDashboardData() {
    console.log('Refreshing dashboard data...');
    
    // Show loading indicators
    showLoadingIndicators();
    
    // Simulate API call
    setTimeout(() => {
        // Update metrics
        updateMetrics();
        
        // Refresh charts
        refreshCharts();
        
        // Update tables
        updateTables();
        
        // Hide loading indicators
        hideLoadingIndicators();
        
        // Show success notification
        if (window.notificationManager) {
            window.notificationManager.show('Dashboard data refreshed successfully', 'success');
        }
    }, 1500);
}

function updateMetrics() {
    // Simulate updated metrics
    const metrics = {
        'total-revenue': 'E ' + (Math.random() * 1000000 + 2000000).toLocaleString(),
        'production-volume': (Math.random() * 500000 + 1000000).toLocaleString() + ' tons',
        'compliance-rate': (Math.random() * 10 + 90).toFixed(1) + '%',
        'active-contracts': Math.floor(Math.random() * 50 + 100)
    };

    Object.entries(metrics).forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = value;
        }
    });
}

function refreshCharts() {
    // Refresh chart data
    console.log('Refreshing charts...');
    // Implementation would update chart data
}

function updateTables() {
    // Update recent transactions table
    console.log('Updating tables...');
    // Implementation would update table data
}

function showLoadingIndicators() {
    // Add loading spinners to metric cards
    const metricCards = document.querySelectorAll('.metric-card');
    metricCards.forEach(card => {
        card.style.opacity = '0.6';
    });
}

function hideLoadingIndicators() {
    // Remove loading spinners
    const metricCards = document.querySelectorAll('.metric-card');
    metricCards.forEach(card => {
        card.style.opacity = '1';
    });
}

function exportDashboard() {
    console.log('Exporting dashboard...');
    
    if (window.notificationManager) {
        window.notificationManager.show('Preparing dashboard export...', 'info');
    }
    
    // Simulate export process
    setTimeout(() => {
        if (window.notificationManager) {
            window.notificationManager.show('Dashboard exported successfully', 'success');
        }
    }, 2000);
}

function showCustomizeModal() {
    console.log('Showing customize modal...');
    
    if (window.notificationManager) {
        window.notificationManager.show('Dashboard customization coming soon!', 'info');
    }
}

function updateChartPeriod(period) {
    console.log('Updating chart period to:', period);
    // Implementation would update chart data based on period
}
</script>
