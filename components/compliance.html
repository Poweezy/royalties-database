<div class="page-header">
    <div class="page-title">
        <h1><i class="fas fa-shield-check"></i> Compliance & Regulatory Management</h1>
        <p>Ensuring compliance with Eswatini mining laws, fiscal regulations, and regulatory reporting requirements</p>
    </div>
    <div class="page-actions">
        <button class="btn btn-success" id="run-compliance-check-btn">
            <i class="fas fa-search"></i> Run Compliance Check
        </button>
        <button class="btn btn-info" id="generate-compliance-report-btn">
            <i class="fas fa-file-alt"></i> Generate SWANEEF Report
        </button>
        <button class="btn btn-warning" id="tax-submission-btn">
            <i class="fas fa-chart-bar"></i> SRA Tax Submission
        </button>
    </div>
</div>

<!-- Eswatini Regulatory Framework Overview -->
<div class="section-header">
    <h4><i class="fas fa-balance-scale"></i> Eswatini Mining Regulatory Framework</h4>
    <div class="framework-actions">
        <button class="btn btn-info btn-sm" id="view-regulations-btn">
            <i class="fas fa-book-open"></i> View Full Regulations
        </button>
        <button class="btn btn-success btn-sm" id="multi-jurisdictional-btn">
            <i class="fas fa-globe"></i> Multi-Jurisdictional View
        </button>
    </div>
</div>

<div class="charts-grid">
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-university"></i> Primary Legislation</h5>
            <span class="last-updated">Last Updated: Jan 2024</span>
        </div>
        <div class="card-body">
            <ul class="regulation-list">
                <li>
                    <strong>Mines and Minerals Act (2011)</strong> - Primary mining legislation
                    <div class="regulation-details">
                        <span class="reg-status current">Current</span>
                        <span class="reg-amendment">Amendment 2023 in effect</span>
                    </div>
                </li>
                <li>
                    <strong>Mines and Minerals Regulations (2015)</strong> - Operational guidelines
                    <div class="regulation-details">
                        <span class="reg-status current">Current</span>
                        <span class="reg-amendment">Under review 2025</span>
                    </div>
                </li>
                <li>
                    <strong>Income Tax Order (1975)</strong> - Tax obligations
                    <div class="regulation-details">
                        <span class="reg-status current">Current</span>
                        <span class="reg-amendment">Rates updated April 2024</span>
                    </div>
                </li>
                <li>
                    <strong>Environmental Management Act (2002)</strong> - Environmental compliance
                    <div class="regulation-details">
                        <span class="reg-status current">Current</span>
                        <span class="reg-amendment">New EIA requirements 2024</span>
                    </div>
                </li>
                <li>
                    <strong>Occupational Health and Safety Act (2001)</strong> - Workplace safety
                    <div class="regulation-details">
                        <span class="reg-status current">Current</span>
                        <span class="reg-amendment">Mining-specific updates 2023</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-building"></i> Regulatory Bodies</h5>
            <span class="contact-info">Emergency Contact: +268 2404 2000</span>
        </div>
        <div class="card-body">
            <ul class="regulation-list">
                <li>
                    <strong>SWANEEF</strong> - Swaziland National Energy Fund
                    <div class="regulation-details">
                        <span class="reg-role">Mining oversight & licensing</span>
                        <span class="reg-contact">swaneef@gov.sz</span>
                    </div>
                </li>
                <li>
                    <strong>SRA</strong> - Swaziland Revenue Authority
                    <div class="regulation-details">
                        <span class="reg-role">Tax collection & compliance</span>
                        <span class="reg-contact">info@sra.org.sz</span>
                    </div>
                </li>
                <li>
                    <strong>SEA</strong> - Swaziland Environment Authority
                    <div class="regulation-details">
                        <span class="reg-role">Environmental permits & monitoring</span>
                        <span class="reg-contact">sea@environment.sz</span>
                    </div>
                </li>
                <li>
                    <strong>Department of Geological Survey</strong> - Technical oversight
                    <div class="regulation-details">
                        <span class="reg-role">Geological assessments & monitoring</span>
                        <span class="reg-contact">geology@gov.sz</span>
                    </div>
                </li>
                <li>
                    <strong>Ministry of Natural Resources</strong> - Policy oversight
                    <div class="regulation-details">
                        <span class="reg-role">Policy formulation & enforcement</span>
                        <span class="reg-contact">naturalresources@gov.sz</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-percentage"></i> Tax & Royalty Structure (2024)</h5>
            <span class="effective-date">Effective: April 1, 2024</span>
        </div>
        <div class="card-body">
            <ul class="regulation-list">
                <li>
                    <strong>Mining Royalties:</strong> 2-4% of gross value
                    <div class="regulation-details">
                        <span class="tax-detail">Coal: 2% | Base metals: 3% | Precious metals: 4%</span>
                    </div>
                </li>
                <li>
                    <strong>Corporate Tax:</strong> 27.5% on taxable income
                    <div class="regulation-details">
                        <span class="tax-detail">Mining companies: Standard rate applies</span>
                    </div>
                </li>
                <li>
                    <strong>Withholding Tax:</strong> 10% on dividends
                    <div class="regulation-details">
                        <span class="tax-detail">5% for SADC countries (treaty rates)</span>
                    </div>
                </li>
                <li>
                    <strong>Import Duty:</strong> Variable rates on equipment
                    <div class="regulation-details">
                        <span class="tax-detail">Mining equipment: 0-5% | Machinery: 0-15%</span>
                    </div>
                </li>
                <li>
                    <strong>Skills Development Levy:</strong> 1% of payroll
                    <div class="regulation-details">
                        <span class="tax-detail">All employers above E500,000 annual payroll</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Multi-Jurisdictional Compliance -->
<div class="multi-jurisdictional-section" id="multi-jurisdictional-section" style="display: none;">
    <div class="section-header">
        <h4><i class="fas fa-globe"></i> Multi-Jurisdictional Compliance Overview</h4>
        <button class="btn btn-secondary btn-sm" id="close-multi-jurisdictional-btn">
            <i class="fas fa-times"></i> Close
        </button>
    </div>
    
    <div class="jurisdiction-tabs">
        <button class="jurisdiction-tab active" data-jurisdiction="eswatini">üá∏üáø Eswatini</button>
        <button class="jurisdiction-tab" data-jurisdiction="south-africa">üáøüá¶ South Africa</button>
        <button class="jurisdiction-tab" data-jurisdiction="mozambique">üá≤üáø Mozambique</button>
        <button class="jurisdiction-tab" data-jurisdiction="sadc">üèõÔ∏è SADC Region</button>
    </div>
    
    <div class="jurisdiction-content">
        <div class="jurisdiction-panel active" id="eswatini-panel">
            <h5>üá∏üáø Kingdom of Eswatini - Current Jurisdiction</h5>
            <div class="jurisdiction-overview">
                <div class="jurisdiction-stat">
                    <strong>Primary Operations:</strong> 4 Active mines
                </div>
                <div class="jurisdiction-stat">
                    <strong>Compliance Status:</strong> 92% Overall
                </div>
                <div class="jurisdiction-stat">
                    <strong>Annual Royalties:</strong> E12.4M (2024)
                </div>
            </div>
        </div>
        
        <div class="jurisdiction-panel" id="south-africa-panel">
            <h5>üáøüá¶ Republic of South Africa - Cross-Border Operations</h5>
            <div class="jurisdiction-overview">
                <div class="jurisdiction-stat">
                    <strong>Border Mining Rights:</strong> 2 Applications pending
                </div>
                <div class="jurisdiction-stat">
                    <strong>SARS Compliance:</strong> Applicable for cross-border operations
                </div>
                <div class="jurisdiction-stat">
                    <strong>BEE Requirements:</strong> Must comply for SA operations
                </div>
            </div>
        </div>
        
        <div class="jurisdiction-panel" id="mozambique-panel">
            <h5>üá≤üáø Republic of Mozambique - Regional Considerations</h5>
            <div class="jurisdiction-overview">
                <div class="jurisdiction-stat">
                    <strong>SADC Mining Protocol:</strong> Applicable
                </div>
                <div class="jurisdiction-stat">
                    <strong>Trade Agreements:</strong> Bilateral mining cooperation
                </div>
                <div class="jurisdiction-stat">
                    <strong>Environmental Standards:</strong> Regional harmonization
                </div>
            </div>
        </div>
        
        <div class="jurisdiction-panel" id="sadc-panel">
            <h5>üèõÔ∏è SADC Regional Framework</h5>
            <div class="jurisdiction-overview">
                <div class="jurisdiction-stat">
                    <strong>Regional Mining Code:</strong> Harmonized standards
                </div>
                <div class="jurisdiction-stat">
                    <strong>Cross-Border Trade:</strong> Preferential rates apply
                </div>
                <div class="jurisdiction-stat">
                    <strong>Regional Development Bank:</strong> Financing available
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compliance Dashboard -->
<div class="section-header">
    <h4><i class="fas fa-chart-line"></i> Compliance Dashboard</h4>
    <div class="dashboard-actions">
        <button class="btn btn-info btn-sm" id="refresh-metrics-btn">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <button class="btn btn-success btn-sm" id="export-dashboard-btn">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
</div>

<div class="charts-grid">
    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-chart-pie"></i> Overall Score</h3>
        </div>
        <div class="card-body text-center">
            <h2 class="compliance-score-large text-success" id="overall-compliance-score">92%</h2>
            <p class="text-success mb-2" id="compliance-status">Excellent</p>
            <div class="progress-bar-container mt-3">
                <div class="progress-bar-fill bg-success" style="width: 92%;" id="compliance-progress"></div>
            </div>
            <small class="text-muted mt-2">Updated: <span id="last-compliance-check">Today 09:30</span></small>
        </div>
    </div>

    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-file-certificate"></i> Active Permits</h3>
        </div>
        <div class="card-body text-center">
            <h2 class="metric-value text-success" id="active-permits-count">12</h2>
            <small class="text-success"><i class="fas fa-check-circle"></i> Valid & Current</small>
        </div>
    </div>

    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Expiring Soon</h3>
        </div>
        <div class="card-body text-center">
            <h2 class="metric-value text-warning" id="expiring-permits-count">3</h2>
            <small class="text-warning"><i class="fas fa-clock"></i> Within 30 days</small>
        </div>
    </div>

    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-file-invoice-dollar"></i> Tax Compliance</h3>
        </div>
        <div class="card-body text-center">
            <h2 class="metric-value text-success" id="tax-compliance-rate">95%</h2>
            <small class="text-success"><i class="fas fa-chart-line"></i> SRA Submissions</small>
        </div>
    </div>
</div>

<!-- Compliance Alerts & Deadlines -->
<div class="section-header">
    <h4><i class="fas fa-bell"></i> Compliance Alerts & Deadlines</h4>
    <div class="alert-controls">
        <button class="btn btn-info btn-sm" id="refresh-deadlines-btn">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <select id="alert-filter" class="form-select btn-sm">
            <option value="all">All Alerts</option>
            <option value="urgent">Urgent (< 7 days)</option>
            <option value="upcoming">Upcoming (< 30 days)</option>
            <option value="completed">Recently Completed</option>
        </select>
    </div>
</div>

<div class="charts-grid">
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-exclamation-triangle text-danger"></i> Critical Alerts</h5>
            <span class="badge bg-danger">2</span>
        </div>
        <div class="card-body">
            <div class="alerts-list" id="compliance-alerts-list">
                <!-- Urgent Alert -->
                <div class="alert-item urgent mb-3" data-days="2" data-type="tax">
                    <div class="alert-header">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle text-danger"></i>
                        </div>
                        <div class="alert-main">
                            <h6 class="mb-1">SRA Quarterly Return Due</h6>
                            <div class="alert-meta">
                                <span class="badge bg-danger">Due in 2 days</span>
                                <span class="text-muted">‚Ä¢ June 30, 2025</span>
                            </div>
                        </div>
                    </div>
                    <div class="alert-details mt-2">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted d-block">Entity: All mining entities</small>
                                <small class="text-muted d-block">Penalty: 10% of tax due + SWL 5,000</small>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-danger btn-sm" onclick="startTaxPreparation()">
                                    <i class="fas fa-play"></i> Start Now
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="setReminder('sra-quarterly')">
                                    <i class="fas fa-bell"></i> Remind
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Warning Alert -->
                <div class="alert-item warning mb-3" data-days="5" data-type="permit">
                    <div class="alert-header">
                        <div class="alert-icon">
                            <i class="fas fa-certificate text-warning"></i>
                        </div>
                        <div class="alert-main">
                            <h6 class="mb-1">Water Use License Renewal</h6>
                            <div class="alert-meta">
                                <span class="badge bg-warning">Due in 5 days</span>
                                <span class="text-muted">‚Ä¢ July 3, 2025</span>
                            </div>
                        </div>
                    </div>
                    <div class="alert-details mt-2">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted d-block">Entity: Maloma Colliery</small>
                                <small class="text-muted d-block">Impact: Operations halt if expired</small>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-warning btn-sm" onclick="startRenewalProcess('water-license')">
                                    <i class="fas fa-redo"></i> Renew
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewRequirements('water-license')">
                                    <i class="fas fa-list"></i> Requirements
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upcoming Reports Section -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-file-alt text-info"></i> Upcoming Reports</h5>
            <span class="badge bg-info">3</span>
        </div>
        <div class="card-body">
            <div class="report-item mb-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">SWANEEF Annual Mining Report</h6>
                        <div class="report-meta">
                            <span class="badge bg-info">Due in 33 days</span>
                            <span class="text-muted">‚Ä¢ July 31, 2025</span>
                        </div>
                        <small class="text-muted d-block mt-1">All active mining operations</small>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-primary btn-sm" onclick="startReport('swaneef-annual')">
                            Start Report
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="report-item mb-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">Safety Equipment Inspection</h6>
                        <div class="report-meta">
                            <span class="badge bg-warning">Due in 12 days</span>
                            <span class="text-muted">‚Ä¢ July 10, 2025</span>
                        </div>
                        <small class="text-muted d-block mt-1">Kwalini Quarry</small>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-warning btn-sm" onclick="scheduleInspection('kwalini-safety')">
                            Schedule
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="report-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">Environmental Impact Assessment</h6>
                        <div class="report-meta">
                            <span class="badge bg-success">Due in 45 days</span>
                            <span class="text-muted">‚Ä¢ August 15, 2025</span>
                        </div>
                        <small class="text-muted d-block mt-1">Bulembu Asbestos Mine</small>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-outline-primary btn-sm" onclick="planAssessment('bulembu-eia')">
                            Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                            <span class="alert-penalty">Permit suspension risk</span>
                        </div>
                    </div>
                    <div class="alert-actions">
                        <button class="btn btn-sm btn-primary" onclick="startEIAReview('bulembu')">Begin Review</button>
                        <button class="btn btn-sm btn-secondary" onclick="consultSpecialist('eia')">Consult Expert</button>
                    </div>
                </div>
            </div>
            
            <div class="alert-summary">
                <div class="summary-stats">
                    <div class="stat-item urgent">
                        <span class="stat-number" id="urgent-count">2</span>
                        <span class="stat-label">Urgent</span>
                    </div>
                    <div class="stat-item warning">
                        <span class="stat-number" id="warning-count">3</span>
                        <span class="stat-label">Warning</span>
                    </div>
                    <div class="stat-item info">
                        <span class="stat-number" id="info-count">2</span>
                        <span class="stat-label">Info</span>
                    </div>
                    <div class="stat-item success">
                        <span class="stat-number" id="completed-count">1</span>
                        <span class="stat-label">Completed</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Mining Licenses & Permits Registry -->
<div class="section-header">
    <h4><i class="fas fa-certificate"></i> Mining Licenses & Permits Registry</h4>
    <div class="permit-actions">
        <button class="btn btn-success btn-sm" id="add-permit-btn">
            <i class="fas fa-plus"></i> Add Permit
        </button>
        <button class="btn btn-warning btn-sm" id="renewal-tracker-btn">
            <i class="fas fa-calendar-check"></i> Renewal Tracker
        </button>
        <select id="permit-filter" class="form-select btn-sm">
            <option value="all">All Permits</option>
            <option value="expiring">Expiring Soon</option>
            <option value="valid">Valid</option>
            <option value="expired">Expired</option>
        </select>
    </div>
</div>

<div class="charts-grid">
    <!-- Mining Rights & Licenses -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-pickaxe"></i> Mining Rights & Licenses</h5>
            <span class="badge bg-success">3 Active</span>
        </div>
        <div class="card-body">
            <div class="permits-list">
                <div class="permit-item mb-3 p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Mining Right Certificate</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>MRC-2023-001</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Kwalini Quarry</div>
                                <div class="mb-2"><strong>Authority:</strong> SWANEEF</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Dec 2025</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>173 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewPermitDetails('MRC-2023-001')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="downloadPermit('MRC-2023-001')">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item mb-3 p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Coal Mining License</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>CML-2022-034</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Maloma Colliery</div>
                                <div class="mb-2"><strong>Authority:</strong> SWANEEF</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Apr 2026</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>298 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewPermitDetails('CML-2022-034')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="amendPermit('CML-2022-034')">
                                <i class="fas fa-edit"></i> Amend
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Iron Ore Extraction License</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>IOEL-2024-007</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Ngwenya Mine</div>
                                <div class="mb-2"><strong>Authority:</strong> SWANEEF</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Oct 2027</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>826 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewPermitDetails('IOEL-2024-007')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="expandPermit('IOEL-2024-007')">
                                <i class="fas fa-expand"></i> Expand
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Environmental Permits -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-leaf"></i> Environmental Permits</h5>
            <span class="badge bg-warning">1 Expiring</span>
        </div>
        <div class="card-body">
            <div class="permits-list">
                <div class="permit-item mb-3 p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Environmental Impact Assessment</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>EIA-2024-012</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Kwalini Quarry</div>
                                <div class="mb-2"><strong>Authority:</strong> SEA</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Mar 2026</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>268 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewEIAReport('EIA-2024-012')">
                                <i class="fas fa-file-alt"></i> Report
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="scheduleMonitoring('EIA-2024-012')">
                                <i class="fas fa-calendar"></i> Monitor
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item mb-3 p-3 border border-warning rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-warning">Water Use License</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>WUL-2023-089</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Maloma Colliery</div>
                                <div class="mb-2"><strong>Authority:</strong> SEA/Water Board</div>
                                <div class="mt-1">
                                    <span class="badge bg-warning">Expires Sep 2025</span>
                                    <small class="text-warning d-block mt-1"><i class="fas fa-exclamation-triangle me-1"></i>91 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-warning btn-sm mb-1" onclick="renewPermit('WUL-2023-089')">
                                <i class="fas fa-redo"></i> Renew
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="viewWaterUsage('WUL-2023-089')">
                                <i class="fas fa-chart-line"></i> Usage
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item p-3 border border-danger rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-danger">Air Emission Permit</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>AEP-2022-167</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Bulembu Asbestos Mine</div>
                                <div class="mb-2"><strong>Authority:</strong> SEA</div>
                                <div class="mt-1">
                                    <span class="badge bg-danger">Expired May 2025</span>
                                    <small class="text-danger d-block mt-1"><i class="fas fa-ban me-1"></i>58 days overdue</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-danger btn-sm mb-1" onclick="urgentRenewal('AEP-2022-167')">
                                <i class="fas fa-exclamation-triangle"></i> Urgent
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="haltOperations('AEP-2022-167')">
                                <i class="fas fa-stop"></i> Halt Ops
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Safety & Operational Permits -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-hard-hat"></i> Safety & Operational Permits</h5>
            <span class="badge bg-success">3 Active</span>
        </div>
        <div class="card-body">
            <div class="permits-list">
                <div class="permit-item mb-3 p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Explosives License</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>EXP-2025-156</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> All Sites</div>
                                <div class="mb-2"><strong>Authority:</strong> Police/SWANEEF</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Nov 2025</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>142 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewExplosivesLog('EXP-2025-156')">
                                <i class="fas fa-list"></i> Log
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="orderExplosives('EXP-2025-156')">
                                <i class="fas fa-shopping-cart"></i> Order
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item mb-3 p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Occupational Health Certificate</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>OHC-2024-045</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Ngwenya Mine</div>
                                <div class="mb-2"><strong>Authority:</strong> Ministry of Labour</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Dec 2025</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>173 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewHealthRecords('OHC-2024-045')">
                                <i class="fas fa-file-medical"></i> Records
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="scheduleInspection('OHC-2024-045')">
                                <i class="fas fa-calendar-check"></i> Inspect
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="permit-item p-3 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h6 class="mb-1 fw-bold text-primary">Transport Permit</h6>
                            <small class="text-muted"><i class="fas fa-id-card me-1"></i>TRP-2024-289</small>
                        </div>
                        <div class="col-md-4">
                            <div class="permit-details">
                                <div class="mb-1"><strong>Entity:</strong> Maloma Colliery</div>
                                <div class="mb-2"><strong>Authority:</strong> Transport Authority</div>
                                <div class="mt-1">
                                    <span class="badge bg-success">Valid until Aug 2025</span>
                                    <small class="text-success d-block mt-1"><i class="fas fa-calendar-check me-1"></i>57 days remaining</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewTransportLog('TRP-2024-289')">
                                <i class="fas fa-truck"></i> Log
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="renewTransport('TRP-2024-289')">
                                <i class="fas fa-redo"></i> Renew
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Permits Summary -->
<div class="charts-grid">
    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-check-circle"></i> Valid Permits</h3>
        </div>
        <div class="card-body">
            <p>8</p>
            <small><i class="fas fa-shield-check text-success"></i> Currently active</small>
        </div>
    </div>
    
    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Expiring Soon</h3>
        </div>
        <div class="card-body">
            <p>2</p>
            <small><i class="fas fa-calendar-alt text-warning"></i> Within 90 days</small>
        </div>
    </div>
    
    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-times-circle"></i> Expired</h3>
        </div>
        <div class="card-body">
            <p>1</p>
            <small><i class="fas fa-ban text-danger"></i> Requires renewal</small>
        </div>
    </div>
    
    <div class="metric-card card">
        <div class="card-header">
            <h3><i class="fas fa-certificate"></i> Total Permits</h3>
        </div>
        <div class="card-body">
            <p>11</p>
            <small><i class="fas fa-folder text-primary"></i> Complete registry</small>
        </div>
    </div>
</div>

<div class="charts-grid">
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-chart-line"></i> Compliance Trends</h5>
        </div>
        <div class="card-body">
            <div class="stats-grid text-center">
                <div class="stat-item">
                    <h4 class="text-success m-0">95%</h4>
                    <small>Q1 2025</small>
                </div>
                <div class="stat-item">
                    <h4 class="text-success m-0">93%</h4>
                    <small>Q2 2025</small>
                </div>
                <div class="stat-item">
                    <h4 class="text-success m-0">92%</h4>
                    <small>Q3 2025</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Regulatory Reporting & Submissions -->
<div class="section-header">
    <h4><i class="fas fa-file-alt"></i> Regulatory Reporting & Submissions</h4>
    <div class="reporting-actions">
        <button class="btn btn-primary btn-sm" id="schedule-submission-btn">
            <i class="fas fa-calendar-plus"></i> Schedule
        </button>
        <button class="btn btn-success btn-sm" id="bulk-export-btn">
            <i class="fas fa-download"></i> Export All
        </button>
        <button class="btn btn-info btn-sm" id="submission-calendar-btn">
            <i class="fas fa-calendar-alt"></i> Calendar
        </button>
    </div>
</div>

<div class="charts-grid">
    <!-- Critical Report -->
    <div class="card border-danger">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0"><i class="fas fa-chart-bar"></i> SRA Tax Returns</h5>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-white text-danger">Quarterly</span>
                <span class="badge bg-warning text-dark">URGENT</span>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="report-status">
                        <h6 class="text-danger mb-2">
                            <i class="fas fa-clock"></i> Due in 2 days
                        </h6>
                        <p class="mb-1"><strong>Due Date:</strong> June 30, 2025</p>
                        <p class="mb-1"><strong>Last Submitted:</strong> March 31, 2025</p>
                        <p class="mb-1"><strong>Current Status:</strong> 
                            <span class="badge bg-warning">Data Compilation</span>
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="report-progress mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Progress</span>
                            <span class="fw-bold">65%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-warning" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="report-requirements mb-3">
                <h6>Required Data:</h6>
                <ul class="list-unstyled mb-0">
                    <li><i class="fas fa-check text-success"></i> Q2 2025 royalty payments</li>
                    <li><i class="fas fa-check text-success"></i> Corporate tax calculations</li>
                    <li><i class="fas fa-times text-danger"></i> PAYE reconciliation</li>
                    <li><i class="fas fa-times text-danger"></i> Final submission review</li>
                </ul>
            </div>
            
            <div class="alert alert-danger p-2 mb-3">
                <small><i class="fas fa-exclamation-triangle"></i> Late penalty: 10% of tax due + SWL 5,000</small>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-danger btn-sm" onclick="urgentTaxPreparation()">
                    <i class="fas fa-play"></i> Complete Now
                </button>
                <button class="btn btn-outline-warning btn-sm" onclick="requestExtension('sra-q2-2025')">
                    <i class="fas fa-calendar-plus"></i> Request Extension
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="viewTemplate('sra-quarterly')">
                    <i class="fas fa-file"></i> Template
                </button>
            </div>
        </div>
    </div>
    
    <!-- Regular Report -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-industry"></i> SWANEEF Mining Production Report</h5>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-secondary">Annual</span>
                <span class="badge bg-success">On Track</span>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="report-status">
                        <h6 class="text-primary mb-2">
                            <i class="fas fa-calendar"></i> Due in 33 days
                        </h6>
                        <p class="mb-1"><strong>Due Date:</strong> July 31, 2025</p>
                        <p class="mb-1"><strong>Last Submitted:</strong> July 30, 2024</p>
                        <p class="mb-1"><strong>Current Status:</strong> 
                            <span class="badge bg-info">Planning Phase</span>
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="report-progress mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Progress</span>
                            <span class="fw-bold">25%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" style="width: 25%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="report-requirements mb-3">
                <h6>Required Components:</h6>
                <ul class="list-unstyled mb-0">
                    <li><i class="fas fa-circle text-muted"></i> Production volumes & reserves</li>
                    <li><i class="fas fa-circle text-muted"></i> Employment statistics</li>
                    <li><i class="fas fa-circle text-muted"></i> Royalty payment records</li>
                    <li><i class="fas fa-circle text-muted"></i> Environmental compliance data</li>
                </ul>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-primary btn-sm" onclick="startReport('swaneef-annual')">
                    <i class="fas fa-play"></i> Start Report
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="viewLastYear('swaneef-2024')">
                    <i class="fas fa-history"></i> 2024 Report
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="downloadGuidelines('swaneef-annual')">
                    <i class="fas fa-book"></i> Guidelines
                </button>
            </div>
        </div>
    </div>
    
    <!-- Additional Reports -->
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-leaf"></i> Environmental Compliance Report</h5>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-secondary">Semi-Annual</span>
                <span class="badge bg-success">On Track</span>
            </div>
        </div>
        <div class="card-body">
            <div class="report-summary mb-3">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="text-primary">
                            <h6 class="mb-1">62</h6>
                            <small>Days until due</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-success">
                            <h6 class="mb-1">45%</h6>
                            <small>Complete</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-info">
                            <h6 class="mb-1">SEA</h6>
                            <small>Authority</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="report-actions">
                <button class="btn btn-success btn-sm" onclick="continueReport('environmental-h2-2025')">
                    <i class="fas fa-play"></i> Continue
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="viewRequirements('environmental-report')">
                    <i class="fas fa-list"></i> Requirements
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="viewHistory('environmental-reports')">
                    <i class="fas fa-history"></i> History
                </button>
            </div>
        </div>
    </div>
</div>
                    <div class="detail-item">
                        <span class="label">Submission Method:</span>
                        <span class="value">SEA online portal + certified copies</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Monitoring Data:</span>
                        <span class="value">Daily measurements from Jan-Jun 2025</span>
                    </div>
                </div>
                <div class="report-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 80%"></div>
                    </div>
                    <span class="progress-text">80% Complete</span>
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm btn-success" onclick="finalizeReport('environmental-h1-2025')">Finalize</button>
                    <button class="btn btn-sm btn-info" onclick="viewMonitoringData('env-monitoring')">View Data</button>
                    <button class="btn btn-sm btn-secondary" onclick="validateData('environmental')">Validate</button>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-users"></i> Employment & Skills Development Report</h5>
                <div class="report-meta">
                    <span class="report-frequency">Annual</span>
                    <span class="report-priority normal">NORMAL</span>
                </div>
            </div>
            <div class="card-body">
                <div class="report-details">
                    <div class="detail-item">
                        <span class="label">Next Due:</span>
                        <span class="value">31 March 2026 (273 days)</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Last Submitted:</span>
                        <span class="value">31 March 2025</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Status:</span>
                        <span class="value on-track">Monitoring</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Required Data:</span>
                        <span class="value">Employment stats, training programs, local content</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Submission Method:</span>
                        <span class="value">Ministry of Labour + SWANEEF</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Key Metrics:</span>
                        <span class="value">Eswatini nationals %, skills development spend</span>
                    </div>
                </div>
                <div class="report-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 15%"></div>
                    </div>
                    <span class="progress-text">15% Complete (Ongoing monitoring)</span>
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm btn-primary" onclick="updateProgress('employment-2025')">Update</button>
                    <button class="btn btn-sm btn-info" onclick="viewEmploymentStats()">View Stats</button>
                    <button class="btn btn-sm btn-secondary" onclick="planTraining()">Plan Training</button>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-coins"></i> Royalty Payment Reconciliation</h5>
                <div class="report-meta">
                    <span class="report-frequency">Monthly</span>
                    <span class="report-priority high">HIGH</span>
                </div>
            </div>
            <div class="card-body">
                <div class="report-details">
                    <div class="detail-item">
                        <span class="label">Next Due:</span>
                        <span class="value">31 July 2025 (33 days)</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Last Submitted:</span>
                        <span class="value">30 June 2025</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Status:</span>
                        <span class="value on-track">Current</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Required Data:</span>
                        <span class="value">Production volumes, commodity prices, royalty calculations</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Submission Method:</span>
                        <span class="value">SWANEEF portal with payment proof</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">June 2025 Amount:</span>
                        <span class="value">SWL 1,248,650</span>
                    </div>
                </div>
                <div class="report-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <span class="progress-text">100% Complete (June)</span>
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm btn-success" onclick="verifyPayment('royalty-june-2025')">Verified</button>
                    <button class="btn btn-sm btn-info" onclick="viewReconciliation('june-2025')">View Details</button>
                    <button class="btn btn-sm btn-secondary" onclick="prepareNext('royalty-july-2025')">Prepare July</button>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-shield-alt"></i> Safety & Health Report</h5>
                <div class="report-meta">
                    <span class="report-frequency">Quarterly</span>
                    <span class="report-priority high">HIGH</span>
                </div>
            </div>
            <div class="card-body">
                <div class="report-details">
                    <div class="detail-item">
                        <span class="label">Next Due:</span>
                        <span class="value">31 July 2025 (33 days)</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Last Submitted:</span>
                        <span class="value">30 April 2025</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Status:</span>
                        <span class="value on-track">In Progress</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Required Data:</span>
                        <span class="value">Incident reports, safety training, health screenings</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Submission Method:</span>
                        <span class="value">Ministry of Labour + Mine Health & Safety</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Q2 Incidents:</span>
                        <span class="value">2 minor, 0 major, 0 fatalities</span>
                    </div>
                </div>
                <div class="report-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                    <span class="progress-text">60% Complete</span>
                </div>
                <div class="report-actions">
                    <button class="btn btn-sm btn-primary" onclick="updateSafetyReport('q2-2025')">Update</button>
                    <button class="btn btn-sm btn-warning" onclick="reviewIncidents('q2-2025')">Review Incidents</button>
                    <button class="btn btn-sm btn-secondary" onclick="scheduleInspections()">Schedule Inspections</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Submission Calendar View -->
    <div class="submission-calendar" id="submission-calendar" style="display: none;">
        <div class="calendar-header">
            <h5><i class="fas fa-calendar-alt"></i> 2025 Regulatory Submission Calendar</h5>
            <button class="btn btn-sm btn-secondary" id="close-calendar-btn">Close</button>
        </div>
        <div class="calendar-grid">
            <div class="calendar-month">
                <h6>June 2025</h6>
                <div class="calendar-items">
                    <div class="calendar-item urgent">
                        <span class="date">30th</span>
                        <span class="item">SRA Quarterly Return</span>
                    </div>
                </div>
            </div>
            <div class="calendar-month">
                <h6>July 2025</h6>
                <div class="calendar-items">
                    <div class="calendar-item warning">
                        <span class="date">31st</span>
                        <span class="item">SWANEEF Annual Report</span>
                    </div>
                    <div class="calendar-item high">
                        <span class="date">31st</span>
                        <span class="item">Royalty Reconciliation</span>
                    </div>
                    <div class="calendar-item high">
                        <span class="date">31st</span>
                        <span class="item">Safety & Health Report</span>
                    </div>
                </div>
            </div>
            <div class="calendar-month">
                <h6>August 2025</h6>
                <div class="calendar-items">
                    <div class="calendar-item normal">
                        <span class="date">31st</span>
                        <span class="item">Environmental Report</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Entity Compliance Status -->
<div class="section-header">
    <h4><i class="fas fa-building"></i> Entity Compliance Status</h4>
    <div class="entity-actions">
        <select id="compliance-filter" class="form-select btn-sm">
            <option value="all">All Entities</option>
            <option value="excellent">Excellent (90%+)</option>
            <option value="good">Good (80-89%)</option>
            <option value="needs-improvement">Needs Improvement (<80%)</option>
        </select>
        <button class="btn btn-info btn-sm" id="export-compliance-btn">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
</div>

<div class="charts-grid">
    <!-- Excellent Compliance Entities -->
    <div class="card border-success">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-star"></i> Excellent Compliance (90%+)</h5>
            <span class="badge bg-white text-success">2 Entities</span>
        </div>
        <div class="card-body">
            <!-- Kwalini Quarry -->
            <div class="entity-item border-bottom pb-3 mb-3">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h6 class="mb-1 fw-bold">Kwalini Quarry</h6>
                        <div class="score-display">
                            <span class="score-badge bg-success">95%</span>
                            <small class="text-muted">Last audit: Jan 15, 2025</small>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="permits-status">
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-certificate"></i> KQ-ML-2023-001
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-building"></i> SRA-2023-0045
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge valid">
                                <i class="fas fa-leaf"></i> SEA-EIA-2024-012
                                <small class="text-success">Valid</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-end">
                        <div class="entity-actions">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewComplianceDetails('KQ')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="downloadAuditReport('KQ')">
                                <i class="fas fa-download"></i> Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ngwenya Mine -->
            <div class="entity-item">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h6 class="mb-1 fw-bold">Ngwenya Mine</h6>
                        <div class="score-display">
                            <span class="score-badge bg-success">92%</span>
                            <small class="text-muted">Last audit: Jan 25, 2025</small>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="permits-status">
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-certificate"></i> NM-ML-2024-007
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-building"></i> SRA-2024-0012
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge valid">
                                <i class="fas fa-leaf"></i> SEA-EIA-2024-034
                                <small class="text-success">Valid</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-end">
                        <div class="entity-actions">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewComplianceDetails('NM')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="certifyCompliance('NM')">
                                <i class="fas fa-certificate"></i> Certify
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Good Compliance Entities -->
    <div class="card border-warning">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0"><i class="fas fa-check-circle"></i> Good Compliance (80-89%)</h5>
            <span class="badge bg-white text-warning">1 Entity</span>
        </div>
        <div class="card-body">
            <!-- Maloma Colliery -->
            <div class="entity-item">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h6 class="mb-1 fw-bold">Maloma Colliery</h6>
                        <div class="score-display">
                            <span class="score-badge bg-warning text-dark">87%</span>
                            <small class="text-muted">Last audit: Jan 20, 2025</small>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="permits-status">
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-certificate"></i> MC-ML-2022-034
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-building"></i> SRA-2022-0198
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge expiring">
                                <i class="fas fa-leaf"></i> SEA-EIA-2023-089
                                <small class="text-warning">Expiring Soon</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-end">
                        <div class="entity-actions">
                            <button class="btn btn-outline-info btn-sm mb-1" onclick="viewComplianceDetails('MC')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="scheduleAudit('MC')">
                                <i class="fas fa-calendar"></i> Schedule Audit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Needs Attention Entities -->
    <div class="card border-danger">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Needs Attention (<80%)</h5>
            <span class="badge bg-white text-danger">1 Entity</span>
        </div>
        <div class="card-body">
            <!-- Bulembu Asbestos Mine -->
            <div class="entity-item">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h6 class="mb-1 fw-bold">Bulembu Asbestos Mine</h6>
                        <div class="score-display">
                            <span class="score-badge bg-danger">73%</span>
                            <small class="text-muted">Last audit: Feb 10, 2025</small>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="permits-status">
                            <div class="permit-badge expiring mb-1">
                                <i class="fas fa-certificate"></i> BA-ML-2021-156
                                <small class="text-warning">Expiring</small>
                            </div>
                            <div class="permit-badge valid mb-1">
                                <i class="fas fa-building"></i> SRA-2021-0289
                                <small class="text-success">Valid</small>
                            </div>
                            <div class="permit-badge expired">
                                <i class="fas fa-leaf"></i> SEA-EIA-2022-167
                                <small class="text-danger">Expired</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-end">
                        <div class="entity-actions">
                            <button class="btn btn-warning btn-sm mb-1" onclick="viewComplianceDetails('BA')">
                                <i class="fas fa-exclamation-triangle"></i> Urgent Review
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="escalateCompliance('BA')">
                                <i class="fas fa-arrow-up"></i> Escalate
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeComplianceFeatures();
});

function initializeComplianceFeatures() {
    // Initialize dynamic deadline calculation
    updateDynamicDeadlines();
    
    // Set up event listeners
    setupEventListeners();
    
    // Initialize filters
    initializeFilters();
    
    // Start deadline monitoring
    startDeadlineMonitoring();
    
    // Update compliance metrics
    updateComplianceMetrics();
}

function setupEventListeners() {
    // Main action buttons
    const complianceCheckBtn = document.getElementById('run-compliance-check-btn');
    const generateReportBtn = document.getElementById('generate-compliance-report-btn');
    const taxSubmissionBtn = document.getElementById('tax-submission-btn');
    
    if (complianceCheckBtn) {
        complianceCheckBtn.addEventListener('click', runComplianceCheck);
    }
    
    if (generateReportBtn) {
        generateReportBtn.addEventListener('click', generateComplianceReport);
    }
    
    if (taxSubmissionBtn) {
        taxSubmissionBtn.addEventListener('click', startTaxSubmission);
    }
    
    // Multi-jurisdictional view
    const multiJurisdictionalBtn = document.getElementById('multi-jurisdictional-btn');
    const closeMultiJurisdictionalBtn = document.getElementById('close-multi-jurisdictional-btn');
    
    if (multiJurisdictionalBtn) {
        multiJurisdictionalBtn.addEventListener('click', showMultiJurisdictionalView);
    }
    
    if (closeMultiJurisdictionalBtn) {
        closeMultiJurisdictionalBtn.addEventListener('click', hideMultiJurisdictionalView);
    }
    
    // Jurisdiction tabs
    const jurisdictionTabs = document.querySelectorAll('.jurisdiction-tab');
    jurisdictionTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            switchJurisdiction(this.dataset.jurisdiction);
        });
    });
    
    // Refresh deadlines
    const refreshDeadlinesBtn = document.getElementById('refresh-deadlines-btn');
    if (refreshDeadlinesBtn) {
        refreshDeadlinesBtn.addEventListener('click', refreshDeadlines);
    }
    
    // Submission calendar
    const submissionCalendarBtn = document.getElementById('submission-calendar-btn');
    const closeCalendarBtn = document.getElementById('close-calendar-btn');
    
    if (submissionCalendarBtn) {
        submissionCalendarBtn.addEventListener('click', showSubmissionCalendar);
    }
    
    if (closeCalendarBtn) {
        closeCalendarBtn.addEventListener('click', hideSubmissionCalendar);
    }
    
    // Filters
    const alertFilter = document.getElementById('alert-filter');
    const complianceFilter = document.getElementById('compliance-filter');
    const permitFilter = document.getElementById('permit-filter');
    
    if (alertFilter) {
        alertFilter.addEventListener('change', filterAlerts);
    }
    
    if (complianceFilter) {
        complianceFilter.addEventListener('change', filterComplianceTable);
    }
    
    if (permitFilter) {
        permitFilter.addEventListener('change', filterPermits);
    }
}

function updateDynamicDeadlines() {
    const today = new Date();
    const alertItems = document.querySelectorAll('.alert-item[data-days]');
    
    alertItems.forEach(item => {
        const daysUntilDue = parseInt(item.dataset.days);
        const daysRemainingSpan = item.querySelector('.days-remaining');
        
        if (daysRemainingSpan) {
            if (daysUntilDue < 0) {
                daysRemainingSpan.textContent = `${Math.abs(daysUntilDue)} days overdue`;
                item.classList.add('overdue');
            } else if (daysUntilDue === 0) {
                daysRemainingSpan.textContent = 'Due today';
                item.classList.add('due-today');
            } else if (daysUntilDue === 1) {
                daysRemainingSpan.textContent = 'Due tomorrow';
                item.classList.add('urgent');
            } else {
                daysRemainingSpan.textContent = `${daysUntilDue} days`;
            }
        }
        
        // Update alert priority based on days remaining
        if (daysUntilDue <= 0) {
            item.className = item.className.replace(/\b(urgent|warning|info|success)\b/g, 'overdue');
        } else if (daysUntilDue <= 3) {
            item.className = item.className.replace(/\b(warning|info|success)\b/g, 'urgent');
        } else if (daysUntilDue <= 7) {
            item.className = item.className.replace(/\b(info|success)\b/g, 'warning');
        }
    });
    
    updateAlertSummary();
}

function updateAlertSummary() {
    const alertItems = document.querySelectorAll('.alert-item');
    let urgentCount = 0, warningCount = 0, infoCount = 0, completedCount = 0;
    
    alertItems.forEach(item => {
        if (item.classList.contains('urgent') || item.classList.contains('overdue')) {
            urgentCount++;
        } else if (item.classList.contains('warning')) {
            warningCount++;
        } else if (item.classList.contains('info')) {
            infoCount++;
        } else if (item.classList.contains('success')) {
            completedCount++;
        }
    });
    
    const urgentCountEl = document.getElementById('urgent-count');
    const warningCountEl = document.getElementById('warning-count');
    const infoCountEl = document.getElementById('info-count');
    const completedCountEl = document.getElementById('completed-count');
    
    if (urgentCountEl) urgentCountEl.textContent = urgentCount;
    if (warningCountEl) warningCountEl.textContent = warningCount;
    if (infoCountEl) infoCountEl.textContent = infoCount;
    if (completedCountEl) completedCountEl.textContent = completedCount;
}

function startDeadlineMonitoring() {
    // Update deadlines every hour
    setInterval(updateDynamicDeadlines, 3600000);
    
    // Check for new urgent items every 15 minutes
    setInterval(checkUrgentDeadlines, 900000);
}

function checkUrgentDeadlines() {
    const urgentItems = document.querySelectorAll('.alert-item.urgent, .alert-item.overdue');
    
    urgentItems.forEach(item => {
        const alertContent = item.querySelector('.alert-content strong').textContent;
        const daysRemaining = item.dataset.days;
        
        if (daysRemaining <= 1 && !item.dataset.notificationSent) {
            showUrgentNotification(alertContent, daysRemaining);
            item.dataset.notificationSent = 'true';
        }
    });
}

function showUrgentNotification(alertContent, daysRemaining) {
    if (window.notificationManager) {
        const message = daysRemaining <= 0 ? 
            `OVERDUE: ${alertContent}` : 
            `URGENT: ${alertContent} due ${daysRemaining === '0' ? 'today' : 'tomorrow'}`;
        window.notificationManager.show(message, 'error', 10000);
    }
}

function runComplianceCheck() {
    if (window.notificationManager) {
        window.notificationManager.show('Running comprehensive compliance check...', 'info');
    }
    
    // Simulate compliance check process
    setTimeout(() => {
        const complianceScore = calculateComplianceScore();
        updateComplianceScore(complianceScore);
        
        if (window.notificationManager) {
            window.notificationManager.show(`Compliance check completed. Overall score: ${complianceScore}%`, 'success');
        }
    }, 3000);
}

function calculateComplianceScore() {
    // Calculate based on permits, submissions, and alerts
    const validPermits = document.querySelectorAll('.permit-status.valid').length;
    const totalPermits = document.querySelectorAll('.permit-status').length;
    const overdueAlerts = document.querySelectorAll('.alert-item.overdue').length;
    const urgentAlerts = document.querySelectorAll('.alert-item.urgent').length;
    
    let score = (validPermits / totalPermits) * 100;
    score -= (overdueAlerts * 10); // -10% per overdue item
    score -= (urgentAlerts * 5);   // -5% per urgent item
    
    return Math.max(0, Math.min(100, Math.round(score)));
}

function updateComplianceScore(score) {
    const scoreElement = document.getElementById('overall-compliance-score');
    const statusElement = document.getElementById('compliance-status');
    const progressElement = document.getElementById('compliance-progress');
    
    if (scoreElement) scoreElement.textContent = `${score}%`;
    if (progressElement) progressElement.style.width = `${score}%`;
    
    if (statusElement) {
        if (score >= 90) {
            statusElement.textContent = 'Excellent Compliance';
            statusElement.style.color = 'var(--success-color)';
        } else if (score >= 80) {
            statusElement.textContent = 'Good Compliance';
            statusElement.style.color = 'var(--warning-color)';
        } else {
            statusElement.textContent = 'Needs Improvement';
            statusElement.style.color = 'var(--danger-color)';
        }
    }
}

function generateComplianceReport() {
    if (window.notificationManager) {
        window.notificationManager.show('Generating comprehensive compliance report...', 'info');
    }
    
    setTimeout(() => {
        if (window.notificationManager) {
            window.notificationManager.show('Compliance report generated and saved to Downloads folder', 'success');
        }
    }, 2000);
}

function startTaxSubmission() {
    if (window.notificationManager) {
        window.notificationManager.show('Opening SRA portal for tax submission...', 'info');
    }
    
    // In a real application, this would open the SRA portal
    setTimeout(() => {
        if (window.notificationManager) {
            window.notificationManager.show('SRA portal opened. Please complete your submission.', 'success');
        }
    }, 1500);
}

function showMultiJurisdictionalView() {
    const section = document.getElementById('multi-jurisdictional-section');
    if (section) {
        section.style.display = 'block';
        section.scrollIntoView({ behavior: 'smooth' });
    }
}

function hideMultiJurisdictionalView() {
    const section = document.getElementById('multi-jurisdictional-section');
    if (section) {
        section.style.display = 'none';
    }
}

function switchJurisdiction(jurisdiction) {
    // Update active tab
    document.querySelectorAll('.jurisdiction-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.querySelector(`[data-jurisdiction="${jurisdiction}"]`).classList.add('active');
    
    // Update active panel
    document.querySelectorAll('.jurisdiction-panel').forEach(panel => {
        panel.classList.remove('active');
    });
    
    document.getElementById(`${jurisdiction}-panel`).classList.add('active');
}

function refreshDeadlines() {
    if (window.notificationManager) {
        window.notificationManager.show('Refreshing deadline information...', 'info');
    }
    
    updateDynamicDeadlines();
    
    setTimeout(() => {
        if (window.notificationManager) {
            window.notificationManager.show('Deadlines refreshed successfully', 'success');
        }
    }, 1000);
}

function showSubmissionCalendar() {
    const calendar = document.getElementById('submission-calendar');
    if (calendar) {
        calendar.style.display = 'block';
        calendar.scrollIntoView({ behavior: 'smooth' });
    }
}

function hideSubmissionCalendar() {
    const calendar = document.getElementById('submission-calendar');
    if (calendar) {
        calendar.style.display = 'none';
    }
}

function filterAlerts() {
    const filter = document.getElementById('alert-filter').value;
    const alerts = document.querySelectorAll('.alert-item');
    
    alerts.forEach(alert => {
        let show = true;
        
        switch (filter) {
            case 'urgent':
                show = alert.classList.contains('urgent') || alert.classList.contains('overdue');
                break;
            case 'upcoming':
                const days = parseInt(alert.dataset.days);
                show = days >= 0 && days <= 30;
                break;
            case 'completed':
                show = alert.classList.contains('success');
                break;
            default:
                show = true;
        }
        
        alert.style.display = show ? 'block' : 'none';
    });
}

function filterPermits() {
    const filter = document.getElementById('permit-filter').value;
    const permits = document.querySelectorAll('.permit-item');
    
    permits.forEach(permit => {
        let show = true;
        
        switch (filter) {
            case 'expiring':
                show = permit.classList.contains('expiring');
                break;
            case 'valid':
                show = permit.querySelector('.permit-status.valid') !== null;
                break;
            case 'expired':
                show = permit.classList.contains('expired');
                break;
            default:
                show = true;
        }
        
        permit.style.display = show ? 'flex' : 'none';
    });
}

function filterComplianceTable() {
    const filter = document.getElementById('compliance-filter').value;
    const rows = document.querySelectorAll('#compliance-table tbody tr');
    
    rows.forEach(row => {
        const scoreElement = row.querySelector('.score');
        let show = true;
        
        if (scoreElement && filter !== 'all') {
            const scoreText = scoreElement.textContent;
            const score = parseInt(scoreText.replace('%', ''));
            
            switch (filter) {
                case 'excellent':
                    show = score >= 90;
                    break;
                case 'good':
                    show = score >= 80 && score < 90;
                    break;
                case 'needs-improvement':
                    show = score < 80;
                    break;
            }
        }
        
        row.style.display = show ? '' : 'none';
    });
}

function initializeFilters() {
    filterAlerts();
    filterPermits();
    filterComplianceTable();
}

function updateComplianceMetrics() {
    // Update the last compliance check time
    const lastCheckElement = document.getElementById('last-compliance-check');
    if (lastCheckElement) {
        const now = new Date();
        lastCheckElement.textContent = `${now.toLocaleDateString()} at ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
    }
}

// Compliance action functions
function startTaxPreparation() {
    if (window.notificationManager) {
        window.notificationManager.show('Opening tax preparation wizard...', 'info');
    }
}

function setReminder(type) {
    if (window.notificationManager) {
        window.notificationManager.show('Reminder set successfully', 'success');
    }
}

function startRenewalProcess(type) {
    if (window.notificationManager) {
        window.notificationManager.show(`Starting ${type} renewal process...`, 'info');
    }
}

function viewRequirements(type) {
    if (window.notificationManager) {
        window.notificationManager.show(`Opening ${type} requirements...`, 'info');
    }
}

function viewComplianceDetails(entityCode) {
    if (window.notificationManager) {
        window.notificationManager.show(`Loading compliance details for ${entityCode}...`, 'info');
    }
}

function scheduleAudit(entityCode) {
    if (window.notificationManager) {
        window.notificationManager.show(`Scheduling audit for ${entityCode}...`, 'info');
    }
}

function certifyCompliance(entityCode) {
    if (window.notificationManager) {
        window.notificationManager.show(`Certifying compliance for ${entityCode}...`, 'success');
    }
}

function escalateCompliance(entityCode) {
    if (window.notificationManager) {
        window.notificationManager.show(`Escalating compliance issues for ${entityCode}...`, 'warning');
    }
}

// Initialize on page load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeComplianceFeatures);
} else {
    initializeComplianceFeatures();
}
</script>
