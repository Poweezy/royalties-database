<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporting & Analytics Chart Test</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/tables.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/badges.css">
    <link rel="stylesheet" href="css/utilities.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="royalties.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }
        .test-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
            margin: 0.25rem;
        }
        .test-pass { background: #d4edda; color: #155724; }
        .test-fail { background: #f8d7da; color: #721c24; }
        .test-warning { background: #fff3cd; color: #856404; }
        .chart-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .chart-test-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
        }
        .chart-test-item h4 {
            margin: 0 0 0.5rem 0;
            color: #2d3748;
        }
        .chart-test-canvas {
            width: 100%;
            height: 200px;
            background: white;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
        }
        .test-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🎯 Reporting & Analytics Chart Test</h1>
            <p>Testing chart initialization and canvas element availability</p>
            <div id="test-summary">
                <span id="chart-js-status" class="test-status">Chart.js: Checking...</span>
                <span id="canvas-status" class="test-status">Canvas Elements: Checking...</span>
                <span id="init-status" class="test-status">Initialization: Pending...</span>
            </div>
        </div>

        <div class="chart-test-grid">
            <!-- Test chart containers that should exist in reporting-analytics component -->
            <div class="chart-test-item">
                <h4>Revenue Analytics Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="revenue-analytics-chart"></canvas>
                </div>
                <div id="revenue-analytics-result">Testing...</div>
            </div>

            <div class="chart-test-item">
                <h4>Production Analytics Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="production-analytics-chart"></canvas>
                </div>
                <div id="production-analytics-result">Testing...</div>
            </div>

            <div class="chart-test-item">
                <h4>Revenue Trends Analytics Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="revenue-trends-analytics-chart"></canvas>
                </div>
                <div id="revenue-trends-analytics-result">Testing...</div>
            </div>

            <div class="chart-test-item">
                <h4>Entity Revenue Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="entity-revenue-chart"></canvas>
                </div>
                <div id="entity-revenue-result">Testing...</div>
            </div>

            <div class="chart-test-item">
                <h4>Payment Status Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="payment-status-chart"></canvas>
                </div>
                <div id="payment-status-result">Testing...</div>
            </div>

            <div class="chart-test-item">
                <h4>Collection Efficiency Chart</h4>
                <div class="chart-test-canvas">
                    <canvas id="collection-efficiency-chart"></canvas>
                </div>
                <div id="collection-efficiency-result">Testing...</div>
            </div>
        </div>

        <div id="test-log" class="test-log">
            Chart Test Log:<br>
        </div>
    </div>

    <script>
        // Test logging
        function log(message) {
            const logElement = document.getElementById('test-log');
            logElement.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logElement.scrollTop = logElement.scrollHeight;
            console.log('Chart Test:', message);
        }

        // Test Chart.js availability
        function testChartJS() {
            const status = document.getElementById('chart-js-status');
            if (typeof Chart !== 'undefined') {
                status.textContent = 'Chart.js: Available';
                status.className = 'test-status test-pass';
                log('✓ Chart.js is available');
                return true;
            } else {
                status.textContent = 'Chart.js: Missing';
                status.className = 'test-status test-fail';
                log('✗ Chart.js is not available');
                return false;
            }
        }

        // Test canvas elements
        function testCanvasElements() {
            const status = document.getElementById('canvas-status');
            const canvasIds = [
                'revenue-analytics-chart',
                'production-analytics-chart',
                'revenue-trends-analytics-chart',
                'entity-revenue-chart',
                'payment-status-chart',
                'collection-efficiency-chart'
            ];

            let foundCount = 0;
            canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                    foundCount++;
                    log(`✓ Canvas '${id}' found`);
                } else {
                    log(`✗ Canvas '${id}' NOT found`);
                }
            });

            if (foundCount === canvasIds.length) {
                status.textContent = `Canvas Elements: All ${foundCount} found`;
                status.className = 'test-status test-pass';
                return true;
            } else {
                status.textContent = `Canvas Elements: ${foundCount}/${canvasIds.length} found`;
                status.className = 'test-status test-warning';
                return false;
            }
        }

        // Test chart initialization
        function testChartInitialization() {
            const status = document.getElementById('init-status');
            
            if (typeof Chart === 'undefined') {
                status.textContent = 'Initialization: Chart.js Missing';
                status.className = 'test-status test-fail';
                return;
            }

            let successCount = 0;
            let totalTests = 0;

            // Test Revenue Analytics Chart
            totalTests++;
            try {
                const ctx1 = document.getElementById('revenue-analytics-chart');
                if (ctx1) {
                    new Chart(ctx1, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Revenue (E)',
                                data: [95000, 102000, 98000, 111000, 105000, 117000],
                                borderColor: '#1a365d',
                                backgroundColor: 'rgba(26, 54, 93, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('revenue-analytics-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Revenue Analytics Chart created successfully');
                }
            } catch (error) {
                document.getElementById('revenue-analytics-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Revenue Analytics Chart failed: ' + error.message);
            }

            // Test Production Analytics Chart
            totalTests++;
            try {
                const ctx2 = document.getElementById('production-analytics-chart');
                if (ctx2) {
                    new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: ['Coal', 'Iron Ore', 'Stone', 'Sand', 'Gravel'],
                            datasets: [{
                                label: 'Production Volume',
                                data: [185000, 125000, 95000, 65000, 45000],
                                backgroundColor: ['#1a365d', '#2d5a88', '#4a90c2', '#7ba7cc', '#a8c5e2']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('production-analytics-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Production Analytics Chart created successfully');
                }
            } catch (error) {
                document.getElementById('production-analytics-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Production Analytics Chart failed: ' + error.message);
            }

            // Test Revenue Trends Analytics Chart
            totalTests++;
            try {
                const ctx3 = document.getElementById('revenue-trends-analytics-chart');
                if (ctx3) {
                    new Chart(ctx3, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Revenue Trends',
                                data: [85000, 92000, 88000, 101000, 95000, 107000],
                                borderColor: '#1a365d',
                                backgroundColor: 'rgba(26, 54, 93, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('revenue-trends-analytics-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Revenue Trends Analytics Chart created successfully');
                }
            } catch (error) {
                document.getElementById('revenue-trends-analytics-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Revenue Trends Analytics Chart failed: ' + error.message);
            }

            // Test Entity Revenue Chart
            totalTests++;
            try {
                const ctx4 = document.getElementById('entity-revenue-chart');
                if (ctx4) {
                    new Chart(ctx4, {
                        type: 'doughnut',
                        data: {
                            labels: ['Ngwenya Mine', 'Kwalini Quarry', 'Maloma Colliery', 'Mbabane Quarry'],
                            datasets: [{
                                data: [52500, 33450, 10200, 7500],
                                backgroundColor: ['#1a365d', '#2d5a88', '#4a90c2', '#7ba7cc']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('entity-revenue-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Entity Revenue Chart created successfully');
                }
            } catch (error) {
                document.getElementById('entity-revenue-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Entity Revenue Chart failed: ' + error.message);
            }

            // Test Payment Status Chart
            totalTests++;
            try {
                const ctx5 = document.getElementById('payment-status-chart');
                if (ctx5) {
                    new Chart(ctx5, {
                        type: 'bar',
                        data: {
                            labels: ['Paid', 'Pending', 'Overdue'],
                            datasets: [{
                                data: [65, 25, 10],
                                backgroundColor: ['#38a169', '#d69e2e', '#e53e3e']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('payment-status-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Payment Status Chart created successfully');
                }
            } catch (error) {
                document.getElementById('payment-status-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Payment Status Chart failed: ' + error.message);
            }

            // Test Collection Efficiency Chart
            totalTests++;
            try {
                const ctx6 = document.getElementById('collection-efficiency-chart');
                if (ctx6) {
                    new Chart(ctx6, {
                        type: 'line',
                        data: {
                            labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                            datasets: [{
                                label: 'Collection Rate (%)',
                                data: [88, 91, 92, 94],
                                borderColor: '#38a169',
                                backgroundColor: 'rgba(56, 161, 105, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    successCount++;
                    document.getElementById('collection-efficiency-result').innerHTML = '<span style="color: green;">✓ Created</span>';
                    log('✓ Collection Efficiency Chart created successfully');
                }
            } catch (error) {
                document.getElementById('collection-efficiency-result').innerHTML = '<span style="color: red;">✗ Failed</span>';
                log('✗ Collection Efficiency Chart failed: ' + error.message);
            }

            // Update status
            if (successCount === totalTests) {
                status.textContent = `Initialization: All ${successCount} charts created`;
                status.className = 'test-status test-pass';
                log(`🎉 All charts initialized successfully: ${successCount}/${totalTests}`);
            } else {
                status.textContent = `Initialization: ${successCount}/${totalTests} charts created`;
                status.className = 'test-status test-warning';
                log(`⚠️ Some charts failed: ${successCount}/${totalTests} successful`);
            }
        }

        // Run all tests
        function runTests() {
            log('Starting Reporting & Analytics Chart Tests...');
            
            setTimeout(() => {
                const chartJSAvailable = testChartJS();
                const canvasElementsOK = testCanvasElements();
                
                if (chartJSAvailable && canvasElementsOK) {
                    setTimeout(() => {
                        testChartInitialization();
                    }, 500);
                } else {
                    const status = document.getElementById('init-status');
                    status.textContent = 'Initialization: Prerequisites Failed';
                    status.className = 'test-status test-fail';
                }
            }, 100);
        }

        // Start tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
