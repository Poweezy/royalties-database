<div class="page-header">
    <div class="page-title">
        <h1>ðŸ“Š Reporting & Analytics</h1>
        <p>Generate comprehensive reports and view detailed analytics</p>
    </div>
    <div class="page-actions">
        <button class="btn btn-info" id="refresh-analytics-btn">
            <i class="fas fa-sync-alt"></i> Refresh Data
        </button>
        <button class="btn btn-success" id="generate-report-btn">
            <i class="fas fa-file-chart-column"></i> Generate Report
        </button>
        <button class="btn btn-secondary" id="export-analytics-btn">
            <i class="fas fa-download"></i> Export Analytics
        </button>
    </div>
</div>

<!-- Quick Stats -->
<div class="charts-grid" id="analytics-stats">
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-chart-line"></i> Revenue Growth</h3>
        </div>
        <div class="card-body">
            <p id="revenue-growth">+15.2%</p>
            <small class="trend-positive">
                <i class="fas fa-arrow-up"></i> vs last quarter
            </small>
            <div class="mini-progress">
                <div class="progress-bar" style="width: 75%;"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-coins"></i> Collection Rate</h3>
        </div>
        <div class="card-body">
            <p id="collection-rate">92.5%</p>
            <small class="trend-positive">
                <i class="fas fa-check"></i> Above target (90%)
            </small>
            <div class="mini-progress">
                <div class="progress-bar" style="width: 92.5%;"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-clock"></i> Avg. Payment Time</h3>
        </div>
        <div class="card-body">
            <p id="avg-payment-time">18 days</p>
            <small class="trend-positive">
                <i class="fas fa-arrow-down"></i> 3 days faster
            </small>
            <div class="mini-progress">
                <div class="progress-bar" style="width: 60%;"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Overdue Amount</h3>
        </div>
        <div class="card-body">
            <p id="overdue-amount">E 45,250</p>
            <small class="trend-negative">
                <i class="fas fa-arrow-up"></i> Needs attention
            </small>
            <div class="mini-progress">
                <div class="progress-bar" style="width: 25%; background: var(--danger-color);"></div>
            </div>
        </div>
    </div>
</div>

<!-- Report Generation Section -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-file-alt"></i> Report Generator</h5>
    </div>
    <div class="card-body">
        <div class="grid-4">
            <div class="form-group">
                <label for="report-type">
                    <i class="fas fa-list"></i> Report Type
                </label>
                <select id="report-type">
                    <option value="monthly">Monthly Summary</option>
                    <option value="quarterly">Quarterly Report</option>
                    <option value="annual">Annual Report</option>
                    <option value="entity">Entity-wise Report</option>
                    <option value="mineral">Mineral-wise Report</option>
                    <option value="compliance">Compliance Report</option>
                    <option value="overdue">Overdue Payments</option>
                    <option value="custom">Custom Report</option>
                </select>
            </div>

            <div class="form-group">
                <label for="report-period">
                    <i class="fas fa-calendar"></i> Period
                </label>
                <select id="report-period">
                    <option value="current-month">Current Month</option>
                    <option value="last-month">Last Month</option>
                    <option value="current-quarter">Current Quarter</option>
                    <option value="last-quarter">Last Quarter</option>
                    <option value="current-year">Current Year</option>
                    <option value="last-year">Last Year</option>
                    <option value="custom-range">Custom Range</option>
                </select>
            </div>

            <div class="form-group">
                <label for="report-format">
                    <i class="fas fa-file-export"></i> Format
                </label>
                <select id="report-format">
                    <option value="pdf">PDF Document</option>
                    <option value="excel">Excel Spreadsheet</option>
                    <option value="csv">CSV File</option>
                    <option value="html">HTML Report</option>
                </select>
            </div>

            <div class="form-group">
                <label for="report-detail">
                    <i class="fas fa-layer-group"></i> Detail Level
                </label>
                <select id="report-detail">
                    <option value="summary">Summary Only</option>
                    <option value="detailed">Detailed</option>
                    <option value="comprehensive">Comprehensive</option>
                </select>
            </div>
        </div>

        <div class="page-actions" style="margin-top: 1.5rem;">
            <button class="btn btn-secondary" id="preview-report-btn">
                <i class="fas fa-eye"></i> Preview Report
            </button>
            <button class="btn btn-warning" id="schedule-report-btn">
                <i class="fas fa-clock"></i> Schedule Report
            </button>
            <button class="btn btn-success" id="generate-now-btn">
                <i class="fas fa-download"></i> Generate Now
            </button>
        </div>
    </div>
</div>

<!-- Analytics Charts -->
<div class="charts-grid">
    <div class="card">
        <div class="chart-header">
            <h5><i class="fas fa-chart-area"></i> Revenue Trends</h5>
            <div class="chart-controls">
                <button class="chart-btn active" data-period="6months">6M</button>
                <button class="chart-btn" data-period="1year">1Y</button>
                <button class="chart-btn" data-period="2years">2Y</button>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="revenue-trends-analytics-chart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="chart-header">
            <h5><i class="fas fa-chart-pie"></i> Revenue by Entity</h5>
        </div>
        <div class="chart-container">
            <canvas id="entity-revenue-chart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="chart-header">
            <h5><i class="fas fa-chart-bar"></i> Payment Status Distribution</h5>
        </div>
        <div class="chart-container">
            <canvas id="payment-status-chart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="chart-header">
            <h5><i class="fas fa-chart-line"></i> Collection Efficiency</h5>
        </div>
        <div class="chart-container">
            <canvas id="collection-efficiency-chart"></canvas>
        </div>
    </div>
</div>

<!-- Detailed Analytics Tables -->
<div class="charts-grid">
    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-table"></i> Top Performing Entities</h5>
        </div>
        <div class="card-body">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Entity</th>
                            <th>Total Revenue</th>
                            <th>Growth</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ngwenya Mine</td>
                            <td>E 52,500</td>
                            <td><span class="trend-positive">+12%</span></td>
                            <td><span class="status-badge paid">Excellent</span></td>
                        </tr>
                        <tr>
                            <td>Kwalini Quarry</td>
                            <td>E 33,450</td>
                            <td><span class="trend-positive">+8%</span></td>
                            <td><span class="status-badge active">Good</span></td>
                        </tr>
                        <tr>
                            <td>Maloma Colliery</td>
                            <td>E 10,200</td>
                            <td><span class="trend-stable">0%</span></td>
                            <td><span class="status-badge pending">Average</span></td>
                        </tr>
                        <tr>
                            <td>Mbabane Quarry</td>
                            <td>E 7,500</td>
                            <td><span class="trend-negative">-5%</span></td>
                            <td><span class="status-badge overdue">Needs Attention</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5><i class="fas fa-gem"></i> Mineral Performance</h5>
        </div>
        <div class="card-body">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Mineral</th>
                            <th>Volume</th>
                            <th>Revenue</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Iron Ore</td>
                            <td>2,100 tonnes</td>
                            <td>E 52,500</td>
                            <td><span class="trend-positive">â†‘ 15%</span></td>
                        </tr>
                        <tr>
                            <td>Quarried Stone</td>
                            <td>2,230 mÂ³</td>
                            <td>E 33,450</td>
                            <td><span class="trend-positive">â†‘ 8%</span></td>
                        </tr>
                        <tr>
                            <td>Coal</td>
                            <td>850 tonnes</td>
                            <td>E 10,200</td>
                            <td><span class="trend-stable">â†’ 0%</span></td>
                        </tr>
                        <tr>
                            <td>Gravel</td>
                            <td>750 mÂ³</td>
                            <td>E 7,500</td>
                            <td><span class="trend-negative">â†“ 5%</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Key Performance Indicators -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-tachometer-alt"></i> Key Performance Indicators</h5>
    </div>
    <div class="card-body">
        <div class="charts-grid">
            <div class="kpi-item">
                <div class="kpi-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="kpi-content">
                    <h6>Total Revenue YTD</h6>
                    <p>E 1,247,850</p>
                    <small class="trend-positive">+18.5% vs last year</small>
                </div>
            </div>

            <div class="kpi-item">
                <div class="kpi-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="kpi-content">
                    <h6>Compliance Rate</h6>
                    <p>94.2%</p>
                    <small class="trend-positive">+2.1% improvement</small>
                </div>
            </div>

            <div class="kpi-item">
                <div class="kpi-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="kpi-content">
                    <h6>Avg Collection Time</h6>
                    <p>18 days</p>
                    <small class="trend-positive">3 days faster</small>
                </div>
            </div>

            <div class="kpi-item">
                <div class="kpi-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="kpi-content">
                    <h6>Growth Rate</h6>
                    <p>15.2%</p>
                    <small class="trend-positive">Above target (12%)</small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* KPI Styles */
.kpi-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--background-white);
    border-radius: var(--border-radius);
    border: 1px solid var(--border-color);
}

.kpi-icon {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gradient-primary);
    color: var(--text-inverse);
    border-radius: 50%;
    font-size: 1.25rem;
}

.kpi-content h6 {
    margin: 0 0 0.25rem 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.kpi-content p {
    margin: 0 0 0.25rem 0;
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--text-primary);
}

.kpi-content small {
    font-size: 0.75rem;
    font-weight: 500;
}
</style>

<script>
// Initialize analytics functionality when component loads
document.addEventListener('DOMContentLoaded', function() {
    if (window.royaltiesApp) {
        setTimeout(() => {
            initializeAnalyticsCharts();
            setupAnalyticsEventListeners();
        }, 500);
    }
});

function initializeAnalyticsCharts() {
    if (typeof Chart === 'undefined') {
        console.warn('Chart.js not loaded for analytics');
        return;
    }

    // Revenue Trends Chart
    const revenueCtx = document.getElementById('revenue-trends-analytics-chart');
    if (revenueCtx) {
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Revenue (E)',
                    data: [85000, 92000, 88000, 101000, 95000, 107000, 112000, 98000, 105000, 118000, 125000, 132000],
                    borderColor: '#1a365d',
                    backgroundColor: 'rgba(26, 54, 93, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'E' + (value/1000) + 'k';
                            }
                        }
                    }
                }
            }
        });
    }

    // Entity Revenue Chart
    const entityCtx = document.getElementById('entity-revenue-chart');
    if (entityCtx) {
        new Chart(entityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ngwenya Mine', 'Kwalini Quarry', 'Maloma Colliery', 'Mbabane Quarry', 'Sidvokodvo Quarry'],
                datasets: [{
                    data: [52500, 33450, 10200, 7500, 4000],
                    backgroundColor: ['#1a365d', '#2d5a88', '#4a90c2', '#7ba7cc', '#a8c5e2']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { fontSize: 10 } }
                }
            }
        });
    }

    // Payment Status Chart
    const statusCtx = document.getElementById('payment-status-chart');
    if (statusCtx) {
        new Chart(statusCtx, {
            type: 'bar',
            data: {
                labels: ['Paid', 'Pending', 'Overdue'],
                datasets: [{
                    data: [65, 25, 10],
                    backgroundColor: ['#38a169', '#d69e2e', '#e53e3e']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }

    // Collection Efficiency Chart
    const efficiencyCtx = document.getElementById('collection-efficiency-chart');
    if (efficiencyCtx) {
        new Chart(efficiencyCtx, {
            type: 'line',
            data: {
                labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                datasets: [{
                    label: 'Collection Rate (%)',
                    data: [88, 91, 92, 94],
                    borderColor: '#38a169',
                    backgroundColor: 'rgba(56, 161, 105, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        min: 80,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }
}

function setupAnalyticsEventListeners() {
    // Generate Report button
    const generateBtn = document.getElementById('generate-now-btn');
    if (generateBtn) {
        generateBtn.addEventListener('click', function() {
            const reportType = document.getElementById('report-type').value;
            const format = document.getElementById('report-format').value;
            
            if (window.notificationManager) {
                window.notificationManager.show(`Generating ${reportType} report in ${format.toUpperCase()} format...`, 'info');
                
                setTimeout(() => {
                    window.notificationManager.show('Report generated successfully!', 'success');
                }, 2000);
            }
        });
    }

    // Preview Report button
    const previewBtn = document.getElementById('preview-report-btn');
    if (previewBtn) {
        previewBtn.addEventListener('click', function() {
            if (window.notificationManager) {
                window.notificationManager.show('Report preview will open in a new window', 'info');
            }
        });
    }

    // Schedule Report button
    const scheduleBtn = document.getElementById('schedule-report-btn');
    if (scheduleBtn) {
        scheduleBtn.addEventListener('click', function() {
            if (window.notificationManager) {
                window.notificationManager.show('Report scheduling feature will be implemented', 'info');
            }
        });
    }

    // Refresh Analytics button
    const refreshBtn = document.getElementById('refresh-analytics-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            if (window.notificationManager) {
                window.notificationManager.show('Analytics data refreshed', 'success');
            }
            initializeAnalyticsCharts();
        });
    }

    // Export Analytics button
    const exportBtn = document.getElementById('export-analytics-btn');
    if (exportBtn) {
        exportBtn.addEventListener('click', function() {
            if (window.notificationManager) {
                window.notificationManager.show('Exporting analytics data...', 'info');
                
                setTimeout(() => {
                    window.notificationManager.show('Analytics exported to Excel file', 'success');
                }, 1500);
            }
        });
    }
}
</script>
